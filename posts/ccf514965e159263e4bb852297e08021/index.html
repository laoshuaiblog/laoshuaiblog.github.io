<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>我的Android播放器封装经验 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/ccf514965e159263e4bb852297e08021/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="我的Android播放器封装经验">
  <meta property="og:description" content="近段时间，电视家不能用了，好吧，自己开发一个APP。其实也不是开发，而是基于现有的播放器核心自己封装一个，只要能够非常方便操作观看电视就好。
当然，前提是要有节目源，这个我早已完成：通过OpenWRT用udpxy将IPTV信号转换为HTTP单播协议融合到了家里的局域网中。
基于哪一款播放器核心来封装，其实有很多选择：VLC、ExoPlayer、IjkPlayer、安卓自带的控件VideoView。
我首先使用的是VLC，因为这款播放器我用得最多，在Windows平台上，我也用C#基于它封装了一个播放器，平时坐在电脑前一边做事，一边通过这个封装的播放器看看电视。
封装的关键步骤为：
1、按常规步骤新建android项目，Empty View类型的项目就好。
2、为项目添加VLC支持库。修改 build.gradle.kts 文件，在依赖项中添加：
dependencies {
implementation(&#34;org.videolan.android:libvlc-all:3.5.1&#34;)
……
}
这里的版本号可以适时修改。
3、给项目APP授予网络访问的权限。在AndroidManifest.xml中添加：
&amp;lt;uses-permission android:name=&#34;android.permission.INTERNET&#34; /&amp;gt;
4、添加播放器的显示组件。在APP主界面的视图配置文件activity_main.xml中添加：
&amp;lt;SurfaceView
android:id=&#34;@&#43;id/surfaceView&#34;
android:layout_width=&#34;match_parent&#34;
android:layout_height=&#34;match_parent&#34; /&amp;gt;
5、声明初始化基于VLC的播放器核心组件，并将视频显示关联到控件：
ArrayList&amp;lt;String&amp;gt; options = new ArrayList&amp;lt;&amp;gt;();
options.add(&#34;--rtsp-tcp&#34;);
options.add(&#34;--live-caching=200&#34;);
LibVLC libVLC = new LibVLC(this, options);
MediaPlayer mediaPlayer = new MediaPlayer(libVLC);
SurfaceView surfaceView = findViewById(R.id.surfaceView);
mediaPlayer.getVLCVout().setVideoView(surfaceView);
mediaPlayer.getVLCVout().setWindowSize(surfaceView.getWidth(), surfaceView.getHeight());
surfaceView.addOnLayoutChangeListener(new View.OnLayoutChangeListener() {
@Override
public void onLayoutChange(View view, int left, int top, int right, int bottom, int oldLeft, int oldTop, int oldRight, int oldBottom) {">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-07T14:22:04+08:00">
    <meta property="article:modified_time" content="2023-12-07T14:22:04+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">我的Android播放器封装经验</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;text-align:justify;">近段时间，电视家不能用了，好吧，自己开发一个APP。其实也不是开发，而是基于现有的播放器核心自己封装一个，只要能够非常方便操作观看电视就好。</p> 
<p style="margin-left:0;text-align:justify;">当然，前提是要有节目源，这个我早已完成：通过OpenWRT用udpxy将IPTV信号转换为HTTP单播协议融合到了家里的局域网中。</p> 
<p style="margin-left:0;text-align:justify;">基于哪一款播放器核心来封装，其实有很多选择：VLC、ExoPlayer、IjkPlayer、安卓自带的控件VideoView。</p> 
<p style="margin-left:0;text-align:justify;">我首先使用的是VLC，因为这款播放器我用得最多，在Windows平台上，我也用C#基于它封装了一个播放器，平时坐在电脑前一边做事，一边通过这个封装的播放器看看电视。</p> 
<p style="margin-left:0;text-align:justify;">封装的关键步骤为：</p> 
<p style="margin-left:0;text-align:justify;">1、按常规步骤新建android项目，Empty View类型的项目就好。</p> 
<p style="margin-left:0;text-align:justify;">2、为项目添加VLC支持库。修改 build.gradle.kts 文件，在依赖项中添加：</p> 
<p style="margin-left:0;text-align:justify;">dependencies {<!-- --></p> 
<p style="margin-left:0;text-align:justify;">    implementation("org.videolan.android:libvlc-all:3.5.1")</p> 
<p style="margin-left:0;text-align:justify;">    ……</p> 
<p style="margin-left:0;text-align:justify;">}</p> 
<p style="margin-left:0;text-align:justify;">这里的版本号可以适时修改。</p> 
<p style="margin-left:0;text-align:justify;">3、给项目APP授予网络访问的权限。在AndroidManifest.xml中添加：</p> 
<p style="margin-left:0;text-align:justify;">&lt;uses-permission android:name="android.permission.INTERNET" /&gt;</p> 
<p style="margin-left:0;text-align:justify;">4、添加播放器的显示组件。在APP主界面的视图配置文件activity_main.xml中添加：</p> 
<p style="margin-left:0;text-align:justify;">&lt;SurfaceView</p> 
<p style="margin-left:0;text-align:justify;">        android:id="@+id/surfaceView"</p> 
<p style="margin-left:0;text-align:justify;">        android:layout_width="match_parent"</p> 
<p style="margin-left:0;text-align:justify;">        android:layout_height="match_parent" /&gt;</p> 
<p style="margin-left:0;text-align:justify;">5、声明初始化基于VLC的播放器核心组件，并将视频显示关联到控件：</p> 
<p style="margin-left:0;text-align:justify;">        ArrayList&lt;String&gt; options = new ArrayList&lt;&gt;();</p> 
<p style="margin-left:0;text-align:justify;">        options.add("--rtsp-tcp");</p> 
<p style="margin-left:0;text-align:justify;">        options.add("--live-caching=200");</p> 
<p style="margin-left:0;text-align:justify;">        LibVLC libVLC = new LibVLC(this, options);</p> 
<p style="margin-left:0;text-align:justify;">        MediaPlayer mediaPlayer = new MediaPlayer(libVLC);</p> 
<p style="margin-left:0;text-align:justify;">        SurfaceView surfaceView = findViewById(R.id.surfaceView);</p> 
<p style="margin-left:0;text-align:justify;">        mediaPlayer.getVLCVout().setVideoView(surfaceView);</p> 
<p style="margin-left:0;text-align:justify;">        mediaPlayer.getVLCVout().setWindowSize(surfaceView.getWidth(), surfaceView.getHeight());</p> 
<p style="margin-left:0;text-align:justify;">        surfaceView.addOnLayoutChangeListener(new View.OnLayoutChangeListener() {<!-- --></p> 
<p style="margin-left:0;text-align:justify;">            @Override</p> 
<p style="margin-left:0;text-align:justify;">            public void onLayoutChange(View view, int left, int top, int right, int bottom, int oldLeft, int oldTop, int oldRight, int oldBottom) {<!-- --></p> 
<p style="margin-left:0;text-align:justify;">                mediaPlayer.getVLCVout().setWindowSize(right-left, bottom-top);</p> 
<p style="margin-left:0;text-align:justify;">            }</p> 
<p style="margin-left:0;text-align:justify;">        });</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">        mediaPlayer.getVLCVout().attachViews();</p> 
<p style="margin-left:0;text-align:justify;">6、播放网络视频：</p> 
<p style="margin-left:0;text-align:justify;">    public void play(String url){<!-- --></p> 
<p style="margin-left:0;text-align:justify;">        if(libVLC != null &amp;&amp; mediaPlayer != null){<!-- --></p> 
<p style="margin-left:0;text-align:justify;">            Media media = new Media(libVLC, Uri.parse(url));</p> 
<p style="margin-left:0;text-align:justify;">            mediaPlayer.setMedia(media);</p> 
<p style="margin-left:0;text-align:justify;">            media.release();</p> 
<p style="margin-left:0;text-align:justify;">            mediaPlayer.play();</p> 
<p style="margin-left:0;text-align:justify;">        }</p> 
<p style="margin-left:0;text-align:justify;">    }</p> 
<p style="margin-left:0;text-align:justify;">通过以上关键步骤，即可正常播放局域网中IPTV的单播信号。最初在我的AS开发环境的模拟器和我备用手机上测试时，一切正常，换台也很快。但程序安装到我的小米电视后，播放效果就不尽人意了。图像有点灰，部分频道播放正常，但CCTV3、6、湖南卫视、经视等频道只有声音，图像无法正常显示，尝试过各种办法也没有解决。最后，我将VLC原版程序安装到我的小米电视后，问题依旧，那就说明不是我封装的问题了。可能是因为我的小米电视太老旧，2014年的产品，API还是18。</p> 
<p style="margin-left:0;text-align:justify;">我不得不尝试换一种播放器，然后开始尝试ExoPlayer，封装的步骤与VLC的类似，甚至更简单，在模拟器和手机上测试时，所有频道都能正常播放，但大部分频道无声音，CCTV3、6、湖南卫视、经视等频道却能正常播放。尝试安装到小米电视时，又遇到问题，在编译minSDK=18的APP版本时，总是报错，一直没办法解决。</p> 
<p style="margin-left:0;text-align:justify;">然后，我又尝试其他的播放器，如IjkPlayer，但更容易遇到一些无法解决的问题。在不停的尝试中，也试过VideoView，这个Android自带的控件，代码更简单，但在模拟器上一直没办法播放。总是显示“无法播放此视频“。在日志输出中，显示：</p> 
<p style="margin-left:0;text-align:justify;">mapper 4.x is not supported</p> 
<p style="margin-left:0;text-align:justify;">一次偶然的机会，在手机上测试，居然播放正常。然后在我的小米电视上测试，居然所有的频道都正常，很是意外。回头再去查前面的错误，有解释说是需要arm，引用的图形库libnative-igraphics.so只存在于arm64-8a和armeabi-v7a这个两个目录，x86核心的模拟器不能找到文件而无法播放。</p> 
<p style="margin-left:0;text-align:justify;">这真是：踏破铁鞋无觅处，得来全不费功夫。最后给我的感觉应该是：VLC在x86-64的平台上性能最好；Andorid自带的VideoView组件使用了自己系统最底层的东西，在arm平台中性能最好；其他的一些开源的播放器，还需要努力！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d2312e202ff07f3211fab160714c4a5e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">DSP_TMS320F28377D_ADC应用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6bf1260ade47808516617b9ed87622fe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux系统centos7安装、配置、远程连接mysql8.0.35、开机自启动（究级无敌宇宙第一详细）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>