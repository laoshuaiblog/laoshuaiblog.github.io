<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Django Web 项目在Linux环境的在线部署（补充记录） - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/f6c04cc84c6a689e71a87335b3cb39f4/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Django Web 项目在Linux环境的在线部署（补充记录）">
  <meta property="og:description" content="环境介绍：
系统：CentOS 8 64位
工具：Nginx &#43; uWSGI
语言：python
框架：Django
数据库：Mysql
上篇记录的是离线环境下的部署，本篇对在线环境下部署项目做个记录：
软件版本对应：
Nginx --- 1.20.2
python --- 3.10.4
Django --- 4.0.4
MySQL --- 5.7.37
一、相关软件安装：
在线环境下相关软件都使用 yum 进行安装，便以版本以及软件依赖管理，首先使用yum对系统内核及软件方面做个更新
由于centos 版本的原因之前的源已经搬家了需要更改yum源 手动去修改容易出问题，使用 sed 工具统一替换修改：
sed -i &#39;s/mirrorlist/#mirrorlist/g&#39; /etc/yum.repos.d/CentOS-*
sed -i &#39;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&#39; /etc/yum.repos.d/CentOS-*
修改后 sudo yum update 等待更新完成
1、下载安装 python
系统默认安装了3.6.8
而 yum 源中并没有 python-3.10.4 的 rpm 包，最高的就是python39,所以下载源码 python-3.10.4安装
解压、编译安装
安装依赖：
sudo yum install libffi-devel gdbm-devel libtirpc-devel openssl-devel readline-devel sqlite-devel python3-pyOpenSSL tk-devel">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-08-06T21:27:27+08:00">
    <meta property="article:modified_time" content="2022-08-06T21:27:27+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Django Web 项目在Linux环境的在线部署（补充记录）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>环境介绍：</p> 
<p>系统：CentOS 8 64位</p> 
<p>工具：Nginx + uWSGI</p> 
<p>语言：python</p> 
<p>框架：<a href="https://so.csdn.net/so/search?q=Django&amp;spm=1001.2101.3001.7020" title="Django">Django</a></p> 
<p>数据库：Mysql</p> 
<p>上篇记录的是离线环境下的部署，本篇对在线环境下部署项目做个记录：</p> 
<p>软件版本对应：</p> 
<p>Nginx --- 1.20.2</p> 
<p>python --- 3.10.4</p> 
<p>Django --- 4.0.4</p> 
<p>MySQL --- 5.7.37</p> 
<p>一、相关软件安装：</p> 
<p>在线环境下相关软件都使用 yum 进行安装，便以版本以及软件依赖管理，首先使用yum对系统内核及软件方面做个更新</p> 
<p><img alt="" height="394" src="https://images2.imgbox.com/e2/e8/k0EJe3YR_o.png" width="1200"></p> 
<p>由于centos 版本的原因之前的源已经搬家了需要更改yum源 手动去修改容易出问题，使用 sed 工具统一替换修改：</p> 
<p>sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*</p> 
<p>sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*</p> 
<p><img alt="" height="176" src="https://images2.imgbox.com/eb/5b/jHBHguIs_o.png" width="1200"></p> 
<p>修改后 sudo yum update 等待更新完成</p> 
<p><img alt="" height="530" src="https://images2.imgbox.com/23/13/wPMZz9Mg_o.png" width="1200"></p> 
<p> 1、下载安装 python</p> 
<p>系统默认安装了3.6.8</p> 
<p><img alt="" height="175" src="https://images2.imgbox.com/2d/1b/n9BanR46_o.png" width="875"></p> 
<p> 而 yum 源中并没有 python-3.10.4 的 rpm 包，最高的就是python39,所以下载源码 python-3.10.4安装</p> 
<p><img alt="" height="175" src="https://images2.imgbox.com/5b/60/sHp1tgul_o.png" width="1083"></p> 
<p><img alt="" height="467" src="https://images2.imgbox.com/2a/52/qle0IhkU_o.png" width="1200"></p> 
<p> 解压、编译安装</p> 
<p><img alt="" height="947" src="https://images2.imgbox.com/2e/df/67rYNxKt_o.png" width="1200"></p> 
<p> 安装依赖：</p> 
<p>sudo yum install libffi-devel gdbm-devel libtirpc-devel openssl-devel readline-devel sqlite-devel python3-pyOpenSSL tk-devel</p> 
<p><img alt="" height="1094" src="https://images2.imgbox.com/40/eb/fwXab8q7_o.png" width="1200"></p> 
<p><img alt="" height="436" src="https://images2.imgbox.com/64/b3/57VYHln8_o.png" width="1200"></p> 
<p> sudo make clean 再重新编译 make</p> 
<p><img alt="" height="637" src="https://images2.imgbox.com/cf/fe/jYe1mqXB_o.png" width="1200"></p> 
<p>sudo make install</p> 
<p><img alt="" height="345" src="https://images2.imgbox.com/51/5a/5aEtfUTI_o.png" width="1200"></p> 
<p> 修改pip及python指向</p> 
<p><img alt="" height="891" src="https://images2.imgbox.com/7a/67/zIKDNRJG_o.png" width="1200"></p> 
<p><img alt="" height="169" src="https://images2.imgbox.com/71/45/yR79kUpW_o.png" width="1200"> 2、安装MySQL</p> 
<p>参照MySQL官方文档安装</p> 
<p><a class="has-card" href="https://dev.mysql.com/doc/refman/8.0/en/linux-installation-yum-repo.html" rel="nofollow" title="MySQL :: MySQL 8.0 Reference Manual :: 2.5.1 Installing MySQL on Linux Using the MySQL Yum Repository"><span class="link-card-box"><span class="link-title">MySQL :: MySQL 8.0 Reference Manual :: 2.5.1 Installing MySQL on Linux Using the MySQL Yum Repository</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/4d/b7/lHgyyc16_o.png">https://dev.mysql.com/doc/refman/8.0/en/linux-installation-yum-repo.html</span></span></a></p> 
<p>2.1 下载安装 MySQL Yum Repository</p> 
<p>sudo wget https://dev.mysql.com/get/mysql80-community-release-el8-4.noarch.rpm</p> 
<p><img alt="" height="701" src="https://images2.imgbox.com/dc/e8/SxP8ZfLn_o.png" width="1200"></p> 
<p> sudo yum install ./mysql80-community-release-el8-4.noarch.rpm</p> 
<p><img alt="" height="885" src="https://images2.imgbox.com/39/d0/oJPmdH5e_o.png" width="1200"></p> 
<p> 查看是否安装成功</p> 
<p><img alt="" height="224" src="https://images2.imgbox.com/9b/59/sp4H4UzZ_o.png" width="1200"></p> 
<p>选择安装版本，官方文档是介绍了可以选择mysql的安装版本，通过手动配置 mysql-community.repo 将关于 8.0的 enabled参数设置为0，添加 5.7的配置信息并使enabled = 1</p> 
<p><img alt="" height="478" src="https://images2.imgbox.com/d8/f8/cF3bXBC0_o.png" width="1069">但是最终没能安装</p> 
<p><img alt="" height="996" src="https://images2.imgbox.com/97/7c/TfrTeSka_o.png" width="1200"></p> 
<p> 如图中所示：不考虑最佳匹配安装可以安装 4.7.18 ，但全是 el6 的 ，mysql官网中也没找到 el8 和 mysql 5.7 可用的 yum 源，所以如果一定要安装 MySQL 5.7.37（严格要求该版本）就只能源码安装了，就如同前面安装python一样，源中最高只提供了 python39 的 rpm,一定要python 3.10.4 就只能源码安装，这里MySQL的源码安装就不记录了（sudo wget 下载源码下来，安装前篇已经记录了）</p> 
<p><img alt="" height="655" src="https://images2.imgbox.com/f4/16/uE7cLeS1_o.png" width="1200">尝试安装 8.0，修改mysql-community.repo 将关于 8.0的 enabled参数设置为1，删除或注释关于5.7的配置信息后执行安装：sudo yum install mysql-community-server</p> 
<p><img alt="" height="583" src="https://images2.imgbox.com/52/c9/zmmU1oz7_o.png" width="1200"></p> 
<p> 等待安装完成</p> 
<p><img alt="" height="447" src="https://images2.imgbox.com/a5/e9/wP1Wd701_o.png" width="1200"></p> 
<p> 启动mysql服务</p> 
<p><img alt="" height="445" src="https://images2.imgbox.com/c0/3e/g4p0bxZ6_o.png" width="1141"></p> 
<p> 查看系统设置的 root 密码并重置为自己的密码</p> 
<p>sudo grep 'temporary password' /var/log/mysqld.log</p> 
<p>alter user 'root'@'localhost' identified by 'new-password';</p> 
<p>默认会安装密码验证机制，必须包含大小写字母、数字和特殊符号，长度最少8个</p> 
<p> 3、安装Nginx</p> 
<p></p> 
<p>同样如果追求最新稳定版本 1.20.2 就只能源码安装了，官网查看下载地址，wget 下载源码下来</p> 
<p><img alt="" height="678" src="https://images2.imgbox.com/43/b2/xW6rqNon_o.png" width="1200"></p> 
<p> 源码具体安装这里就不记录了</p> 
<p><img alt="" height="627" src="https://images2.imgbox.com/5f/60/2XVRssf3_o.png" width="1200"></p> 
<p> 等待安装完成</p> 
<p><img alt="" height="482" src="https://images2.imgbox.com/70/66/cDKW2fz1_o.png" width="1200"></p> 
<p> 启动nginx服务</p> 
<p><img alt="" height="852" src="https://images2.imgbox.com/d3/1e/bmys4U4L_o.png" width="1200"></p> 
<p>可以看到，yum 安装完后nginx 工作进程的用户是 nginx ，来看下配置文件</p> 
<p><img alt="" height="653" src="https://images2.imgbox.com/2e/45/F2y96hXa_o.png" width="1200"></p> 
<p><img alt="" height="537" src="https://images2.imgbox.com/ab/a7/v0zqrpRR_o.png" width="921"></p> 
<p><img alt="" height="537" src="https://images2.imgbox.com/83/e0/kLkHACQn_o.png" width="1200"></p> 
<p> 4、安装uWSGI</p> 
<p>很遗憾，源里面没有收录 uWSGI的 rpm 包，可以选择源码安装或者pip安装</p> 
<p>首先记录 pip 安装 ，注意此处如果直接pip install uwsgi 则会在当前用户家目录下安装，可以使用 python -m site 查看pip 安装目录</p> 
<p><img alt="" height="272" src="https://images2.imgbox.com/03/56/ZZ6eTUbZ_o.png" width="1020"></p> 
<p><img alt="" height="1030" src="https://images2.imgbox.com/fb/43/0AVeWvZl_o.png" width="1200"></p> 
<p><img alt="" height="633" src="https://images2.imgbox.com/a4/4a/KbeAapXu_o.png" width="1023"></p> 
<p>使用 sudo pip install uwsgi 则安装到全局 python 环境中去</p> 
<p><img alt="" height="290" src="https://images2.imgbox.com/aa/f5/y1BFhgDe_o.png" width="1200"></p> 
<p><img alt="" height="653" src="https://images2.imgbox.com/f3/6b/vMrnnF2K_o.png" width="1138"></p> 
<p> 第二方法就是源码安装了，参照官方文档 wget 下载</p> 
<p><img alt="" height="343" src="https://images2.imgbox.com/52/8f/87DHQDL6_o.png" width="1200"></p> 
<p><img alt="" height="724" src="https://images2.imgbox.com/f0/75/WF8sxYEc_o.png" width="1200"></p> 
<p><img alt="" height="641" src="https://images2.imgbox.com/10/cd/wf2cKdCt_o.png" width="1118"></p> 
<p>二、项目部署</p> 
<p>1、创建项目目录、在项目目录内创建虚拟环境 PrescriptionPushSystem_env 并激活</p> 
<p><img alt="" height="995" src="https://images2.imgbox.com/8a/1b/eBin2CS9_o.png" width="1200"></p> 
<p> 2、pycharm 配置远程deployment ，上传requirements.txt ,配置pip 源，安装项目依赖</p> 
<p><img alt="" height="637" src="https://images2.imgbox.com/21/b2/lviA9RPy_o.png" width="947"></p> 
<p><img alt="" height="367" src="https://images2.imgbox.com/38/d0/F1BCSgNq_o.png" width="1194"></p> 
<p><img alt="" height="1024" src="https://images2.imgbox.com/f2/98/zCM2pOAF_o.png" width="1200"></p> 
<p><img alt="" height="1054" src="https://images2.imgbox.com/54/bd/a8DTiqr6_o.png" width="1200"></p> 
<p><img alt="" height="743" src="https://images2.imgbox.com/69/7f/85d8lgny_o.png" width="1200"></p> 
<p><img alt="" height="665" src="https://images2.imgbox.com/cb/77/FxrVMCHP_o.png" width="1200"></p> 
<p><img alt="" height="564" src="https://images2.imgbox.com/94/91/aRnDlu4S_o.png" width="1200"></p> 
<p> 获取项目依赖清单 requirements.txt </p> 
<p><img alt="" height="259" src="https://images2.imgbox.com/d0/f6/ZuSs7YYP_o.png" width="1200"></p> 
<p>上传 requirements.txt</p> 
<p><img alt="" height="782" src="https://images2.imgbox.com/4f/50/xzaFOTWh_o.png" width="1200"></p> 
<p>到服务器查看</p> 
<p><img alt="" height="177" src="https://images2.imgbox.com/4d/07/zl1oBo85_o.png" width="952"></p> 
<p> 配置pip源，家目录下创建 pip.conf 到家目录下的 .pip 文件夹下</p> 
<p>[global]<br> index-url=https://pypi.tuna.tsinghua.edu.cn/simple</p> 
<p><img alt="" height="96" src="https://images2.imgbox.com/1e/1c/yeNcSQ6C_o.png" width="1190"></p> 
<p>项目虚拟环境激活状态下安装项目依赖</p> 
<p><img alt="" height="746" src="https://images2.imgbox.com/d2/7b/CzCQjiVS_o.png" width="1200"></p> 
<p><img alt="" height="361" src="https://images2.imgbox.com/27/7d/UEFCnIZl_o.png" width="1200"></p> 
<p> 3、按照开发环境创建 项目 PrescriptionPushSystem 及 相关app</p> 
<p><img alt="" height="652" src="https://images2.imgbox.com/25/85/GKKoggn6_o.png" width="1200"></p> 
<p><img alt="" height="843" src="https://images2.imgbox.com/2e/99/4oGZDCyc_o.png" width="951"></p> 
<p> 4、修改映射关系，上传项目源码</p> 
<p><img alt="" height="854" src="https://images2.imgbox.com/45/da/Wr3z0oI8_o.png" width="1200"></p> 
<p><img alt="" height="698" src="https://images2.imgbox.com/e2/d6/slnOFO6M_o.png" width="1200"></p> 
<p><img alt="" height="273" src="https://images2.imgbox.com/af/71/gUGwd79b_o.png" width="1171"></p> 
<p> 5、django runserver 方式试启动项目</p> 
<p><img alt="" height="998" src="https://images2.imgbox.com/be/fa/KjW9gnwg_o.png" width="1200"></p> 
<p> 6、本地项目pycharm中创建uwsgi配置文件 my_uwsgi.xml 管理uwsgi的启动与后台运行，并上传至服务器</p> 
<p><img alt="" height="1094" src="https://images2.imgbox.com/ef/bb/flMcRYhM_o.png" width="1191"></p> 
<p> 7、试运行 项目，失败，uwsgi.log 中总是提示无法导入django</p> 
<p><img alt="" height="1019" src="https://images2.imgbox.com/b6/31/KjsKVM0I_o.png" width="1200">但是虚拟环境下已经完全安装了，回去阅读uwsgi官方文档，使用 pip 将uwsgi安装到虚拟环境中</p> 
<p><img alt="" height="728" src="https://images2.imgbox.com/53/b0/6Tki5ZfW_o.png" width="1200"></p> 
<p> 再运行正常！</p> 
<p>8、配置nginx</p> 
<p><img alt="" height="915" src="https://images2.imgbox.com/a0/e2/QBrhLkRs_o.png" width="840"></p> 
<p> 启动nginx 试访问站点——失败</p> 
<p><img alt="" height="907" src="https://images2.imgbox.com/27/48/oH9elVKy_o.png" width="1200"></p> 
<p> 查看nginx 日志</p> 
<p><img alt="" height="152" src="https://images2.imgbox.com/be/fd/D6wZV0lQ_o.png" width="1200">又是权限问题，yum 安装nginx后，默认配置文件中 nginx 的工作进程使用用户 nginx ,尝试使用 deployer 用户作为 nginx 的工作进程用户：修改 配置文件重新加载nginx再访问站点</p> 
<p><img alt="" height="220" src="https://images2.imgbox.com/ac/08/QPp7AkJW_o.png" width="1131"></p> 
<p><img alt="" height="1113" src="https://images2.imgbox.com/13/a8/SKAY0SaG_o.png" width="1200"></p> 
<p>问题依旧！使用root:</p> 
<p><img alt="" height="200" src="https://images2.imgbox.com/e7/71/yrptk9kt_o.png" width="1136"></p> 
<p><img alt="" height="1098" src="https://images2.imgbox.com/64/2a/U0L9ydds_o.png" width="1200"></p> 
<p> root 都不好使！查看SELinux 状态</p> 
<p><img alt="" height="293" src="https://images2.imgbox.com/8f/1f/AE1a97Me_o.png" width="792"></p> 
<p> 关闭 SELinux 并重启问题解决！</p> 
<p><img alt="" height="77" src="https://images2.imgbox.com/76/20/p5fERi6F_o.png" width="945"></p> 
<p><img alt="" height="346" src="https://images2.imgbox.com/01/f3/MJ6scJ3c_o.png" width="1074"></p> 
<p><img alt="" height="738" src="https://images2.imgbox.com/c5/14/SkAbtTma_o.png" width="1200"></p> 
<p><img alt="" height="562" src="https://images2.imgbox.com/50/44/s3KhbBAM_o.png" width="1200"></p> 
<p> 9、数据库初始化，、迁移sesions、settings配置以及静态资源收集</p> 
<p><img alt="" height="1042" src="https://images2.imgbox.com/c7/cf/PcHvtCEs_o.png" width="1089"></p> 
<p>初始化创建相关数据表时报错</p> 
<p><img alt="" height="566" src="https://images2.imgbox.com/7d/c3/EKGG0U7L_o.png" width="1200"></p> 
<p> 认证插件不支持 caching_sha2_password，回到mysql官方文档位置：</p> 
<p><a class="has-card" href="https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-root-account" rel="nofollow" title="MySQL :: MySQL 8.0 Reference Manual :: 2.11.4 Changes in MySQL 8.0"><span class="link-card-box"><span class="link-title">MySQL :: MySQL 8.0 Reference Manual :: 2.11.4 Changes in MySQL 8.0</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/ae/7c/dyT6KBzc_o.png">https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-root-account</span></span></a><img alt="" height="852" src="https://images2.imgbox.com/81/20/VjrQ3hOc_o.png" width="1200"></p> 
<p> 原因就是 8.0 以后的版本使用 caching_sha2_password 认证插件，而不是之前的mysql_native_password，参照官方文档由于使用的是 yum 安装mysql ，所以数据目录的初始化是自动完成的所以采用第二种修改方式：配置文件中设置  default_authentication_plugin 参数。</p> 
<p>修改 /etc/my.cnf，默认已经提供了这个参数项，只需取消注释就行</p> 
<p><img alt="" height="334" src="https://images2.imgbox.com/62/81/IktDTgrI_o.png" width="1200"></p> 
<p><img alt="" height="345" src="https://images2.imgbox.com/09/d9/uXl6bG0m_o.png" width="1056"></p> 
<p> 重启 mysql 服务</p> 
<p><img alt="" height="108" src="https://images2.imgbox.com/18/2d/ZDEJ7xsC_o.png" width="1188"></p> 
<p> 再次尝试问题依旧！开发环境中用的是 mysql 5.7，安装的连接器是 mysql-connector，在安装项目依赖时也是安装的mysql-connector-2.2.9，其实问题很明确 就是之前的连接器不支持 caching_sha2_password 而在mysql 官方文档中关于python 与mysql 开发指南篇有如下说明<br><a class="has-card" href="https://dev.mysql.com/doc/connector-python/en/" rel="nofollow" title="MySQL :: MySQL Connector/Python Developer Guide"><span class="link-card-box"><span class="link-title">MySQL :: MySQL Connector/Python Developer Guide</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/c3/91/LBdbDieH_o.png">https://dev.mysql.com/doc/connector-python/en/</span></span></a></p> 
<p><img alt="" height="720" src="https://images2.imgbox.com/d6/c7/YTnwts6L_o.png" width="1200"></p> 
<p><img alt="" height="932" src="https://images2.imgbox.com/3c/c0/ym5erYWU_o.png" width="1200"> 因此需要安装对 mysql 8.0 及更高版本支持的连接器，对应的模块就是 MYSQL-connector-python</p> 
<p> 取消之前对 /etc/my.cnf 的修改，直接安装 MYSQL-connector-python 模块后成功初始化创建相关数据表！</p> 
<p><img alt="" height="625" src="https://images2.imgbox.com/1d/24/iBwytIjs_o.png" width="1200"></p> 
<p><img alt="" height="791" src="https://images2.imgbox.com/ea/11/TmVZ4gBi_o.png" width="998"></p> 
<p>迁移 sessions</p> 
<p><img alt="" height="768" src="https://images2.imgbox.com/ff/b4/YeQhB9pd_o.png" width="1200"> settings 配置及静态收集</p> 
<p><img alt="" height="109" src="https://images2.imgbox.com/82/3b/3deDwRGI_o.png" width="1200"></p> 
<p> 10、重启 uwsgi 和 nginx 并验证</p> 
<p><img alt="" height="927" src="https://images2.imgbox.com/1a/95/wo6mEgwm_o.png" width="1200"></p> 
<p><img alt="" height="765" src="https://images2.imgbox.com/47/3a/jCcEEBqW_o.png" width="1200"></p> 
<p></p> 
<p> ok!至此部署完成，做点总结：</p> 
<p>前后两篇都是关于 linux 的部署，前篇记录的是完全离线环境部署，自己文中记录的方式是相关软件包、依赖等存放在U盘中，自己的U盘做成双类型的一部分是FAT文件类型，另一部分是NTFS（可以存放大数据，比如系统 iso），用于 linux挂载 NTFS 文件系统的驱动 NTFS-3G 就存放在 FAT区，系统自动识别就可以直接安装NTFS-3G，安装完后通过挂载 NTFS 区就可以使用里面的 软件包、依赖及项目包了。</p> 
<p>前半部分都是关于软件的安装（python/mysql/uwsgi/nginx）,离线环境安装主要就是解决软件依赖问题，自己文中记录的方式还是具有一定的限制，这跟用来部署的服务器内核版本有关，系统在部署前是最小安装还是server with GUI 亦或是否已经安装了诸如 Development Tools等软件都是限制因素。一种具有普遍适用性的方法可以在开发环境（有外网）直接将 yum 源或 pip 源下载下来，到部署环境再部署成本地源使用，至于怎么操作就不记录了，相信网上也有很多教程！第二篇中在线环境安装就主要看所使用的 yum 源以及对软件版本是否苛刻，如果 yum 源里面没有相关软件版本对应的 rpm 包也就只能源码安装了，还想到一点自己可以将开发环境的软件比如 python 自己编译打包成 rpm 包来安装，应该能实现，不过回头一想一是需要去验证，再者这又回到离线环境了，有点南辕北辙，既然是在线环境 如果 yum 安装不了就直接下载源码安装，简单直接！至于在线源码安装需要的依赖项前文已经记录不在赘述。</p> 
<p>相关软件安装完毕就是项目部署了，前篇离线环境部署采用的是全局部署，没有将项目放到单独的虚拟环境中，相对来说这种直接快捷，而本片就为项目创建了单独的虚拟环境，这也导致前文中 初次以 uwsgi 启动项目失败而卸载之前安装的uwsgi后再到虚拟环境中 pip 安装 uwsgi，uwsgi 没有安装到虚拟环境中，uwsgi启动项目加载 wsgi文件时路径就是不对也无法导入 django，自然也无法启动 application；总结一点，针对 uwsgi 的安装：如果计划将项目部署到单独的虚拟环境当中去，那么在部署前安装软件时就先不安装 uwsgi ，直接等到部署时创建好项目虚拟环境后直接激活项目虚拟环境以 pip install uwsgi 来安装；若项目没必要拥有单独的环境则可以是源码或者sudo pip install uwsgi 来全局安装（经过验证，无论采用这两种哪种安装，只要是将项目放到虚拟环境在启动时都报一样的错误，路径不对，找不到django也启动不了application）；此外，uwsgi.log 中两此测试都有一个警告：!!! no internal routing support, rebuild with pcre support !!! 认为是警告是因为并没有影响项目的正常启动运行，提示需要有 pcre 的支持下重新编译，这之前没遇到，解决办法就是在安装 uwsgi 之前先 sudo yum install pcre-devel，装完pcre-devel 再安装 uwsgi 。</p> 
<p>需要注意的：SELinux 对项目运行的影响。全局部署也出现过nginx 工作进程用户对收集好的静态资源访问权限不足，当时也想到了 SELinux 的影响，但是当时已经尝试关闭SELinux 后来运行但并没起什么作用，最终还是通过配置 nginx 工作进程用户与静态资源所属用户一致 均为 deployer 用户解决；但是在本篇中还有点不同：并不是访问 静态资源权限不足，而是 nginx 与 uwsgi 之间通信建立连接时权限不足，nginx 和 uwsgi 正常启动，并不是静态资源加载失败而是页面都没加载，而关闭SELinux则解决该问题。</p> 
<p>关于最终软件版本说明：自己最初开发环境为 python-3.7.2 + django-3.2.12 + mysql-5.7.38 ，那么本篇主要记录在线部署，但 yum 源中只提供 python36、python38、python39 的安装，今年刚发布的 python310又没有，所以索性就直接源码安装 python 3.10.4.稳定版，毕竟3.7已经快是5年之前的了，借此机会也就将之前项目python 版本，pycharm等升级到最新重新调试一下，当然django版本自然也升级用 4.0.4 了，而 mysql 是一直使用 5.7.38，而官方源又没提供 5.7的（也可能是自己没找到吧），就索性也升级到 8.0 来用用了！只做记录，反正没有或者找不到的至少都有源码，大不了就源码安装呗！就这样。</p> 
<p>---------------------------------------------------------------------------------------------------------------------------------————————————————————    完     ———————————————————----------------------------------------------------------------------------------------------------------------------------------</p> 
<p></p> 
<p>后面几次部署中pip 安装 项目依赖时会遇到如下bug：</p> 
<p><img alt="" height="904" src="https://images2.imgbox.com/ee/2c/BWflTEgr_o.png" width="1200"></p> 
<p> 这里做下记录，源码安装python时，安装依赖的时候加一项mysql-devel</p> 
<p><img alt="" height="807" src="https://images2.imgbox.com/e4/2e/oaMJNJLU_o.png" width="1200">该问题不一定会出现，使用python 3.10.4在华为云上面没遇到过，在自己虚拟机上出现，后面在华为云上使用python 3.10.5时又出现，不管如何，安装python时都安装一下该依赖 </p> 
<p>总的依赖如下：</p> 
<p>sudo yum install libffi-devel gdbm-devel libtirpc-devel openssl-devel readline-devel sqlite-devel python3-pyOpenSSL tk-devel mysql-devel</p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/094b303f39cc4f7c35c82202a564ff80/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">stm32的timer-trgo &#43; DMA &#43; DAC 播放WAV格式音乐</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0f6af0893c0118521cc275f29a3d11e8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Collectors.toMap key重复会报错】Collectors.toMap Duplicate key 1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>