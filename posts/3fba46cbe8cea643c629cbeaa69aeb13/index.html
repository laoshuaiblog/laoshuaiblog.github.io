<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java线程池以及Future和CompletableFuture的用法 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/3fba46cbe8cea643c629cbeaa69aeb13/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Java线程池以及Future和CompletableFuture的用法">
  <meta property="og:description" content="线程池 是一种多线程处理形式，处理过程中将任务添加到队列，然后在创建线程后自动启动这些任务。
为什么使用线程池?
频繁申请/销毁资源和调度资源，将带来额外的消耗，可能会非常巨大。
对资源无限申请缺少抑制手段，易引发系统资源耗尽的风险。
系统无法合理管理内部的资源分布，会降低系统的稳定性。
使用线程池的好处？
重用存在的线程，减少对象创建、消亡的开销。
有效的控制最大并发数，提高系统资源使用率。
统一的分配、调优和监控、可定时执行、定期执行。
线程池所在包java.util.concurrent
顶级接口Executor,真正的线程池接口是ExecutorService
Executors类提供创建线程池的方法
线程池工作流程 Java内置的线程池 自定义线程池 拒绝任务策略
1、AbortPolicy
当任务添加到线程池中被拒绝时，它将抛出RejectedExecutionException异常。(该策路下，直接丢弃任务，并抛出RejectedExecutionException异常)
2、DiscardPolicy
当任务添加到线程池中被拒绝时，默认情况下它将丢弃被拒绝的任务。(即该策略下，直接丢弃任务，什么都不做)
3.DiscardoldestPolicy
当任务添加到线程池中被拒绝时，线程池会放弃等待队列中最旧的未处理任务，然后将被拒绝的任务添加到等待队列中。(该策略下，抛弃进入队列最早的那个任务，然后尝试把这次拒绝的任务放入队列)
4、CallerRunsPolicy
不进入线程池执行，在这种方式(CallerRunsPolicy)中，任务将由调用者线程去执行。(用于被拒绝任务的处理程序，它直接在execute方法的调用线程中运行被拒绝的任务：如果执行程序已关闭，则会丢弃该任务。)
Future和CompletableFuture的用法 在Java多线程编程中，Future是一个接口，用于表示一个异步计算的结果。当启动callable线程时，就可以声明一个Future，用于接收返回结果。它提供了一系列的方法，用于管理和获取任务的执行结果。Future接口定义在java.util.concurrent包中。
使用Future可以将任务提交给线程池执行，并在需要时获取任务的执行结果。它的主要作用是允许主线程在提交异步任务后，继续执行其他操作，而不需要等待任务执行完成。
下面是Future接口的一些常用方法：
boolean cancel(boolean mayInterruptIfRunning): 取消任务的执行。如果任务正在执行，并且mayInterruptIfRunning参数设置为true，则会尝试中断任务的执行。boolean isCancelled(): 判断任务是否已被取消。boolean isDone(): 判断任务是否已经完成。V get() throws InterruptedException, ExecutionException: 获取任务的执行结果。如果任务还未执行完毕，get()方法会阻塞直到任务执行完成。如果任务执行过程中发生异常，get()方法会抛出ExecutionException，可以通过getCause()方法获取具体的异常信息。V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException: 在指定的时间内获取任务的执行结果，如果任务在指定时间内未执行完毕，会抛出TimeoutException异常。
通过Future接口，我们可以方便地提交任务并获取任务执行结果。这对于需要处理耗时操作的应用程序非常有用，可以提高系统的并发性和响应性。 栗子：四个刚需（线程）去买房摇号，future获取摇号结果。摇号结果未出，就一直阻塞。
public class FutureTest { /** * 买房摇号 */ public static class Yaohao implements Callable&amp;lt;Integer&amp;gt; { /** * 返回摇号结果 * @return 0：中签 1：没中 * @throws Exception */ @Override public Integer call() throws Exception { Random random = new Random(); //模拟摇号，10天内出结果 TimeUnit.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-10-16T13:39:03+08:00">
    <meta property="article:modified_time" content="2023-10-16T13:39:03+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java线程池以及Future和CompletableFuture的用法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>线程池</h3> 
<p>是一种多线程处理形式，处理过程中将任务添加到队列，然后在创建线程后自动启动这些任务。</p> 
<p><strong>为什么使用线程池?</strong><br> 频繁申请/销毁资源和调度资源，将带来额外的消耗，可能会非常巨大。<br> 对资源无限申请缺少抑制手段，易引发系统资源耗尽的风险。<br> 系统无法合理管理内部的资源分布，会降低系统的稳定性。</p> 
<p><strong>使用线程池的好处？</strong><br> 重用存在的线程，减少对象创建、消亡的开销。<br> 有效的控制最大并发数，提高系统资源使用率。<br> 统一的分配、调优和监控、可定时执行、定期执行。</p> 
<p>线程池所在包java.util.concurrent<br> 顶级接口Executor,真正的线程池接口是ExecutorService<br> Executors类提供创建线程池的方法<br> <img src="https://images2.imgbox.com/83/82/RK7TtjVQ_o.png" alt="在这里插入图片描述" width="430" height="230"></p> 
<h3><a id="_18"></a>线程池工作流程</h3> 
<p><img src="https://images2.imgbox.com/bf/ba/sOqYJU18_o.png" alt="在这里插入图片描述" width="530" height="330"></p> 
<h3><a id="Java_20"></a>Java内置的线程池</h3> 
<p><img src="https://images2.imgbox.com/78/49/hdB9s5p7_o.png" alt="禁制使用" width="630" height="260"><br> <img src="https://images2.imgbox.com/f7/e0/aHW60g1t_o.png" alt="在这里插入图片描述" width="530" height="290"><br> <img src="https://images2.imgbox.com/5a/53/3urzXdmY_o.png" alt="在这里插入图片描述" width="530" height="290"></p> 
<h3><a id="_24"></a>自定义线程池</h3> 
<p><img src="https://images2.imgbox.com/72/f4/67UT8XgI_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/67/34/fsPdm5wg_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3f/6e/4PqNsqtA_o.png" alt="在这里插入图片描述" width="530" height="250"><br> <strong>拒绝任务策略</strong><br> 1、AbortPolicy<br> 当任务添加到线程池中被拒绝时，它将抛出RejectedExecutionException异常。(该策路下，直接丢弃任务，并抛出RejectedExecutionException异常)<br> 2、DiscardPolicy<br> 当任务添加到线程池中被拒绝时，默认情况下它将丢弃被拒绝的任务。(即该策略下，直接丢弃任务，什么都不做)<br> 3.DiscardoldestPolicy<br> 当任务添加到线程池中被拒绝时，线程池会放弃等待队列中最旧的未处理任务，然后将被拒绝的任务添加到等待队列中。(该策略下，抛弃进入队列最早的那个任务，然后尝试把这次拒绝的任务放入队列)<br> 4、CallerRunsPolicy<br> 不进入线程池执行，在这种方式(CallerRunsPolicy)中，任务将由调用者线程去执行。(用于被拒绝任务的处理程序，它直接在execute方法的调用线程中运行被拒绝的任务：如果执行程序已关闭，则会丢弃该任务。)</p> 
<h3><a id="FutureCompletableFuture_38"></a>Future和CompletableFuture的用法</h3> 
<p>在Java多线程编程中，<code>Future</code>是一个接口，用于表示一个异步计算的结果。当启动<code>callable</code>线程时，就可以声明一个<code>Future</code>，用于接收返回结果。它提供了一系列的方法，用于管理和获取任务的执行结果。<code>Future</code>接口定义在<code>java.util.concurrent</code>包中。<br> <strong>使用<code>Future</code>可以将任务提交给线程池执行，并在需要时获取任务的执行结果。它的主要作用是允许主线程在提交异步任务后，继续执行其他操作，而不需要等待任务执行完成。</strong></p> 
<p>下面是<code>Future</code>接口的一些常用方法：</p> 
<ol><li><code>boolean cancel(boolean mayInterruptIfRunning)</code>: 取消任务的执行。如果任务正在执行，并且<code>mayInterruptIfRunning</code>参数设置为<code>true</code>，则会尝试中断任务的执行。</li><li><code>boolean isCancelled()</code>: 判断任务是否已被取消。</li><li><code>boolean isDone()</code>: 判断任务是否已经完成。</li><li><code>V get() throws InterruptedException, ExecutionException</code>: 获取任务的执行结果。如果任务还未执行完毕，<code>get()</code>方法会阻塞直到任务执行完成。如果任务执行过程中发生异常，<code>get()</code>方法会抛出<code>ExecutionException</code>，可以通过<code>getCause()</code>方法获取具体的异常信息。</li><li><code>V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException</code>: 在指定的时间内获取任务的执行结果，如果任务在指定时间内未执行完毕，会抛出<code>TimeoutException</code>异常。<br> 通过<code>Future</code>接口，我们可以方便地提交任务并获取任务执行结果。这对于需要处理耗时操作的应用程序非常有用，可以提高系统的并发性和响应性。</li></ol> 
<p>栗子：四个刚需（线程）去买房摇号，future获取摇号结果。摇号结果未出，就一直阻塞。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FutureTest</span> <span class="token punctuation">{<!-- --></span>
 
    <span class="token comment">/**
     * 买房摇号
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Yaohao</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * 返回摇号结果
         * @return 0：中签   1：没中
         * @throws Exception
         */</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//模拟摇号，10天内出结果</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> result <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"     "</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" is done!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span> <span class="token punctuation">{<!-- --></span>
 
        <span class="token class-name">Yaohao</span> gangxu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Yaohao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Yaohao</span> gangxu2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Yaohao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Yaohao</span> gangxu3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Yaohao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Yaohao</span> gangxu4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Yaohao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result1 <span class="token operator">=</span> es<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>gangxu1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result2 <span class="token operator">=</span> es<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>gangxu2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result3 <span class="token operator">=</span> es<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>gangxu3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result4 <span class="token operator">=</span> es<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>gangxu4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        es<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"刚需1，摇号结果："</span><span class="token operator">+</span><span class="token punctuation">(</span>result1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token operator">?</span><span class="token string">"中签"</span><span class="token operator">:</span><span class="token string">"没中"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"刚需2，摇号结果："</span><span class="token operator">+</span><span class="token punctuation">(</span>result2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token operator">?</span><span class="token string">"中签"</span><span class="token operator">:</span><span class="token string">"没中"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"刚需3，摇号结果："</span><span class="token operator">+</span><span class="token punctuation">(</span>result3<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token operator">?</span><span class="token string">"中签"</span><span class="token operator">:</span><span class="token string">"没中"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"刚需4，摇号结果："</span><span class="token operator">+</span><span class="token punctuation">(</span>result4<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token operator">?</span><span class="token string">"中签"</span><span class="token operator">:</span><span class="token string">"没中"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
<span class="token punctuation">}</span>
</code></pre> 
<p>两个栗子</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FutureTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">UserInfoService</span> userInfoService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MedalService</span> medalService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MedalService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> userId <span class="token operator">=</span><span class="token number">666L</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用用户服务获取用户基本信息</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> userInfoFutureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> userInfoService<span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>userInfoFutureTask<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//模拟主线程其它操作耗时</span>

        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MedalInfo</span><span class="token punctuation">&gt;</span></span> medalInfoFutureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MedalInfo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">MedalInfo</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> medalService<span class="token punctuation">.</span><span class="token function">getMedalInfo</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>medalInfoFutureTask<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> userInfoFutureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取个人信息结果</span>
        <span class="token class-name">MedalInfo</span> medalInfo <span class="token operator">=</span> medalInfoFutureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取勋章信息结果</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"总共用时"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong><code>FutureTask</code>和<code>Future</code>的区别</strong></p> 
<ol><li> <p>功能不同：<code>Future</code>是一个接口，用于表示一个异步计算的结果，可以用来取消任务、查询结果是否完成以及获取计算结果。<code>FutureTask</code>是一个实现了<code>Future</code>接口的具体类，同时也是一个可执行的任务，可以被<code>Executor</code>执行。</p> </li><li> <p>使用方式不同：<code>Future</code>通常与<code>ExecutorService</code>一起使用，用来提交任务并获取任务的执行结果。<code>FutureTask</code>既可以直接使用<code>FutureTask</code>对象来提交任务，也可以将其作为<code>Runnable</code>或<code>Callable</code>对象提交给<code>ExecutorService</code>。</p> </li><li> <p>创建方式不同：创建<code>Future</code>对象时，通常使用<code>ExecutorService</code>提交任务后返回的<code>Future</code>实例。而创建<code>FutureTask</code>对象时，可以直接通过<code>new FutureTask(callable)</code>构造函数或<code>new FutureTask(runnable, result)</code>构造函数来实例化。</p> </li><li> <p>取消任务的能力不同：<code>Future</code>接口提供了<code>cancel(boolean mayInterruptIfRunning)</code>方法，用于取消任务的执行。而<code>FutureTask</code>类还提供了<code>cancel(boolean mayInterruptIfRunning)</code>方法以及<code>boolean cancel(boolean mayInterruptIfRunning)</code>方法，用于取消任务的执行并返回取消成功与否的信息。</p> </li></ol> 
<p>总的来说，<code>Future</code>是一个接口，用于表示一个异步计算的结果；<code>FutureTask</code>是<code>Future</code>接口的具体实现类，同时也是一个可执行的任务。<code>FutureTask</code>相比<code>Future</code>更为灵活，能够直接作为任务提交给<code>ExecutorService</code>执行，并提供了更多的取消任务的方法。</p> 
<p><strong>ExecutorService 的submit方法的作用</strong><br> <code>ExecutorService</code> 是 Java 提供的一个用于管理线程池的接口。它可以用来执行异步任务并管理线程的生命周期。<code>submit</code> 方法是 <code>ExecutorService</code> 接口定义的一个方法，用于向线程池提交一个任务并获取一个 <code>Future</code> 对象来表示任务的执行结果。</p> 
<p>具体来说，<code>submit</code> 方法用于提交一个 <code>Callable</code> 或 <code>Runnable</code> 对象到线程池中执行。<code>Callable</code> 是带有返回结果的任务，而 <code>Runnable</code> 是没有返回结果的任务。<code>submit</code> 方法将任务提交给线程池后会立即返回一个 <code>Future</code> 对象，通过这个对象可以获得任务的执行结果或者取消任务的执行。</p> 
<p>使用 <code>submit</code> 方法可以方便地管理线程池中的任务，可以通过 <code>Future</code> 对象获取任务的状态、结果或者取消任务的执行。通常情况下，我们可以使用 <code>submit</code> 方法来替代 <code>execute</code> 方法，因为它具有更多的功能和灵活性。</p> 
<p><strong>submit 和execute 的区别</strong><br> <code>submit()</code> 和 <code>execute()</code> 是 <code>ExecutorService</code> 接口用于提交任务到线程池的两种方法，它们之间有以下区别：</p> 
<ol><li> <p>返回值类型不同: <code>submit()</code> 方法返回一个 <code>Future</code> 对象，可以用来获取任务的执行结果或者取消任务的执行；而 <code>execute()</code> 方法没有返回值，无法获取任务的执行结果。</p> </li><li> <p>异常处理不同: <code>submit()</code> 方法能够捕获任务执行过程中抛出的异常，将异常封装到 <code>Future</code> 对象中，通过调用 <code>get()</code> 方法或者 <code>get(long, TimeUnit)</code> 方法获取任务的执行结果时，如果任务抛出了异常，可以通过 <code>ExecutionException</code> 来获取异常信息；而 <code>execute()</code> 方法无法对任务抛出的异常进行处理，如果任务抛出了异常，线程池会将异常记录到控制台。</p> </li><li> <p>参数类型不同: <code>submit()</code> 方法接受 <code>Callable</code> 或者 <code>Runnable</code> 对象作为参数，<code>Callable</code> 是带有返回值的任务，而 <code>Runnable</code> 是没有返回值的任务；而 <code>execute()</code> 方法只接受 <code>Runnable</code> 对象作为参数。因此，如果需要获取任务执行的结果，应该使用 <code>submit()</code> 方法，如果不需要获取结果，可以使用 <code>execute()</code> 方法。</p> </li></ol> 
<p>总的来说，<code>submit()</code> 方法比 <code>execute()</code> 方法更加灵活，可以获取任务的执行结果和捕获任务中抛出的异常，因此在处理需要获取结果或者处理异常的任务时，推荐使用 <code>submit()</code> 方法。而对于不需要获取结果的简单任务，可以使用 <code>execute()</code> 方法。</p> 
<p><strong>Future的局限</strong><br> Future对于结果的获取，不是很友好，只能通过阻塞或者轮询的方式得到任务的结果。<br> Future.get() 就是阻塞调用，在线程获取结果之前get方法会一直阻塞。Future提供了一个isDone方法，可以在程序中轮询这个方法查询执行结果。<br> 阻塞的方式和异步编程的设计理念相违背，而轮询的方式会耗费无谓的CPU资源。因此，JDK8设计出CompletableFuture，提供了一种观察者模式类似的机制，可以让任务执行完成后通知监听的一方。</p> 
<p><strong>CompletableFuture 使用详解</strong></p> 
<p><a href="https://www.jianshu.com/p/6bac52527ca4" rel="nofollow">CompletableFuture 使用详解</a><br> <a href="https://blog.csdn.net/sermonlizhi/article/details/123356877?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168872237916800182147655%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168872237916800182147655&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-123356877-null-null.142%5Ev88%5Einsert_down28v1,239%5Ev2%5Einsert_chatgpt&amp;utm_term=CompletableFuture&amp;spm=1018.2226.3001.4187">CompletableFuture使用详解</a><br> <a href="https://juejin.cn/post/6970558076642394142" rel="nofollow">异步编程利器：CompletableFuture详解 ｜Java 开发实战</a><br> CompletableFuture提供了多种方法来获取异步计算的结果。以下是一些常用的方法：</p> 
<ol><li>使用get()方法：CompletableFuture类继承了Future接口，因此可以使用get()方法来获取计算的结果。但需要注意的是，get()方法是阻塞的，会等待异步计算完成后返回结果。如果计算没有完成，get()方法会一直阻塞，直到计算完成并返回结果或者抛出异常。</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> result <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 阻塞获取计算结果</span>
</code></pre> 
<ol start="2"><li>使用join()方法：与get()方法类似，join()方法也可以获取计算结果，但它是非阻塞的。如果计算没有完成，join()方法会等待计算完成后立即返回结果。</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> result <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 非阻塞获取计算结果</span>
</code></pre> 
<ol start="3"><li>使用CompletableFuture组合方法：CompletableFuture提供了一系列方法，如thenApply、thenAccept、thenCompose等，用于对计算结果进行处理。这些方法返回的是新的CompletableFuture实例，可以继续链式调用。通过这些方法，我们可以在异步计算完成后，对结果进行进一步的操作或处理。</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s <span class="token operator">+</span> <span class="token string">" World"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> result <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="4"><li>使用回调方法：CompletableFuture还提供了一系列回调方法，如whenComplete、handle、thenAccept、exceptionally等，用于在计算完成后执行相应的操作或处理。这些方法允许我们以非阻塞的方式处理计算结果，并在计算完成或出现异常时执行相应的逻辑。</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s <span class="token operator">+</span> <span class="token string">" World"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">thenAccept</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span>ex <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Error: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>上述是一些常用的获取CompletableFuture计算结果的方法，根据具体需求和场景，你可以选择适合的方式来处理异步计算的结果。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/23c07c44cdae55949ff86ecd1cc46174/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VMware虚拟机配置固定IP</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/25974de41f138859634c93579fcc8a9b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Verilog编译预处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>