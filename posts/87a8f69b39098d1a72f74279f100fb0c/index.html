<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ubuntu10.04 apache2.2开启tls1.2的支持，使现代的edge和firefox浏览器能正常访问https - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/87a8f69b39098d1a72f74279f100fb0c/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="ubuntu10.04 apache2.2开启tls1.2的支持，使现代的edge和firefox浏览器能正常访问https">
  <meta property="og:description" content="最近发现自己ubuntu10.04服务器上的apache https无法通过win11上的edge和firefox浏览器访问，但xp下的ie6和ie8没有问题。
firefox的错误提示为“此网站可能不支持TLS 1.2协议,而这是Firefox支持的最低版本”。
经过检查发现：
IE6访问https所需的版本是SSLv3。
IE8访问https所需的版本是TLS1.0。
但win11上的edge和最新版本的firefox浏览器访问https所需的版本是TLS1.2。
使apache服务器支持TLS1.2需要的服务器运行环境：
apache对应版本应&amp;gt;=2.2.23
OpenSSL对应版本应&amp;gt;=1.0.1
查看apache和openssl的版本：
apache2 -v
openssl version -a
查看openssl支持的加密算法：
openssl ciphers -v
ubuntu10.04里面能用sudo apt-get安装的最高版本是
Server version: Apache/2.2.14 (Ubuntu)
Server built: Mar 5 2015 18:11:29
OpenSSL 0.9.8k 25 Mar 2009
built on: Thu Mar 19 15:32:30 UTC 2015
所以必须自己编译新版的apache2和openssl。
系统默认的apache2和openssl都是安装在/usr下的。两者安装在同一目录下，安装文件直接混合在一起。
我们自己源码编译安装的默认是/usr/local/apache2和/usr/local/ssl，两者是分开的。
源码编译安装openssl 1.0.1f：
wget https://www.openssl.org/source/old/1.0.1/openssl-1.0.1f.tar.gz --no-check-certificate
tar xf openssl-1.0.1f.tar.gz
cd openssl-1.0.1f/
./config shared
make
sudo make install
查看刚安装的openssl版本：
/usr/local/ssl/bin/openssl version -a">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-22T00:05:22+08:00">
    <meta property="article:modified_time" content="2024-03-22T00:05:22+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ubuntu10.04 apache2.2开启tls1.2的支持，使现代的edge和firefox浏览器能正常访问https</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近发现自己ubuntu10.04服务器上的apache https无法通过win11上的edge和firefox浏览器访问，但xp下的ie6和ie8没有问题。<br> firefox的错误提示为“此网站可能不支持TLS 1.2协议,而这是Firefox支持的最低版本”。<br> 经过检查发现：<br> IE6访问https所需的版本是SSLv3。<br> IE8访问https所需的版本是TLS1.0。<br> 但win11上的edge和最新版本的firefox浏览器访问https所需的版本是TLS1.2。</p> 
<p>使apache服务器支持TLS1.2需要的服务器运行环境：<br> apache对应版本应&gt;=2.2.23<br> OpenSSL对应版本应&gt;=1.0.1</p> 
<p>查看apache和openssl的版本：<br> apache2 -v<br> openssl version -a<br> 查看openssl支持的加密算法：<br> openssl ciphers -v</p> 
<p>ubuntu10.04里面能用sudo apt-get安装的最高版本是<br> Server version: Apache/2.2.14 (Ubuntu)<br> Server built:   Mar  5 2015 18:11:29<br> OpenSSL 0.9.8k 25 Mar 2009<br> built on: Thu Mar 19 15:32:30 UTC 2015<br> 所以必须自己编译新版的apache2和openssl。</p> 
<p>系统默认的apache2和openssl都是安装在/usr下的。两者安装在同一目录下，安装文件直接混合在一起。<br> 我们自己源码编译安装的默认是/usr/local/apache2和/usr/local/ssl，两者是分开的。</p> 
<p>源码编译安装openssl 1.0.1f：<br> wget https://www.openssl.org/source/old/1.0.1/openssl-1.0.1f.tar.gz --no-check-certificate<br> tar xf openssl-1.0.1f.tar.gz<br> cd openssl-1.0.1f/<br> ./config shared<br> make<br> sudo make install</p> 
<p>查看刚安装的openssl版本：<br> /usr/local/ssl/bin/openssl version -a<br> /usr/local/ssl/bin/openssl ciphers -v</p> 
<p>源码编译安装apache2，注意用--with-ssl绑定新安装的openssl：<br> 在浏览器里面下载https://archive.apache.org/dist/httpd/httpd-2.2.23.tar.gz (wget命令不好使了）<br> tar xf httpd-2.2.23.tar.gz<br> cd httpd-2.2.23<br> ./configure --enable-deflate --enable-expires --enable-heads --with-mpm-worker --enable-rewrite --enable-so --with-included-apr --enable-ssl --with-ssl=/usr/local/ssl --enable-mods-shared=all<br> make<br> sudo make install</p> 
<p>查看新安装的apache2里面的mod_ssl模块：<br> ls -l /usr/local/apache2/modules/mod_ssl.so</p> 
<p>将新安装的libssl.so.1.0.0所在的路径加入LD_LIBRARY_PATH列表中：<br> 在/etc/ld.so.conf.d文件夹中新建一个mynewssl.conf文件，内容为/usr/local/ssl/lib。<br> 然后执行sudo ldconfig。</p> 
<p>打开/usr/local/apache2/conf/httpd.conf，将<br> Include conf/extra/httpd-ssl.conf<br> 取消注释。</p> 
<p>打开/usr/local/apache2/conf/extra/httpd-ssl.conf，正确配置证书文件路径，如：<br> SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem<br> SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key</p> 
<p>启动新安装的apache2：<br> sudo /usr/local/apache2/bin/apachectl start<br> 停止新安装的apache2：<br> sudo /usr/local/apache2/bin/apachectl stop</p> 
<p>然后再访问https，就可以访问成功了。在firefox里面也可以看到apache已经支持tls1.2了。</p> 
<p style="text-align:center;"><img alt="" class="left" src="https://images2.imgbox.com/fe/6f/5hwtTxRS_o.png"></p> 
<p>IE6：</p> 
<p><img alt="" src="https://images2.imgbox.com/70/46/i2ucnfUf_o.png"></p> 
<p>IE8：</p> 
<p style="text-align:center;"><img alt="" class="left" src="https://images2.imgbox.com/95/7a/fH8xMHfa_o.png"></p> 
<p>win11下的edge浏览器：</p> 
<p><img alt="" src="https://images2.imgbox.com/45/93/ijyPlOfm_o.png"></p> 
<p>win11下的ie11浏览器：</p> 
<p style="text-align:center;"><img alt="" class="left" src="https://images2.imgbox.com/d6/de/RyEjE5rD_o.png"></p> 
<p> </p> 
<hr> 
<p>新安装的apache2.2.23绑定系统已有的php：<br> 在/usr/local/apache2/conf/httpd.conf末尾加入<br> Include /etc/apache2/mods-available/php5.load<br> Include /etc/apache2/mods-available/php5.conf</p> 
<p>【可选】引用以前的VirtualHost虚拟主机配置文件：<br> （不用补加NameVirtualHost指令）<br> Include /etc/apache2/sites-available/myoldsite.conf<br> 如果访问出现<br> Forbidden<br> You don't have permission to access / on this server.<br> 则需要在myoldsite.conf的&lt;VirtualHost&gt;的&lt;Directory&gt;下加入Allow from All指令。</p> 
<p>重启新安装的apache2：<br> sudo /usr/local/apache2/bin/apachectl restart</p> 
<p>禁止ubuntu10.04原有的apache2开机自启动：<br> $ sudo update-rc.d -f apache2 remove<br>  Removing any system startup links for /etc/init.d/apache2 ...<br>    /etc/rc0.d/K20apache2<br>    /etc/rc1.d/K20apache2<br>    /etc/rc2.d/S20apache2<br>    /etc/rc3.d/S20apache2<br>    /etc/rc4.d/S20apache2<br>    /etc/rc5.d/S20apache2<br>    /etc/rc6.d/K20apache2</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f3b1ae0140aebed6eb67d9ee9a4ed214/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">春秋云境CVE-2022-25099</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/eefb28937ef1c480933ef4932d56eca2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【理解机器学习算法】之Clustering算法(K-Means)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>