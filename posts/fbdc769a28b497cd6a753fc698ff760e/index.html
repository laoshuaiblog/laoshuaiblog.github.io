<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java 网络访问框架_RxJava&#43;Retrofit 搭建网络请求框架 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/fbdc769a28b497cd6a753fc698ff760e/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="java 网络访问框架_RxJava&#43;Retrofit 搭建网络请求框架">
  <meta property="og:description" content="前言
之前一直在简书上写文章，然后自己搭建博客，想了一下，其实更多的精力还是应该放在学习上面，博客等就是分享自己的所学，一直认为，我如果能够把文章写的很明白了，自己也就掌握的差不多了，其次，很多东西自己也方便查看，加快开发的速度。
Overview
Retrofit 与 RxJava 完美结合，支持断点下载，上传，支持缓存，自定义绑定生命周期.
github地址
效果图
Download
Step 1. Add the JitPack repository to your build file
Add it in your root build.gradle at the end of repositories:
allprojects {
repositories {
...
maven { url &#39;https://www.jitpack.io&#39; }
}
}
复制代码
Step 2. Add the dependency
dependencies {
implementation &#39;com.github.JiangHaiYang01:RxHttp-RxJava:0.0.2&#39;
}
复制代码
Usage
基础使用
配置retrifot
rxHttp = RxHttp.Builder()
.baseUrl(&#34;https://www.wanandroid.com&#34;)
.isLog(true)
.level(HttpLevel.BODY)
.writeTimeout(10)
.readTimeout(10)
.connectTimeout(10)
.build(this)
复制代码">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-03-05T07:07:00+08:00">
    <meta property="article:modified_time" content="2021-03-05T07:07:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java 网络访问框架_RxJava&#43;Retrofit 搭建网络请求框架</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>前言</p> 
 <p>之前一直在简书上写文章，然后自己搭建博客，想了一下，其实更多的精力还是应该放在学习上面，博客等就是分享自己的所学，一直认为，我如果能够把文章写的很明白了，自己也就掌握的差不多了，其次，很多东西自己也方便查看，加快开发的速度。</p> 
 <p>Overview</p> 
 <p>Retrofit 与 RxJava 完美结合，支持断点下载，上传，支持缓存，自定义绑定生命周期.</p> 
 <p>github地址</p> 
 <p>效果图</p> 
 <p align="center"><img src="https://images2.imgbox.com/87/e7/5yPZMZDd_o.png" alt="b0dad767a65367278ff97c7ec0da8838.png"></p> 
 <p>Download</p> 
 <p>Step 1. Add the JitPack repository to your build file</p> 
 <p>Add it in your root build.gradle at the end of repositories:</p> 
 <p>allprojects {<!-- --></p> 
 <p>repositories {<!-- --></p> 
 <p>...</p> 
 <p>maven { url 'https://www.jitpack.io' }</p> 
 <p>}</p> 
 <p>}</p> 
 <p>复制代码</p> 
 <p>Step 2. Add the dependency</p> 
 <p>dependencies {<!-- --></p> 
 <p>implementation 'com.github.JiangHaiYang01:RxHttp-RxJava:0.0.2'</p> 
 <p>}</p> 
 <p>复制代码</p> 
 <p>Usage</p> 
 <p>基础使用</p> 
 <p>配置retrifot</p> 
 <p>rxHttp = RxHttp.Builder()</p> 
 <p>.baseUrl("https://www.wanandroid.com")</p> 
 <p>.isLog(true)</p> 
 <p>.level(HttpLevel.BODY)</p> 
 <p>.writeTimeout(10)</p> 
 <p>.readTimeout(10)</p> 
 <p>.connectTimeout(10)</p> 
 <p>.build(this)</p> 
 <p>复制代码</p> 
 <p>get 网络请求</p> 
 <p>private fun getRequest() {<!-- --></p> 
 <p>Log.i(TAG, "get 方法启动 线程 ${Thread.currentThread().name}")</p> 
 <p>val data = rxHttp</p> 
 <p>.create()</p> 
 <p>.addParameter("k", "java")</p> 
 <p>.doGet(</p> 
 <p>parameter = "wxarticle/chapters/json", tClass = TestBean::class.java,</p> 
 <p>listener = object : OnHttpListener() {<!-- --></p> 
 <p>override fun onSuccess(t: TestBean) {<!-- --></p> 
 <p>log.text = t.toString()</p> 
 <p>}</p> 
 <p>override fun onError(e: Throwable) {<!-- --></p> 
 <p>log.text = e.toString()</p> 
 <p>}</p> 
 <p>}</p> 
 <p>)</p> 
 <p>Log.i(TAG, "收到响应 $data thread ${Thread.currentThread().name}")</p> 
 <p>}</p> 
 <p>复制代码</p> 
 <p>post网络请求</p> 
 <p>private fun postRequest() {<!-- --></p> 
 <p>val data = rxHttp</p> 
 <p>.create()</p> 
 <p>.addParameter("title", "123456")</p> 
 <p>.addParameter("author", "123456")</p> 
 <p>.addParameter("link", "123456")</p> 
 <p>.doPost("lg/collect/add/json", TestBean::class.java, object : OnHttpListener() {<!-- --></p> 
 <p>override fun onSuccess(t: TestBean) {<!-- --></p> 
 <p>log.text = t.toString()</p> 
 <p>}</p> 
 <p>override fun onError(e: Throwable) {<!-- --></p> 
 <p>log.text = e.toString()</p> 
 <p>}</p> 
 <p>})</p> 
 <p>}</p> 
 <p>复制代码说明</p> 
 <p>create 方法创建一个请求</p> 
 <p>使用 addParameter 添加请求参数</p> 
 <p>使用 addHeard 添加请求头</p> 
 <p>使用 bindEvent 绑定生命周期</p> 
 <p>使用 addFile 添加上传的文件(在上传时候使用才有效)</p> 
 <p>断点下载</p> 
 <p>启动下载</p> 
 <p>rxHttp.create().doDownLoad(info.taskId, info.url, getBasePath(this), info.saveName, this)</p> 
 <p>复制代码</p> 
 <p>接口返回</p> 
 <p>interface DownLoadProgressListener {<!-- --></p> 
 <p>/**</p> 
 <p>* 下载进度</p> 
 <p>*</p> 
 <p>* @param key url</p> 
 <p>* @param progress 进度</p> 
 <p>* @param read 读取</p> 
 <p>* @param count 总共长度</p> 
 <p>* @param done 是否完成</p> 
 <p>*/</p> 
 <p>fun onUpdate(</p> 
 <p>key: String,</p> 
 <p>progress: Int,</p> 
 <p>read: Long,</p> 
 <p>count: Long,</p> 
 <p>done: Boolean</p> 
 <p>)</p> 
 <p>}</p> 
 <p>interface OnDownLoadListener : DownLoadProgressListener {<!-- --></p> 
 <p>//等待下载</p> 
 <p>fun onDownLoadPrepare(key: String)</p> 
 <p>//进度</p> 
 <p>fun onDownLoadProgress(key: String, progress: Int)</p> 
 <p>//下载失败</p> 
 <p>fun onDownLoadError(key: String, throwable: Throwable)</p> 
 <p>//下载成功</p> 
 <p>fun onDownLoadSuccess(key: String, path: String)</p> 
 <p>//下载暂停</p> 
 <p>fun onDownLoadPause(key: String)</p> 
 <p>//下载取消</p> 
 <p>fun onDownLoadCancel(key: String)</p> 
 <p>}</p> 
 <p>复制代码取消某一个下载任务</p> 
 <p>doDownLoadCancel(key: String)</p> 
 <p>复制代码暂停某一个下载任务</p> 
 <p>doDownLoadPause(key: String)</p> 
 <p>复制代码取消全部任务</p> 
 <p>doDownLoadCancelAll</p> 
 <p>复制代码暂停全部任务</p> 
 <p>doDownLoadPauseAll</p> 
 <p>复制代码</p> 
 <p>上传</p> 
 <p>启动上传任务</p> 
 <p>private fun startUploadSuspend(info: UpLoadInfo) {<!-- --></p> 
 <p>rxHttp.create()</p> 
 <p>.addFile("uploaded_file", File(info.path))</p> 
 <p>.addHeard("heard", "1")</p> 
 <p>.addParameter("parameter", "2")</p> 
 <p>.doUpload(</p> 
 <p>info.taskId,</p> 
 <p>"http://t.xinhuo.com/index.php/Api/Pic/uploadPic",</p> 
 <p>TestBean::class.java,</p> 
 <p>this</p> 
 <p>)</p> 
 <p>}</p> 
 <p>复制代码取消某一个上传任务</p> 
 <p>doUpLoadCancel(tag:String)</p> 
 <p>复制代码</p> 
 <p>加入其他自定义的解析器</p> 
 <p>项目本身 加入了解析器</p> 
 <p>client.addConverterFactory(GsonConverterFactory.create()) // json 解析器</p> 
 <p>client.addCallAdapterFactory(RxJava2CallAdapterFactory.create()) // 支持RxJava</p> 
 <p>复制代码</p> 
 <p>如果想支持其他解析器也是可以的</p> 
 <p>在 build RxHttp 的时候 使用 addBuilderClientListener 添加解析器</p> 
 <p>eg:</p> 
 <p>rxHttp = RxHttp.Builder()</p> 
 <p>.baseUrl("https://www.wanandroid.com")</p> 
 <p>.isLog(true)</p> 
 <p>.level(HttpLevel.BODY)</p> 
 <p>.writeTimeout(10)</p> 
 <p>.readTimeout(10)</p> 
 <p>.connectTimeout(10)</p> 
 <p>.addBuilderClientListener(object : OnBuildClientListener {<!-- --></p> 
 <p>override fun addBuildClient(): MutableSet {<!-- --></p> 
 <p>return mutableSetOf(GsonConverterFactory.create(),RxJava2CallAdapterFactory.create())</p> 
 <p>}</p> 
 <p>})</p> 
 <p>.build(this)</p> 
 <p>复制代码</p> 
 <p>是否显示日志打印 &amp;&amp; 日志级别</p> 
 <p>···</p> 
 <p>.isLog(true)</p> 
 <p>.level(HttpLevel.BODY)</p> 
 <p>···</p> 
 <p>复制代码</p> 
 <p>保存网络请求的log</p> 
 <p>有时候 在调试的时候可能需要将 网络请求的log 保存到 本地文件，这里也提供接口，开发者可使用 addLogListener 自行处理log文件</p> 
 <p>eg:</p> 
 <p>rxHttp = RxHttp.Builder()</p> 
 <p>.baseUrl("https://www.wanandroid.com")</p> 
 <p>.isLog(true)</p> 
 <p>.level(HttpLevel.BODY)</p> 
 <p>.writeTimeout(10)</p> 
 <p>.readTimeout(10)</p> 
 <p>.addLogListener(this)</p> 
 <p>.connectTimeout(10)</p> 
 <p>.build(this)</p> 
 <p>复制代码</p> 
 <p align="center"><img src="https://images2.imgbox.com/02/4d/ljfwVG7K_o.png" alt="ccce081d9f9e3b92a931cd6ed2b8321b.png"></p> 
 <p>有时候可能不需要那么多的日志 可以使用 addLogFilter自定添加过滤器</p> 
 <p>eg:</p> 
 <p>rxHttp = RxHttp.Builder()</p> 
 <p>.baseUrl("https://www.wanandroid.com")</p> 
 <p>.isLog(true)</p> 
 <p>.level(HttpLevel.BODY)</p> 
 <p>.writeTimeout(10)</p> 
 <p>.readTimeout(10)</p> 
 <p>.addLogFilter(object :OnLogFilterListener{<!-- --></p> 
 <p>override fun filter(message: String): Boolean {<!-- --></p> 
 <p>if(message.contains("adb")){<!-- --></p> 
 <p>return true</p> 
 <p>}</p> 
 <p>return false</p> 
 <p>}</p> 
 <p>})</p> 
 <p>.connectTimeout(10)</p> 
 <p>.build(this)</p> 
 <p>复制代码注意 上传和下载的日志已经过滤了，是不会显示上传和下载的日志的，这里主要是防止 @Steam 注解失效</p> 
 <p>网络cache</p> 
 <p>在构建 RxHttp 的时候 使用 cacheType 方法，构建缓存策略</p> 
 <p>提供 4中缓存策略,默认是没有网络缓存的</p> 
 <p>enum class CacheType {<!-- --></p> 
 <p>//不加入缓存的逻辑</p> 
 <p>NONE,</p> 
 <p>//有网时:每次都请求实时数据； 无网时:无限时请求有网请求好的数据；</p> 
 <p>HAS_NETWORK_NOCACHE_AND_NO_NETWORK_NO_TIME,</p> 
 <p>//有网时:特定时间之后请求数据； 无网时:无限时请求有网请求好的数据；</p> 
 <p>HAS_NETWORK_CACHE_TIME_AND_NO_NETWORK_NO_TIME,</p> 
 <p>//有网时:每次都请求实时数据； 无网时:特定时间之前请求有网请求好的数据；</p> 
 <p>HAS_NETWORK_NOCACHE_AND_NO_NETWORK_HAS_TIME,</p> 
 <p>//有网时:特定时间之后请求数据； 无网时:特定时间之前请求有网请求好的数据；</p> 
 <p>HAS_NETWORK_CACHE_TIME_AND_NO_NETWORK_HAS_TIME,</p> 
 <p>}</p> 
 <p>复制代码</p> 
 <p>当使用cache 的时候 提供下面api 处理缓存时间等</p> 
 <p>cacheNetWorkTimeOut</p> 
 <p>有网时:特定时间之后请求数据；(比如：特定时间为20s) 默认20</p> 
 <p>cacheNoNetWorkTimeOut</p> 
 <p>无网时:特定时间之前请求有网请求好的数据；((比如：特定时间为30天) 默认30 天 单位(秒)</p> 
 <p>cacheSize</p> 
 <p>缓存大小 默认10M</p> 
 <p>cachePath</p> 
 <p>缓存位置 默认沙盒目录下 cacheHttp 文件夹</p> 
 <p>Cookie 拦截器</p> 
 <p>fun addCookieInterceptor(</p> 
 <p>cookieListener: OnCookieListener,</p> 
 <p>onCookieInterceptor: OnCookieInterceptor</p> 
 <p>)</p> 
 <p>复制代码</p> 
 <p>下载安装包</p> 
 <p align="center"></p> 
 <p>License</p> 
 <p>Licensed under the Apache License, Version 2.0 (the "License");</p> 
 <p>you may not use this file except in compliance with the License.</p> 
 <p>You may obtain a copy of the License at</p> 
 <p>http://www.apache.org/licenses/LICENSE-2.0</p> 
 <p>Unless required by applicable law or agreed to in writing, software</p> 
 <p>distributed under the License is distributed on an "AS IS" BASIS,</p> 
 <p>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</p> 
 <p>See the License for the specific language governing permissions and</p> 
 <p>limitations under the License.</p> 
 <p>复制代码</p> 
 <p>写在最后</p> 
 <p>更新的话还是会放在 Github 上面。毕竟 Github 才是最后的王道，</p> 
 <p align="center"><img src="https://images2.imgbox.com/a4/07/Mll9xffe_o.png" alt="b739ec46bb5c46d9c0aa4ce35ba1ea56.png"></p> 
 <p>关于找一找教程网</p> 
 <p>本站文章仅代表作者观点，不代表本站立场，所有文章非营利性免费分享。</p> 
 <p>本站提供了软件编程、网站开发技术、服务器运维、人工智能等等IT技术文章，希望广大程序员努力学习，让我们用科技改变世界。</p> 
 <p>[RxJava+Retrofit 搭建网络请求框架]http://www.zyiz.net/tech/detail-138631.html</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d4cab23bf09e7ddb3ee0dcd23b3efe9d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">散点图的相关性与显著性---MATLAB</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2fc8832423873a4a84d46085d60fea9d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2021-03-05</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>