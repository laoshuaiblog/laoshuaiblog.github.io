<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Uniapp之APP离线打包 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/84ea929e1f22e842dca91e0b10458bbb/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Uniapp之APP离线打包">
  <meta property="og:description" content="生成wangyz.jks文件
命令行打开定位到.jks文件的位置进行以下操作
命令行输入：
keytool -list -v -keystore /Users/apple/Desktop/wangyz/wangyz.jks SHA1为我们需要的
DCLOUD官网配置离线打包所需要的keyhttps://dev.dcloud.net.cn
HBuilderX“生成本地打包APP资源”
点击就会在控制台生成相应的资源包，根据控制台返回的路径找到相应的文件
AndroidStudio离线打包配置
基础库配置
App离线SDK下载：https://nativesupport.dcloud.net.cn/AppDocs/download/android
最新配置方案，可以参考官文进行配置：https://nativesupport.dcloud.net.cn/AppDocs/usesdk/android
在下载好的离线SDK中找到以下文件，
将lib.5plus.base-release.aar、android-gif-drawable-release@1.2.23.aar、uniapp-v8-release.aar和oaid_sdk_1.0.25.aar拷贝到libs目录下
build. gradle文件下添加如下：
implementation fileTree(dir: &#39;libs&#39;, include: [&#39;*.aar&#39;, &#39;*.jar&#39;], exclude: []) implementation &#34;com.android.support:support-v4:28.0.0&#34; implementation &#34;com.android.support:appcompat-v7:28.0.0&#34; implementation &#39;com.android.support:recyclerview-v7:28.0.0&#39; implementation &#39;com.facebook.fresco:fresco:1.13.0&#39; implementation &#34;com.facebook.fresco:animated-gif:1.13.0&#34; implementation &#39;com.github.bumptech.glide:glide:4.9.0&#39; implementation &#39;com.alibaba:fastjson:1.1.46.android&#39; signingConfigs { config { keyAlias &#39;key0&#39; keyPassword &#39;123456&#39; storeFile file(&#39;wangyz.jks&#39;) storePassword &#39;123456&#39; v1SigningEnabled true v2SigningEnabled true } } buildTypes { debug { signingConfig signingConfigs.config minifyEnabled false proguardFiles getDefaultProguardFile(&#39;proguard-android.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-09-23T16:16:29+08:00">
    <meta property="article:modified_time" content="2021-09-23T16:16:29+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Uniapp之APP离线打包</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>生成wangyz.jks文件</strong><br> <img src="https://images2.imgbox.com/6d/5d/ZXNjQK9l_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b8/fb/IdKfZSOI_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/b4/0d/RPA0v3a8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cb/80/yrEK6MxG_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/a6/1a/U54GGQIU_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/b5/24/zioWgsHB_o.png" alt="在这里插入图片描述"></p> 
<p>命令行打开定位到.jks文件的位置进行以下操作<br> 命令行输入：</p> 
<pre><code>keytool -list -v -keystore /Users/apple/Desktop/wangyz/wangyz.jks
</code></pre> 
<p><img src="https://images2.imgbox.com/44/65/FaCOnCeb_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/7e/00/kkpyuo5X_o.png" alt="在这里插入图片描述"><br> SHA1为我们需要的<br> <img src="https://images2.imgbox.com/e6/d1/lPp8VJ9G_o.png" alt="在这里插入图片描述"><br> <strong>DCLOUD官网配置离线打包所需要的key</strong><a href="https://dev.dcloud.net.cn" rel="nofollow">https://dev.dcloud.net.cn</a><br> <img src="https://images2.imgbox.com/54/a4/Gvac5mJI_o.png" alt="在这里插入图片描述"><br> <strong>HBuilderX“生成本地打包APP资源”</strong><br> <img src="https://images2.imgbox.com/b0/a0/rlqjTHnZ_o.png" alt="在这里插入图片描述">点击就会在控制台生成相应的资源包，根据控制台返回的路径找到相应的文件</p> 
<p><strong>AndroidStudio离线打包配置</strong></p> 
<p><img src="https://images2.imgbox.com/53/6c/7kBI4dsv_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/5f/78/F8l392TK_o.png" alt="在这里插入图片描述"><strong>基础库配置</strong><br> App离线SDK下载：<a href="https://nativesupport.dcloud.net.cn/AppDocs/download/android" rel="nofollow">https://nativesupport.dcloud.net.cn/AppDocs/download/android</a></p> 
<p>最新配置方案，可以参考官文进行配置：<a href="https://nativesupport.dcloud.net.cn/AppDocs/usesdk/android" rel="nofollow">https://nativesupport.dcloud.net.cn/AppDocs/usesdk/android</a><br> 在下载好的离线SDK中找到以下文件，<br> 将lib.5plus.base-release.aar、android-gif-drawable-release@1.2.23.aar、uniapp-v8-release.aar和oaid_sdk_1.0.25.aar拷贝到libs目录下<br> <img src="https://images2.imgbox.com/5b/0d/NPglt5JM_o.png" alt="在这里插入图片描述"></p> 
<p>build. gradle文件下添加如下：</p> 
<pre><code> implementation fileTree(dir: 'libs', include: ['*.aar', '*.jar'], exclude: [])
 implementation "com.android.support:support-v4:28.0.0"
 implementation "com.android.support:appcompat-v7:28.0.0"
 implementation 'com.android.support:recyclerview-v7:28.0.0'
 implementation 'com.facebook.fresco:fresco:1.13.0'
 implementation "com.facebook.fresco:animated-gif:1.13.0"
 implementation 'com.github.bumptech.glide:glide:4.9.0'
 implementation 'com.alibaba:fastjson:1.1.46.android'


signingConfigs {
        config {
            keyAlias 'key0'
            keyPassword '123456'
            storeFile file('wangyz.jks')
            storePassword '123456'
            v1SigningEnabled true
            v2SigningEnabled true
        }
    }
    buildTypes {
        debug {
            signingConfig signingConfigs.config
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
        release {
            signingConfig signingConfigs.config
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
</code></pre> 
<p>uni-app配置时需要在build.gradle中添加aaptOptions配置</p> 
<pre><code>aaptOptions {
   additionalParameters '--auto-add-overlay'
    ignoreAssetsPattern "!.svn:!.git:.*:!CVS:!thumbs.db:!picasa.ini:!*.scc:*~"
}
</code></pre> 
<p>build. gradle完整代码：</p> 
<pre><code>plugins {
    id 'com.android.application'
}

android {
    compileSdk 30

    defaultConfig {
        applicationId "com.zhihuixian.app"
        minSdk 21
        targetSdk 30
        versionCode 1
        versionName "1.0"

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }
    signingConfigs {
        config {
            keyAlias 'key0'
            keyPassword '123456'
            storeFile file('wangyz.jks')
            storePassword '123456'
            v1SigningEnabled true
            v2SigningEnabled true
        }
    }
    buildTypes {
        debug {
            signingConfig signingConfigs.config
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
        release {
            signingConfig signingConfigs.config
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

    aaptOptions {
        additionalParameters '--auto-add-overlay'
        ignoreAssetsPattern "!.svn:!.git:.*:!CVS:!thumbs.db:!picasa.ini:!*.scc:*~"
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.aar', '*.jar'], exclude: [])
    implementation "com.android.support:support-v4:28.0.0"
    implementation "com.android.support:appcompat-v7:28.0.0"
    implementation 'com.android.support:recyclerview-v7:28.0.0'
    implementation 'com.facebook.fresco:fresco:1.13.0'
    implementation "com.facebook.fresco:animated-gif:1.13.0"
    implementation 'com.github.bumptech.glide:glide:4.9.0'
    implementation 'com.alibaba:fastjson:1.1.46.android'

    implementation 'androidx.appcompat:appcompat:1.2.0'
    implementation 'com.google.android.material:material:1.3.0'
    implementation 'androidx.constraintlayout:constraintlayout:2.0.4'
    testImplementation 'junit:junit:4.+'
    androidTestImplementation 'androidx.test.ext:junit:1.1.2'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.3.0'
}
</code></pre> 
<p>将下述内容添加到Androidmanifest.xml的application节点中,删除默认创建的MainActivity</p> 
<pre><code>  &lt;activity
      android:name="io.dcloud.PandoraEntry"
      android:configChanges="orientation|keyboardHidden|keyboard|navigation"
      android:label="@string/app_name"
      android:launchMode="singleTask"
      android:hardwareAccelerated="true"
      android:theme="@style/TranslucentTheme"
      android:screenOrientation="user"
      android:windowSoftInputMode="adjustResize" &gt;
      &lt;intent-filter&gt;
          &lt;action android:name="android.intent.action.MAIN" /&gt;
          &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
      &lt;/intent-filter&gt;
  &lt;/activity&gt;
  &lt;activity
      android:name="io.dcloud.PandoraEntryActivity"
      android:launchMode="singleTask"
      android:configChanges="orientation|keyboardHidden|screenSize|mcc|mnc|fontScale|keyboard|smallestScreenSize|screenLayout|screenSize"
      android:hardwareAccelerated="true"
      android:permission="com.miui.securitycenter.permission.AppPermissionsEditor"
      android:screenOrientation="user"
      android:theme="@style/DCloudTheme"
      android:windowSoftInputMode="adjustResize"&gt;
      &lt;intent-filter&gt;
          &lt;category android:name="android.intent.category.DEFAULT" /&gt;
          &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
          &lt;action android:name="android.intent.action.VIEW" /&gt;
          &lt;data android:scheme="h56131bcf" /&gt;
      &lt;/intent-filter&gt;
  &lt;/activity&gt;
  &lt;!--provider节点必须添加--&gt;
  &lt;provider
      android:name="io.dcloud.common.util.DCloud_FileProvider"
      android:authorities="${apk.applicationId}.dc.fileprovider"
      android:exported="false"
      android:grantUriPermissions="true"&gt;
      &lt;meta-data
          android:name="android.support.FILE_PROVIDER_PATHS"
          android:resource="@xml/dcloud_file_provider" /&gt;
  &lt;/provider&gt;
  &lt;meta-data
      android:name="dcloud_appkey"
      android:value="替换为自己申请的Appkey" /&gt;
</code></pre> 
<p>注意：${apk.applicationId} 必须替换成当前应用的包名</p> 
<p><strong>资源配置</strong></p> 
<p>Android studio默认项目没有assets文件夹，需手动创建，创建位置与java目录同级。<br> 创建data文件夹并拷贝资源<br> 将SDK-&gt;assets-&gt;data文件夹拷贝到刚刚创建的assets文件夹下，如下图</p> 
<p><img src="https://images2.imgbox.com/40/85/HbznbP3T_o.png" alt="在这里插入图片描述"><br> 创建apps文件夹并拷贝资源</p> 
<p>将HBuilderX中的项目导出，将导出的资源复制到assets-&gt;apps下，如下图所示：<br> <img src="https://images2.imgbox.com/72/12/pNVNRSgF_o.png" alt="在这里插入图片描述"></p> 
<p>修改dcloud_control.xml文件</p> 
<p>修改dcloud_control.xml中的appid为拷贝过来的uni-app的id，确保dcloud_control.xml中的appid与manifest.json中的id与文件夹名一致，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/78/54/28nCPnsI_o.png" alt="在这里插入图片描述"><br> 运行项目出现以下报错<img src="https://images2.imgbox.com/96/8b/ERAA5v3o_o.png" alt="在这里插入图片描述">解决办法：<br> 找到设置<br> <img src="https://images2.imgbox.com/24/2d/dTMPIfKf_o.png" alt="在这里插入图片描述">运行项目成功就可以进行打包了</p> 
<p><strong>打包</strong><br> <img src="https://images2.imgbox.com/25/76/pZts9jj1_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/10/9e/e3Y2zbNH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/56/69/ehVFsBd4_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3db794fa08bf58a49aea9034a5015a5b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ES6模块化用法全解析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a809f4811f7c077cdb06701675eb3235/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java8下Collectors.toMap方法当key重复时报错信息错误</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>