<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringMVC中使用Ajax请求以json格式返回null值 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/1978ddb3d8f78885e480999f3fc366a1/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="SpringMVC中使用Ajax请求以json格式返回null值">
  <meta property="og:description" content="一：问题demo展示 在开发新需求，调试代码的时候发现一个问题，就是HttpServletRequest 获取不到ajax post请求的json参数！下面是伪代码是整个请求的逻辑！
1.前台JS请求代码(伪代码) var _phoneId = &#34;123456789&#34;; var closeUrl=contextPath&#43;&#34;/close&#34;; ajax(closeUrl,{&#34;phoneId&#34;:_phoneId},&#34;post&#34;,false,callbackForSessionClose,null,&#39;json&#39;); function ajax(url,reqData,type,async,successBack,errorBack,statusText,dataType){ $.ajax({ type : type, url : url, dataType : dataType, async : async, timeout : &#34;60000&#34;, contentType : &#34;application/json&#34;, data : JSON.stringify(reqData), success : function(data) { // 成功的处理逻辑 }, error : function(data) { // 错误的处理逻辑 } }); } 2.后台代码(伪代码) @RequestMapping(value=&#34;/close&#34;,method=RequestMethod.POST) @ResponseBody public String closeSession(HttpServletRequest request){ String response; try{ String phoneId = request.getParameter(&#34;phoneId&#34;); if(phoneId == &#34;123456789&#34;){ response = &#34;">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-04-04T09:16:00+08:00">
    <meta property="article:modified_time" content="2019-04-04T09:16:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringMVC中使用Ajax请求以json格式返回null值</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p> </p> 
 <h4>一：问题demo展示</h4> 
 <p>在开发新需求，调试代码的时候发现一个问题，就是HttpServletRequest 获取不到ajax post请求的json参数！下面是伪代码是整个请求的逻辑！</p> 
 <h5>1.前台JS请求代码(伪代码)</h5> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;"> var _phoneId = "123456789";
    
    var closeUrl=contextPath+"/close";

    ajax(closeUrl,{"phoneId":_phoneId},"post",false,callbackForSessionClose,null,'json');
    
    function ajax(url,reqData,type,async,successBack,errorBack,statusText,dataType){
        
        $.ajax({
            type : type,
            url : url,
            dataType : dataType,
            async : async,
            timeout : "60000",
            contentType : "application/json",
            data : JSON.stringify(reqData),
            success : function(data) {
                // 成功的处理逻辑
             
            },
            error : function(data) {
                // 错误的处理逻辑
            }
            
        });
    }</span></pre> 
 </div> 
 <h5>2.后台代码(伪代码)</h5> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">@RequestMapping(value="/close",method=RequestMethod.POST)
    @ResponseBody
    public String closeSession(HttpServletRequest request){
        String response;
        try{
            String phoneId = request.getParameter("phoneId");
            if(phoneId == "123456789"){
                response = "success";
            }else{
                response = "error";
            }
        }catch (ServiceException e) {
            //业务异常处理逻辑
        }catch (Exception e) {
            //非业务异常处理逻辑
        
        }
        return response;
    }</span></pre> 
 </div> 
 <div> 
  <div> 
   <h4>二：问题分析</h4> 
   <p>正常的post请求(不包括ajax请求)在http头中的content-type为application/x-www-form-urlencoded,这时在java后台可以通过request.getParameter(name)的形式获取.但是通过原生ajax请求时,在java后台通过request.getParameter(name)的形式却无法获取到传入的参数.</p> 
   <p>原因是原生ajax请求时,在http头中的content-type为text/plain;charset=UTF-8.当请求到达tomcat服务器时,服务器只对application/x-www-form-urlencoded形式的http,post请求进行读取body体中的参数,并放到request的parameter中,对于原生ajax请求则直接忽略,不会读取body体中的参数,才导致request.getParameter(name)读取不到参数.</p> 
   <p>根据上面的分析结合自己的当前系统，发现系统封装的ajax默认content-type为application/json，那么这种方式在java后台通过request.getParameter(name)的形式是不能获取到传入的参数的！</p> 
   <h4>三：解决方案</h4> 
   <h5>1.[前台解决方案]修改Ajax post请求的contentType和data</h5> 
   <div> 
    <div> 
     <p>修改前：</p> 
     <pre><code class="language-javascript"><code class="javascript">        contentType : <span class="hljs-string">"application/json",
        <span class="hljs-attr">data : <span class="hljs-built_in">JSON.stringify(reqData),
        
</span></span></span></code></code></pre> 
     <p>修改后：</p> 
     <pre><code class="language-cpp"><code class="cpp">        contentType : <span class="hljs-string">"application/x-www-form-urlencoded",
        data : reqData, <span class="hljs-comment">//不需要使用JSON.stringify()</span></span></code></code></pre> 
    </div> 
    <br> 
    <br> 
    <div> 
     <div> 
      <p><strong>后台代码不变！</strong></p> 
      <h5>2.[后台解决方案]使用@RequestBody</h5> 
      <p><strong>前台js代码不变！</strong></p> 
      <p>后台代码修改：</p> 
      <p>新增一个类：</p> 
      <div class="cnblogs_code"> 
       <pre>    <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> CloseRequestVO <span style="color:#0000ff;">implements</span><span style="color:#000000;"> Serializable{
        
        </span><span style="color:#0000ff;">private</span><span style="color:#000000;"> String phoneId;
        </span><span style="color:#008000;">//</span><span style="color:#008000;">省略get set方法
        </span><span style="color:#008000;">//</span><span style="color:#008000;">....</span>
<span style="color:#000000;">        
    }
    @RequestMapping(value</span>="/close",method=<span style="color:#000000;">RequestMethod.POST)
    @ResponseBody
    </span><span style="color:#0000ff;">public</span><span style="color:#000000;"> String closeSession(@RequestBody CloseRequestVO requestVO){
        String response;
        </span><span style="color:#0000ff;">try</span><span style="color:#000000;">{
            String phoneId </span>=<span style="color:#000000;"> requestVO.getPhoneId();
            </span><span style="color:#0000ff;">if</span>(phoneId == "123456789"<span style="color:#000000;">){
                response </span>= "success"<span style="color:#000000;">;
            }</span><span style="color:#0000ff;">else</span><span style="color:#000000;">{
                response </span>= "error"<span style="color:#000000;">;
            }
        }</span><span style="color:#0000ff;">catch</span><span style="color:#000000;"> (ServiceException e) {
            </span><span style="color:#008000;">//</span><span style="color:#008000;">业务异常处理逻辑</span>
        }<span style="color:#0000ff;">catch</span><span style="color:#000000;"> (Exception e) {
            </span><span style="color:#008000;">//</span><span style="color:#008000;">非业务异常处理逻辑</span>
<span style="color:#000000;">        
        }
        </span><span style="color:#0000ff;">return</span><span style="color:#000000;"> response;
    }</span></pre> 
      </div> 
      <div> 
       <div> 
        <h4>四：@RequestBody简单介绍</h4> 
        <blockquote> 
         <p>@RequestBody ： @RequestBody是指方法参数应该被绑定到HTTP请求Body上</p> 
        </blockquote> 
        <p>&lt;font color='red'&gt;申明：在SpringMVC环境中,@RequestBody接收的是一个Json对象的字符串，而不是一个Json对象。&lt;/font&gt;<br><strong><em>所以</em></strong><br><strong>第一</strong>：@RequestBody需要接的参数是一个String化的json，前台js代码可以直接使用JSON.stringify(json)这个方法来转化；</p> 
        <p><strong>第二</strong>：从@RequestBody名称上来看，也就是说要读取的数据在请求体（body）里，所以要发post请求；</p> 
        <p><strong>第三</strong>：@RequestBody接收的是一个String的Json，那么要设置请求contentType，contentType:"application/json，明确的告诉服务器发送的内容是json。</p> 
       </div> 
       <br> 
       <br> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
  <br> 
  <br> 
 </div> 
 <p>---恢复内容结束---</p> 
</div> 
<p>转载于:https://www.cnblogs.com/zemul/p/10652980.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/94fa15d8c641286e79c41d8cf629670a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Linux】半同步半异步线程池</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ad285999138c789d7df507a8c564002/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">window环境下使用Qemu运行自己制作的img映像文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>