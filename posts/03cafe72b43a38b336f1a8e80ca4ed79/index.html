<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>asp.net 自定义控件（2种方法） - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/03cafe72b43a38b336f1a8e80ca4ed79/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="asp.net 自定义控件（2种方法）">
  <meta property="og:description" content="概念
1. 构建自定义控件
目的：创建类似MS自带的控件，具有属性、方法、事件等特性，利于重用。 技术：HtmlTextWriter类---用于生成Html。 该类所支持的方法： AddAttribute()---给调用RenderBeginTag()生成的标签添加一个Html属性. AddStyleAttribute()---给调用RenderBeginTag()生成的标签添加一个CSS属性. RenderBeginTag()---生成开始Html标签. WriteBreak()—生成&amp;lt;br /&amp;gt;标签 方法所用枚举: HtmlTextWriterTag---Html标签列表 HtmlTextWriterAttribute—Html属性列表 HtmlTextWriterStyle---CSS属性列表. 重写RenderContents(HtmlTextWriter writer)用于呈现页面. 组合控件包含子控件,在属性内要强制调用EnsureChildControls(),重写CreateChildControls()方法 指定包围WebControl标签,重写HtmlTextWriter TagKey属性 在混合控件中,两种方法都要重写. 实现方式:在组件中编写代码.调用命名空间. System.Web.UI.Control 所有控件的基类 System.Web.UI.WebControls.WebControl 含有开始结束标签 System.Web.UI.WebControls.CompositeControl 组合控件 继承它们,然后在其中编写各种所需的属性\方法\事件.其布局方法用编码代替了直观的方法. 2. 视图状态和控件状态 视图状态概念:利用一个_VIEWSTATE隐藏表单域在页面回传中保存控件属性的状态.应用于简单的值. 目的:重复回传也能显示新文本 实现方式:添加ViewStateText属性 技术:ViewState[“Message”]=value 控件状态概念:添加在控件状态中的值保存在_VIEWSTATE中,而它不能被禁用. 目的:用于在页面回传中存贮最重要的信息 技术:重写OnInit(EventArgs e) SaveControlState() 保存 LoadControlState(object saveState) 加载 3. 处理回传数据 目的:用于状态表单域数据传给控件.相当于事件的实现. 技术:实现IPostBackDataHandler接口 所包含的方法:LoadPostData() 搜索从浏览器传回的表单域. RaisePostDataChangedEvent() 引发表单域的值发生改变的事件 实现方式:从WebControl,IpostBackDataHandler继承 分别定义事件\视图\属性\表现\接口的方法. 处理回传数据,例如:button的事件就是用来处理回传事件的 技术:实现IpostBackEventHandler接口 包括:RaisePostBackEvent()方法,用于服务器端调用 Page.ClientScript.GetPostBackClientHyperlink(this,String.Empty)返回在浏览器引起表单回传的JavaScript. 传递回传时间参数 可为GetPostBackClientHyperlink()提供可选参数,其值可传到服务器端的RaisePostBackEvent()中. 使用回传选项 PostBackOptions类指定回传属性,例如ActionUrl跨页提交,验证,焦点等. Page.ClientScript.GetPostBackEventReference(options);实例化后传递给方法. 实现方式: 4. 使用控件属性集合 目的:创建表示对象集合的控件,如DropDownList 技术:ParseChildren attribute 如何分析控件包含内容 [ParseChildren(true)]所包含内容作属性分析 [ParseChildren[(false)]独立分析 ControlBuilder 自定义此类去修改控件解析内容 包含方法:AllowWhiteSpaceLiterals() 删除空间内容所有空白 AppendLiteralString()删除空间内容中中所有空白 GetChildControlType() 指定某种标签解析成哪种控件 AddParsedSubObject() 指定把哪些解析过的控件添加到Controls集合.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2013-01-16T10:57:47+08:00">
    <meta property="article:modified_time" content="2013-01-16T10:57:47+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">asp.net 自定义控件（2种方法）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-size:32px">概念</span><br> </p> 
<p>1.     构建自定义控件</p> 目的：创建类似MS自带的控件，具有属性、方法、事件等特性，利于重用。 
<br> 技术：HtmlTextWriter类---用于生成Html。 
<br> 该类所支持的方法： 
<br> AddAttribute()---给调用RenderBeginTag()生成的标签添加一个Html属性. 
<br> AddStyleAttribute()---给调用RenderBeginTag()生成的标签添加一个CSS属性. 
<br> RenderBeginTag()---生成开始Html标签. 
<br> WriteBreak()—生成&lt;br /&gt;标签 
<br> 方法所用枚举: 
<br> HtmlTextWriterTag---Html标签列表 
<br> HtmlTextWriterAttribute—Html属性列表 
<br> HtmlTextWriterStyle---CSS属性列表. 
<br> 重写RenderContents(HtmlTextWriter writer)用于呈现页面. 
<br> 组合控件包含子控件,在属性内要强制调用EnsureChildControls(),重写CreateChildControls()方法 
<br> 指定包围WebControl标签,重写HtmlTextWriter TagKey属性 
<br> 在混合控件中,两种方法都要重写. 
<br> 实现方式:在组件中编写代码.调用命名空间. 
<br> System.Web.UI.Control    所有控件的基类 
<br> System.Web.UI.WebControls.WebControl   含有开始结束标签 
<br> System.Web.UI.WebControls.CompositeControl           组合控件 
<br> 继承它们,然后在其中编写各种所需的属性\方法\事件.其布局方法用编码代替了直观的方法. 
<br>   
<br> 2.     视图状态和控件状态 
<br> 视图状态概念:利用一个_VIEWSTATE隐藏表单域在页面回传中保存控件属性的状态.应用于简单的值. 
<br> 目的:重复回传也能显示新文本 
<br> 实现方式:添加ViewStateText属性 
<br> 技术:ViewState[“Message”]=value 
<br> 控件状态概念:添加在控件状态中的值保存在_VIEWSTATE中,而它不能被禁用. 
<br> 目的:用于在页面回传中存贮最重要的信息 
<br> 技术:重写OnInit(EventArgs e) 
<br>            SaveControlState() 保存 
<br>            LoadControlState(object saveState)  加载 
<br>   
<br> 3.     处理回传数据 
<br> 目的:用于状态表单域数据传给控件.相当于事件的实现. 
<br> 技术:实现IPostBackDataHandler接口 
<br> 所包含的方法:LoadPostData()     搜索从浏览器传回的表单域. 
<br>                  RaisePostDataChangedEvent()  引发表单域的值发生改变的事件 
<br> 实现方式:从WebControl,IpostBackDataHandler继承 
<br>            分别定义事件\视图\属性\表现\接口的方法. 
<br> 处理回传数据,例如:button的事件就是用来处理回传事件的 
<br> 技术:实现IpostBackEventHandler接口 
<br> 包括:RaisePostBackEvent()方法,用于服务器端调用 
<br> Page.ClientScript.GetPostBackClientHyperlink(this,String.Empty)返回在浏览器引起表单回传的JavaScript. 
<br> 传递回传时间参数 
<br> 可为GetPostBackClientHyperlink()提供可选参数,其值可传到服务器端的RaisePostBackEvent()中. 
<br> 使用回传选项 
<br> PostBackOptions类指定回传属性,例如ActionUrl跨页提交,验证,焦点等. 
<br> Page.ClientScript.GetPostBackEventReference(options);实例化后传递给方法. 
<br> 实现方式: 
<br>   
<br> 4.     使用控件属性集合 
<br> 目的:创建表示对象集合的控件,如DropDownList 
<br> 技术:ParseChildren   attribute  如何分析控件包含内容 
<br> [ParseChildren(true)]所包含内容作属性分析 
<br> [ParseChildren[(false)]独立分析 
<br> ControlBuilder  自定义此类去修改控件解析内容 
<br>       包含方法:AllowWhiteSpaceLiterals()  删除空间内容所有空白 
<br>                  AppendLiteralString()删除空间内容中中所有空白 
<br>                  GetChildControlType()  指定某种标签解析成哪种控件 
<br> AddParsedSubObject() 指定把哪些解析过的控件添加到Controls集合. 
<br> 实现方式:判断内容解析成控件还是属性  ParseChildren 
<br>            构造要被解析的控件        Class 
<br>            是控件解析成何种控件      继承ControlBuilder  GetChildControlType() 
<br>            把解析过的控件加进Controls集合,剔除其他的.  AddParsedSubObject() 
<br>            再加入这种控件的其他功能 视图,回传 
<br>            构造控件的实现方式        RenderContents(------) 
<br> 5.     构建更好的设计器体验 
<br> 设计时属性(densign-time attribute),用于给属性关联某个编辑器 
<br> 如:[Category(“Movie”)] 
<br>       [Description(“Movie Title”)] 
<br>   
<br> 创建ControlDesigner改变自定义控件在设计视图中的外观 
<br> 创建ContainerControlDesigner 
<br> 目的:在设计时,添加子控件到其中. 
<br> 技术:继承ContainerControlDesigner 
<br> [Designer(typeof(GradientPanelDesigner))]关联attribute 
<br> 创建DesignerActionList 
<br> 目的:设计时添加智能标签功能 
<p><span style="font-size:32px">一、在类中写自定义控件</span></p> 
<p>自定义DropDownList：</p> 
<p>1，首先创建一个cs类文件Controls（采用工厂模式）</p> 
<p>using System.Collections.Generic;<br> using System.Text;<br> using System;<br> using System.IO;<br> using System.Drawing;<br> using System.Data;<br> using System.Data.SqlClient;<br> using System.Web.UI;<br> using System.Web.UI.WebControls;<br> using System.ComponentModel;<br> using System.Configuration;<br> using Model;<br> using BLL;<br> <br> <br> namespace Controls<br> {<!-- --><br>     public class <span style="color:#ff0000">useDepDropDownList : DropDownList</span><br>     {<!-- --></p> 
<p>//不带Session的自定义控件  <br>         public useDepDropDownList()<br>         {<!-- --><br>             this.Items.Add(new ListItem("全部部门", " "));<br>             foreach (DepInfo cat in Dep.GetDeps())<br>             {<!-- --><br>                 this.Items.Add(new ListItem(cat.Name, cat.Name));<br>             }<br>         }<br>     }<br>     public class <span style="color:#ff0000">CompanyDepDropDownList : DropDownList</span><br>     {<!-- --></p> 
<p>//带Session的自定义控件  <br>         public CompanyDepDropDownList()<br>         {<!-- --><br>             if (Context.Session["username"] != null)<br>             {                         <br>                 this.Items.Add(new ListItem("全部", "全部"));<br> <br> <br>                 foreach (GWInfo cat in GW.GetDepByloginid(Context.Session["username"].ToString()))<br>                 {<!-- --><br>                     this.Items.Add(new ListItem(cat.dep.ToString(), cat.dep.ToString()));<br>                 }<br>             }<br>         }</p> 
<p>}<br> }<br> </p> 
<p>2，创建一个页面aspx页面使用自定义的控件来绑定下拉框的数据</p> 
<p>&lt;%@ Page Language="C#" AutoEventWireup="true" CodeFile="Defaulthc.aspx.cs" Inherits="Import_Defaulthc" %&gt;<br> <span style="color:#ff0000"><strong>&lt;%@ Register Assembly="Controls" Namespace="Controls" TagPrefix="Hc" %&gt;</strong></span><br> <br> <br> &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;<br> <br> <br> &lt;html xmlns="http://www.w3.org/1999/xhtml" &gt;<br> &lt;head runat="server"&gt;<br>     &lt;title&gt;自定义控件绑定部门&lt;/title&gt;<br> &lt;/head&gt;<br> &lt;body&gt;<br>     &lt;form id="form1" runat="server"&gt;<br>     &lt;div&gt;<br>     部门<span style="color:#ff0000"><strong>&lt;Hc:useDepDropDownList</strong></span> ID="DropDownList1" runat="server" AutoPostBack="true"<br>                                             Width="120px"&gt;<br>                                        <strong> <span style="color:#ff0000">&lt;/Hc:useDepDropDownList&gt;</span></strong><br>     &lt;/div&gt;<br>     &lt;/form&gt;<br> &lt;/body&gt;<br> &lt;/html&gt;<br> </p> 
<p>这样就不用在UI页面的aspx.cs里写任何代码，而且自定义控件可重复使用省去很多重复代码</p> 
<p><br> </p> 
<p><span style="font-size:32px">二、还有一种方法vs里提供了<span style="font-family:tahoma,helvetica,arial; line-height:21px">自定义</span>Web用户<span style="font-family:tahoma,helvetica,arial; line-height:21px">控件（.ascx）</span></span><br> </p> 
<p></p> 
<p>同样在你的自定义控件.ascx.cs内写入方法，和上述相同</p> 
<p>public class <span style="color:rgb(255,0,0)">useDepDropDownList : DropDownList</span><br>     {<!-- --></p> 
<p>//不带Session的自定义控件  <br>         public useDepDropDownList()<br>         {<!-- --><br>             this.Items.Add(new ListItem("全部部门", " "));<br>             foreach (DepInfo cat in Dep.GetDeps())<br>             {<!-- --><br>                 this.Items.Add(new ListItem(cat.Name, cat.Name));<br>             }<br>         }<br>     }</p> 
<p>在调用它的 .aspx文件中同样需要在最上边加入自定义命名：<br> 首先要注册自定义控件，注册的语句要写到页面的上方（属于页面指令的位置。   ）<br> &lt;%@ Register TagPrefix="可自定义的控件前缀" TagName="自定义的控件标签名" Src="自定义控件的位置"%&gt;</p> 
<p><span style="color:#ff0000">&lt;%@ Register src="MyDDL.ascx" TagName="<span style="color:rgb(255,0,0)"><strong>useDepDropDownList</strong></span>"  TagPrefix="Hc" %&gt;</span></p> 
<p>然后在aspx文件中使用：<br> &lt;自定义的控件前缀:自定义的控件标签名 ID="yourControl" runat="server"&gt;&lt;/前缀:控件标签名&gt;</p> 
<p><span style="color:rgb(255,0,0)"><strong>&lt;Hc:useDepDropDownList</strong></span> <span style="color:#ff0000">ID="DropDownList1" runat="server" AutoPostBack="true"<br>                                             Width="120px"&gt;</span><br>                                        <strong> <span style="color:rgb(255,0,0)">&lt;/Hc:useDepDropDownList&gt;</span></strong><br> 使用自定义控件的属性在 .aspx.cs文件中调用就可以了：</p> 
<p><br> </p> 
<p>还可以在ascx中自己设计一个模版块,在aspx中引用,ascx.cs后台可以写任意方法</p> 
<p>.ascx代码</p> 
<p></p> 
<pre><code class="language-html">&lt;%@ Control Language="C#" AutoEventWireup="true" CodeFile="UserLeftControl.ascx.cs" Inherits="Controls_UserLeftControl" %&gt;

&lt;div style="text-align:left;"&gt;
      &lt;div&gt;
        &lt;h3&gt;登录用户信息&lt;/h3&gt;
        &lt;ul&gt;
          &lt;li&gt;用户名：&lt;span class="red"&gt;&lt;/span&gt;&lt;/li&gt;
		  &lt;li&gt;称呼：&lt;span &gt;&lt;/span&gt;&lt;/li&gt;
		  &lt;li&gt;性别：&lt;span &gt;&lt;/span&gt;&lt;/li&gt;
          &lt;li&gt;注册时间：&lt;span&gt;&lt;/span&gt;&lt;/li&gt;
          &lt;li&gt;[&lt;a style="color:Red" href="~/index.aspx" &gt;回到首页&lt;/a&gt;]&lt;/li&gt;
		   
        &lt;/ul&gt;
      &lt;/div&gt;
      &lt;div class="menber_link"&gt;
        &lt;h3&gt;管理中心&lt;/h3&gt;
        &lt;ul&gt;
        &lt;li&gt;&lt;a href="#"&gt;我的资料&lt;/a&gt;&lt;/li&gt; 
        &lt;li&gt;&lt;a href="#"&gt;我的收货地址&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href="#"&gt;修改密码&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href="#"&gt;我的订单&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href="#"&gt;我的积分&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href="#"&gt;我的收藏&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href="#"&gt;我的购物车&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href="#"&gt;投诉/建议/咨询&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;asp:LinkButton ID="linkbin" CausesValidation="false"  runat="server"&gt;安全退出&lt;/asp:LinkButton&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
    &lt;/div&gt;</code></pre> 
<br> aspx中引用自定义快 
<p></p> 
<p></p> 
<pre><code class="language-html">&lt;%@ Page Language="C#" AutoEventWireup="true" CodeFile="text1.aspx.cs" Inherits="text1" %&gt;
&lt;%@ Register src="~/Controls/UserLeftControl.ascx" TagName="UserLeftControl"  TagPrefix="Hc" %&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head id="Head1" runat="server"&gt;
    &lt;title&gt;Untitled Page&lt;/title&gt;
    &lt;link href="~/css/UserLeft.css" rel="stylesheet" type="text/css" /&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id="from1" runat="server"&gt;    
        &lt;div runat="server"&gt;
        &lt;Hc:UserLeftControl runat="server"&gt;&lt;/Hc:UserLeftControl&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<br> 
<br> 
<p>将编译好的dll添加到工具箱内</p> 
<p>在工具栏下面找个空白的地方点击右键--&gt;添加选项卡--&gt;选择项--&gt;浏览--&gt;找到自己编译好的dll--&gt;确定,这时候就能在工具箱的自定义选项卡内看到自己的控件了.<br> </p> 
<p><a target="_blank" href="http://msdn.microsoft.com/zh-cn/library/yhzc935f%28VS.80%29.aspx" rel="nofollow noopener noreferrer">http://msdn.microsoft.com/zh-cn/library/yhzc935f(VS.80).aspx</a></p> 
<p><a target="_blank" href="http://www.cnblogs.com/holywolf/archive/2008/12/23/1360316.html" rel="nofollow noopener noreferrer">http://www.cnblogs.com/holywolf/archive/2008/12/23/1360316.html</a><br> </p> 
<p><a target="_blank" href="http://blog.csdn.net/gujia200808/article/details/5403437" rel="noopener noreferrer">http://blog.csdn.net/gujia200808/article/details/5403437</a><br> </p> 
<p>注册AssemblyInfo.cs</p> 
<p><a target="_blank" href="http://blog.bossma.cn/dotnet/aspnet-custom-control-develop-2/" rel="nofollow noopener noreferrer">http://blog.bossma.cn/dotnet/aspnet-custom-control-develop-2/</a><br> </p> 
<p><span style="font-family:Arial"><span style="font-size:14px; line-height:26px"><span style="color:#33cc00">注:欢迎喜爱编程的朋友进群交流。QQ群交流：256169347</span><br> </span></span></p> 
<p><span style="font-family:Arial"><span style="font-size:14px; line-height:26px"><span style="color:#33cc00">群共享了很多pdf书籍文档</span></span></span></p> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3aaf5c87ba66f48309f3a3158e20e10e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Crawlzilla搭建</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/00e88d4ecfd262c8ddf1360b02738cde/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">集论几何学定理：一个球变成两个球</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>