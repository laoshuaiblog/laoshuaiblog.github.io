<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>J2EE之java自定义注解在项目中的使用 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/6b09f4d1eb31716c1b3a9025e9f90ac0/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="J2EE之java自定义注解在项目中的使用">
  <meta property="og:description" content="J2EE之java自定义注解在项目中的使用 源代码： Filter.java:
package com.imooc.test; @Table(&#34;user&#34;)//表名 public class Filter { @Column(&#34;id&#34;)//数据名 private int id; @Column(&#34;user_name&#34;)//数据名 private String userName; @Column(&#34;nick_name&#34;)//数据名 private String nickName; @Column(&#34;age&#34;)//数据名 private int age; @Column(&#34;city&#34;)//数据名 private String city; @Column(&#34;email&#34;)//数据名 private String email; @Column(&#34;mobile&#34;)//数据名 private String mobile; public int getId() { return id; } public void setId(int id) { this.id = id; } public String getUserName() { return userName; } public void setUserName(String userName) { this.userName = userName; } public String getNickName() { return nickName; } public void setNickName(String nickName) { this.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2016-10-27T15:19:08+08:00">
    <meta property="article:modified_time" content="2016-10-27T15:19:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">J2EE之java自定义注解在项目中的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="j2ee之java自定义注解在项目中的使用">J2EE之java自定义注解在项目中的使用</h2> 
<p><img src="https://images2.imgbox.com/14/c0/Bdpct2jj_o.png" alt="这里写图片描述" title=""> <br> <img src="https://images2.imgbox.com/0b/03/GVHlh5jD_o.png" alt="这里写图片描述" title=""></p> 
<h3 id="源代码">源代码：</h3> 
<p>Filter.java:</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.imooc.test;


<span class="hljs-annotation">@Table</span>(<span class="hljs-string">"user"</span>)<span class="hljs-comment">//表名</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Filter</span> {<!-- --></span>

    <span class="hljs-annotation">@Column</span>(<span class="hljs-string">"id"</span>)<span class="hljs-comment">//数据名</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;

    <span class="hljs-annotation">@Column</span>(<span class="hljs-string">"user_name"</span>)<span class="hljs-comment">//数据名</span>
    <span class="hljs-keyword">private</span> String userName;

    <span class="hljs-annotation">@Column</span>(<span class="hljs-string">"nick_name"</span>)<span class="hljs-comment">//数据名</span>
    <span class="hljs-keyword">private</span> String nickName;

    <span class="hljs-annotation">@Column</span>(<span class="hljs-string">"age"</span>)<span class="hljs-comment">//数据名</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;

    <span class="hljs-annotation">@Column</span>(<span class="hljs-string">"city"</span>)<span class="hljs-comment">//数据名</span>
    <span class="hljs-keyword">private</span> String city;

    <span class="hljs-annotation">@Column</span>(<span class="hljs-string">"email"</span>)<span class="hljs-comment">//数据名</span>
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-annotation">@Column</span>(<span class="hljs-string">"mobile"</span>)<span class="hljs-comment">//数据名</span>
    <span class="hljs-keyword">private</span> String mobile;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getId</span>() {
        <span class="hljs-keyword">return</span> id;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span>(<span class="hljs-keyword">int</span> id) {
        <span class="hljs-keyword">this</span>.id = id;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getUserName</span>() {
        <span class="hljs-keyword">return</span> userName;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserName</span>(String userName) {
        <span class="hljs-keyword">this</span>.userName = userName;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getNickName</span>() {
        <span class="hljs-keyword">return</span> nickName;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setNickName</span>(String nickName) {
        <span class="hljs-keyword">this</span>.nickName = nickName;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAge</span>() {
        <span class="hljs-keyword">return</span> age;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span>(<span class="hljs-keyword">int</span> age) {
        <span class="hljs-keyword">this</span>.age = age;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getCity</span>() {
        <span class="hljs-keyword">return</span> city;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCity</span>(String city) {
        <span class="hljs-keyword">this</span>.city = city;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getEmail</span>() {
        <span class="hljs-keyword">return</span> email;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEmail</span>(String email) {
        <span class="hljs-keyword">this</span>.email = email;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getMobile</span>() {
        <span class="hljs-keyword">return</span> mobile;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMobile</span>(String mobile) {
        <span class="hljs-keyword">this</span>.mobile = mobile;
    }


}
</code></pre> 
<p>Table.java:</p> 
<pre class="prettyprint"><code class=" hljs avrasm">package <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.imooc</span><span class="hljs-preprocessor">.test</span><span class="hljs-comment">;</span>

import java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.ElementType</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.Retention</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.RetentionPolicy</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.Target</span><span class="hljs-comment">;</span>


@Target({ElementType<span class="hljs-preprocessor">.TYPE</span>})
@Retention(RetentionPolicy<span class="hljs-preprocessor">.RUNTIME</span>)
public @interface Table {

    String value()<span class="hljs-comment">;</span>
}
</code></pre> 
<p>Column.java:</p> 
<pre class="prettyprint"><code class=" hljs avrasm">package <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.imooc</span><span class="hljs-preprocessor">.test</span><span class="hljs-comment">;</span>

import java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.ElementType</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.Retention</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.RetentionPolicy</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.Target</span><span class="hljs-comment">;</span>


@Target({ElementType<span class="hljs-preprocessor">.FIELD</span>})//字段上面
@Retention(RetentionPolicy<span class="hljs-preprocessor">.RUNTIME</span>)
public @interface Column {

    String value()<span class="hljs-comment">;</span>
}
</code></pre> 
<p>Test.java:</p> 
<pre class="prettyprint"><code class=" hljs avrasm">package <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.imooc</span><span class="hljs-preprocessor">.test</span><span class="hljs-comment">;</span>

import java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.Field</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.Method</span><span class="hljs-comment">;</span>

import javax<span class="hljs-preprocessor">.swing</span><span class="hljs-preprocessor">.plaf</span><span class="hljs-preprocessor">.basic</span><span class="hljs-preprocessor">.BasicBorders</span><span class="hljs-preprocessor">.SplitPaneBorder</span><span class="hljs-comment">;</span>

public class Test {
    public static void main(String[] args) {
        Filter f1=new Filter()<span class="hljs-comment">;</span>
        f1<span class="hljs-preprocessor">.setId</span>(<span class="hljs-number">10</span>)<span class="hljs-comment">;//查询id为10的用户</span>

        Filter f2=new Filter()<span class="hljs-comment">;</span>
        f2<span class="hljs-preprocessor">.setUserName</span>(<span class="hljs-string">"lucy"</span>)<span class="hljs-comment">;//模糊查询用户名为lucy的用户</span>
        f2<span class="hljs-preprocessor">.setId</span>(<span class="hljs-number">18</span>)<span class="hljs-comment">;</span>

        Filter f3=new Filter()<span class="hljs-comment">;</span>
        f3<span class="hljs-preprocessor">.setEmail</span>(<span class="hljs-string">"liu@sina.com,77777@qq.com"</span>)<span class="hljs-comment">;//查询邮箱为其中任意一个的用户</span>

        String sql1=query(f1)<span class="hljs-comment">;</span>
        String sql2=query(f2)<span class="hljs-comment">;</span>
        String sql3=query(f3)<span class="hljs-comment">;</span>

        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(sql1)<span class="hljs-comment">;</span>
        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(sql2)<span class="hljs-comment">;</span>
        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(sql3)<span class="hljs-comment">;</span>
    }

    private static String query(Filter f){
        StringBuffer sb=new StringBuffer()<span class="hljs-comment">;</span>
        //<span class="hljs-number">1.</span>获取到class
        Class c=f<span class="hljs-preprocessor">.getClass</span>()<span class="hljs-comment">;</span>
        //<span class="hljs-number">2.</span>获取到table的名字
        boolean exists=c<span class="hljs-preprocessor">.isAnnotationPresent</span>(Table<span class="hljs-preprocessor">.class</span>)<span class="hljs-comment">;</span>
        if(!exists){
            return null<span class="hljs-comment">;</span>
        }
        Table t=(Table)c<span class="hljs-preprocessor">.getAnnotation</span>(Table<span class="hljs-preprocessor">.class</span>)<span class="hljs-comment">;</span>
        String tableName=t<span class="hljs-preprocessor">.value</span>()<span class="hljs-comment">;</span>
        sb<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"select * from"</span>)<span class="hljs-preprocessor">.append</span>(tableName)<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">" where 1=1"</span>)<span class="hljs-comment">;</span>

        //<span class="hljs-number">3.</span>遍历所有的字段
        Field[] fArray=c<span class="hljs-preprocessor">.getDeclaredFields</span>()<span class="hljs-comment">;</span>
        for (Field field : fArray) {
            //<span class="hljs-number">4.</span>处理每个字段对应的sql
            //<span class="hljs-number">4.1</span>拿到字段名
            boolean fExists=field<span class="hljs-preprocessor">.isAnnotationPresent</span>(Column<span class="hljs-preprocessor">.class</span>)<span class="hljs-comment">;</span>
            if(!fExists){
                continue<span class="hljs-comment">;</span>
            }
            Column column=field<span class="hljs-preprocessor">.getAnnotation</span>(Column<span class="hljs-preprocessor">.class</span>)<span class="hljs-comment">;</span>
            String columnName=column<span class="hljs-preprocessor">.value</span>()<span class="hljs-comment">;</span>
            //<span class="hljs-number">4.2</span>拿到字段值
            String fieldName=field<span class="hljs-preprocessor">.getName</span>()<span class="hljs-comment">;</span>
            String getMethodName=<span class="hljs-string">"get"</span>+fieldName<span class="hljs-preprocessor">.substring</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<span class="hljs-preprocessor">.toUpperCase</span>()+fieldName<span class="hljs-preprocessor">.substring</span>(<span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
            Object fieldValue=null<span class="hljs-comment">;</span>
            try {
                Method getMethod=c<span class="hljs-preprocessor">.getMethod</span>(getMethodName)<span class="hljs-comment">;</span>
                fieldValue=getMethod<span class="hljs-preprocessor">.invoke</span>(f)<span class="hljs-comment">;</span>
            } catch (Exception e) {
                e<span class="hljs-preprocessor">.printStackTrace</span>()<span class="hljs-comment">;</span>
            }

            //<span class="hljs-number">4.3</span>拼装sql
            if(fieldValue==null||(fieldValue instanceof Integer &amp;&amp; (Integer)fieldValue==<span class="hljs-number">0</span>)){
                continue<span class="hljs-comment">;</span>
            }
            sb<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">" and "</span>)<span class="hljs-preprocessor">.append</span>(fieldName)<span class="hljs-comment">;</span>
            if(fieldValue instanceof String){
                if(((String) fieldValue)<span class="hljs-preprocessor">.contains</span>(<span class="hljs-string">","</span>)){
                    String[] values= ((String)fieldValue)<span class="hljs-preprocessor">.split</span>(<span class="hljs-string">","</span>)<span class="hljs-comment">;</span>
                    sb<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">" in("</span>)<span class="hljs-comment">;</span>
                    for (String v : values) {
                        sb<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"'"</span>)<span class="hljs-preprocessor">.append</span>(v)<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"'"</span>)<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">","</span>)<span class="hljs-comment">;</span>
                    }
                    sb<span class="hljs-preprocessor">.deleteCharAt</span>(sb<span class="hljs-preprocessor">.length</span>()-<span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
                    sb<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">")"</span>)<span class="hljs-comment">;</span>
                }else{
                    sb<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"="</span>)<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"'"</span>)<span class="hljs-preprocessor">.append</span>(fieldValue)<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"'"</span>)<span class="hljs-comment">;</span>
                }

            }else if(fieldValue instanceof Integer){
                sb<span class="hljs-preprocessor">.append</span>(<span class="hljs-string">"="</span>)<span class="hljs-preprocessor">.append</span>(fieldValue)<span class="hljs-comment">;</span>
            }

            return sb<span class="hljs-preprocessor">.toString</span>()<span class="hljs-comment">;</span>
        }

        return null<span class="hljs-comment">;</span>
    }
}
</code></pre> 
<p><img src="https://images2.imgbox.com/ef/98/fR0BPs86_o.png" alt="这里写图片描述" title=""></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/52916c14be3c33b6f84d2fd5ad893111/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">J2EE之java的注解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5af771a6b5ed4bdcf03a47170f36f0ce/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android 仪表进度条 自定义View</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>