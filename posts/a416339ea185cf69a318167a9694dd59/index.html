<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Cloudera Impala RPM安装 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/a416339ea185cf69a318167a9694dd59/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Cloudera Impala RPM安装">
  <meta property="og:description" content="官方文档地址，建议通读以下2篇文章：
https://www.cloudera.com/documentation/enterprise/5-6-x/topics/impala_noncm_installation.html
https://www.cloudera.com/documentation/enterprise/5-6-x/topics/impala_config_options.html
在使用RPM安装之前，我花了一天时间去使用源码编译安装，由于官方文档以及网上没有太多关于源码安装的方法，最后编译完成也无法使用。关于这一点，我感觉Cloudera是故意的。
RPM安装总体比较简单，步骤如下：
1. 新建impala用户及组
groupadd impala useradd -g impala impal 2. 配置CDH yum源,下面的源是我使用CDH5的改了一下baseurl及gpgkey.
[root@xxxx catalog]# cat /etc/yum.repos.d/cloudera-cdh6.repo [cloudera-cdh6] # Packages for Cloudera&#39;s Distribution for Hadoop, Version 5, on RedHat or CentOS 6 x86_64 name=Cloudera&#39;s Distribution for Hadoop, Version 6 baseurl=https://archive.cloudera.com/cdh6/6.2.0/redhat6/yum/ gpgkey =https://archive.cloudera.com/cdh6/6.2.0/redhat6/yum/RPM-GPG-KEY-cloudera gpgcheck = 1 3. 安装impala-server, impala-catalogd, impala statestore
$ sudo yum install impala # Binaries for daemons $ sudo yum install impala-server # Service start/stop script $ sudo yum install impala-state-store # Service start/stop script $ sudo yum install impala-catalog # Service start/stop script $ sudo yum install impala-shell 安装impala会有相当多的依赖包，总共大约1G，我粗略的看了一下，https://archive.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-05-01T16:48:09+08:00">
    <meta property="article:modified_time" content="2019-05-01T16:48:09+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Cloudera Impala RPM安装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>官方文档地址，建议通读以下2篇文章：</p> 
<p><a href="https://www.cloudera.com/documentation/enterprise/5-6-x/topics/impala_noncm_installation.html" rel="nofollow">https://www.cloudera.com/documentation/enterprise/5-6-x/topics/impala_noncm_installation.html</a></p> 
<p><a href="https://www.cloudera.com/documentation/enterprise/5-6-x/topics/impala_config_options.html" rel="nofollow">https://www.cloudera.com/documentation/enterprise/5-6-x/topics/impala_config_options.html</a></p> 
<p>在使用RPM安装之前，我花了一天时间去使用源码编译安装，由于官方文档以及网上没有太多关于源码安装的方法，最后编译完成也无法使用。关于这一点，我感觉Cloudera是故意的。</p> 
<p>RPM安装总体比较简单，步骤如下：</p> 
<p>1. 新建impala用户及组</p> 
<pre class="has"><code>groupadd impala
useradd -g impala impal</code></pre> 
<p>2. 配置CDH yum源,下面的源是我使用CDH5的改了一下baseurl及gpgkey.</p> 
<pre class="has"><code>[root@xxxx catalog]# cat /etc/yum.repos.d/cloudera-cdh6.repo 
[cloudera-cdh6]
# Packages for Cloudera's Distribution for Hadoop, Version 5, on RedHat or CentOS 6 x86_64
name=Cloudera's Distribution for Hadoop, Version 6
baseurl=https://archive.cloudera.com/cdh6/6.2.0/redhat6/yum/
gpgkey =https://archive.cloudera.com/cdh6/6.2.0/redhat6/yum/RPM-GPG-KEY-cloudera    
gpgcheck = 1</code></pre> 
<p>3. 安装impala-server, impala-catalogd, impala statestore</p> 
<pre class="has"><code>$ sudo yum install impala             # Binaries for daemons
$ sudo yum install impala-server      # Service start/stop script
$ sudo yum install impala-state-store # Service start/stop script
$ sudo yum install impala-catalog     # Service start/stop script
$ sudo yum install impala-shell</code></pre> 
<p>安装impala会有相当多的依赖包，总共大约1G，我粗略的看了一下，<a href="https://archive.cloudera.com/cdh6/6.2.0/redhat6/yum/" rel="nofollow">https://archive.cloudera.com/cdh6/6.2.0/redhat6/yum/</a> 这个地址下的软件包全部安装上去了。</p> 
<p>安装完成之后，可以先尝试在同一台机器重启上述3个进程，如果正常，表示安装成功。</p> 
<p>4. 新建/etc/impala/conf目录，并拷贝hive-site.xml,  hdfs-site.xml, core-site.xml，如果有hbase等以来也一并拷贝进去即可。</p> 
<pre class="has"><code>[root@xxx  conf.dist]# cd /etc/impala/conf
[root@xxx  conf]# ls -l
total 180
-rw-r--r--. 1 root root   3707 May  1 07:58 core-site.xml
-rw-r--r--. 1 root root   3102 May  1 07:58 hadoop-env.sh
-rw-r--r--. 1 root root   3288 May  1 07:58 hdfs-site.xml
-rw-r--r--. 1 root root 168441 May  1 05:10 hive-site.xml</code></pre> 
<p>5. 修改impala配置文件: /etc/default/impala</p> 
<p>安装完RPM会自动生成/etc/default/impala, /usr/lib/impala/lib等目录。以下配置不是默认的，我增加了一些，诸如 -mem_limit=30% -max_log_files=10</p> 
<pre class="has"><code>[root@xxxx   conf]# cat /etc/default/impala 
IMPALA_CATALOG_SERVICE_HOST=10.40.2.175
IMPALA_STATE_STORE_HOST=10.40.2.175
IMPALA_STATE_STORE_PORT=24000
IMPALA_BACKEND_PORT=22000
IMPALA_LOG_DIR=/var/log/impala

IMPALA_CATALOG_ARGS=" -log_dir=${IMPALA_LOG_DIR} \
                      -catalog_service_port=26000 \
                      -max_log_files=10 \
                      -enable_webserver=true \
                      -mem_limit=10%"
IMPALA_STATE_STORE_ARGS=" -log_dir=${IMPALA_LOG_DIR} \
                          -state_store_port=${IMPALA_STATE_STORE_PORT} \
                          -state_store_num_server_worker_threads=4 \
                          -max_log_files=10"
IMPALA_SERVER_ARGS=" \
    -log_dir=${IMPALA_LOG_DIR} \
    -catalog_service_host=${IMPALA_CATALOG_SERVICE_HOST} \
    -state_store_port=${IMPALA_STATE_STORE_PORT} \
    -use_statestore \
    -state_store_host=${IMPALA_STATE_STORE_HOST} \
    -be_port=${IMPALA_BACKEND_PORT} \
    -max_log_files=10 \
    -max_result_cache_size=100000 \
    -abort_on_config_error=true \
    -mem_limit=30% "

ENABLE_CORE_DUMPS=false

LIBHDFS_OPTS=-Djava.library.path=/usr/lib/impala/lib
MYSQL_CONNECTOR_JAR=/usr/share/java/mysql-connector-java.jar
IMPALA_BIN=/usr/lib/impala/sbin
IMPALA_HOME=/usr/lib/impala
HIVE_HOME=/data/hive
#HBASE_HOME=/usr/lib/hbase
IMPALA_CONF_DIR=/etc/impala/conf
HADOOP_CONF_DIR=/etc/impala/conf
HIVE_CONF_DIR=/etc/impala/conf
#HBASE_CONF_DIR=/etc/impala/conf</code></pre> 
<p>然后重新启动服务。</p> 
<p>6. 测试impala-shell</p> 
<pre class="has"><code>
[root@xxxx  conf]# impala-shell 
Starting Impala Shell without Kerberos authentication
Opened TCP connection to xxxxxxx:21000
Connected to xxxxxxx:21000
Server version: impalad version 3.2.0-cdh6.2.0 RELEASE (build edc19942b4debdbfd485fbd26098eef435003f5d)
***********************************************************************************
Welcome to the Impala shell.
(Impala Shell v3.2.0-cdh6.2.0 (edc1994) built on Thu Mar 14 00:14:36 PDT 2019)

The '-B' command line flag turns off pretty-printing for query results. Use this
flag to remove formatting from results you want to save for later, or to benchmark
Impala.
***********************************************************************************
[xxxxxxx:21000] default&gt; show databases;
Query: show databases
+------------------+----------------------------------------------+
| name             | comment                                      |
+------------------+----------------------------------------------+
| _impala_builtins | System database for Impala builtin functions |
| default          | Default Hive database                        |
+------------------+----------------------------------------------+
Fetched 2 row(s) in 0.01s
[xxxxxxxx:21000] default&gt; use default;
Query: use default
[tsczbddbprd3.trinasolar.com:21000] default&gt; select count(*) from jlwang2;
Query: select count(*) from jlwang2
Query submitted at: 2019-05-01 08:37:39 (Coordinator: http://xxxxxx:25000)
Query progress can be monitored at: http://xxxxxx:25000/query_plan?query_id=ec4131fa1d7e78a1:e9ebcc500000000
+----------+
| count(*) |
+----------+
| 0        |
+----------+
Fetched 1 row(s) in 5.64s
[xxxxx:21000] default&gt; </code></pre> 
<p>7. 经过上述过程，impala就安装好了，客户端只需要yum install impala-shell即可，而且impala-shell没有任何依赖，任何一台机器作为impala的客户端只需要安装一个impala-shell.</p> 
<p>之前提过安装impala守护进程的依赖包有1G，安装完之后会在/usr/bin及/usr/lib等目录下产生文件，很多是命令，比如impala依赖hive, 因此/usr/bin会产生hive的命令。</p> 
<p>关于这一点非常头疼，按照官方文档的推荐，每个datanode都安装一个impala进程 (这是因为short read的功能，也就是impala直接读取HDFS数据而不通过datanode服务）, 可想而知，每台机器都产生那么多垃圾文件，而且这些文件有可能会影响我们。比如一台机器是HIVE，然后因为安装了impala又产生了一个hive命令，如下：</p> 
<pre class="has"><code>[root@xxx  conf]# hive
Error: Could not find or load main class org.apache.hadoop.util.VersionInfo
Unable to determine Hadoop version information.
'hadoop version' returned:
Error: Could not find or load main class org.apache.hadoop.util.VersionInfo

[root@xxx  conf]# hadoop version
Error: Could not find or load main class org.apache.hadoop.util.VersionInfo
[root@tsczbddbprd3 conf]# which hive
/usr/bin/hive</code></pre> 
<p>关于这一点好像是用RPM是无解的。</p> 
<p>8. 通过imapla web端口分别查看impalad, catalogd, statestore服务相关信息：</p> 
<pre class="has"><code>http://xxxxxx:25000/25010/25020</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1211b08041d964c3839f9b98bc1fe895/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;Builder的基本功能</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/040673300691e880fc237e5c795eff5b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">编译原理 —— 正规文法转换为正规式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>