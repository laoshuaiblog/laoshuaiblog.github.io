<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pve组网实现公网访问pve,访问电脑，访问pve中的openwrt同时经过openwrt穿透主路由地址nginx全公网访问最佳办法测试研究... - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/e34d3bd67189eb11877824197aea003c/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="pve组网实现公网访问pve,访问电脑，访问pve中的openwrt同时经过openwrt穿透主路由地址nginx全公网访问最佳办法测试研究...">
  <meta property="og:description" content=" 一台路由器 做主路由
工控机 装pve虚拟机 虚拟机里面装一个openwrt,
外网可以直接访问pve,可以访问pve里的openwrt
一台主机 可选择连
有4个口，分别eth0,eth1,eth2,eth3
pve有管理口 这个情况下 ，没有openwrt 直接电脑和pve管理口连在一起就能进pve管理界面
情况2 假设pve 的管理口味eth0
openwrt中桥接的是eth0 eth1 eth2
那么电脑连接eth3或者pve管理口设置eth3，那么openwrt也是无法访问eth3口的
情况3 openwrt的eth1连的主路由，外网经过主路由要访问pve口， 前提就是要eth1和eth0进行桥接，否则在eth1是无法访问eth0的。
让pve和电脑，pve中的openwrt互相ping通 管理口为eth0,eth0的网线连主路由， 电脑也连主路由或者旁路由其他口，
pve里面有一个虚拟机，是旁路由，这种情况ok.
确保pve添加4个虚拟设备
image.png 但是当电脑连的是4口的旁路由时，如果把openwrt关闭，那么桥接失去了作用，主机的eth0无法和eth其他通讯，因此此时电脑无法访问pve管理口。
当openwrt关闭(关闭桥接)也可通过电脑无线网卡连接主路由的wifi,然后再次访问发现又能通了，因此确认此时走的是从无线走的pve
openwrt情况
image.png 假如openwrt只桥接了eth0 eth1 eth2 没有桥接eth3 ，电脑连接eth3时，pve中的openwrt ping电脑本地网卡ip无法ping通
但是，当电脑网线插到eth2时，openwrt可ping通电脑
但是测试pve ping电脑ip ,eth0(pve)和eth3通讯(电脑网线,wifi未连主路由) ，正常
补充openwrt中的桥接配置，实现4口变成交换机可互相通讯，(旁路由不再是路由)
image.png ">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-08-10T20:49:33+08:00">
    <meta property="article:modified_time" content="2023-08-10T20:49:33+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pve组网实现公网访问pve,访问电脑，访问pve中的openwrt同时经过openwrt穿透主路由地址nginx全公网访问最佳办法测试研究...</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <article class="_2rhmJa" style="font-size: 16px;"> 
 <p>一台路由器 做主路由<br> 工控机 装pve虚拟机 虚拟机里面装一个openwrt,<br> 外网可以直接访问pve,可以访问pve里的openwrt</p> 
 <p>一台主机 可选择连</p> 
 <p>有4个口，分别eth0,eth1,eth2,eth3<br> pve有管理口 这个情况下 ，没有openwrt 直接电脑和pve管理口连在一起就能进pve管理界面</p> 
 <h2>情况2</h2> 
 <p>假设pve 的管理口味eth0<br> openwrt中桥接的是eth0 eth1 eth2<br> 那么电脑连接eth3或者pve管理口设置eth3，那么openwrt也是无法访问eth3口的</p> 
 <h2>情况3</h2> 
 <p>openwrt的eth1连的主路由，外网经过主路由要访问pve口， 前提就是要eth1和eth0进行桥接，否则在eth1是无法访问eth0的。</p> 
 <h2>让pve和电脑，pve中的openwrt互相ping通</h2> 
 <p>管理口为eth0,eth0的网线连主路由， 电脑也连主路由或者旁路由其他口，<br> pve里面有一个虚拟机，是旁路由，这种情况ok.<br> 确保pve添加4个虚拟设备</p> 
 <div class="image-package"> 
  <div class="image-container"> 
   <div class="image-view" style="text-align: center;"> 
    <img src="https://images2.imgbox.com/49/63/FyXxnlxM_o.png" style="outline: none;"> 
   </div> 
  </div> 
  <div class="image-caption">
    image.png 
  </div> 
 </div> 
 <p>但是当电脑连的是4口的旁路由时，如果把openwrt关闭，那么桥接失去了作用，主机的eth0无法和eth其他通讯，因此此时电脑无法访问pve管理口。<br> 当openwrt关闭(关闭桥接)也可通过电脑无线网卡连接主路由的wifi,然后再次访问发现又能通了，因此确认此时走的是从无线走的pve</p> 
 <p>openwrt情况</p> 
 <div class="image-package"> 
  <div class="image-container"> 
   <div class="image-view" style="text-align: center;"> 
    <img src="https://images2.imgbox.com/e2/e5/XHTagKcu_o.png" style="outline: none;"> 
   </div> 
  </div> 
  <div class="image-caption">
    image.png 
  </div> 
 </div> 
 <p>假如openwrt只桥接了eth0 eth1 eth2 没有桥接eth3 ，电脑连接eth3时，pve中的openwrt ping电脑本地网卡ip无法ping通<br> 但是，当电脑网线插到eth2时，openwrt可ping通电脑<br> 但是测试pve ping电脑ip ,eth0(pve)和eth3通讯(电脑网线,wifi未连主路由) ，正常<br> 补充openwrt中的桥接配置，实现4口变成交换机可互相通讯，(旁路由不再是路由)</p> 
 <div class="image-package"> 
  <div class="image-container"> 
   <div class="image-view" style="text-align: center;"> 
    <img src="https://images2.imgbox.com/fe/d6/1DYzdk8o_o.png" style="outline: none;"> 
   </div> 
  </div> 
  <div class="image-caption">
    image.png 
  </div> 
 </div> 
</article>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8fc18057b4005fc0dadd1938408d69ff/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VMWare Workstation中NAT模式设置静态IP</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/66c0d229fef5e005b2a7b024ce0a85b1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">动态代理中的死循环导致的java.lang.StackOverflowError</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>