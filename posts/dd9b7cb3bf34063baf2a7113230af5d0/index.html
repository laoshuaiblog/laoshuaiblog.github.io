<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 仪表盘 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/dd9b7cb3bf34063baf2a7113230af5d0/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Android 仪表盘">
  <meta property="og:description" content="1：概述 在以前的项目中，需要实现一个根据用户的压力值显示不同的进度（类似仪表盘）圆弧的进度条。实现的原理其实很简单 ，自定义View 重写onDraw（）方法在里面同一圆心画三个不同半径颜色实心圆弧，主要了解canvas.drawArc(rectF, startAngle, sweepAngle, true, mPaint);的使用，五个参数的意思分别表示，圆弧的位置和大小，圆弧开始角度，圆弧的结束角度，是否经过圆心，画笔， 我们只要动态改变 sweepAngle 参数就能达到我们想要的效果，废话不多说，直接看代码。 说了一大推先上个效果图
下面是实现代码
自定义的CustomSectorView.java
package com.example.wem.sectorviewdemo.widget; import android.content.Context; import android.graphics.Canvas; import android.graphics.Color; import android.graphics.Paint; import android.graphics.RectF; import android.util.AttributeSet; import android.util.Log; import android.view.View; public class CustomSectorView extends View { private static final String TAG = CustomSectorView.class.getSimpleName(); private float startAngle = 180, sweepAngle = 180; private float pointerStartAngle = 180, pointerSweepAngle = 0; private Paint mPaint; public CustomSectorView(Context context) { super(context); } public CustomSectorView(Context context, AttributeSet attrs) { super(context, attrs); mPaint = new Paint(); } @Override protected void onDraw(Canvas canvas) { float width = getWidth(); float height = getHeight(); int left = (int) (width / 6 &#43; 0.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2017-02-08T10:11:42+08:00">
    <meta property="article:modified_time" content="2017-02-08T10:11:42+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 仪表盘</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3 id="1概述">1：概述</h3> 
<ol><li>在以前的项目中，需要实现一个根据用户的压力值显示不同的进度（类似仪表盘）圆弧的进度条。</li><li>实现的原理其实很简单 ，自定义View 重写onDraw（）方法在里面同一圆心画三个不同半径颜色实心圆弧，主要了解canvas.drawArc(rectF, startAngle, sweepAngle, true, mPaint);的使用，五个参数的意思分别表示，圆弧的位置和大小，圆弧开始角度，圆弧的结束角度，是否经过圆心，画笔， 我们只要动态改变 sweepAngle 参数就能达到我们想要的效果，废话不多说，直接看代码。</li></ol> 
<blockquote> 
 <p>说了一大推先上个效果图</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/2b/ca/eOIHwy9g_o.gif" alt="优雅的实现圆弧进度条" title=""></p> 
<p>下面是实现代码</p> 
<p>自定义的CustomSectorView.java</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.example.wem.sectorviewdemo.widget;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.graphics.Canvas;
<span class="hljs-keyword">import</span> android.graphics.Color;
<span class="hljs-keyword">import</span> android.graphics.Paint;
<span class="hljs-keyword">import</span> android.graphics.RectF;
<span class="hljs-keyword">import</span> android.util.AttributeSet;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.View;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomSectorView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">View</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = CustomSectorView.class.getSimpleName();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span> startAngle = <span class="hljs-number">180</span>, sweepAngle = <span class="hljs-number">180</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span> pointerStartAngle = <span class="hljs-number">180</span>, pointerSweepAngle = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> Paint mPaint;

    <span class="hljs-keyword">public</span> <span class="hljs-title">CustomSectorView</span>(Context context) {
        <span class="hljs-keyword">super</span>(context);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title">CustomSectorView</span>(Context context, AttributeSet attrs) {
        <span class="hljs-keyword">super</span>(context, attrs);
        mPaint = <span class="hljs-keyword">new</span> Paint();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDraw</span>(Canvas canvas) {
        <span class="hljs-keyword">float</span> width = getWidth();
        <span class="hljs-keyword">float</span> height = getHeight();
        <span class="hljs-keyword">int</span> left = (<span class="hljs-keyword">int</span>) (width / <span class="hljs-number">6</span> + <span class="hljs-number">0.5</span>f);
        Log.d(TAG, <span class="hljs-string">"onDraw: width=="</span> + width + <span class="hljs-string">" height=="</span> + height);
        RectF rectF = <span class="hljs-keyword">new</span> RectF(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height); <span class="hljs-comment">//设置圆弧的位置和大小</span>
        mPaint.setColor(<span class="hljs-number">0xff8bc5ba</span>);<span class="hljs-comment">//设置画笔颜色</span>
        mPaint.setAntiAlias(<span class="hljs-keyword">true</span>);<span class="hljs-comment">//取消锯齿</span>
        mPaint.setStrokeWidth(<span class="hljs-number">5</span>);<span class="hljs-comment">//设置画笔宽度</span>
        mPaint.setStyle(Paint.Style.FILL);<span class="hljs-comment">//设置画笔为填充模式</span>
        canvas.drawArc(rectF, startAngle, sweepAngle, <span class="hljs-keyword">true</span>, mPaint);
        mPaint.setColor(<span class="hljs-number">0xff3b083f</span>);
        canvas.drawArc(rectF, pointerStartAngle, pointerSweepAngle, <span class="hljs-keyword">true</span>, mPaint);
        mPaint.setColor(Color.WHITE);
        RectF innerRectf = <span class="hljs-keyword">new</span> RectF(left, left, <span class="hljs-number">5</span> * left, <span class="hljs-number">5</span> * left);
        canvas.drawArc(innerRectf, startAngle, sweepAngle, <span class="hljs-keyword">true</span>, mPaint);
    }


    <span class="hljs-javadoc">/**
     * 设置圆弧的角度
     *
     *<span class="hljs-javadoctag"> @param</span> pointerSweepAngle
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPointerSweepAngle</span>(<span class="hljs-keyword">float</span> pointerSweepAngle) {
        <span class="hljs-keyword">this</span>.pointerSweepAngle = pointerSweepAngle;
        invalidate();
    }
}
</code></pre> 
<p>MainActivity.java</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.example.wem.sectorviewdemo;

<span class="hljs-keyword">import</span> android.animation.ObjectAnimator;
<span class="hljs-keyword">import</span> android.animation.ValueAnimator;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.support.v7.app.AppCompatActivity;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.Button;
<span class="hljs-keyword">import</span> android.widget.ImageView;

<span class="hljs-keyword">import</span> com.example.wem.sectorviewdemo.widget.CustomSectorView;

<span class="hljs-keyword">import</span> java.util.Timer;
<span class="hljs-keyword">import</span> java.util.TimerTask;

<span class="hljs-keyword">import</span> butterknife.BindView;
<span class="hljs-keyword">import</span> butterknife.ButterKnife;
<span class="hljs-keyword">import</span> butterknife.OnClick;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TAG = MainActivity.class.getSimpleName();
    <span class="hljs-annotation">@BindView</span>(R.id.start_button)
    Button mStartButton;
    <span class="hljs-annotation">@BindView</span>(R.id.stop_button)
    Button mStopButton;
    <span class="hljs-annotation">@BindView</span>(R.id.custom_sector)
    CustomSectorView mCustomSector;
    <span class="hljs-annotation">@BindView</span>(R.id.pointer_imageview)
    ImageView mPointerImageview;
    <span class="hljs-keyword">private</span> Timer mTimer = <span class="hljs-keyword">new</span> Timer();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> currentMeter = <span class="hljs-number">0</span>;  <span class="hljs-comment">//当前旋转的角度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> lastMeter = <span class="hljs-number">0</span>;  <span class="hljs-comment">//旋转后的角度</span>

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        ButterKnife.bind(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-annotation">@OnClick</span>({R.id.start_button, R.id.stop_button})
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View view) {
        <span class="hljs-keyword">switch</span> (view.getId()) {
            <span class="hljs-keyword">case</span> R.id.start_button:
                startTimer();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> R.id.stop_button:
                stopTimer();
                <span class="hljs-keyword">break</span>;
        }
    }


    <span class="hljs-javadoc">/**
     * 开启定时任务
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startTimer</span>() {
        stopTimer();
        MeterTimerTask meterTimerTask = <span class="hljs-keyword">new</span> MeterTimerTask();
        mTimer.schedule(meterTimerTask, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>);
    }

    <span class="hljs-javadoc">/**
     * 关闭定时任务
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopTimer</span>() {
        <span class="hljs-keyword">if</span> (mTimer == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span>;
        }
        mTimer.cancel();
        mTimer = <span class="hljs-keyword">null</span>;
        mTimer = <span class="hljs-keyword">new</span> Timer();
    }


    <span class="hljs-javadoc">/**
     * 定时任务
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MeterTimerTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TimerTask</span> {<!-- --></span>
        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
            runOnUiThread(<span class="hljs-keyword">new</span> Runnable() {
                <span class="hljs-annotation">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
                    currentMeter += <span class="hljs-number">1</span>;
                    <span class="hljs-keyword">if</span> (currentMeter &gt;= <span class="hljs-number">180</span>) {
                        currentMeter = <span class="hljs-number">0</span>;
                    }
                    mCustomSector.setPointerSweepAngle(currentMeter);
                    rotateAnimation(lastMeter, currentMeter);
                    lastMeter = currentMeter;
                }
            });
        }
    }


    <span class="hljs-javadoc">/**
     * 指针旋转动画
     *
     *<span class="hljs-javadoctag"> @param</span> fromDegrees 开始角度
     *<span class="hljs-javadoctag"> @param</span> toDegrees   结束角度
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rotateAnimation</span>(<span class="hljs-keyword">float</span> fromDegrees, <span class="hljs-keyword">float</span> toDegrees) {
        ObjectAnimator anim = ObjectAnimator.ofFloat(mPointerImageview, <span class="hljs-string">"rotation"</span>, fromDegrees, toDegrees);
        anim.setDuration(<span class="hljs-number">50</span>);
        anim.addUpdateListener(<span class="hljs-keyword">new</span> ValueAnimator.AnimatorUpdateListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationUpdate</span>(ValueAnimator animation) {
                <span class="hljs-keyword">float</span> value = (Float) animation.getAnimatedValue();
            }
        });
        anim.start();
    }

}
</code></pre> 
<p>activity_main.xml</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout
</span>    <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attribute">xmlns:tools</span>=<span class="hljs-value">"http://schemas.android.com/tools"</span>
    <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/activity_main"</span>
    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
    <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"#ffffff"</span>
    <span class="hljs-attribute">tools:context</span>=<span class="hljs-value">"com.example.wem.sectorviewdemo.MainActivity"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout
</span>        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"50dp"</span>
        <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"horizontal"</span>
        &gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">Button
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/start_button"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"0dp"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"start"</span>
            /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">Button
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/stop_button"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"0dp"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"stop"</span>
            /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">RelativeLayout
</span>        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:layout_alignParentBottom</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:layout_centerHorizontal</span>=<span class="hljs-value">"true"</span>
        <span class="hljs-attribute">android:layout_marginBottom</span>=<span class="hljs-value">"-100dp"</span>
        &gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">com.example.wem.sectorviewdemo.widget.CustomSectorView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/custom_sector"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"200dp"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"200dp"</span>
            /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">ImageView
</span>            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/pointer_imageview"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:layout_centerInParent</span>=<span class="hljs-value">"true"</span>
            <span class="hljs-attribute">android:src</span>=<span class="hljs-value">"@mipmap/pointer"</span>
            /&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">RelativeLayout</span>&gt;</span>
</code></pre> 
<blockquote> 
 <p>最后附上本文的源码下载地址：<a href="https://pan.baidu.com/s/1ge8Tu5X" rel="nofollow">点击下载源码</a></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/611d27f24c48de531aa4a960e94c221c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux环境下如何通过WMI对windows进行监控</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/478acc21b1b6c226d88d483af489e9a7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java泛型的一些常见用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>