<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker 安装keepalived - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/197b62ae384683e985d68d47420cc55d/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="docker 安装keepalived">
  <meta property="og:description" content="docker 安装keepalived 1、拉取keepalived镜像 能够拉取镜像的前提是已经安装了docker,如未安装请参考docker安装手册
搜素镜像 先搜索所有keepalived镜像，根据实际环境拉取所需要的镜像
docker search keepalived 部分结果如下：
NAME DESCRIPTION STARS OFFICIAL AUTOMATED alterway/keepalived Keepalived manage virtual ip between servers. 24 [OK] osixia/keepalived Keepalived with quick start configuration vi… 12 arcts/keepalived Alpine based container for keepalived 7 [OK] solnetcloud/keepalived Routing software designed to provide facilit… 3 [OK] gloppenhosting/keepalived keepalived for virtual ip between kamailio s… 2 [OK] goldenroute/keepalived-haproxy Keepalived and HAProxy 1 [OK] indigodatacloud/keepalived Docker image for Keepalived 0 [OK] osixia/keepalived-confd Keepalived that get unicast peers from any k… 0 weikinhuang/keepalived-kube keepalived: Loadbalancing &amp;amp; High-Availabilit… 0 clearent/keepalived Dockerized keepalived to ease HA in deployme… 0 aramase/keepalived Docker image for running keepalived 0 interlegis/keepalived Docker container for keepalived 0 [OK] randomcoww/keepalived Keepalived 0 [OK] mesosphere/keepalived 0 mesosphere/keepalived-snmp Dockerized keepalived with snmp support 0 azenk/keepalived Apline based Keepalived 0 [OK] angelnu/keepalived Keepalived for multiple architectures 0 [OK] alogoc/keepalived 0 osism/keepalived 0 bara/keepalived keepalived based on alpine linux with netsta… 0 [OK] jckasper/keepalived 0 djannot/keepalived 0 nexinto/keepalived 0 brainloop/keepalived 0 拉取镜像 docker pull arcts/keepalived 2、启动容器 因为keepalived需要创建vip，其对网络权限要求较高，我们在启动容器的时候需要增加权限，启动方式如下。">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-04-16T14:57:54+08:00">
    <meta property="article:modified_time" content="2020-04-16T14:57:54+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker 安装keepalived</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="docker_keepalived_0"></a>docker 安装keepalived</h2> 
<h4><a id="1keepalived_2"></a>1、拉取keepalived镜像</h4> 
<p>能够拉取镜像的前提是已经安装了docker,如未安装请参考docker安装手册</p> 
<h6><a id="_6"></a>搜素镜像</h6> 
<p>先搜索所有keepalived镜像，根据实际环境拉取所需要的镜像</p> 
<pre><code class="prism language-bash">docker search keepalived
</code></pre> 
<p>部分结果如下：</p> 
<pre><code>NAME        DESCRIPTION        STARS          OFFICIAL                         AUTOMATED
alterway/keepalived                    Keepalived manage virtual ip between servers.   24                                      [OK]
osixia/keepalived                      Keepalived with quick start configuration vi…   12                                      
arcts/keepalived                       Alpine based container for keepalived           7                                       [OK]
solnetcloud/keepalived                 Routing software designed to provide facilit…   3                                       [OK]
gloppenhosting/keepalived              keepalived for virtual ip between kamailio s…   2                                       [OK]
goldenroute/keepalived-haproxy         Keepalived and HAProxy                          1                                       [OK]
indigodatacloud/keepalived             Docker image for Keepalived                     0                                       [OK]
osixia/keepalived-confd                Keepalived that get unicast peers from any k…   0                                       
weikinhuang/keepalived-kube            keepalived: Loadbalancing &amp; High-Availabilit…   0                                       
clearent/keepalived                    Dockerized keepalived to ease HA in deployme…   0                                       
aramase/keepalived                     Docker image for running keepalived             0                                       
interlegis/keepalived                  Docker container for keepalived                 0                                       [OK]
randomcoww/keepalived                  Keepalived                                      0                                       [OK]
mesosphere/keepalived                                                                  0                                       
mesosphere/keepalived-snmp             Dockerized keepalived with snmp support         0                                       
azenk/keepalived                       Apline based Keepalived                         0                                       [OK]
angelnu/keepalived                     Keepalived for multiple architectures           0                                       [OK]
alogoc/keepalived                                                                      0                                       
osism/keepalived                                                                       0                                       
bara/keepalived                        keepalived based on alpine linux with netsta…   0                                       [OK]
jckasper/keepalived                                                                    0                                       
djannot/keepalived                                                                     0                                       
nexinto/keepalived                                                                     0                                       
brainloop/keepalived                                                                   0                                       
</code></pre> 
<h6><a id="_44"></a>拉取镜像</h6> 
<pre><code class="prism language-bash">docker pull arcts/keepalived
</code></pre> 
<h4><a id="2_50"></a>2、启动容器</h4> 
<p>因为keepalived需要创建vip，其对网络权限要求较高，我们在启动容器的时候需要增加权限，启动方式如下。</p> 
<pre><code class="prism language-bash">docker run -it --name keepalived_master --net<span class="token operator">=</span>host --cap-add NET_ADMIN  <span class="token punctuation">[</span>image id<span class="token punctuation">]</span> /bin/bash
</code></pre> 
<p>例：</p> 
<pre><code class="prism language-bash">docker run -it --name keepalived_master --net<span class="token operator">=</span>host --cap-add NET_ADMIN  124d8d1c0dc2 /bin/bash
</code></pre> 
<h4><a id="3keepalived_64"></a>3、编辑keepalived配置文件</h4> 
<p>vim /etc/keepalived/keepalived.conf</p> 
<p>以下为master部分示例，安装时请根据自身情况更改或者添加配置文件信息</p> 
<pre><code class="prism language-bash">vrrp_instance VI_1 <span class="token punctuation">{<!-- --></span>
    state MASTER  			<span class="token comment">#主为MASTER 备为BACKUP</span>
    interface ens33  		<span class="token comment">#ens33为绑定的网卡名，此处请根据现实情况更改</span>
    virtual_router_id 2 	<span class="token comment">#虚拟路由ID，负责相同虚拟IP的keepalived集群最好定义为相同的id</span>
    priority 101 			<span class="token comment">#优先级，MASTER的优先级必须比BACKUP的高</span>
    advert_int 2
    authentication <span class="token punctuation">{<!-- --></span>
        auth_type PASS 
        auth_pass 1111
    <span class="token punctuation">}</span>
    virtual_ipaddress <span class="token punctuation">{<!-- --></span>
        192.168.11.96  		<span class="token comment">#虚拟IP</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="4_87"></a>4、测试配置文件</h4> 
<pre><code class="prism language-bash">keepalived -t -f /etc/keepalived/keepalived.conf
</code></pre> 
<p>以上操作在主备节点都进行</p> 
<h4><a id="5_95"></a>5、启动</h4> 
<pre><code class="prism language-bash">keepalived -l -f /etc/keepalived/keepalived.conf
</code></pre> 
<h6><a id="_101"></a>在主节点启动之后命令行无返回</h6> 
<p>使用ip addr验证是否绑定虚拟ip</p> 
<pre><code class="prism language-bash">2: ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:b8:e5:cf brd ff:ff:ff:ff:ff:ff
    inet 192.168.11.172/24 brd 192.168.11.255 scope global ens33
       valid_lft forever preferred_lft forever
    inet 192.168.11.96/32 scope global ens33		<span class="token comment">#虚拟ip已绑定</span>
       valid_lft forever preferred_lft forever
</code></pre> 
<h6><a id="_114"></a>主节点正常运行的情况下，备节点启动之后会有返回</h6> 
<pre><code class="prism language-bash">bash-4.4<span class="token comment"># keepalived -l -f /etc/keepalived/keepalived.conf</span>
Keepalived<span class="token punctuation">[</span>9<span class="token punctuation">]</span>: Starting Keepalived v2.0.5 <span class="token punctuation">(</span>06/30,2018<span class="token punctuation">)</span>, <span class="token function">git</span> commit v3.8.1-6-g8fc23ec3d0
Keepalived<span class="token punctuation">[</span>9<span class="token punctuation">]</span>: WARNING - keepalived was build <span class="token keyword">for</span> newer Linux 4.4.6, running on Linux 3.10.0-1062.4.3.el7.x86_64 <span class="token comment">#1 SMP Wed Nov 13 23:58:53 UTC 2019</span>
Keepalived<span class="token punctuation">[</span>9<span class="token punctuation">]</span>: Opening <span class="token function">file</span> <span class="token string">'/etc/keepalived/keepalived.conf'</span><span class="token keyword">.</span>
bash-4.4<span class="token comment"># Keepalived[10]: Starting VRRP child process, pid=11</span>
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Registering Kernel netlink reflector
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Registering Kernel netlink <span class="token function">command</span> channel
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Opening <span class="token function">file</span> <span class="token string">'/etc/keepalived/keepalived.conf'</span><span class="token keyword">.</span>
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Registering gratuitous ARP shared channel
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: <span class="token punctuation">(</span>VI_1<span class="token punctuation">)</span> Entering BACKUP STATE <span class="token punctuation">(</span>init<span class="token punctuation">)</span>
</code></pre> 
<p>最后一行可以看到备节点就位</p> 
<p>查看备节点ip信息</p> 
<pre><code class="prism language-bash">ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 00:0c:29:b8:e5:cf brd ff:ff:ff:ff:ff:ff
    inet 192.168.11.181/24 brd 192.168.11.255 scope global ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::8e86:ffc0:f6ed:bce7/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft foever
</code></pre> 
<p>备节点虚拟ip未绑定</p> 
<h4><a id="6_144"></a>6、验证</h4> 
<h6><a id="_146"></a>关闭主节点</h6> 
<p>在主节点上查看ip地址</p> 
<pre><code class="prism language-bash">ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 00:0c:29:b8:e5:cf brd ff:ff:ff:ff:ff:ff
    inet 192.168.11.172/24 brd 192.168.11.255 scope global ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::8e86:ffc0:f6ed:bce7/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft foever
</code></pre> 
<p>可以看到vip已解绑</p> 
<h6><a id="_161"></a>查看备节点</h6> 
<pre><code class="prism language-bash">bash-4.4<span class="token comment"># keepalived -l -f /etc/keepalived/keepalived.conf</span>
Keepalived<span class="token punctuation">[</span>9<span class="token punctuation">]</span>: Starting Keepalived v2.0.5 <span class="token punctuation">(</span>06/30,2018<span class="token punctuation">)</span>, <span class="token function">git</span> commit v3.8.1-6-g8fc23ec3d0
Keepalived<span class="token punctuation">[</span>9<span class="token punctuation">]</span>: WARNING - keepalived was build <span class="token keyword">for</span> newer Linux 4.4.6, running on Linux 3.10.0-1062.4.3.el7.x86_64 <span class="token comment">#1 SMP Wed Nov 13 23:58:53 UTC 2019</span>
Keepalived<span class="token punctuation">[</span>9<span class="token punctuation">]</span>: Opening <span class="token function">file</span> <span class="token string">'/etc/keepalived/keepalived.conf'</span><span class="token keyword">.</span>
bash-4.4<span class="token comment"># Keepalived[10]: Starting VRRP child process, pid=11</span>
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Registering Kernel netlink reflector
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Registering Kernel netlink <span class="token function">command</span> channel
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Opening <span class="token function">file</span> <span class="token string">'/etc/keepalived/keepalived.conf'</span><span class="token keyword">.</span>
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Registering gratuitous ARP shared channel
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: <span class="token punctuation">(</span>VI_1<span class="token punctuation">)</span> Entering BACKUP STATE <span class="token punctuation">(</span>init<span class="token punctuation">)</span>
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: <span class="token punctuation">(</span>VI_1<span class="token punctuation">)</span> Entering MASTER STATE
</code></pre> 
<p>可以看到最后一行增加信息，备节点变为主节点</p> 
<p>查看备节点ip信息</p> 
<pre><code class="prism language-bash">2: ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:bf:0d:e7 brd ff:ff:ff:ff:ff:ff
    inet 192.168.11.181/24 brd 192.168.11.255 scope global noprefixroute dynamic ens33
       valid_lft 1241sec preferred_lft 1241sec
    inet 192.168.11.96/32 scope global ens33		<span class="token comment">#虚拟ip</span>
       valid_lft forever preferred_lft forever
</code></pre> 
<p>可以看到虚拟ip绑定到了备节点上</p> 
<p>重新启动主节点，备节点会发生变化</p> 
<pre><code class="prism language-bash">bash-4.4<span class="token comment"># keepalived -l -f /etc/keepalived/keepalived.conf</span>
Keepalived<span class="token punctuation">[</span>9<span class="token punctuation">]</span>: Starting Keepalived v2.0.5 <span class="token punctuation">(</span>06/30,2018<span class="token punctuation">)</span>, <span class="token function">git</span> commit v3.8.1-6-g8fc23ec3d0
Keepalived<span class="token punctuation">[</span>9<span class="token punctuation">]</span>: WARNING - keepalived was build <span class="token keyword">for</span> newer Linux 4.4.6, running on Linux 3.10.0-1062.4.3.el7.x86_64 <span class="token comment">#1 SMP Wed Nov 13 23:58:53 UTC 2019</span>
Keepalived<span class="token punctuation">[</span>9<span class="token punctuation">]</span>: Opening <span class="token function">file</span> <span class="token string">'/etc/keepalived/keepalived.conf'</span><span class="token keyword">.</span>
bash-4.4<span class="token comment"># Keepalived[10]: Starting VRRP child process, pid=11</span>
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Registering Kernel netlink reflector
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Registering Kernel netlink <span class="token function">command</span> channel
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Opening <span class="token function">file</span> <span class="token string">'/etc/keepalived/keepalived.conf'</span><span class="token keyword">.</span>
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: Registering gratuitous ARP shared channel
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: <span class="token punctuation">(</span>VI_1<span class="token punctuation">)</span> Entering BACKUP STATE <span class="token punctuation">(</span>init<span class="token punctuation">)</span>
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: <span class="token punctuation">(</span>VI_1<span class="token punctuation">)</span> Entering MASTER STATE
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: <span class="token punctuation">(</span>VI_1<span class="token punctuation">)</span> Master received advert from 192.168.11.172 with higher priority 101, ours 100
Keepalived_vrrp<span class="token punctuation">[</span>11<span class="token punctuation">]</span>: <span class="token punctuation">(</span>VI_1<span class="token punctuation">)</span> Entering BACKUP STATE
</code></pre> 
<p>最后两行可以看到状态发生改变，收到主节点消息重新变回备节点</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e132c3a491e49957c9d11a919beb418/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">边沿检测电路的Verilog实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/da3412784026c38cf532c7b3e5fb24f0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【TS】566- 一文读懂 TS 中 Object, object, {} 类型之间的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>