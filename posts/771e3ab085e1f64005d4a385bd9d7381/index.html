<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Pandas表格样式设置技巧，漂亮！ - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/771e3ab085e1f64005d4a385bd9d7381/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Pandas表格样式设置技巧，漂亮！">
  <meta property="og:description" content="大家好，我是阿粥
今天给大家分享如何给Pandas DataFrame添加颜色和样式。
前排提示，文末送两本商业分析的好书~
通过这一方法，增强数据的呈现，使信息的探索和理解不仅内容丰富，而且具有视觉吸引力。
Pandas Styler是Pandas库中的一个模块，它提供了创建DataFrame的HTML样式表示的方法。
此功能允许在可视化期间自定义DataFrame的视觉外观。Pandas Styler的核心功能在于能够根据特定条件对单元格进行突出显示、着色和格式化。
增强了可视化体验，并能够更直观地解释数据集中包含的信息。
接下来，我们将使用一组数据创建一个数据透视表，为其提供不同的样式和条件格式，最终如上图所示。
数据透视表是一种表格数据结构，它提供来自另一个表的信息的汇总概述，根据一个变量组织数据并显示与另一个变量关联的值。
在本次分析中，我们将使用Apple Store应用程序数据集来探索数据透视表的创建和表格样式的自定义。
数据集涵盖从应用程序名称到大小、价格和评级等细节的各个方面。我们的目标是有效地分解信息，同时应用有效增强数据呈现和理解的风格。 数据说明。
查看环境基础信息。
import pandas as pd import numpy as np import math import matplotlib.pyplot as plt import warnings # 关闭pandas warning warnings.filterwarnings(&#39;ignore&#39;) print(&#34;Python Libraries version:&#34;) print(&#39; - &#39;*20) print(&#34;Pandas version: &#34;, pd.__version__) print(&#34;Numpy version: &#34;, np.__version__) print(&#34;Matplotlib version: &#34;, plt.matplotlib.__version__) 结果如下。
读取数据。
# 读取数据 path=&#39;data/AppleStore.csv&#39; data =pd.read_csv(path,sep=&#39;;&#39;) 创建数据透视表。
# 过滤数据，只保留前15个类型 top_genre = data.value_counts(&#39;prime_genre&#39;)[:15].index.tolist() tmp = data.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-21T22:03:39+08:00">
    <meta property="article:modified_time" content="2024-03-21T22:03:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Pandas表格样式设置技巧，漂亮！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p style="text-align:left;">大家好，我是阿粥</p> 
 <p style="text-align:left;">今天给大家分享如何给Pandas DataFrame添加颜色和样式。<br></p> 
 <p style="text-align:justify;"><strong>前排提示，文末送两本商业分析的好书~</strong></p> 
 <p style="text-align:justify;">通过这一方法，增强数据的呈现，使信息的探索和理解不仅内容丰富，而且具有视觉吸引力。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/e8/0a/JPKIctJY_o.png" alt="2d3cadc6df28f6fa8f5ee2ee59ffd857.png"></p> 
 <p style="text-align:justify;">Pandas Styler是Pandas库中的一个模块，它提供了创建DataFrame的HTML样式表示的方法。</p> 
 <p style="text-align:justify;">此功能允许在可视化期间自定义DataFrame的视觉外观。Pandas Styler的核心功能在于能够根据特定条件对单元格进行突出显示、着色和格式化。</p> 
 <p style="text-align:justify;">增强了可视化体验，并能够更直观地解释数据集中包含的信息。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/d0/85/SNlxSbDX_o.jpg" alt="3e1bbb935e794919c7ce3c5373bc410c.jpeg"></p> 
 <p style="text-align:justify;">接下来，我们将使用一组数据创建一个数据透视表，为其提供不同的样式和条件格式，最终如上图所示。</p> 
 <p style="text-align:justify;">数据透视表是一种表格数据结构，它提供来自另一个表的信息的汇总概述，根据一个变量组织数据并显示与另一个变量关联的值。</p> 
 <p style="text-align:justify;">在本次分析中，我们将使用Apple Store应用程序数据集来探索数据透视表的创建和表格样式的自定义。</p> 
 <p style="text-align:justify;">数据集涵盖从应用程序名称到大小、价格和评级等细节的各个方面。我们的目标是有效地分解信息，同时应用有效增强数据呈现和理解的风格。 </p> 
 <p style="text-align:justify;">数据说明。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/3d/bf/VbVqN23w_o.png" alt="4cc5793f18e82e404737863a3e79dcf6.png"></p> 
 <p style="text-align:justify;">查看环境基础信息。</p> 
 <pre class="has"><code class="language-go">import pandas as pd
import numpy as np
import math
import matplotlib.pyplot as plt
import warnings

# 关闭pandas warning
warnings.filterwarnings('ignore')
print("Python Libraries version:")
print(' - '*20)
print("Pandas version: ", pd.__version__)
print("Numpy version: ", np.__version__)
print("Matplotlib version: ", plt.matplotlib.__version__)</code></pre> 
 <p style="text-align:justify;">结果如下。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/c7/96/98jDT2Za_o.png" alt="909c9a2a2a551692b218808ac280c067.png"></p> 
 <p style="text-align:justify;">读取数据。</p> 
 <pre class="has"><code class="language-go"># 读取数据
path='data/AppleStore.csv'
data =pd.read_csv(path,sep=';')</code></pre> 
 <p style="text-align:justify;">创建数据透视表。</p> 
 <pre class="has"><code class="language-go"># 过滤数据，只保留前15个类型
top_genre = data.value_counts('prime_genre')[:15].index.tolist()
tmp = data.loc[data['prime_genre'].isin(top_genre),['prime_genre','user_rating','price']]

# 创建一个新列，将评级四舍五入到最接近的整数
tmp['user_rating'] = [f'rating_{str(math.trunc(item))}' for item in tmp['user_rating']]

# 创建数据透视表
tmp_pivot = (
 pd.pivot_table(
 data = tmp,
 columns='user_rating',
 index='prime_genre',
 values='price',
 aggfunc='mean',
 fill_value=0
 ).reset_index().round(2)
)

# 重命名列
tmp_pivot.columns.name=''
# 打印透视表
tmp_pivot</code></pre> 
 <p style="text-align:justify;">结果如下。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/fc/8d/m6HnxNhn_o.png" alt="4c944a2fd179a886396526b657e26f8f.png"></p> 
 <p style="text-align:justify;">现在我们将探索Pandas中的“style”模块，它使我们能够增强DataFrame的视觉呈现。“style”模块提供了不同的选项来修改数据的外观，允许我们自定义以下方面： </p> 
 <p style="text-align:justify;">给单元格着色：根据单元格值或条件应用不同的颜色。 </p> 
 <p style="text-align:justify;">突出显示：强调特定的行、列或值。 </p> 
 <p style="text-align:justify;">格式：调整显示值的格式，包括精度和对齐方式。 </p> 
 <p style="text-align:justify;">条形图：在单元格内用水平或垂直条形图表示数据。</p> 
 <p style="text-align:justify;"><strong>样式：设置标题的背景颜色</strong></p> 
 <p style="text-align:justify;">在本节中，我们将应用样式到标题和表格。因此，我们使用背景颜色来突出显示标题和表格的其余部分。</p> 
 <pre class="has"><code class="language-go"># 更改列的背景颜色
headers = {
 'selector': 'th.col_heading',
 'props': 'background-color: #5E17EB; color: white;'
}
index_style = {
 'selector': 'th.index_name',
 'props': 'background-color: #5E17EB; color: white;'
}
tmp_pivot_style = (
 tmp_pivot
 .style
 .set_table_styles([headers,index_style])
 .set_properties(**{'background-color': '#ECE3FF','color': 'black'})
)
tmp_pivot_style</code></pre> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/e7/72/nOT3hChO_o.png" alt="e32695067a6d94f5fc21f685b0a0f569.png"></p> 
 <p style="text-align:justify;"><strong>样式：设置特定单元格的背景颜色</strong></p> 
 <p style="text-align:justify;">下面的代码片段说明了如何使用pandas样式为DataFrame中的特定单元格设置自定义背景颜色。</p> 
 <pre class="has"><code class="language-go">(
   tmp_pivot
   .style
   .set_table_styles([headers, index_style])
   .set_properties(**{'background-color': '#ECE3FF', 'color': 'black'})
   .set_properties(**{'background-color': '#FD636B', 'color': 'white'},subset=pd.IndexSlice[4, 'rating_5'])
)</code></pre> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/04/82/4SQU3tyc_o.png" alt="2be74b0e4dd35e084bd3d808c6331934.png"></p> 
 <p style="text-align:justify;"><strong>样式：设置数据框中最大/最小值的背景颜色</strong></p> 
 <p style="text-align:justify;">现在，我们将重点突出显示DataFrame中的最大值和最小值。因此，我们将为这些极值分配独特的背景颜色，以便于更快、更直观地理解数据集。下面的代码片段演示了如何实现这种风格增强。</p> 
 <pre class="has"><code class="language-go"># 选择'rating_'开头的列
columns = tmp_pivot.columns[tmp_pivot.columns.str.startswith('rating_')]

# 获取最大、最小值
max_value = tmp_pivot[columns].max().max()
min_value = tmp_pivot[columns].min().min()
# 最大值样式
max_style = f'border: 4px solid #3BE8B0 !important;'
# 最小值样式
min_style = f'background-color: #FF66C4; '
(
 tmp_pivot
 .style
 .set_table_styles([headers, index_style])
 .set_properties(**{'background-color': '#ECE3FF', 'color': 'black'})
 .set_properties(**{'background-color': '#FD636B', 'color': 'white'}, subset=pd.IndexSlice[4, 'rating_5'])
 .applymap(lambda x: max_style if x == max_value else '')
 .applymap(lambda x: min_style if x == min_value else '', subset=columns)
)</code></pre> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/bc/42/BCZCHDcZ_o.png" alt="a5f5dc41d2ae7ee4d3a639bf69940744.png"></p> 
 <p style="text-align:justify;"><strong>风格：颜色背景渐变</strong></p> 
 <p style="text-align:justify;">在接下来的部分中，我们将深入研究颜色图的概念，它表示以渐变方式排列的颜色光谱。颜色图本质上是一个颜色调色板，由独特的名称组成，最流行的名称是['viridis'、'magma'、'Greens'、'Reds']。 </p> 
 <p style="text-align:justify;">创建这些色谱的主要目的是增强数据的视觉表示。渐变中的每种颜色都具有特定的细微差别，有助于提供更细致的数据可视化体验。 </p> 
 <p style="text-align:justify;">对于广泛的颜色选项，您可以浏览matplotlib colormaps链接。</p> 
 <p style="text-align:justify;">https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html</p> 
 <pre class="has"><code class="language-go">import matplotlib.pyplot as plt
import numpy as np

# 定义颜色映射
for cmap_item in ['viridis', 'magma','Greens','Reds']:
 cmap = plt.get_cmap(cmap_item)
 # 创建颜色渐变
 gradient = np.linspace(0, 1, 256).reshape(1, -1)
 # 显示调色板
 plt.figure(figsize=(10, 0.2))
 plt.imshow(gradient, aspect='auto', cmap=cmap)
 plt.axis('off')
 plt.title(f'{cmap_item.capitalize()} Color Palette', loc='left', fontsize=9)
 plt.show()</code></pre> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/19/de/hoB2KLAJ_o.png" alt="5bfd3bbe03121fd2576f3064fec4d52c.png"></p> 
 <p style="text-align:justify;">Viridis调色板。现在，我们将向数据透视表应用颜色渐变，以便可以使用Viridis调色板观察它的着色方式。在这种情况下，较浅的颜色表示分布中较大的值，而较深的阴影对应于分布中较小的值。这种方法提供了一种视觉表示，可以直观地传达数据的大小，从而更容易辨别数据集中的模式和变化。</p> 
 <pre class="has"><code class="language-go">plt.get_cmap( 'viridis' ,lut= 20 )</code></pre> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/c0/8b/Uavh9kzW_o.png" alt="3f12b654398ad976497f7aac92b8e69e.png"></p> 
 <pre class="has"><code class="language-go">( 
tmp_pivot 
.style 
.set_table_styles([headers, index_style]) 
.background_gradient(cmap= 'viridis' ,subset=columns) 
)</code></pre> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/d8/6a/PWFzytDH_o.png" alt="e3abf35b7bad022acc467a439a7facba.png"></p> 
 <p style="text-align:justify;"><strong>风格：列中的彩色背景</strong></p> 
 <p style="text-align:justify;">在下一个代码块中，我们将通过向特定列引入不同的颜色背景来增强数据透视表的视觉表示。此技术有助于更好地突出显示数据并对其进行分类，从而更轻松地从表格中获取见解。</p> 
 <pre class="has"><code class="language-go">(
 tmp_pivot
 .style
 .set_table_styles([headers, index_style])
 .set_properties(**{'background-color': '#FFCFC9','color':'black'},subset=['rating_0','rating_1'])
 .set_properties(**{'background-color': '#FFF1B0','color':'black'},subset=['rating_2','rating_3'])
 .set_properties(**{'background-color': '#BEEAE5','color':'black'},subset=['rating_4','rating_5'])
)</code></pre> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/63/8a/cmf5gHYx_o.png" alt="feb335e63409ed9e412ced0f3d759dea.png"></p> 
 <p style="text-align:justify;"><strong>风格：彩条</strong></p> 
 <p style="text-align:justify;">在本节中，我们将实现style.bar函数以将动态颜色条引入到我们的DataFrame中。颜色条提供数据值的直观表示，为不同的数据范围分配不同的颜色。</p> 
 <pre class="has"><code class="language-go">(
 tmp_pivot
 .style
 .set_table_styles([headers, index_style])
 .set_properties(**{'background-color': '#ECE3FF', 'color': 'black'})
 .set_properties(**{'background-color': 'white','color':'black'},subset=columns)
 .bar(color='#FFCFC9',subset=['rating_0','rating_1'])
 .bar(color='#FFF1B0',subset=['rating_2','rating_3'])
 .bar(color='#BEEAE5',subset=['rating_4','rating_5'])
)</code></pre> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/06/3c/unvI6ppp_o.png" alt="e4d013f3cd2c86846bb9ce74550ffd56.png"></p> 
 <p style="text-align:justify;"><strong>风格：分列图像</strong></p> 
 <p style="text-align:justify;">在本节中，我们将通过向附加列添加图像来探索数据表示的增强。这种方法提供了一种替代方法来提升所呈现数据的视觉效果。这些图像可以作为图标、代表品牌或传达额外的视觉元素来吸引和吸引观众。</p> 
 <pre class="has"><code class="language-go"># 创建一个函数，根据类型将图像添加到dataframe
def add_image(image_name):
 img_url = f"img/icons/img_{image_name}.png"
 width = "width: 50px"
 height = "height: 50px"
 text_align ="center"
 return f'{width};{height}; content: url({img_url}); text-align:{text_align}'

# 将函数应用于dataframe
styled_df = (
 tmp_pivot
 .head(5)
 .reset_index()
 .rename({'index': 'genre'}, axis=1)
 .style.applymap(add_image, subset=pd.IndexSlice[:, ['genre']])
 .set_table_styles([headers, index_style])
 .set_properties(**{'background-color': '#ECE3FF', 'color': 'black'})
)

# 显示带有图像的dataframe
display(styled_df)</code></pre> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/be/ce/Ie7fqUYo_o.png" alt="d95dff0c6a8a8bc837c2e2dda70ca951.png"></p> 
 <p style="text-align:justify;"><strong>风格：基于百分位数的表情符号表示</strong></p> 
 <p style="text-align:justify;">在本节中，我们将深入研究基于百分位值的表情符号的创造性使用，提供一种独特的方法来提升数据表示。通过整合不同的表情符号，我们增强了数据的视觉冲击力。具体来说，我们使用圆圈和小队作为表情符号，为我们的数据点带来微妙的表达。</p> 
 <pre class="has"><code class="language-go">def get_percentiles(row_data, bins=3, emoji='circle'):
    emoji_labels = {
        'circle': {3: ['🔴', '🟡', '🟢'], 
                   4: ['🔴', '🟠', '🟡', '🟢']},
        'squad': {3: ['🟥', '🟨', '🟩'], 
                  4: ['🟥', '🟨', '🟧', '🟩']}
    }

    if emoji in ['max', 'min', 'min_max']:
        return create_series(row_data, emoji)
    elif emoji in emoji_labels and bins in emoji_labels[emoji]:
        labels = emoji_labels[emoji][bins]
        return pd.cut(row_data, bins=len(labels), labels=labels, ordered=False)
    else:
        return row_data

def create_series(row_data, emoji):
    if emoji == 'max':
        return pd.Series(['🟩' if item == row_data.max() else '⬜' for item in row_data])
    elif emoji == 'min':
        return pd.Series(['🟥' if item == row_data.min() else '⬜' for item in row_data])
    elif emoji == 'min_max':
        return pd.Series(['🟥' if item == row_data.min() else '🟩' if item == row_data.max() else '⬜' for item in row_data])

def get_conditional_table_column(data, bins=3, emoji='circle'):
    tmp = data.copy()
    for column in data.columns:
        if pd.api.types.is_numeric_dtype(data[column]):
            row_data_emoji = get_percentiles(data[column], bins, emoji).astype(str)
            tmp[column] = data[column].astype(str) + ' ' + row_data_emoji
    return tmp

def get_conditional_table_row(data, bins=3, emoji='circle'):
    response_values = []
    column_str = [item for item in data.columns if data[item].dtypes not in ['int64', 'float64']]
    columns_num = [item for item in data.columns if data[item].dtypes in ['int64', 'float64']]

    for row in range(data.shape[0]):
        row_data = data.loc[row, columns_num]
        percentil = get_percentiles(row_data, bins, emoji)
        row_data = row_data.apply(lambda x: '{:.2f}'.format(x))
        percentil_values = [str(row_data[item]) + ' ' + percentil[item] for item in range(percentil.shape[0])]
        response_values.append(percentil_values)

    result_df = pd.DataFrame(response_values).round(2)
    result_df.columns = columns_num
    result_df = pd.concat([data[column_str], result_df], axis=1)
    return result_df


# 按列条件筛选
get_conditional_table_row(data=tmp_pivot,emoji='min_max')

# 最小值
get_conditional_table_column(data=tmp_pivot,emoji='min')

# 最大值
get_conditional_table_column(data=tmp_pivot,emoji='max')

# 4分类
get_conditional_table_column(data=tmp_pivot,emoji='circle',bins=4)</code></pre> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/35/06/MJye59aT_o.png" alt="57262149e3388da90a621ea694746063.png"></p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/8f/0c/qIUUnqEX_o.png" alt="65f17688d76bac84442d9e2a87d37ac8.png"></p> 
 <p><strong>最后的最后，粉丝福利，送两本北京大学出版社的好书</strong><strong>《商业分析思维与实践：用数据分</strong><strong>析解决商业问题》</strong>。这本书以业务为导向，详细地讲解了如何通过大数据分析来解决商业问题。其目的在于运用大数据分析思维，帮助读者把学术知识应用于真实的业务场景，解决实际的业务问题，有思路、有体系、有实战、有落地，推荐一读！</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/2d/53/pFcT1Lf8_o.jpg" alt="8d9e41fcd32738d1746827d5c515024b.jpeg"></p> 
 <p style="text-align:left;"><strong>这次抽奖形式丰富点，</strong><strong>本文三连（点赞、在看或者转发任意都可）后：</strong></p> 
 <p style="text-align:left;"><strong>1、留言点赞排名第3的送一本（增强随机性）</strong></p> 
 <p style="text-align:left;"><strong>2、加我微信好友，回复“抽奖”，抽奖送1本</strong></p> 
 <pre class="has"><code class="language-go">👇扫码加我好友👇</code></pre> 
 <p style="text-align:left;"><strong>3月24日22:00开奖（一个人最多只能获得一本），<strong>祝大家好运~</strong></strong></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1f3a4d5ec2162ae2a35107583d598afa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ShardingSphere&#43;JPA&#43;Druid实现分表操作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fb2bfc328214ac0f6f2c69dae66a93e4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JPA使用CriteriaQuery实现动态分组查询</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>