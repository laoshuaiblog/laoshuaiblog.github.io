<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>从零开发短视频电商 Java开发者的AI大模型（LLM）应用开发和设计-LangChain4j - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/08a61cfc508cd10c5930e938791f659d/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="从零开发短视频电商 Java开发者的AI大模型（LLM）应用开发和设计-LangChain4j">
  <meta property="og:description" content="文章目录 简介示例1.添加依赖2.设置OpenAI API 密钥3.创建模型的实例并开始交互 功能实践爬取网页并embeddingHuggingFace在线API集成加载离线model 简介 Github:
https://github.com/langchain4j
https://github.com/langchain4j/langchain4j
https://github.com/langchain4j/langchain4j-embeddings
https://github.com/langchain4j/langchain4j-examples
Java版langchain, 利用LLMs的力量增强你的java应用程序。
该项目的目标是简化 AI/LLM 功能到 Java 应用程序的集成。
可以通过以下方式实现：
一个简单且连贯的抽象层，旨在确保您的代码不依赖于具体实现，例如 LLM providers, embedding store providers,等。这允许轻松替换组件。上述抽象的多种实现，为您提供了多种 LLMs 和嵌入存储可供选择。LLM 之上的一系列热门功能，例如： 获取您自己的数据 own data（文档、代码库等）的能力，允许LLM 根据您的数据采取行动和做出响应。用于将任务（动态定义）委托给LLM的自主代理 agents ，LLM将努力完成这些任务。提示模板 Prompt templates 可帮助您获得最高质量的 LLM 回复。记忆Memory 为LLM提供您当前和过去对话的背景信息。用于接收来自 LLM 的响应的结构化输出，具有所需的结构（如 Java POJO）。“AI 服务”，用于在简单的 API 背后声明性地定义复杂的 AI 行为。减少常见用例中对大量样板代码的需求的链 Chains 。自动调节以确保LLM的所有输入和输出都不会有害。 这个更像是一个大的框架，给你从头到尾梳理了个标准的流程，我认为是一个很大的解决方案。
Spring Boot 3 的支持
兼容性：Java8 或更高, Spring Boot: 2 or 3
示例 1.添加依赖 &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;dev.langchain4j&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;langchain4j-open-ai&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;0.24.0&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; 2.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-13T16:19:20+08:00">
    <meta property="article:modified_time" content="2023-12-13T16:19:20+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">从零开发短视频电商 Java开发者的AI大模型（LLM）应用开发和设计-LangChain4j</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">简介</a></li><li><a href="#_35" rel="nofollow">示例</a></li><li><ul><li><a href="#1_37" rel="nofollow">1.添加依赖</a></li><li><a href="#2OpenAI_API__47" rel="nofollow">2.设置OpenAI API 密钥</a></li><li><a href="#3_63" rel="nofollow">3.创建模型的实例并开始交互</a></li></ul> 
   </li><li><a href="#_75" rel="nofollow">功能</a></li><li><a href="#_143" rel="nofollow">实践</a></li><li><ul><li><a href="#embedding_145" rel="nofollow">爬取网页并embedding</a></li><li><a href="#HuggingFaceAPI_172" rel="nofollow">HuggingFace在线API集成</a></li><li><a href="#model_209" rel="nofollow">加载离线model</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>简介</h3> 
<p><strong>Github</strong>:</p> 
<ul><li> <p><a href="https://github.com/langchain4j">https://github.com/langchain4j</a></p> </li><li> <p><a href="https://github.com/langchain4j/langchain4j">https://github.com/langchain4j/langchain4j</a></p> </li><li> <p><a href="https://github.com/langchain4j/langchain4j-embeddings">https://github.com/langchain4j/langchain4j-embeddings</a></p> </li><li> <p><a href="https://github.com/langchain4j/langchain4j-examples">https://github.com/langchain4j/langchain4j-examples</a></p> </li></ul> 
<p>Java版<code>langchain</code>, 利用LLMs的力量增强你的java应用程序。</p> 
<p>该项目的目标是简化 AI/LLM 功能到 Java 应用程序的集成。</p> 
<p>可以通过以下方式实现：</p> 
<ul><li>一个简单且连贯的抽象层，旨在确保您的代码不依赖于具体实现，例如 LLM providers, embedding store providers,等。这允许轻松替换组件。</li><li>上述抽象的多种实现，为您提供了多种 LLMs 和嵌入存储可供选择。</li><li><strong>LLM 之上的一系列热门功能，例如：</strong> 
  <ul><li>获取您<strong>自己的数据</strong> <strong>own data</strong>（文档、代码库等）的能力，允许LLM 根据您的数据采取行动和做出响应。</li><li>用于将任务（动态定义）委托给LLM的自主<strong>代理</strong> <strong>agents</strong> ，LLM将努力完成这些任务。</li><li><strong>提示模板</strong> <strong>Prompt templates</strong> 可帮助您获得最高质量的 LLM 回复。</li><li>记忆<strong>Memory</strong> 为<strong>LLM</strong>提供您当前和过去对话的背景信息。</li><li>用于接收来自 LLM 的响应的<strong>结构化输出</strong>，具有所需的结构（如 Java POJO）。</li><li>“<strong>AI 服务</strong>”，用于在简单的 API 背后声明性地定义复杂的 AI 行为。</li><li>减少常见用例中对大量样板代码的需求的链 <strong>Chains</strong> 。</li><li><strong>自动调节</strong>以确保LLM的所有输入和输出都不会有害。</li></ul> </li></ul> 
<blockquote> 
 <p>这个更像是一个大的框架，给你从头到尾梳理了个<strong>标准的流程</strong>，我认为是一个很大的<strong>解决方案</strong>。</p> 
 <p>Spring Boot 3 的支持</p> 
 <p>兼容性：Java8 或更高, Spring Boot: 2 or 3</p> 
</blockquote> 
<h3><a id="_35"></a>示例</h3> 
<h4><a id="1_37"></a>1.添加依赖</h4> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>dev.langchain4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>langchain4j-open-ai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.24.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="2OpenAI_API__47"></a>2.设置OpenAI API 密钥</h4> 
<pre><code class="prism language-java"><span class="token class-name">String</span> apiKey <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"OPENAI_API_KEY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>可以用自己的秘钥，不过要收费。</p> 
 <p>OpenAI（付费）或 HuggingFace（免费）</p> 
 <p>建议使用 OpenAI LLM（<code>gpt-3.5-turbo</code>和<code>gpt-4</code>），因为它们是迄今为止最有能力且价格合理的。</p> 
 <p>也可以使用免费提供的 API 密钥<code>demo</code>来测试 OpenAI。</p> 
 <p>即 <code>String apiKey = "demo"</code></p> 
</blockquote> 
<h4><a id="3_63"></a>3.创建模型的实例并开始交互</h4> 
<pre><code class="prism language-java"><span class="token class-name">OpenAiChatModel</span> model <span class="token operator">=</span> <span class="token class-name">OpenAiChatModel</span><span class="token punctuation">.</span><span class="token function">withApiKey</span><span class="token punctuation">(</span>apiKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> answer <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello! How can I assist you today?</span>
</code></pre> 
<h3><a id="_75"></a>功能</h3> 
<p><strong>AI服务</strong>：</p> 
<ul><li>简单模式</li><li>带有记忆功能</li><li>带有工具支持</li><li>带有流式处理</li><li>带有检索器</li><li>带有自动审核</li><li>带有结构化输出、结构化提示等功能</li></ul> 
<p><strong>与OpenAI和Azure OpenAI集成的功能</strong>：</p> 
<ul><li>聊天（同步 + 流式 + 函数）</li><li>完成（同步 + 流式）</li><li>嵌入</li></ul> 
<p><strong>与Google Vertex AI集成的功能</strong>：</p> 
<ul><li>聊天</li><li>完成</li><li>嵌入</li></ul> 
<p><strong>与HuggingFace Inference API集成的功能</strong>：</p> 
<ul><li>聊天</li><li>完成</li><li>嵌入</li></ul> 
<p><strong>与LocalAI集成的功能</strong>：</p> 
<ul><li>聊天（同步 + 流式 + 函数）</li><li>完成（同步 + 流式）</li><li>嵌入</li></ul> 
<p><strong>与DashScope集成的功能</strong>：</p> 
<ul><li>聊天（同步 + 流式）</li><li>完成（同步 + 流式）</li><li>嵌入</li></ul> 
<p><strong>聊天记忆</strong><br> <strong>持久性聊天记忆</strong><br> <strong>与文档进行聊天</strong><br> <strong>与Astra DB和Cassandra集成</strong><br> <strong>与Chroma集成</strong><br> <strong>与Elasticsearch集成</strong><br> <strong>与Milvus集成</strong><br> <strong>与Pinecone集成</strong><br> <strong>与Redis集成</strong><br> <strong>与Vespa集成</strong><br> <strong>与Weaviate集成</strong><br> <strong>内存嵌入存储（可持久化）</strong><br> <strong>结构化输出</strong><br> <strong>提示模板</strong><br> <strong>结构化提示模板</strong><br> <strong>LLM响应的流式传输</strong><br> <strong>从文件系统和通过URL加载txt、html、pdf、doc、xls和ppt文档</strong><br> <strong>将文档拆分为段落</strong></p> 
<ul><li> <p>按段落、行、句子、单词等：</p> </li><li> <p>递归</p> </li><li> <p>带有重叠</p> </li></ul> 
<p><strong>标记计数估算</strong>（以便您可以预测您将支付多少）</p> 
<h3><a id="_143"></a>实践</h3> 
<h4><a id="embedding_145"></a>爬取网页并embedding</h4> 
<pre><code class="prism language-java"><span class="token comment">// 从url拉取html</span>
<span class="token comment">// loaders 有from WebUrl,s3,file</span>
<span class="token class-name">Document</span> document <span class="token operator">=</span> <span class="token class-name">UrlDocumentLoader</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">,</span> <span class="token class-name">DocumentType</span><span class="token punctuation">.</span><span class="token constant">HTML</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过 css选择器 抽取内容和标题</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> metadataCssSelectors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
metadataCssSelectors<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token string">".title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">HtmlTextExtractor</span> transformer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HtmlTextExtractor</span><span class="token punctuation">(</span><span class="token string">"#content"</span><span class="token punctuation">,</span> metadataCssSelectors<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Document</span> transformedDocument <span class="token operator">=</span> transformer<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// </span>
<span class="token class-name">String</span> title <span class="token operator">=</span> transformedDocument<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"title: {}"</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// splitter 文档拆分为段</span>
<span class="token comment">// 按段，特殊字符，句子，定长</span>
<span class="token class-name">DocumentSplitter</span> splitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DocumentBySentenceSplitter</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TextSegment</span><span class="token punctuation">&gt;</span></span> segments <span class="token operator">=</span> splitter<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>transformedDocument<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// embedding</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TextSegment</span> segment <span class="token operator">:</span> segments<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token class-name">String</span> text <span class="token operator">=</span> segment<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// embedding</span>
     <span class="token class-name">Float</span><span class="token punctuation">[</span><span class="token punctuation">]</span> xxx <span class="token operator">=</span> textEmbeddingService<span class="token punctuation">.</span><span class="token function">embed</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token class-name">ModelTypeEnum</span><span class="token punctuation">.</span><span class="token constant">BERT_EN_UNCASED_L4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="HuggingFaceAPI_172"></a>HuggingFace在线API集成</h4> 
<blockquote> 
 <p>为什么用HuggingFace的在线API，就是因为免费，哈哈哈！！！</p> 
</blockquote> 
<p>对于嵌入（<strong>embedding</strong>），我们建议使用HuggingFace <a href="https://huggingface.co/spaces/mteb/leaderboard" rel="nofollow">MTEB 排行榜</a>中的模型之一。您必须找到最适合您的特定用例的一种。</p> 
<p>以下是获取 HuggingFace API 密钥的方法：</p> 
<ul><li><a href="https://huggingface.co/" rel="nofollow">在https://huggingface.co</a>上创建一个帐户</li><li>前往https://huggingface.co/settings/tokens 生成新的访问令牌</li></ul> 
<p><strong>引入依赖</strong></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>dev.langchain4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>langchain4j-hugging-face<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.24.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>推理示例</strong></p> 
<pre><code class="prism language-java">  <span class="token class-name">EmbeddingModel</span> embeddingModel <span class="token operator">=</span> <span class="token class-name">HuggingFaceEmbeddingModel</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">accessToken</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"HF_API_KEY"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">modelId</span><span class="token punctuation">(</span><span class="token string">"sentence-transformers/all-MiniLM-L6-v2"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">waitForModel</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Embedding</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> embeddingModel<span class="token punctuation">.</span><span class="token function">embed</span><span class="token punctuation">(</span><span class="token string">"Hello, how are you?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="model_209"></a>加载离线model</h4> 
<p><strong>针对加载离线model这块，底层依赖onnxruntime + djl.api</strong></p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>dev<span class="token punctuation">.</span>langchain4j<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>langchain4j<span class="token operator">-</span>embeddings<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">0.24</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<p>证据在<code>langchain4j-embeddings</code>依赖的pom:</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 使用这个加载onnx模型 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.microsoft.onnxruntime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>onnxruntime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.16.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 使用这里内置的分词器等 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>ai.djl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.25.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>示例代码</strong></p> 
<p>1.首先自己去huggingface或其他站点下载开源的onnx模型到本地</p> 
<p>例如：https://huggingface.co/bert-base-uncased</p> 
<p><img src="https://images2.imgbox.com/86/1b/Dc0TWO2V_o.png" alt=""></p> 
<p>2.加载本地onnx模型，并进行推测。</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">"Let's demonstrate that embedding can be done within a Java process and entirely offline."</span><span class="token punctuation">;</span>
<span class="token comment">// path  "C:/Users/laker/Downloads/model.onnx"</span>
<span class="token class-name">EmbeddingModel</span> embeddingModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OnnxEmbeddingModel</span><span class="token punctuation">(</span><span class="token string">"/home/me/model.onnx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Embedding</span> inProcessEmbedding <span class="token operator">=</span> embeddingModel<span class="token punctuation">.</span><span class="token function">embed</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>inProcessEmbedding<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>官方也提供了几个带onnx文件的jar，里面内置了onnx文件，你就不需要再下载了。</p> 
<ul><li>https://github.com/langchain4j/langchain4j-embeddings</li></ul> 
<p><img src="https://images2.imgbox.com/d8/51/GARX7jyy_o.png" alt="在这里插入图片描述"></p> 
<p>根据需要的模型引入依赖。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>dev.langchain4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>langchain4j-embeddings-bge-small-zh<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.24.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>推理的示例代码</p> 
<pre><code class="prism language-java"><span class="token comment">// EmbeddingModel embeddingModel = new AllMiniLmL6V2EmbeddingModel();</span>
<span class="token class-name">EmbeddingModel</span> embeddingModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BgeSmallZhEmbeddingModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Embedding</span> inProcessEmbedding <span class="token operator">=</span> embeddingModel<span class="token punctuation">.</span><span class="token function">embed</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>inProcessEmbedding<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/506cab3bfd2043c73e2b715c8dfc47e3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Maven 私服搭建</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/98a6be6a86abf6bab9fd56dc1ec7b43a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">最简攻略，一分钟搞定（保姆级）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>