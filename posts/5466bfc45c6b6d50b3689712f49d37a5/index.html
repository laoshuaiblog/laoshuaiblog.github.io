<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>获取本机内网、外网ip(C&#43;&#43;) - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/5466bfc45c6b6d50b3689712f49d37a5/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="获取本机内网、外网ip(C&#43;&#43;)">
  <meta property="og:description" content="基础知识 电脑在局域网内，通过网关/路由器连接到Internet则ip分为内网ip、外网ip。通过ipconfig得到的为局域网ip。电脑直接拨号连接等，则本机通过ipconfig得到的就是外网ip。 代码 //Get IP int GetLocalIP(std::string &amp;amp;local_ip); int GetInternetIP(std::string &amp;amp;Inernet_ip); int GetLocalIP( std::string &amp;amp;local_ip ) { WSADATA wsaData = {0}; if (WSAStartup(MAKEWORD(2, 1), &amp;amp;wsaData) != 0) return kErrorWSAStartup; char szHostName[MAX_PATH] = {0}; int nRetCode; nRetCode = gethostname(szHostName, sizeof(szHostName)); PHOSTENT hostinfo; if (nRetCode != 0) return WSAGetLastError(); hostinfo = gethostbyname(szHostName); local_ip = inet_ntoa(*(struct in_addr*)*hostinfo-&amp;gt;h_addr_list); WSACleanup(); return 1; } int GetInternetIP( std::string &amp;amp;Inernet_ip ) { Inernet_ip.resize(32); TCHAR szTempPath[_MAX_PATH] = {0}, szTempFile[MAX_PATH] = {0}; std::string buffer; GetTempPath(MAX_PATH, szTempPath); UINT nResult = GetTempFileName(szTempPath, _T(&#34;">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-11-06T09:00:45+08:00">
    <meta property="article:modified_time" content="2020-11-06T09:00:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">获取本机内网、外网ip(C&#43;&#43;)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <ul><li>基础知识</li></ul> 
<p> </p> 
<ol><li> 电脑在局域网内，通过网关/路由器连接到Internet则ip分为内网ip、外网ip。通过ipconfig得到的为局域网ip。</li><li>电脑直接拨号连接等，则本机通过ipconfig得到的就是外网ip。</li></ol> 
<p> </p> 
<ul><li>代码</li></ul> 
<pre>//Get IP
int GetLocalIP(std::string &amp;local_ip);
int GetInternetIP(std::string &amp;Inernet_ip);</pre> 
<p><img alt="复制代码" src="https://images2.imgbox.com/dc/d3/AIvVoCHn_o.png"></p> 
<pre>int GetLocalIP( std::string &amp;local_ip )
{
    WSADATA wsaData = {0};
    if (WSAStartup(MAKEWORD(2, 1), &amp;wsaData) != 0)
        return kErrorWSAStartup;
    char szHostName[MAX_PATH] = {0};
    int nRetCode;
    nRetCode = gethostname(szHostName, sizeof(szHostName));
    PHOSTENT hostinfo;
    if (nRetCode != 0)
        return WSAGetLastError();        
    hostinfo = gethostbyname(szHostName);
    local_ip = inet_ntoa(*(struct in_addr*)*hostinfo-&gt;h_addr_list);
    WSACleanup();
    return 1;
}
 
int GetInternetIP( std::string &amp;Inernet_ip )
{
    Inernet_ip.resize(32);
    TCHAR szTempPath[_MAX_PATH] = {0}, szTempFile[MAX_PATH] = {0};
    std::string buffer;
    GetTempPath(MAX_PATH, szTempPath);
    UINT nResult = GetTempFileName(szTempPath, _T("~ex"), 0, szTempFile);
    int ret=URLDownloadToFile(NULL,_T("http://www.ip138.com/ip2city.asp"),szTempFile,BINDF_GETNEWESTVERSION,NULL);
    if (ret == S_FALSE)
        return 0;
    FILE *fp;
    if (_wfopen_s(&amp;fp,szTempFile,_T("rb"))!=0){
        return 0;
    }
    fseek(fp,0,SEEK_END);//得到文件大小
    int ilength=ftell(fp);
    fseek(fp,0,SEEK_SET);
    if(ilength&gt;0)
    { 
        buffer.resize(ilength);
        fread(&amp;buffer[0],sizeof(TCHAR),ilength,fp);
        fclose(fp);
        DeleteFile(_T("ip.ini"));
        
         char* str_ip = strstr(&amp;buffer[0], "[");
         if (str_ip !=NULL)
         {
             sscanf_s(str_ip+1, "%[^]]", &amp;Inernet_ip[0], 32);
         }     
        return 1;
    }
    else
    {
        fclose(fp);
        return 0;
    }
}</pre> 
<p><img alt="复制代码" src="https://images2.imgbox.com/89/d8/XVnjoTeS_o.png"></p> 
<ul><li>解释</li></ul> 
<p>获取内网ip：</p> 
<p>1、通过系统函数gethostname得到主机名。</p> 
<p>2、通过主机名得到内网ip。</p> 
<p>获取外网ip：</p> 
<p>1、通过ip源，下载其脚本文件并保存。</p> 
<p>2、保存文件中有外网ip，解析出来。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d8d6862378a45ea6411ce0b0641eb5ba/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python:将json数据写入到excel</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b3b5894b1962b74167cc0fc9698a067b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一个详细的数据结构博客</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>