<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据挖掘——时间序列算法之ARIMA模型 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/66c34a65f77eda291f19675deb8858ab/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="数据挖掘——时间序列算法之ARIMA模型">
  <meta property="og:description" content="数据挖掘——时间序列算法之ARIMA模型 前言差分定义ARIMA模型实践1、检验序列的平稳性2、进行一阶差分后，进行平稳性和白噪声检验3、对一阶差分之后的平稳非白噪声序列拟合ARMA模型1）人为识别方法2）相对最优模型识别 4、使用ARIMA预测 关于时间序列的其他模型，请参考本人的以下博文：
1、平滑法
2、趋势拟合法
3、组合模型
4、AR模型
5、MA模型
6、ARMA模型
7、ARIMA模型
8、ARCH模型
9、GARCH模型及其衍生模型
前言 前面几篇对平稳序列进行分析，然而实际上大多数时间序列都是非平稳的。对非平稳时间序列的分析方法可以分为确定性因素分解的时序分析和随机时序分析两个大类。
确定性因素分解的方法把所有序列的变化都归结为4个因素：长期趋势、季节变动、循环变动和随机波动。其中长期趋势和季节变动的规律性信息通常比较容易提取，而由随机因素导致的波动则非常难确定和分析，对随机信息浪费验证，会导致模型拟合精度差。随机时序分析法的发展就是为了弥补确定性因素分解方法的不足。根据时间序列的不同特点，随机时序分析可以建立的模型有ARIMA模型、残差自回归模型、季节模型、异方差模型。 差分定义 相距d期的两个序列值之间的减法运算称为d阶差分运算。（定义这个是为了后面用）
ARIMA模型 ARIMA模型（Autoregressive Integrated Moving Average model），差分整合移动平均自回归模型，又称整合移动平均自回归模型（移动也可称作滑动），是时间序列预测分析方法之一
许多非平稳序列差分后会显示出平稳序列的性质，这时非平稳序列为差分平稳序列。对差分平稳序列就可以使用ARMA模型进行拟合了。
ARIMA的数学表达：
x t = μ &#43; φ 1 ∗ x t − 1 &#43; . . . &#43; φ p ∗ x t − p &#43; θ 1 e t − 1 − . . . − θ q e t − q x_{t}= \mu &#43; \varphi_{1}* x_{t-1}&#43; .">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-11-21T20:46:29+08:00">
    <meta property="article:modified_time" content="2019-11-21T20:46:29+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据挖掘——时间序列算法之ARIMA模型</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>数据挖掘——时间序列算法之ARIMA模型</h4> 
 <ul><li><a href="#_12" rel="nofollow">前言</a></li><li><a href="#_18" rel="nofollow">差分定义</a></li><li><a href="#ARIMA_21" rel="nofollow">ARIMA模型</a></li><li><a href="#_38" rel="nofollow">实践</a></li><li><ul><li><a href="#1_47" rel="nofollow">1、检验序列的平稳性</a></li><li><a href="#2_87" rel="nofollow">2、进行一阶差分后，进行平稳性和白噪声检验</a></li><li><a href="#3ARMA_139" rel="nofollow">3、对一阶差分之后的平稳非白噪声序列拟合ARMA模型</a></li><li><ul><li><a href="#1_143" rel="nofollow">1）人为识别方法</a></li><li><a href="#2_162" rel="nofollow">2）相对最优模型识别</a></li></ul> 
   </li><li><a href="#4ARIMA_194" rel="nofollow">4、使用ARIMA预测</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>关于时间序列的其他模型，请参考本人的以下博文：<br> <a href="https://blog.csdn.net/weixin_42211626/article/details/103113698">1、平滑法</a><br> <a href="https://blog.csdn.net/weixin_42211626/article/details/103190415">2、趋势拟合法</a><br> <a href="https://blog.csdn.net/weixin_42211626/article/details/103190449">3、组合模型</a><br> <a href="https://blog.csdn.net/weixin_42211626/article/details/103190485">4、AR模型</a><br> <a href="https://blog.csdn.net/weixin_42211626/article/details/103190496">5、MA模型</a><br> <a href="https://blog.csdn.net/weixin_42211626/article/details/103190507">6、ARMA模型</a><br> <a href="https://blog.csdn.net/weixin_42211626/article/details/103190512">7、ARIMA模型</a><br> <a href="https://blog.csdn.net/weixin_42211626/article/details/103190527">8、ARCH模型</a><br> <a href="https://blog.csdn.net/weixin_42211626/article/details/103190553">9、GARCH模型及其衍生模型</a></p> 
<h2><a id="_12"></a>前言</h2> 
<p>前面几篇对平稳序列进行分析，然而实际上大多数时间序列都是非平稳的。对非平稳时间序列的分析方法可以分为<strong>确定性因素分解的时序分析</strong>和<strong>随机时序分析</strong>两个大类。</p> 
<ul><li>确定性因素分解的方法把所有序列的变化都归结为4个因素：长期趋势、季节变动、循环变动和随机波动。其中长期趋势和季节变动的规律性信息通常比较容易提取，而由随机因素导致的波动则非常难确定和分析，对随机信息浪费验证，会导致模型拟合精度差。</li><li>随机时序分析法的发展就是为了弥补确定性因素分解方法的不足。根据时间序列的不同特点，随机时序分析可以建立的模型有ARIMA模型、残差自回归模型、季节模型、异方差模型。</li></ul> 
<h2><a id="_18"></a>差分定义</h2> 
<p>相距d期的两个序列值之间的减法运算称为d阶差分运算。（定义这个是为了后面用）</p> 
<h2><a id="ARIMA_21"></a>ARIMA模型</h2> 
<p>ARIMA模型（Autoregressive Integrated Moving Average model），差分整合移动平均自回归模型，又称整合移动平均自回归模型（移动也可称作滑动），是时间序列预测分析方法之一<br> 许多非平稳序列差分后会显示出平稳序列的性质，这时非平稳序列为差分平稳序列。对差分平稳序列就可以使用ARMA模型进行拟合了。</p> 
<p>ARIMA的数学表达：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
         
           t 
          
         
        
          = 
         
        
          μ 
         
        
          + 
         
         
         
           φ 
          
         
           1 
          
         
        
          ∗ 
         
         
         
           x 
          
          
          
            t 
           
          
            − 
           
          
            1 
           
          
         
        
          + 
         
        
          . 
         
        
          . 
         
        
          . 
         
        
          + 
         
         
         
           φ 
          
         
           p 
          
         
        
          ∗ 
         
         
         
           x 
          
          
          
            t 
           
          
            − 
           
          
            p 
           
          
         
        
          + 
         
         
         
           θ 
          
         
           1 
          
         
         
         
           e 
          
          
          
            t 
           
          
            − 
           
          
            1 
           
          
         
        
          − 
         
        
          . 
         
        
          . 
         
        
          . 
         
        
          − 
         
         
         
           θ 
          
         
           q 
          
         
         
         
           e 
          
          
          
            t 
           
          
            − 
           
          
            q 
           
          
         
        
       
         x_{t}= \mu + \varphi_{1}* x_{t-1}+ ...+ \varphi_{p}* x_{t-p} + \theta_{1}e_{t-1}-...-\theta_{q}e_{t-q} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.77777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.65972em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.791661em; vertical-align: -0.208331em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.751388em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.869438em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.902771em; vertical-align: -0.208331em;"></span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.280556em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></p> 
<p>很明显哈，ARIMA的实质就是差分运算与ARMA模型的结合。其中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         φ 
        
       
      
        \varphi 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">φ</span></span></span></span></span>是AR模型的参数，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         θ 
        
       
      
        \theta 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span></span></span></span></span>是MA模型的参数。</p> 
<p>关于ARIMA的计算方法，这里有一篇比较好的<a href="https://www.cnblogs.com/bradleon/p/6827109.html" rel="nofollow">博客</a>，我这里就臭不要脸的在他的上面截图了：</p> 
<p><img src="https://images2.imgbox.com/07/bc/XNbKN6xs_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9e/bd/i8JbTkOb_o.png" alt="在这里插入图片描述">上面的例子可以很好的帮助理解ARIMA模型。</p> 
<p>差分平稳时间序列建模步骤：<br> <img src="https://images2.imgbox.com/ea/ac/XlpoQTcg_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_38"></a>实践</h2> 
<p>先查看数据长什么样</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span> <span class="token string">'./data/arima_data.xls'</span><span class="token punctuation">,</span> index_col <span class="token operator">=</span> u<span class="token string">'日期'</span><span class="token punctuation">)</span>
data
</code></pre> 
<p><img src="https://images2.imgbox.com/6f/01/YLTYm4NE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1_47"></a>1、检验序列的平稳性</h3> 
<p>1）画个趋势图，检验序列的平稳性</p> 
<pre><code class="prism language-python"><span class="token comment">#时序图</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span> <span class="token comment">#用来正常显示中文标签</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment">#用来正常显示负号</span>
data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/94/85/643R16MA_o.png" alt="原始数据的时序图"></p> 
<p>从原始数据的趋势图中很明显的看出，该序列具有单调递增趋势，可以判断为是非平稳数据。</p> 
<p>2）再看下原始数据的自相关图</p> 
<pre><code class="prism language-python"><span class="token comment">#自相关图</span>
<span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>tsaplots <span class="token keyword">import</span> plot_acf
plot_acf<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6c/da/KTBlKLUA_o.png" alt="原始序列的自相关图">上面的自相关图显示自相关系数长期大于0，说明序列间具有很强的长期相关性。</p> 
<p>3）再来看原始数据的单位根检验</p> 
<pre><code class="prism language-python"><span class="token comment">#平稳性检测</span>
<span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>stattools <span class="token keyword">import</span> adfuller <span class="token keyword">as</span> ADF
<span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token string">'原始序列的ADF检验结果为：'</span><span class="token punctuation">,</span> ADF<span class="token punctuation">(</span>data<span class="token punctuation">[</span>u<span class="token string">'销量'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#返回值依次为adf、pvalue、usedlag、nobs、critical values、icbest、regresults、resstore</span>
</code></pre> 
<p>结果如下：<br> <img src="https://images2.imgbox.com/8c/bd/Hk6ttaIx_o.png" alt="在这里插入图片描述">整理成表格：</p> 
<table><thead><tr><th>ADF</th><th>cValue</th><th>p值</th></tr></thead><tbody><tr><td>1.8138</td><td>1%:-3.7112；5%:-2.9812；10%:-2.6301</td><td>0.9984</td></tr></tbody></table> 
<p>结论：上表中表明，单位根检验统计量对应的p值显著大于0.05，最终将该序列判断为非平稳序列，并且非平稳数据一定不是白噪声数据。</p> 
<h3><a id="2_87"></a>2、进行一阶差分后，进行平稳性和白噪声检验</h3> 
<p>1）对一阶差分后的序列再次做平稳性判断</p> 
<pre><code class="prism language-python"><span class="token comment">#差分后的结果</span>
D_data <span class="token operator">=</span> data<span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
D_data<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span>u<span class="token string">'销量差分'</span><span class="token punctuation">]</span>
D_data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#时序图</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/63/0b/cHqN8liQ_o.png" alt="在这里插入图片描述"><br> 2）自相关图</p> 
<pre><code class="prism language-python">plot_acf<span class="token punctuation">(</span>D_data<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#自相关图</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/57/07/U6tF6ZNj_o.png" alt="在这里插入图片描述"><br> 3）单位根检验</p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token string">'差分序列的ADF检验结果为：'</span><span class="token punctuation">,</span> ADF<span class="token punctuation">(</span>D_data<span class="token punctuation">[</span>u<span class="token string">'销量差分'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#平稳性检测</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a9/b6/0FEIgz9X_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th>ADF</th><th>cValue</th><th>p值</th></tr></thead><tbody><tr><td>-3.1561</td><td>1%:-3.6327；5%:-2.9485；10%:-2.6130</td><td>0.0227</td></tr></tbody></table> 
<p>结果显示：</p> 
<ol><li>一阶差分后的序列的时序图在均值附近比较平稳的波动</li><li>自相关图有很强的短期相关性</li><li>单位根检验p值小于0.05</li></ol> 
<p>结论：一阶差分之后的序列是平稳序列。</p> 
<p>上面已经证明了一阶差分后的序列是平稳序列了，那么就<font color="red">需要对该平稳的一节差分做白噪声检验：</font></p> 
<pre><code class="prism language-python"><span class="token comment">#白噪声检验</span>
<span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>stats<span class="token punctuation">.</span>diagnostic <span class="token keyword">import</span> acorr_ljungbox
<span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token string">'差分序列的白噪声检验结果为：'</span><span class="token punctuation">,</span> acorr_ljungbox<span class="token punctuation">(</span>D_data<span class="token punctuation">,</span> lags<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#返回统计量和p值</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/25/8d/ABjr117S_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th>stat</th><th>p值</th></tr></thead><tbody><tr><td>11.304</td><td>0.007724</td></tr></tbody></table> 
<p>结论：输出的p值小于0.05，所以一阶差分之后的序列是平稳非白噪声序列。</p> 
<h3><a id="3ARMA_139"></a>3、对一阶差分之后的平稳非白噪声序列拟合ARMA模型</h3> 
<p>下面进行模型定阶，也就是确定ARMA的p和q。</p> 
<p>这里有两种方法可以确定出p和q，即<strong>人为识别的方法</strong>和<strong>相对最优模型识别</strong>。</p> 
<h4><a id="1_143"></a>1）人为识别方法</h4> 
<p>使用该方法确定p和q时，一定要知道AR模型和MA模型的<strong>性质</strong>，这在我的博文里面有说，详见本文开始部分处的链接。<br> 回顾下一阶差分后的自相关图：<br> <img src="https://images2.imgbox.com/5c/0a/nICTIslE_o.png" alt="在这里插入图片描述">可见一阶差分后的自相关图显示出了1阶截尾 （记为结论1）</p> 
<p>再看一阶差分后的偏自相关图：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>tsaplots <span class="token keyword">import</span> plot_pacf
plot_pacf<span class="token punctuation">(</span>D_data<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#偏自相关图</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7b/17/16cGHTBU_o.png" alt="在这里插入图片描述"><br> 可见一阶差分后的偏自相关图显示出了拖尾性 （记为结论2）<br> （关于截尾和拖尾，看此篇<a href="https://blog.csdn.net/baby_bye/article/details/91561024">文章</a>，或者简要的看下下面的图）<br> <img src="https://images2.imgbox.com/36/4c/cIWs0djA_o.png" alt="在这里插入图片描述"><br> <strong>综合结论1和结论2 ，可以考虑用MA(1)模型拟合1阶差分后的序列，即对袁术序列建立ARIMA(0,1,1)模型。</strong></p> 
<h4><a id="2_162"></a>2）相对最优模型识别</h4> 
<p>使用该方法必须了解BIC和AIC的含义，可以看此篇文章：<a href="https://blog.csdn.net/sunnyxidian/article/details/92946542">ARIMA模型原理及实现</a>，这块截一段主要介绍：<br> <img src="https://images2.imgbox.com/cc/42/9COVKYvk_o.png" alt="在这里插入图片描述"><br> 计算ARMR(p,q)。当p和q均小于等于3的所有组合的BIC信息量，取其中BIC信息量达到最小的模型阶数。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>arima_model <span class="token keyword">import</span> ARIMA
data<span class="token punctuation">[</span>u<span class="token string">'销量'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>u<span class="token string">'销量'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">)</span>
<span class="token comment">#定阶</span>
pmax <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>D_data<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">#一般阶数不超过length/10</span>
qmax <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>D_data<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">#一般阶数不超过length/10</span>
bic_matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">#bic矩阵</span>
<span class="token keyword">for</span> p <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>pmax<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> q <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>qmax<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span> <span class="token comment">#存在部分报错，所以用try来跳过报错。</span>
            tmp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ARIMA<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bic<span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            tmp<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>
    bic_matrix<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>

bic_matrix <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>bic_matrix<span class="token punctuation">)</span> <span class="token comment">#从中可以找出最小值</span>
bic_matrix
</code></pre> 
<p><img src="https://images2.imgbox.com/67/77/Trg0bWiZ_o.png" alt="在这里插入图片描述">可以看到在p=0,q=1的时候BIC是最小的，为422.51…。用下面的代码找出</p> 
<pre><code class="prism language-python">p<span class="token punctuation">,</span>q <span class="token operator">=</span> bic_matrix<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>idxmin<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#先用stack展平，然后用idxmin找出最小值位置。</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token string">'BIC最小的p值和q值为：%s、%s'</span> <span class="token operator">%</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/f3/00/SP7T3n02_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4ARIMA_194"></a>4、使用ARIMA预测</h3> 
<p>上面已经得到了p=0，q=1，那么就应用ARIMA（0,1,1）对原始数据即某餐厅的显瘦数据作为为期5天的预测。</p> 
<pre><code class="prism language-python">model <span class="token operator">=</span> ARIMA<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#建立ARIMA(0, 1, 1)模型</span>
model<span class="token punctuation">.</span>summary2<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#给出一份模型报告</span>
model<span class="token punctuation">.</span>forecast<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">#作为期5天的预测，返回预测结果、标准误差、置信区间。</span>
</code></pre> 
<p>预测结果如下：<br> <img src="https://images2.imgbox.com/ff/04/G0Ztuvtt_o.png" alt="在这里插入图片描述"><br> <font size="5" color="red">需要注意：利用模型向前预测的时期越长，预测误差将会越大，这是时间预测的典型特点。</font></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2bf9aab9523d95b10133e5f6bec83505/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据挖掘——时间序列算法之平滑法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d838cd14fdce3801d5b2fbb1efab887f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">API【国内城市天气指数】（空气、湿度、风向、日出）- 0303</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>