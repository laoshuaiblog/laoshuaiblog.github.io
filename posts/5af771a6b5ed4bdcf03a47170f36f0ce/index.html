<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 仪表进度条 自定义View - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/5af771a6b5ed4bdcf03a47170f36f0ce/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Android 仪表进度条 自定义View">
  <meta property="og:description" content="Android 自定义仪表进度条浅析 最近写了几个小教程，一次性发出来吧，今天最后一篇，继续玩一玩自定义View吧，这次加上了自定义属性，即，在xml中引用该控件可以通过自定义属性设置一些效果。该进度条实现了颜色渐变等，是出门旅行，熟悉自定义View之必备补品，可直接用于实际项目，已优化，比如下载东西展示个进度什么的，知识点掌握之后，你想怎么折腾就怎么折腾吧。 (Gradle Build)
原创帖，转载请注明出处，开源思想，欢迎关注探讨Github：https://github.com/Zjinji/MeterView 作者：尽际
目录 Android 自定义仪表进度条浅析 目录学习流程 基础知识绘制技巧Have Fun附上截图 学习流程： 基础知识
绘制技巧
Have fun
基础知识 1、Canvas旋转 a、baseCanvas.rotate(1, 2, 3); 参数1：画布旋转角度，负数为逆时针，正数为顺时针 参数2：旋转围绕的中心x坐标 参数3：旋转围绕的中心y坐标 2、attrs定义 a、在values文件夹中，创建attrs.xml文件，文件内容大致如下， 主要是定义一些后续会使用到的属性： &amp;lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&amp;gt; &amp;lt;resources&amp;gt; &amp;lt;declare-styleable name=&#34;MeterView&#34;&amp;gt; &amp;lt;attr name=&#34;arcColor&#34; format=&#34;color&#34;/&amp;gt; &amp;lt;attr name=&#34;arcWidth&#34; format=&#34;dimension&#34;/&amp;gt; &amp;lt;attr name=&#34;text&#34; format=&#34;string&#34;/&amp;gt; &amp;lt;attr name=&#34;levelCount&#34; format=&#34;integer&#34;/&amp;gt; &amp;lt;attr name=&#34;innerCircleColor&#34; format=&#34;color&#34;/&amp;gt; &amp;lt;attr name=&#34;pointerColor&#34; format=&#34;color&#34;/&amp;gt; &amp;lt;attr name=&#34;textSize&#34; format=&#34;dimension&#34;/&amp;gt; &amp;lt;/declare-styleable&amp;gt; &amp;lt;/resources&amp;gt; 3、TypedArray a、在自定义View的构造方法中，通过该对象得到引用资源，即 TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.MeterView, defStyleAttr, 0); b、 参数1：attrsSet集合 参数2：你刚才定义的declare-styleable 参数3：默认样式 这个默认样式为如果用户没有显示的在xml中使用你刚才的属性，那么这些属性的默认值是多少，你可以自己设定一下，比如： &amp;lt;style name=&#34;">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2016-11-01T15:39:40+08:00">
    <meta property="article:modified_time" content="2016-11-01T15:39:40+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 仪表进度条 自定义View</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="android-自定义仪表进度条浅析">Android 自定义仪表进度条浅析</h2> 
<p>最近写了几个小教程，一次性发出来吧，今天最后一篇，继续玩一玩自定义View吧，这次加上了自定义属性，即，在xml中引用该控件可以通过自定义属性设置一些效果。该进度条实现了颜色渐变等，是出门旅行，熟悉自定义View之必备补品，可直接用于实际项目，已优化，比如下载东西展示个进度什么的，知识点掌握之后，你想怎么折腾就怎么折腾吧。 <br> (Gradle Build)</p> 
<p>原创帖，转载请注明出处，开源思想，欢迎关注探讨Github：<a href="https://github.com/Zjinji/MeterView">https://github.com/Zjinji/MeterView</a> <br> 作者：尽际</p> 
<h3 id="目录">目录</h3> 
<p></p> 
<div class="toc"> 
 <div class="toc"> 
  <ul><li><a href="#android-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BB%AA%E8%A1%A8%E8%BF%9B%E5%BA%A6%E6%9D%A1%E6%B5%85%E6%9E%90" rel="nofollow">Android 自定义仪表进度条浅析</a> 
    <ul><li><a href="#%E7%9B%AE%E5%BD%95" rel="nofollow">目录</a></li><li><a href="#%E5%AD%A6%E4%B9%A0%E6%B5%81%E7%A8%8B" rel="nofollow">学习流程</a> 
      <ul><li><a href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86" rel="nofollow">基础知识</a></li><li><a href="#%E7%BB%98%E5%88%B6%E6%8A%80%E5%B7%A7" rel="nofollow">绘制技巧</a></li><li><a href="#have-fun%E9%99%84%E4%B8%8A%E6%88%AA%E5%9B%BE" rel="nofollow">Have Fun附上截图</a></li></ul> </li></ul> </li></ul> 
 </div> 
</div> 
<p></p> 
<h3 id="学习流程">学习流程：</h3> 
<ul><li><p><strong>基础知识</strong></p></li><li><p><strong>绘制技巧</strong></p></li><li><p><strong>Have fun</strong></p></li></ul> 
<h4 id="基础知识">基础知识</h4> 
<pre><code>1、Canvas旋转
    a、baseCanvas.rotate(1, 2, 3);
        参数1：画布旋转角度，负数为逆时针，正数为顺时针
        参数2：旋转围绕的中心x坐标
        参数3：旋转围绕的中心y坐标
2、attrs定义
    a、在values文件夹中，创建attrs.xml文件，文件内容大致如下，
    主要是定义一些后续会使用到的属性：
</code></pre> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">resources</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">declare-styleable</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"MeterView"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attr</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"arcColor"</span> <span class="hljs-attribute">format</span>=<span class="hljs-value">"color"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attr</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"arcWidth"</span> <span class="hljs-attribute">format</span>=<span class="hljs-value">"dimension"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attr</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">format</span>=<span class="hljs-value">"string"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attr</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"levelCount"</span> <span class="hljs-attribute">format</span>=<span class="hljs-value">"integer"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attr</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"innerCircleColor"</span> <span class="hljs-attribute">format</span>=<span class="hljs-value">"color"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attr</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"pointerColor"</span> <span class="hljs-attribute">format</span>=<span class="hljs-value">"color"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attr</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"textSize"</span> <span class="hljs-attribute">format</span>=<span class="hljs-value">"dimension"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">declare-styleable</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">resources</span>&gt;</span></code></pre> 
<pre><code>3、TypedArray
    a、在自定义View的构造方法中，通过该对象得到引用资源，即
</code></pre> 
<pre class="prettyprint"><code class=" hljs avrasm">TypedArray typedArray = context<span class="hljs-preprocessor">.obtainStyledAttributes</span>(attrs, R<span class="hljs-preprocessor">.styleable</span><span class="hljs-preprocessor">.MeterView</span>, defStyleAttr, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span></code></pre> 
<pre><code>    b、
        参数1：attrsSet集合
        参数2：你刚才定义的declare-styleable
        参数3：默认样式
        这个默认样式为如果用户没有显示的在xml中使用你刚才的属性，那么这些属性的默认值是多少，你可以自己设定一下，比如：
</code></pre> 
<pre class="prettyprint"><code class=" hljs applescript">&lt;style <span class="hljs-property">name</span>=<span class="hljs-string">"MeterViewInStyle"</span>&gt;
        &lt;<span class="hljs-property">item</span> <span class="hljs-property">name</span>=<span class="hljs-string">"arcColor"</span>&gt;<span class="hljs-comment">#0085cc&lt;/item&gt;</span>
        &lt;<span class="hljs-property">item</span> <span class="hljs-property">name</span>=<span class="hljs-string">"levelCount"</span>&gt;<span class="hljs-number">12</span>&lt;/<span class="hljs-property">item</span>&gt;
        &lt;<span class="hljs-property">item</span> <span class="hljs-property">name</span>=<span class="hljs-string">"innerCircleColor"</span>&gt;<span class="hljs-comment">#939393&lt;/item&gt;</span>
        &lt;<span class="hljs-property">item</span> <span class="hljs-property">name</span>=<span class="hljs-string">"pointerColor"</span>&gt;<span class="hljs-comment">#4d4d4d&lt;/item&gt;</span>
        &lt;<span class="hljs-property">item</span> <span class="hljs-property">name</span>=<span class="hljs-string">"textSize"</span>&gt;<span class="hljs-number">24</span>px&lt;/<span class="hljs-property">item</span>&gt;
        &lt;<span class="hljs-property">item</span> <span class="hljs-property">name</span>=<span class="hljs-string">"text"</span>&gt;当前速度&lt;/<span class="hljs-property">item</span>&gt;
        &lt;<span class="hljs-property">item</span> <span class="hljs-property">name</span>=<span class="hljs-string">"arcWidth"</span>&gt;<span class="hljs-number">50</span>px&lt;/<span class="hljs-property">item</span>&gt;
    &lt;/style&gt;</code></pre> 
<pre><code>        参数4：还是默认样式。此处详情请查阅：obtainStyledAttributes
        方法的源码注释。

    4、canvas save restore
        a、save：即保存画布的当前状态，这个状态是指画布的位置状态，很多人会理解为画布当前画了哪些东西的状态，这种思想很危险。：）
        b、restore：即恢复画布到刚才保存的状态节点。
        一般在save以及restore中间会做一些基本的操作，比如在一个圆上绘制刻度，通过旋转画布的方式比用三角函数更轻松些。
        详情见代码，一看便知，注释详细。
    5、onMessure
        a、View的测量，自定义View方法的调用顺序为：
                onMessure 测量
                onLayout 布局
                onDraw 绘制
            在绘制之前，可能会多次的调用测量和布局方法。其中
            onMessure中的具体实现，见代码，主要用户就是来确定
            当前空间的大小。
            （Paint此处先不赘述了）
</code></pre> 
<h4 id="绘制技巧">绘制技巧</h4> 
<pre><code>1、避免在onDraw方法中实例化对象，底层仪表不论进度怎么变化，仪表都是没有变化的；
所以，仪表应该当做底层图层来绘制；
最后在onDraw中直接绘制整个仪表图层即可，变化的部分，直接放在onDraw中绘制。如果你能有PS中作图时图层的感觉就好。
底层图层这样做：
</code></pre> 
<pre class="prettyprint"><code class=" hljs avrasm">baseBitmap = Bitmap<span class="hljs-preprocessor">.createBitmap</span>(meterViewWidth, meterViewHeight, Bitmap<span class="hljs-preprocessor">.Config</span><span class="hljs-preprocessor">.ARGB</span>_8888)<span class="hljs-comment">;</span>
        baseCanvas = new Canvas(baseBitmap)<span class="hljs-comment">;</span></code></pre> 
<pre><code>2、画弧
a、确定圆弧的绘制区域RectF outterArc = new RectF(1, 2, 3, 4)
    参数1，2：矩形左上角顶点坐标
    参数3，4：矩形右下角顶点坐标
b、baseCanvas.drawArc(1, 2, 3, 4, 5);
    参数1：你刚才定义的矩形区域
    参数2：圆弧起始角度，圆心右方水平为0°，顺时针递增，大家脑补下。
    参数3：圆弧扫过角度。即，从参数2顺时针，扫多少个角度。
    参数4：是否将圆弧两端顶点连接并填充颜色，需要配合画笔（FILL style）
    参数5：画笔对象
    （注：顺时针为正角度，逆时针为负角度）
c、绘制刻度：通过画布旋转
</code></pre> 
<pre class="prettyprint"><code class=" hljs mel">        <span class="hljs-comment">//绘制右边刻度</span>
        <span class="hljs-comment">//旋转角度</span>
        <span class="hljs-keyword">float</span> roundAngle = <span class="hljs-number">250</span>f / levelCount;
        <span class="hljs-comment">//右刻度</span>
        <span class="hljs-comment">//当画布进行任何位置变换后，最终均将回到最初状态</span>
        baseCanvas.save();
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; levelCount / <span class="hljs-number">2</span>; i++){
            baseCanvas.<span class="hljs-keyword">rotate</span>(roundAngle, w / <span class="hljs-number">2</span>, h / <span class="hljs-number">2</span>);
            baseCanvas.drawLine(w / <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, w / <span class="hljs-number">2</span>, <span class="hljs-number">20</span>, basePaint);
        }
        baseCanvas.restore();</code></pre> 
<pre><code>    旋转画布绘制刻度怎么理解呢，你可以想象成，画笔不动（即绘制坐标不变），让画布转圈，这样子，画笔就可以在画布的不同位置绘制内容了。

    以上为绘制重点，其他，比如设置个什么百分比了，动态改变当前进度了，就很简答了，代码见就好。
    渐变效果，是为画笔设置了LinearGradient线性渐变Shader。即：paint.setShader(linearGradient);
    （如果没有格式错误的话，在代码204行）
</code></pre> 
<h4 id="have-fun附上截图">Have Fun(附上截图)</h4> 
<pre><code>因为对于你们过于简单，核心讲解完了，没啥好说了感觉。
大家玩的开心：）
</code></pre> 
<p><img src="https://images2.imgbox.com/2f/f0/uMmPmAbl_o.png" alt="MeterView" title=""></p> 
<p>源码传送门：免积分分享给大家 <br> [自定义仪表MeterView]<a href="http://download.csdn.net/detail/z279868688/9669182">http://download.csdn.net/detail/z279868688/9669182</a></p> 
<p>PS：Github以及这里会持续更新Android有趣的开发。欢迎关注探讨。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6b09f4d1eb31716c1b3a9025e9f90ac0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">J2EE之java自定义注解在项目中的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/be4fe3a2d2cb1d74276e2624ded07ffe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL对数据进行统计、常用集合函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>