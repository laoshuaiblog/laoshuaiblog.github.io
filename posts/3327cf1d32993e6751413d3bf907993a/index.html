<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Collectors.toMap报错 ：Duplicate key - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/3327cf1d32993e6751413d3bf907993a/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Collectors.toMap报错 ：Duplicate key">
  <meta property="og:description" content="第一种写法:使用Collectors.toMap的方法，如果key重复会直接报错
第二种写法: 使用mergeFunction参数，可以取重复的key中的第一个或最后一个
方案1:#使用Collectors.toMap的方法，如果key重复会直接报错 List&amp;lt;TpLifecircleConsumeDO&amp;gt; list = new ArrayList&amp;lt;&amp;gt;(); TpLifecircleConsumeDO tpLifecircleConsumeDO = new TpLifecircleConsumeDO(); TpLifecircleConsumeDO tpLifecircleConsumeDO2 = new TpLifecircleConsumeDO(); tpLifecircleConsumeDO.setOrderSn(&#34;123&#34;); tpLifecircleConsumeDO.setOrderSumprice(new BigDecimal(&#34;2.1&#34;)); list.add(tpLifecircleConsumeDO); tpLifecircleConsumeDO2.setOrderSn(&#34;123&#34;); tpLifecircleConsumeDO2.setOrderSumprice(new BigDecimal(&#34;2.1&#34;)); list.add(tpLifecircleConsumeDO2); 方案1:#使用Collectors.toMap的方法，如果key重复会直接报错 Map&amp;lt;String, TpLifecircleConsumeDO&amp;gt; consumeDOMap = list.stream().distinct().collect(Collectors.toMap(TpLifecircleConsumeDO::getOrderSn, consumeDo -&amp;gt; consumeDo)); System.out.println(consumeDOMap); Exception in thread &#34;main&#34; java.lang.IllegalStateException: Duplicate key TpLifecircleConsumeDO[id=&amp;lt;null&amp;gt;,ext1=&amp;lt;null&amp;gt;,ext2=&amp;lt;null&amp;gt;,ext3=&amp;lt;null&amp;gt;,ext4=&amp;lt;null&amp;gt;,token=&amp;lt;null&amp;gt;,openid=&amp;lt;null&amp;gt;,remark=&amp;lt;null&amp;gt;,orderSn=123,bankType=&amp;lt;null&amp;gt;,discount=&amp;lt;null&amp;gt;,payToken=&amp;lt;null&amp;gt;,callBackUrl=&amp;lt;null&amp;gt;,merchantOrderSn=&amp;lt;null&amp;gt;,uid=&amp;lt;null&amp;gt;,mode=&amp;lt;null&amp;gt;,type=&amp;lt;null&amp;gt;,mchid=&amp;lt;null&amp;gt;,redId=&amp;lt;null&amp;gt;,userId=&amp;lt;null&amp;gt;,agentId=&amp;lt;null&amp;gt;,channel=&amp;lt;null&amp;gt;,payTime=&amp;lt;null&amp;gt;,payType=&amp;lt;null&amp;gt;,storeId=&amp;lt;null&amp;gt;,markread=&amp;lt;null&amp;gt;,printNum=&amp;lt;null&amp;gt;,redPreId=&amp;lt;null&amp;gt;,cashierId=&amp;lt;null&amp;gt;,payStatus=&amp;lt;null&amp;gt;,createTime=&amp;lt;null&amp;gt;,discountId=&amp;lt;null&amp;gt;,refundStatus=&amp;lt;null&amp;gt;,rechargeactId=&amp;lt;null&amp;gt;,preferentialId=&amp;lt;null&amp;gt;,repairOrderStatus=&amp;lt;null&amp;gt;,updateTimeAuto=&amp;lt;null&amp;gt;,fee=&amp;lt;null&amp;gt;,refund=&amp;lt;null&amp;gt;,cashFee=&amp;lt;null&amp;gt;,rateFee=&amp;lt;null&amp;gt;,redMoney=&amp;lt;null&amp;gt;,couponFee=&amp;lt;null&amp;gt;,orderPrice=&amp;lt;null&amp;gt;,commissionFee=&amp;lt;null&amp;gt;,discountMoney=&amp;lt;null&amp;gt;,orderSumprice=2.1,autowipingzero=&amp;lt;null&amp;gt;,additionalPrice=&amp;lt;null&amp;gt;,commissionRateFee=&amp;lt;null&amp;gt;,rechargeactAmount=&amp;lt;null&amp;gt;,preferentialAmount=&amp;lt;null&amp;gt;] at java.util.stream.Collectors.lambda$throwingMerger$0(Collectors.java:133) at java.util.HashMap.merge(HashMap.java:1254) at java.util.stream.Collectors.lambda$toMap$58(Collectors.java:1320) at java.util.stream.ReduceOps$3ReducingSink.accept(ReduceOps.java:169) at java.util.stream.DistinctOps$1$2.accept(DistinctOps.java:175) at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382) at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481) at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471) at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708) at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499) at com.fshows.lifecircle.datacore.service.facade.impl.MonthlyTableFacadeImpl.main(MonthlyTableFacadeImpl.java:554) 方案2: 使用mergeFunction参数，可以取重复的key中的第一个或最后一个 Map&amp;lt;String, TpLifecircleConsumeDO&amp;gt; consumeDOMap = list.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-04-20T15:01:45+08:00">
    <meta property="article:modified_time" content="2020-04-20T15:01:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Collectors.toMap报错 ：Duplicate key</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>第一种写法:使用Collectors.toMap的方法，如果key重复会直接报错<br> 第二种写法: 使用mergeFunction参数，可以取重复的key中的第一个或最后一个</p> 
<h3><a id="1CollectorstoMapkey_4"></a>方案1:#使用Collectors.toMap的方法，如果key重复会直接报错</h3> 
<pre><code class="prism language-csharp">List<span class="token operator">&lt;</span>TpLifecircleConsumeDO<span class="token operator">&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TpLifecircleConsumeDO</span> tpLifecircleConsumeDO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TpLifecircleConsumeDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TpLifecircleConsumeDO</span> tpLifecircleConsumeDO2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TpLifecircleConsumeDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tpLifecircleConsumeDO<span class="token punctuation">.</span><span class="token function">setOrderSn</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tpLifecircleConsumeDO<span class="token punctuation">.</span><span class="token function">setOrderSumprice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"2.1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token keyword">add</span><span class="token punctuation">(</span>tpLifecircleConsumeDO<span class="token punctuation">)</span><span class="token punctuation">;</span>
tpLifecircleConsumeDO2<span class="token punctuation">.</span><span class="token function">setOrderSn</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tpLifecircleConsumeDO2<span class="token punctuation">.</span><span class="token function">setOrderSumprice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"2.1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token keyword">add</span><span class="token punctuation">(</span>tpLifecircleConsumeDO2<span class="token punctuation">)</span><span class="token punctuation">;</span>

方案<span class="token number">1</span><span class="token punctuation">:</span>#使用Collectors<span class="token punctuation">.</span>toMap的方法，如果key重复会直接报错
Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> TpLifecircleConsumeDO<span class="token operator">&gt;</span> consumeDOMap <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>TpLifecircleConsumeDO<span class="token punctuation">:</span><span class="token punctuation">:</span>getOrderSn<span class="token punctuation">,</span> consumeDo <span class="token operator">-</span><span class="token operator">&gt;</span> consumeDo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>consumeDOMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Exception</span> <span class="token keyword">in</span> thread <span class="token string">"main"</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>IllegalStateException<span class="token punctuation">:</span> <span class="token class-name">Duplicate</span> key TpLifecircleConsumeDO<span class="token punctuation">[</span>id<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>ext1<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>ext2<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>ext3<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>ext4<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>token<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>openid<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>remark<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>orderSn<span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">,</span>bankType<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>discount<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>payToken<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>callBackUrl<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>merchantOrderSn<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>uid<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>mode<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>type<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>mchid<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>redId<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>userId<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>agentId<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>channel<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>payTime<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>payType<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>storeId<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>markread<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>printNum<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>redPreId<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>cashierId<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>payStatus<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>createTime<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>discountId<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>refundStatus<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>rechargeactId<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>preferentialId<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>repairOrderStatus<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>updateTimeAuto<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>fee<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>refund<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>cashFee<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>rateFee<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>redMoney<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>couponFee<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>orderPrice<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>commissionFee<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>discountMoney<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>orderSumprice<span class="token operator">=</span><span class="token number">2.1</span><span class="token punctuation">,</span>autowipingzero<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>additionalPrice<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>commissionRateFee<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>rechargeactAmount<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>preferentialAmount<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">.</span>lambda$throwingMerger$<span class="token function">0</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">133</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>HashMap<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">1254</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">.</span>lambda$toMap$<span class="token function">58</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">1320</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>ReduceOps$<span class="token number">3</span>ReducingSink<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>ReduceOps<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">169</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>DistinctOps$<span class="token number">1</span>$<span class="token number">2.</span><span class="token function">accept</span><span class="token punctuation">(</span>DistinctOps<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">175</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList$ArrayListSpliterator<span class="token punctuation">.</span><span class="token function">forEachRemaining</span><span class="token punctuation">(</span>ArrayList<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">1382</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>AbstractPipeline<span class="token punctuation">.</span><span class="token function">copyInto</span><span class="token punctuation">(</span>AbstractPipeline<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">481</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>AbstractPipeline<span class="token punctuation">.</span><span class="token function">wrapAndCopyInto</span><span class="token punctuation">(</span>AbstractPipeline<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">471</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>ReduceOps$ReduceOp<span class="token punctuation">.</span><span class="token function">evaluateSequential</span><span class="token punctuation">(</span>ReduceOps<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">708</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>AbstractPipeline<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>AbstractPipeline<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">234</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>ReferencePipeline<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>ReferencePipeline<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">499</span><span class="token punctuation">)</span>
	at com<span class="token punctuation">.</span>fshows<span class="token punctuation">.</span>lifecircle<span class="token punctuation">.</span>datacore<span class="token punctuation">.</span>service<span class="token punctuation">.</span>facade<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>MonthlyTableFacadeImpl<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>MonthlyTableFacadeImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">554</span><span class="token punctuation">)</span>
 
</code></pre> 
<h3><a id="2_mergeFunctionkey_38"></a>方案2: 使用mergeFunction参数，可以取重复的key中的第一个或最后一个</h3> 
<pre><code class="prism language-csharp">
Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> TpLifecircleConsumeDO<span class="token operator">&gt;</span> consumeDOMap <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>TpLifecircleConsumeDO<span class="token punctuation">:</span><span class="token punctuation">:</span>getOrderSn<span class="token punctuation">,</span> consumeDo <span class="token operator">-</span><span class="token operator">&gt;</span> consumeDo<span class="token punctuation">,</span> <span class="token punctuation">(</span>key1<span class="token punctuation">,</span> key2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> key1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>consumeDOMap<span class="token punctuation">)</span><span class="token punctuation">;</span>


源代码：
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token punctuation">,</span> K<span class="token punctuation">,</span> U<span class="token operator">&gt;</span>
Collector<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>U<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">toMap</span><span class="token punctuation">(</span>Function<span class="token operator">&lt;</span><span class="token operator">?</span> super T<span class="token punctuation">,</span> <span class="token operator">?</span> extends K<span class="token operator">&gt;</span> keyMapper<span class="token punctuation">,</span>
                                Function<span class="token operator">&lt;</span><span class="token operator">?</span> super T<span class="token punctuation">,</span> <span class="token operator">?</span> extends U<span class="token operator">&gt;</span> valueMapper<span class="token punctuation">,</span>
                                BinaryOperator<span class="token operator">&lt;</span>U<span class="token operator">&gt;</span> mergeFunction<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">toMap</span><span class="token punctuation">(</span>keyMapper<span class="token punctuation">,</span> valueMapper<span class="token punctuation">,</span> mergeFunction<span class="token punctuation">,</span> HashMap<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token operator">&lt;</span>T<span class="token punctuation">,</span> K<span class="token punctuation">,</span> U<span class="token punctuation">,</span> <span class="token class-name">M</span> extends Map<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> U<span class="token operator">&gt;</span><span class="token operator">&gt;</span>
Collector<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">,</span> M<span class="token operator">&gt;</span> <span class="token function">toMap</span><span class="token punctuation">(</span>Function<span class="token operator">&lt;</span><span class="token operator">?</span> super T<span class="token punctuation">,</span> <span class="token operator">?</span> extends K<span class="token operator">&gt;</span> keyMapper<span class="token punctuation">,</span>
                            Function<span class="token operator">&lt;</span><span class="token operator">?</span> super T<span class="token punctuation">,</span> <span class="token operator">?</span> extends U<span class="token operator">&gt;</span> valueMapper<span class="token punctuation">,</span>
                            BinaryOperator<span class="token operator">&lt;</span>U<span class="token operator">&gt;</span> mergeFunction<span class="token punctuation">,</span>
                            Supplier<span class="token operator">&lt;</span>M<span class="token operator">&gt;</span> mapSupplier<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    BiConsumer<span class="token operator">&lt;</span>M<span class="token punctuation">,</span> T<span class="token operator">&gt;</span> accumulator
            <span class="token operator">=</span> <span class="token punctuation">(</span>map<span class="token punctuation">,</span> element<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> map<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>keyMapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          valueMapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span> mergeFunction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CollectorImpl</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>mapSupplier<span class="token punctuation">,</span> accumulator<span class="token punctuation">,</span> <span class="token function">mapMerger</span><span class="token punctuation">(</span>mergeFunction<span class="token punctuation">)</span><span class="token punctuation">,</span> CH_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1500adf5f525f656be2af521626985be/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Unity】在Inspector上显示自定义的位掩码枚举（Flags）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fc3561fb9989b2744aef6f709190c4cb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python连接sftp进行文件操作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>