<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LSTM的多变量时间序列预测（北京PM2.5预测） - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/bf78828beeefc957f607ca3c8e2b1b44/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="LSTM的多变量时间序列预测（北京PM2.5预测）">
  <meta property="og:description" content="参考博客
文章目录 LSTM简介数据集简介数据预处理多元LSTM预测模型数据准备：定义和拟合模型评估模型 训练多个滞后时间步 LSTM简介 LSTM（Long Short-Term Memory）是一种特殊类型的循环神经网络（RNN），它在处理序列数据和时间序列数据时表现出色。
相比于传统的RNN，LSTM引入了记忆单元（memory cell）和门控机制（gate mechanism），以解决传统RNN中的梯度消失和梯度爆炸问题，从而更好地捕捉长期依赖关系。
LSTM的核心组件是记忆单元，它可以存储和访问信息，并通过门控机制来控制信息的流动。LSTM中的三种门控单元是：
输入门（Input Gate）：控制是否将新输入信息添加到记忆单元中。 遗忘门（Forget Gate）：控制记忆单元中的哪些信息需要被遗忘。 输出门（Output Gate）：控制从记忆单元中读取哪些信息并输出。 这些门通过使用sigmoid激活函数来产生0到1之间的输出，表示信息的通过程度。
LSTM在训练过程中可以学习到如何选择存储和遗忘信息，从而对输入序列建模并捕捉到长期依赖关系。除了标准的LSTM，还有一些变种模型，如双向LSTM（Bidirectional LSTM）、多层LSTM（Multi-layer LSTM）和注意力机制LSTM（LSTM with Attention），它们进一步扩展了LSTM的能力和灵活性。 数据集简介 北京PM2.5数据集
下载数据集并将其放在当前工作目录中，文件名为 “ raw.csv ”。
这是一个报告了中国北京美国大使馆五年每个小时的天气和污染程度的数据集。
No：行号year：这一行中的数据年份month：此行中的数据月份day：这一行中的数据日hour：此行中的小时数据pm2.5：PM2.5浓度DEWP：露点TEMP：温度PRES：压力cbwd：综合风向Iws：累计风速Is：累积下了几个小时的雪Ir：累积下了几个小时的雨
我们可以使用这些数据，并构建一个预测问题，在前一时刻的天气条件和污染情况下，我们预测下一个时刻的污染情况。 数据预处理 原始数据：
对原始数据处理：
from pandas import read_csv from datetime import datetime # 加载数据 def parse(x): return datetime.strptime(x,&#39;%Y %m %d %H&#39;) dataset=read_csv(&#39;data/raw.csv&#39;,parse_dates=[[&#39;year&#39;,&#39;month&#39;,&#39;day&#39;,&#39;hour&#39;]],index_col=0,date_parser=parse) dataset.drop(&#39;No&#39;,axis=1,inplace=True) # 手动更改列名 dataset.columns=[&#39;pollution&#39;,&#39;dew&#39;,&#39;temp&#39;,&#39;press&#39;,&#39;wnd_dir&#39;,&#39;wnd_spd&#39;,&#39;snow&#39;,&#39;rain&#39;] dataset.index.name=&#39;data&#39; # 把所有NA值用0替换 dataset[&#39;pollution&#39;].fillna(0,inplace=True) dataset=dataset[24:] # 输出前五行 print(dataset.head(5)) # 保存到文件中 dataset.to_csv(&#39;pollution.csv&#39;) 对以上代码进行解释：">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-23T22:09:39+08:00">
    <meta property="article:modified_time" content="2024-01-23T22:09:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LSTM的多变量时间序列预测（北京PM2.5预测）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://cloud.tencent.com/developer/article/1041442" rel="nofollow">参考博客</a><br> </p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#LSTM_3" rel="nofollow">LSTM简介</a></li><li><a href="#_17" rel="nofollow">数据集简介</a></li><li><a href="#_36" rel="nofollow">数据预处理</a></li><li><a href="#LSTM_90" rel="nofollow">多元LSTM预测模型</a></li><li><ul><li><ul><li><a href="#_92" rel="nofollow">数据准备：</a></li><li><a href="#_165" rel="nofollow">定义和拟合模型</a></li><li><a href="#_212" rel="nofollow">评估模型</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_240" rel="nofollow">训练多个滞后时间步</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="LSTM_3"></a>LSTM简介</h3> 
<ul><li> <p>LSTM（Long Short-Term Memory）是一种特殊类型的循环神经网络（RNN），它在处理序列数据和时间序列数据时表现出色。</p> </li><li> <p>相比于传统的RNN，LSTM引入了记忆单元（memory cell）和门控机制（gate mechanism），以解决传统RNN中的梯度消失和梯度爆炸问题，从而更好地捕捉长期依赖关系。</p> </li><li> <p>LSTM的核心组件是记忆单元，它可以存储和访问信息，并通过门控机制来控制信息的流动。LSTM中的三种门控单元是：</p> <pre><code> 输入门（Input Gate）：控制是否将新输入信息添加到记忆单元中。
 遗忘门（Forget Gate）：控制记忆单元中的哪些信息需要被遗忘。
 输出门（Output Gate）：控制从记忆单元中读取哪些信息并输出。
</code></pre> </li></ul> 
<p>这些门通过使用sigmoid激活函数来产生0到1之间的输出，表示信息的通过程度。</p> 
<ul><li>LSTM在训练过程中可以学习到如何选择存储和遗忘信息，从而对输入序列建模并捕捉到长期依赖关系。</li><li>除了标准的LSTM，还有一些变种模型，如双向LSTM（Bidirectional LSTM）、多层LSTM（Multi-layer LSTM）和注意力机制LSTM（LSTM with Attention），它们进一步扩展了LSTM的能力和灵活性。</li></ul> 
<h3><a id="_17"></a>数据集简介</h3> 
<p><a href="https://archive.ics.uci.edu/dataset/381/beijing+pm2+5+data" rel="nofollow">北京PM2.5数据集</a><br> 下载数据集并将其放在当前工作目录中，文件名为 “ raw.csv ”。<br> 这是一个报告了中国北京美国大使馆五年每个小时的天气和污染程度的数据集。</p> 
<ul><li>No：行号</li><li>year：这一行中的数据年份</li><li>month：此行中的数据月份</li><li>day：这一行中的数据日</li><li>hour：此行中的小时数据</li><li>pm2.5：PM2.5浓度</li><li>DEWP：露点</li><li>TEMP：温度</li><li>PRES：压力</li><li>cbwd：综合风向</li><li>Iws：累计风速</li><li>Is：累积下了几个小时的雪</li><li>Ir：累积下了几个小时的雨<br> 我们可以使用这些数据，并构建一个预测问题，在前一时刻的天气条件和污染情况下，我们预测下一个时刻的污染情况。</li></ul> 
<h3><a id="_36"></a>数据预处理</h3> 
<p>原始数据：<br> <img src="https://images2.imgbox.com/d0/a2/aOCADipW_o.png" alt="在这里插入图片描述"><br> 对原始数据处理：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pandas <span class="token keyword">import</span> read_csv
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token comment"># 加载数据</span>
<span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string">'%Y %m %d %H'</span><span class="token punctuation">)</span>
dataset<span class="token operator">=</span>read_csv<span class="token punctuation">(</span><span class="token string">'data/raw.csv'</span><span class="token punctuation">,</span>parse_dates<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'year'</span><span class="token punctuation">,</span><span class="token string">'month'</span><span class="token punctuation">,</span><span class="token string">'day'</span><span class="token punctuation">,</span><span class="token string">'hour'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>date_parser<span class="token operator">=</span>parse<span class="token punctuation">)</span>
dataset<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'No'</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 手动更改列名</span>
dataset<span class="token punctuation">.</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'pollution'</span><span class="token punctuation">,</span><span class="token string">'dew'</span><span class="token punctuation">,</span><span class="token string">'temp'</span><span class="token punctuation">,</span><span class="token string">'press'</span><span class="token punctuation">,</span><span class="token string">'wnd_dir'</span><span class="token punctuation">,</span><span class="token string">'wnd_spd'</span><span class="token punctuation">,</span><span class="token string">'snow'</span><span class="token punctuation">,</span><span class="token string">'rain'</span><span class="token punctuation">]</span>
dataset<span class="token punctuation">.</span>index<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'data'</span>
<span class="token comment"># 把所有NA值用0替换</span>
dataset<span class="token punctuation">[</span><span class="token string">'pollution'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
dataset<span class="token operator">=</span>dataset<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment"># 输出前五行</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 保存到文件中</span>
dataset<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'pollution.csv'</span><span class="token punctuation">)</span>
</code></pre> 
<p>对以上代码进行解释：</p> 
<ul><li>将日期 - 时间信息合并成一个日期 - 时间，以便我们可以将它用作Pandas的一个索引。</li><li>“No”列被删除，"inplace=True"时，表示对原始对象进行就地修改，而不是创建一个新的对象。</li><li>为每列指定更清晰的名称。最后，将NA值替换为“0”值，并且将前24小时移除。</li><li>运行该示例将输出转换数据集的前5行，并将数据集保存为“ pollution.csv ”。<br> <img src="https://images2.imgbox.com/9c/94/CcT0o1Wc_o.png" alt="在这里插入图片描述"><br> 接下来查看我们的数据：</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pandas <span class="token keyword">import</span> read_csv
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot
<span class="token comment"># 加载数据集</span>
dataset<span class="token operator">=</span>read_csv<span class="token punctuation">(</span><span class="token string">'data/pollution.csv'</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
values<span class="token operator">=</span>dataset<span class="token punctuation">.</span>values
<span class="token comment"># 指定要绘制的列</span>
groups<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span>
i<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># 绘制每一列</span>
pyplot<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> group <span class="token keyword">in</span> groups<span class="token punctuation">:</span>
    pyplot<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>groups<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    pyplot<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>group<span class="token punctuation">]</span><span class="token punctuation">)</span>
    pyplot<span class="token punctuation">.</span>title<span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>columns<span class="token punctuation">[</span>group<span class="token punctuation">]</span><span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>loc<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">)</span>
    i<span class="token operator">+=</span><span class="token number">1</span>
pyplot<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c6/96/JBD8MNgU_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="LSTM_90"></a>多元LSTM预测模型</h3> 
<h5><a id="_92"></a>数据准备：</h5> 
<ul><li>将数据集构造为监督学习问题并对输入变量进行归一化。</li><li>使用series_to_supervised（）函数来转换数据集</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 将序列转换成监督学习问题</span>
<span class="token keyword">def</span> <span class="token function">series_to_supervised</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> n_in<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> n_out<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> dropnan<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n_vars <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token builtin">list</span> <span class="token keyword">else</span> data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    df <span class="token operator">=</span> DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    cols<span class="token punctuation">,</span> names <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># input sequence (t-n, ... t-1)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_in<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cols<span class="token punctuation">.</span>append<span class="token punctuation">(</span>df<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        names <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'var%d(t-%d)'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_vars<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># forecast sequence (t, t+1, ... t+n)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_out<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cols<span class="token punctuation">.</span>append<span class="token punctuation">(</span>df<span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            names <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'var%d(t)'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_vars<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            names <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'var%d(t+%d)'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_vars<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># put it all together</span>
    agg <span class="token operator">=</span> concat<span class="token punctuation">(</span>cols<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    agg<span class="token punctuation">.</span>columns <span class="token operator">=</span> names
    <span class="token comment"># drop rows with NaN values</span>
    <span class="token keyword">if</span> dropnan<span class="token punctuation">:</span>
        agg<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> agg
 
<span class="token comment"># 加载数据集</span>
dataset <span class="token operator">=</span> read_csv<span class="token punctuation">(</span><span class="token string">'pollution.csv'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
values <span class="token operator">=</span> dataset<span class="token punctuation">.</span>values
<span class="token comment"># 整数编码方向</span>
encoder <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
values<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 确保所有数据是浮动的</span>
values <span class="token operator">=</span> values<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
<span class="token comment"># 归一化特征</span>
scaler <span class="token operator">=</span> MinMaxScaler<span class="token punctuation">(</span>feature_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
scaled <span class="token operator">=</span> scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>values<span class="token punctuation">)</span>
<span class="token comment"># 构建成监督学习问题</span>
reframed <span class="token operator">=</span> series_to_supervised<span class="token punctuation">(</span>scaled<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 丢弃我们不想预测的列</span>
reframed<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>reframed<span class="token punctuation">.</span>columns<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>reframed<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果展示：</p> 
<pre><code class="prism language-python">   var1<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  var2<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  var3<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  var4<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  var5<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  var6<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  \
<span class="token number">1</span>   <span class="token number">0.129779</span>   <span class="token number">0.352941</span>   <span class="token number">0.245902</span>   <span class="token number">0.527273</span>   <span class="token number">0.666667</span>   <span class="token number">0.002290</span>
<span class="token number">2</span>   <span class="token number">0.148893</span>   <span class="token number">0.367647</span>   <span class="token number">0.245902</span>   <span class="token number">0.527273</span>   <span class="token number">0.666667</span>   <span class="token number">0.003811</span>
<span class="token number">3</span>   <span class="token number">0.159960</span>   <span class="token number">0.426471</span>   <span class="token number">0.229508</span>   <span class="token number">0.545454</span>   <span class="token number">0.666667</span>   <span class="token number">0.005332</span>
<span class="token number">4</span>   <span class="token number">0.182093</span>   <span class="token number">0.485294</span>   <span class="token number">0.229508</span>   <span class="token number">0.563637</span>   <span class="token number">0.666667</span>   <span class="token number">0.008391</span>
<span class="token number">5</span>   <span class="token number">0.138833</span>   <span class="token number">0.485294</span>   <span class="token number">0.229508</span>   <span class="token number">0.563637</span>   <span class="token number">0.666667</span>   <span class="token number">0.009912</span>
 
   var7<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  var8<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>   var1<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
<span class="token number">1</span>   <span class="token number">0.000000</span>        <span class="token number">0.0</span>  <span class="token number">0.148893</span>
<span class="token number">2</span>   <span class="token number">0.000000</span>        <span class="token number">0.0</span>  <span class="token number">0.159960</span>
<span class="token number">3</span>   <span class="token number">0.000000</span>        <span class="token number">0.0</span>  <span class="token number">0.182093</span>
<span class="token number">4</span>   <span class="token number">0.037037</span>        <span class="token number">0.0</span>  <span class="token number">0.138833</span>
<span class="token number">5</span>   <span class="token number">0.074074</span>        <span class="token number">0.0</span>  <span class="token number">0.109658</span>
</code></pre> 
<p>对以上代码进行解释：</p> 
<ul><li> <p><code>encoder = LabelEncoder() values[:,4] = encoder.fit_transform(values[:,4])</code>对第四列wnd_dir列进行处理，将object类型转化成整数<br> <img src="https://images2.imgbox.com/cc/12/oLW236nv_o.png" alt="在这里插入图片描述"></p> </li><li> <p>series_to_supervised（）函数中的shift（i）是将整列向上移动i个单位。</p> </li><li> <p>series_to_supervised（）函数的作用：将第一列的数据向上以一格，存储到最后一列。<br> <img src="https://images2.imgbox.com/cb/35/Vf98Fqtp_o.png" alt="在这里插入图片描述"></p> </li><li> <p>注意<code>n_in=1,n_out=1,</code>用一个时间步长预测一个时间步长</p> </li></ul> 
<h5><a id="_165"></a>定义和拟合模型</h5> 
<ul><li>将第一年的数据作为训练集</li><li>前几列特征作为输入，最后一列为预测输出</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> MinMaxScaler
<span class="token keyword">from</span> pandas <span class="token keyword">import</span> DataFrame
<span class="token keyword">from</span> pandas <span class="token keyword">import</span> concat
<span class="token comment"># 把数据分为训练集和测试集</span>
values <span class="token operator">=</span> reframed<span class="token punctuation">.</span>values
n_train_hours <span class="token operator">=</span> <span class="token number">365</span> <span class="token operator">*</span> <span class="token number">24</span>
train <span class="token operator">=</span> values<span class="token punctuation">[</span><span class="token punctuation">:</span>n_train_hours<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
test <span class="token operator">=</span> values<span class="token punctuation">[</span>n_train_hours<span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment"># 把数据分为输入和输出</span>
train_X<span class="token punctuation">,</span> train_y <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> train<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
test_X<span class="token punctuation">,</span> test_y <span class="token operator">=</span> test<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token comment"># 把输入重塑成3D格式 [样例， 时间步, 特征]</span>
train_X <span class="token operator">=</span> train_X<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>train_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> train_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_X <span class="token operator">=</span> test_X<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>test_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> test_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>train_X<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> train_y<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> test_X<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> test_y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/86/9d/v9F68cog_o.png" alt="在这里插入图片描述"></p> 
<ul><li>在第一隐层中定义50个神经元，在输出层中定义1个神经元用于预测污染。输入形状将是带有8个特征的一个时间步。</li><li><code>model.add(Dense(1))</code>在神经网络模型中添加一个全连接层</li><li>使用平均绝对误差（MAE）损失函数和随机梯度下降的高效Adam版本。</li><li>批量大小为72的50个训练时期</li><li><code>verbose=2, shuffle=False</code>在每个epoch结束后输出一行记录。每个epoch训练数据将按照原始顺序进行训练</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 设计网络</span>
model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>LSTM<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span>train_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> train_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span><span class="token string">'mae'</span><span class="token punctuation">,</span> optimizer<span class="token operator">=</span><span class="token string">'adam'</span><span class="token punctuation">)</span>
<span class="token comment"># 拟合网络</span>
history <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">72</span><span class="token punctuation">,</span> validation_data<span class="token operator">=</span><span class="token punctuation">(</span>test_X<span class="token punctuation">,</span> test_y<span class="token punctuation">)</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment"># 绘制历史数据</span>
pyplot<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'loss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'train'</span><span class="token punctuation">)</span>
pyplot<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'val_loss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span>
pyplot<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
pyplot<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/97/d0/VrdFBG8n_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/da/f7/DHt5LJBT_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_212"></a>评估模型</h5> 
<pre><code class="prism language-python"><span class="token keyword">from</span> keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> Sequential
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> LSTM<span class="token punctuation">,</span> Dense
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error
<span class="token comment"># 做出预测</span>
yhat <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span>
test_X <span class="token operator">=</span> test_X<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>test_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 反向转换预测值比例</span>
inv_yhat <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>yhat<span class="token punctuation">,</span> test_X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
inv_yhat <span class="token operator">=</span> scaler<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>inv_yhat<span class="token punctuation">)</span>
inv_yhat <span class="token operator">=</span> inv_yhat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># 反向转换实际值比例</span>
test_y <span class="token operator">=</span> test_y<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
inv_y <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>test_y<span class="token punctuation">,</span> test_X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
inv_y <span class="token operator">=</span> scaler<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>inv_y<span class="token punctuation">)</span>
inv_y <span class="token operator">=</span> inv_y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># 计算RMSE</span>
rmse <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>mean_squared_error<span class="token punctuation">(</span>inv_y<span class="token punctuation">,</span> inv_yhat<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Test RMSE: %.3f'</span> <span class="token operator">%</span> rmse<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">1095</span><span class="token operator">/</span><span class="token number">1095</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 1s 1ms<span class="token operator">/</span>step
Test RMSE<span class="token punctuation">:</span> <span class="token number">26.628</span>
</code></pre> 
<h3><a id="_240"></a>训练多个滞后时间步</h3> 
<p>用多个时间步长去预测一个时间步长，将n_in=1,传入参数改为n_in=n_hours=3，<code>n_features=8</code>。</p> 
<blockquote> 
 <p>反向转换预测值比例 inv_yhat = concatenate((yhat, test_X<code>[:, -7:]</code>), axis=1)<br> inv_yhat = scaler.inverse_transform(inv_yhat) inv_yhat = inv_yhat[:,0]<br> 反向转换实际值大小 test_y = test_y.reshape((len(test_y), 1)) inv_y =<br> concatenate((test_y, test_X<code>[:, -7:]</code>), axis=1) inv_y =<br> scaler.inverse_transform(inv_y) inv_y = inv_y[:,0]<br> <strong><code>为什么 concatenate((test_y, test_X</code>[:, -7:]<code>), axis=1)里面的test_X可以选择任意的七列？？？在线求解</code></strong></p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">from</span> math <span class="token keyword">import</span> sqrt
<span class="token keyword">from</span> numpy <span class="token keyword">import</span> concatenate
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot
<span class="token keyword">from</span> pandas <span class="token keyword">import</span> read_csv
<span class="token keyword">from</span> pandas <span class="token keyword">import</span> DataFrame
<span class="token keyword">from</span> pandas <span class="token keyword">import</span> concat
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> MinMaxScaler
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>models <span class="token keyword">import</span> Sequential
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> Dense
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> LSTM
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 将序列转换为监督学习问题</span>
<span class="token keyword">def</span> <span class="token function">series_to_supervised</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> n_in<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> n_out<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> dropnan<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n_vars <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token builtin">list</span> <span class="token keyword">else</span> data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    df <span class="token operator">=</span> DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    cols<span class="token punctuation">,</span> names <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># input sequence (t-n, ... t-1)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_in<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cols<span class="token punctuation">.</span>append<span class="token punctuation">(</span>df<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        names <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'var%d(t-%d)'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_vars<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># forecast sequence (t, t+1, ... t+n)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n_out<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cols<span class="token punctuation">.</span>append<span class="token punctuation">(</span>df<span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            names <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'var%d(t)'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_vars<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            names <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'var%d(t+%d)'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_vars<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># put it all togethe</span>
    agg <span class="token operator">=</span> concat<span class="token punctuation">(</span>cols<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    agg<span class="token punctuation">.</span>columns <span class="token operator">=</span> names
    <span class="token comment"># drop rows with NaN values</span>
    <span class="token keyword">if</span> dropnan<span class="token punctuation">:</span>
        agg<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> agg
 
</code></pre> 
<pre><code class="prism language-python"> 
<span class="token comment"># 加载数据集</span>
dataset <span class="token operator">=</span> read_csv<span class="token punctuation">(</span><span class="token string">'data/pollution.csv'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
values <span class="token operator">=</span> dataset<span class="token punctuation">.</span>values
<span class="token comment"># 整数编码</span>
encoder <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
values<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 确保所有数据是浮动的</span>
values <span class="token operator">=</span> values<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
<span class="token comment"># 归一化特征</span>
scaler <span class="token operator">=</span> MinMaxScaler<span class="token punctuation">(</span>feature_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
scaled <span class="token operator">=</span> scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>values<span class="token punctuation">)</span>
<span class="token comment"># 指定滞后时间大小</span>
n_hours <span class="token operator">=</span> <span class="token number">3</span>
n_features <span class="token operator">=</span> <span class="token number">8</span>
<span class="token comment"># 构建监督学习问题</span>
reframed <span class="token operator">=</span> series_to_supervised<span class="token punctuation">(</span>scaled<span class="token punctuation">,</span> n_hours<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">#将除了PM2.5的其余列丢弃</span>
reframed<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>reframed<span class="token punctuation">.</span>columns<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>reframed<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token punctuation">(</span><span class="token number">43797</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">var1<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>	var2<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>	var3<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>	var4<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>	var5<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>	var6<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>	var7<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>	var8<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>	var1<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>	var2<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	var8<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>	var1<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>	var2<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>	var3<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>	var4<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>	var5<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>	var6<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>	var7<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>	var8<span class="token punctuation">(</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>	var1<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
<span class="token number">3</span>	<span class="token number">0.129779</span>	<span class="token number">0.352941</span>	<span class="token number">0.245902</span>	<span class="token number">0.527273</span>	<span class="token number">0.666667</span>	<span class="token number">0.002290</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.148893</span>	<span class="token number">0.367647</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token number">0.0</span>	<span class="token number">0.159960</span>	<span class="token number">0.426471</span>	<span class="token number">0.229508</span>	<span class="token number">0.545454</span>	<span class="token number">0.666667</span>	<span class="token number">0.005332</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.182093</span>
<span class="token number">4</span>	<span class="token number">0.148893</span>	<span class="token number">0.367647</span>	<span class="token number">0.245902</span>	<span class="token number">0.527273</span>	<span class="token number">0.666667</span>	<span class="token number">0.003811</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.159960</span>	<span class="token number">0.426471</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token number">0.0</span>	<span class="token number">0.182093</span>	<span class="token number">0.485294</span>	<span class="token number">0.229508</span>	<span class="token number">0.563637</span>	<span class="token number">0.666667</span>	<span class="token number">0.008391</span>	<span class="token number">0.037037</span>	<span class="token number">0.0</span>	<span class="token number">0.138833</span>
<span class="token number">5</span>	<span class="token number">0.159960</span>	<span class="token number">0.426471</span>	<span class="token number">0.229508</span>	<span class="token number">0.545454</span>	<span class="token number">0.666667</span>	<span class="token number">0.005332</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.182093</span>	<span class="token number">0.485294</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token number">0.0</span>	<span class="token number">0.138833</span>	<span class="token number">0.485294</span>	<span class="token number">0.229508</span>	<span class="token number">0.563637</span>	<span class="token number">0.666667</span>	<span class="token number">0.009912</span>	<span class="token number">0.074074</span>	<span class="token number">0.0</span>	<span class="token number">0.109658</span>
<span class="token number">6</span>	<span class="token number">0.182093</span>	<span class="token number">0.485294</span>	<span class="token number">0.229508</span>	<span class="token number">0.563637</span>	<span class="token number">0.666667</span>	<span class="token number">0.008391</span>	<span class="token number">0.037037</span>	<span class="token number">0.0</span>	<span class="token number">0.138833</span>	<span class="token number">0.485294</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token number">0.0</span>	<span class="token number">0.109658</span>	<span class="token number">0.485294</span>	<span class="token number">0.213115</span>	<span class="token number">0.563637</span>	<span class="token number">0.666667</span>	<span class="token number">0.011433</span>	<span class="token number">0.111111</span>	<span class="token number">0.0</span>	<span class="token number">0.105634</span>
<span class="token number">7</span>	<span class="token number">0.138833</span>	<span class="token number">0.485294</span>	<span class="token number">0.229508</span>	<span class="token number">0.563637</span>	<span class="token number">0.666667</span>	<span class="token number">0.009912</span>	<span class="token number">0.074074</span>	<span class="token number">0.0</span>	<span class="token number">0.109658</span>	<span class="token number">0.485294</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token number">0.0</span>	<span class="token number">0.105634</span>	<span class="token number">0.485294</span>	<span class="token number">0.213115</span>	<span class="token number">0.581818</span>	<span class="token number">0.666667</span>	<span class="token number">0.014492</span>	<span class="token number">0.148148</span>	<span class="token number">0.0</span>	<span class="token number">0.124748</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">43795</span>	<span class="token number">0.008048</span>	<span class="token number">0.250000</span>	<span class="token number">0.311475</span>	<span class="token number">0.745455</span>	<span class="token number">0.333333</span>	<span class="token number">0.365103</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.009054</span>	<span class="token number">0.264706</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token number">0.0</span>	<span class="token number">0.010060</span>	<span class="token number">0.264706</span>	<span class="token number">0.278689</span>	<span class="token number">0.763638</span>	<span class="token number">0.333333</span>	<span class="token number">0.385730</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.008048</span>
<span class="token number">43796</span>	<span class="token number">0.009054</span>	<span class="token number">0.264706</span>	<span class="token number">0.295082</span>	<span class="token number">0.763638</span>	<span class="token number">0.333333</span>	<span class="token number">0.377322</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.010060</span>	<span class="token number">0.264706</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token number">0.0</span>	<span class="token number">0.008048</span>	<span class="token number">0.250000</span>	<span class="token number">0.278689</span>	<span class="token number">0.781818</span>	<span class="token number">0.333333</span>	<span class="token number">0.395659</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.010060</span>
<span class="token number">43797</span>	<span class="token number">0.010060</span>	<span class="token number">0.264706</span>	<span class="token number">0.278689</span>	<span class="token number">0.763638</span>	<span class="token number">0.333333</span>	<span class="token number">0.385730</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.008048</span>	<span class="token number">0.250000</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token number">0.0</span>	<span class="token number">0.010060</span>	<span class="token number">0.264706</span>	<span class="token number">0.262295</span>	<span class="token number">0.781818</span>	<span class="token number">0.333333</span>	<span class="token number">0.405588</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.010060</span>
<span class="token number">43798</span>	<span class="token number">0.008048</span>	<span class="token number">0.250000</span>	<span class="token number">0.278689</span>	<span class="token number">0.781818</span>	<span class="token number">0.333333</span>	<span class="token number">0.395659</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.010060</span>	<span class="token number">0.264706</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token number">0.0</span>	<span class="token number">0.010060</span>	<span class="token number">0.264706</span>	<span class="token number">0.262295</span>	<span class="token number">0.781818</span>	<span class="token number">0.333333</span>	<span class="token number">0.413996</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.008048</span>
<span class="token number">43799</span>	<span class="token number">0.010060</span>	<span class="token number">0.264706</span>	<span class="token number">0.262295</span>	<span class="token number">0.781818</span>	<span class="token number">0.333333</span>	<span class="token number">0.405588</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.010060</span>	<span class="token number">0.264706</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token number">0.0</span>	<span class="token number">0.008048</span>	<span class="token number">0.264706</span>	<span class="token number">0.245902</span>	<span class="token number">0.781818</span>	<span class="token number">0.333333</span>	<span class="token number">0.420866</span>	<span class="token number">0.000000</span>	<span class="token number">0.0</span>	<span class="token number">0.012072</span>
<span class="token number">43797</span> rows × <span class="token number">25</span> columns

</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 分为训练集和测试集</span>
values <span class="token operator">=</span> reframed<span class="token punctuation">.</span>values
n_train_hours <span class="token operator">=</span> <span class="token number">365</span> <span class="token operator">*</span> <span class="token number">24</span>
train <span class="token operator">=</span> values<span class="token punctuation">[</span><span class="token punctuation">:</span>n_train_hours<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
test <span class="token operator">=</span> values<span class="token punctuation">[</span>n_train_hours<span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment"># 分为输入和输出</span>
n_obs <span class="token operator">=</span> n_hours <span class="token operator">*</span> n_features
train_X<span class="token punctuation">,</span> train_y <span class="token operator">=</span> train<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> train<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
test_X<span class="token punctuation">,</span> test_y <span class="token operator">=</span> test<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>train_X<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_X<span class="token punctuation">)</span><span class="token punctuation">,</span> train_y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token comment"># 重塑为3D形状 [samples, timesteps, features]</span>
n_features <span class="token operator">=</span> <span class="token number">8</span>
train_X <span class="token operator">=</span> train_X<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>train_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n_hours<span class="token punctuation">,</span> n_features<span class="token punctuation">)</span><span class="token punctuation">)</span>
test_X <span class="token operator">=</span> test_X<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>test_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n_hours<span class="token punctuation">,</span> n_features<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>train_X<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> train_y<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> test_X<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> test_y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token punctuation">(</span><span class="token number">8760</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token number">8760</span> <span class="token punctuation">(</span><span class="token number">8760</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">8760</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">8760</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">35037</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">35037</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p><strong>模型中的最后一层是一个具有1个神经元的全连接层（Dense），因此预测结果将是train_y.shape[1]列。</strong><br> <img src="https://images2.imgbox.com/59/d2/UZd5WK9K_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 设计网络</span>
model <span class="token operator">=</span> Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>LSTM<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span>train_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> train_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span><span class="token string">'mae'</span><span class="token punctuation">,</span> optimizer<span class="token operator">=</span><span class="token string">'adam'</span><span class="token punctuation">)</span>
<span class="token comment"># 拟合网络模型</span>
history <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_X<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">72</span><span class="token punctuation">,</span> validation_data<span class="token operator">=</span><span class="token punctuation">(</span>test_X<span class="token punctuation">,</span> test_y<span class="token punctuation">)</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment"># 绘制历史数据</span>
pyplot<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'loss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'train'</span><span class="token punctuation">)</span>
pyplot<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>history<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">'val_loss'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span>
pyplot<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
pyplot<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c0/51/Lya2uWen_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 作出预测</span>
yhat <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span>
test_X <span class="token operator">=</span> test_X<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>test_X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n_hours<span class="token operator">*</span>n_features<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 反向转换预测值比例</span>
inv_yhat <span class="token operator">=</span> concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>yhat<span class="token punctuation">,</span> test_X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
inv_yhat <span class="token operator">=</span> scaler<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>inv_yhat<span class="token punctuation">)</span>
inv_yhat <span class="token operator">=</span> inv_yhat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># 反向转换实际值大小</span>
test_y <span class="token operator">=</span> test_y<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
inv_y <span class="token operator">=</span> concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>test_y<span class="token punctuation">,</span> test_X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
inv_y <span class="token operator">=</span> scaler<span class="token punctuation">.</span>inverse_transform<span class="token punctuation">(</span>inv_y<span class="token punctuation">)</span>
inv_y <span class="token operator">=</span> inv_y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># 计算RMSE大小</span>
rmse <span class="token operator">=</span> sqrt<span class="token punctuation">(</span>mean_squared_error<span class="token punctuation">(</span>inv_y<span class="token punctuation">,</span> inv_yhat<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Test RMSE: %.3f'</span> <span class="token operator">%</span> rmse<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token number">1095</span><span class="token operator">/</span><span class="token number">1095</span> <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> <span class="token operator">-</span> 2s 1ms<span class="token operator">/</span>step
Test RMSE<span class="token punctuation">:</span> <span class="token number">26.396</span>
</code></pre> 
<p>26.396与26.628相比没有差很多，并没有真正显示出技术上的优势。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bc782f6fb94223b3e77cba41fa70ac79/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【零基础C语言】C语言的概念初识</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fcc1198f6a84dfa2392d11aa25d98756/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spring @Async 原理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>