<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>clickHouse的安装配置流程： - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/74f448e9dd7545cf565156230a9f7068/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="clickHouse的安装配置流程：">
  <meta property="og:description" content="clickHouse的安装配置流程： 本次CH集群设计：4个节点、2分片、2副本
1、首先下载CH的安装包：
（默认下载最新版） 1. curl -s https://packagecloud.io/install/repositories/Altinity/clickhouse/script.rpm.sh | sudo bash 2. yum list &#39;clickhouse*&#39; 3. yum install -y clickhouse-server clickhouse-client 指定版本安装： sudo yum install clickhouse-server-common-20.3.12.112-1.el7.x86_64 sudo yum install clickhouse-common-static-20.3.12.112-1.el7.x86_64 sudo yum install clickhouse-server-20.3.12.112-1.el7.x86_64 sudo yum install clickhouse-client-20.3.12.112-1.el7.x86_64 启动命令：service clickhouse-server start
2、更改配置文件：
cd /etc/clickhouse-server 有一个config.xml配置文件 3、修改配置文件中的参数：
config.xml如下
&amp;lt;?xml version=&#34;1.0&#34;?&amp;gt; &amp;lt;!-- NOTE: User and query level settings are set up in &#34;users.xml&#34; file. --&amp;gt; &amp;lt;yandex&amp;gt; &amp;lt;logger&amp;gt; &amp;lt;!-- Possible levels: https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/Logger.h#L105 --&amp;gt; &amp;lt;level&amp;gt;warning&amp;lt;/level&amp;gt; &amp;lt;log&amp;gt;/var/log/clickhouse-server/clickhouse-server.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-07-09T18:13:57+08:00">
    <meta property="article:modified_time" content="2020-07-09T18:13:57+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">clickHouse的安装配置流程：</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="clickHouse_0"></a>clickHouse的安装配置流程：</h2> 
<p>本次CH集群设计：4个节点、2分片、2副本</p> 
<p>1、首先下载CH的安装包：</p> 
<pre><code>（默认下载最新版）
1. curl -s https://packagecloud.io/install/repositories/Altinity/clickhouse/script.rpm.sh | sudo bash
2. yum list 'clickhouse*'
3. yum install -y clickhouse-server clickhouse-client

指定版本安装：
sudo yum install clickhouse-server-common-20.3.12.112-1.el7.x86_64
sudo yum install clickhouse-common-static-20.3.12.112-1.el7.x86_64
sudo yum install clickhouse-server-20.3.12.112-1.el7.x86_64
sudo yum install clickhouse-client-20.3.12.112-1.el7.x86_64

</code></pre> 
<p>启动命令：service clickhouse-server start</p> 
<p>2、更改配置文件：</p> 
<pre><code>cd   /etc/clickhouse-server   有一个config.xml配置文件
</code></pre> 
<p>3、修改配置文件中的参数：<br> <strong>config.xml如下</strong></p> 
<pre><code class="prism language-powershell">&lt;?xml version=<span class="token string">"1.0"</span>?&gt;
&lt;<span class="token operator">!</span>-<span class="token operator">-</span>
  NOTE: User and query level settings are <span class="token function">set</span> up in <span class="token string">"users.xml"</span> file<span class="token punctuation">.</span>
<span class="token operator">--</span>&gt;
&lt;yandex&gt;
    &lt;logger&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Possible levels: https:<span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>pocoproject<span class="token operator">/</span>poco<span class="token operator">/</span>blob<span class="token operator">/</span>poco<span class="token operator">-</span>1<span class="token punctuation">.</span>9<span class="token punctuation">.</span>4<span class="token operator">-</span>release<span class="token operator">/</span>Foundation<span class="token operator">/</span>include<span class="token operator">/</span>Poco<span class="token operator">/</span>Logger<span class="token punctuation">.</span>h<span class="token comment">#L105 --&gt;</span>
        &lt;level&gt;warning&lt;<span class="token operator">/</span>level&gt;
        &lt;log&gt;<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>clickhouse<span class="token operator">-</span>server<span class="token operator">/</span>clickhouse<span class="token operator">-</span>server<span class="token punctuation">.</span>log&lt;<span class="token operator">/</span>log&gt;
        &lt;errorlog&gt;<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>clickhouse<span class="token operator">-</span>server<span class="token operator">/</span>clickhouse<span class="token operator">-</span>server<span class="token punctuation">.</span>err<span class="token punctuation">.</span>log&lt;<span class="token operator">/</span>errorlog&gt;
        &lt;size&gt;1000M&lt;<span class="token operator">/</span>size&gt;
        &lt;count&gt;5&lt;<span class="token operator">/</span>count&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> &lt;console&gt;1&lt;<span class="token operator">/</span>console&gt; <span class="token operator">--</span>&gt; &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Default behavior is autodetection <span class="token punctuation">(</span>log to console <span class="token keyword">if</span> not daemon mode and is tty<span class="token punctuation">)</span> <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">/</span>logger&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span>display_name&gt;production&lt;<span class="token operator">/</span>display_name-<span class="token operator">-</span>&gt; &lt;<span class="token operator">!</span>-<span class="token operator">-</span> It is the name that will be shown in the client <span class="token operator">--</span>&gt;
    &lt;http_port&gt;8123&lt;<span class="token operator">/</span>http_port&gt;
    &lt;tcp_port&gt;9000&lt;<span class="token operator">/</span>tcp_port&gt;
    &lt;mysql_port&gt;9004&lt;<span class="token operator">/</span>mysql_port&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> <span class="token keyword">For</span> HTTPS and SSL over native protocol<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span>
    &lt;https_port&gt;8443&lt;<span class="token operator">/</span>https_port&gt;
    &lt;tcp_port_secure&gt;9440&lt;<span class="token operator">/</span>tcp_port_secure&gt;
    <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Used with https_port and tcp_port_secure<span class="token punctuation">.</span> Full ssl options list: https:<span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>ClickHouse<span class="token operator">-</span>Extras<span class="token operator">/</span>poco<span class="token operator">/</span>blob<span class="token operator">/</span>master<span class="token operator">/</span>NetSSL_OpenSSL<span class="token operator">/</span>include<span class="token operator">/</span>Poco<span class="token operator">/</span>Net<span class="token operator">/</span>SSLManager<span class="token punctuation">.</span>h<span class="token comment">#L71 --&gt;</span>
    &lt;openSSL&gt;
        &lt;server&gt; &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Used <span class="token keyword">for</span> https server AND secure tcp port <span class="token operator">--</span>&gt;
            &lt;<span class="token operator">!</span>-<span class="token operator">-</span> openssl req <span class="token operator">-</span>subj <span class="token string">"/CN=localhost"</span> <span class="token operator">-</span>new <span class="token operator">-</span>newkey rsa:2048 <span class="token operator">-</span>days 365 <span class="token operator">-</span>nodes <span class="token operator">-</span>x509 <span class="token operator">-</span>keyout <span class="token operator">/</span>etc<span class="token operator">/</span>clickhouse<span class="token operator">-</span>server<span class="token operator">/</span>server<span class="token punctuation">.</span>key <span class="token operator">-</span>out <span class="token operator">/</span>etc<span class="token operator">/</span>clickhouse<span class="token operator">-</span>server<span class="token operator">/</span>server<span class="token punctuation">.</span>crt <span class="token operator">--</span>&gt;
            &lt;certificateFile&gt;<span class="token operator">/</span>etc<span class="token operator">/</span>clickhouse<span class="token operator">-</span>server<span class="token operator">/</span>server<span class="token punctuation">.</span>crt&lt;<span class="token operator">/</span>certificateFile&gt;
            &lt;privateKeyFile&gt;<span class="token operator">/</span>etc<span class="token operator">/</span>clickhouse<span class="token operator">-</span>server<span class="token operator">/</span>server<span class="token punctuation">.</span>key&lt;<span class="token operator">/</span>privateKeyFile&gt;
            &lt;<span class="token operator">!</span>-<span class="token operator">-</span> openssl dhparam <span class="token operator">-</span>out <span class="token operator">/</span>etc<span class="token operator">/</span>clickhouse<span class="token operator">-</span>server<span class="token operator">/</span>dhparam<span class="token punctuation">.</span>pem 4096 <span class="token operator">--</span>&gt;
            &lt;dhParamsFile&gt;<span class="token operator">/</span>etc<span class="token operator">/</span>clickhouse<span class="token operator">-</span>server<span class="token operator">/</span>dhparam<span class="token punctuation">.</span>pem&lt;<span class="token operator">/</span>dhParamsFile&gt;
            &lt;verificationMode&gt;none&lt;<span class="token operator">/</span>verificationMode&gt;
            &lt;loadDefaultCAFile&gt;true&lt;<span class="token operator">/</span>loadDefaultCAFile&gt;
            &lt;cacheSessions&gt;true&lt;<span class="token operator">/</span>cacheSessions&gt;
            &lt;disableProtocols&gt;sslv2<span class="token punctuation">,</span>sslv3&lt;<span class="token operator">/</span>disableProtocols&gt;
            &lt;preferServerCiphers&gt;true&lt;<span class="token operator">/</span>preferServerCiphers&gt;
        &lt;<span class="token operator">/</span>server&gt;

        &lt;client&gt; &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Used <span class="token keyword">for</span> connecting to https dictionary source <span class="token operator">--</span>&gt;
            &lt;loadDefaultCAFile&gt;true&lt;<span class="token operator">/</span>loadDefaultCAFile&gt;
            &lt;cacheSessions&gt;true&lt;<span class="token operator">/</span>cacheSessions&gt;
            &lt;disableProtocols&gt;sslv2<span class="token punctuation">,</span>sslv3&lt;<span class="token operator">/</span>disableProtocols&gt;
            &lt;preferServerCiphers&gt;true&lt;<span class="token operator">/</span>preferServerCiphers&gt;
            &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Use <span class="token keyword">for</span> self<span class="token operator">-</span>signed: &lt;verificationMode&gt;none&lt;<span class="token operator">/</span>verificationMode&gt; <span class="token operator">--</span>&gt;
            &lt;invalidCertificateHandler&gt;
                &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Use <span class="token keyword">for</span> self<span class="token operator">-</span>signed: &lt;name&gt;AcceptCertificateHandler&lt;<span class="token operator">/</span>name&gt; <span class="token operator">--</span>&gt;
                &lt;name&gt;RejectCertificateHandler&lt;<span class="token operator">/</span>name&gt;
            &lt;<span class="token operator">/</span>invalidCertificateHandler&gt;
        &lt;<span class="token operator">/</span>client&gt;
    &lt;<span class="token operator">/</span>openSSL&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Default root page on http<span class="token namespace">[s]</span> server<span class="token punctuation">.</span> <span class="token keyword">For</span> example load UI <span class="token keyword">from</span> https:<span class="token operator">/</span><span class="token operator">/</span>tabix<span class="token punctuation">.</span>io<span class="token operator">/</span> when opening http:<span class="token operator">/</span><span class="token operator">/</span>localhost:8123 <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span>
    &lt;http_server_default_response&gt;&lt;<span class="token operator">!</span><span class="token punctuation">[</span>CDATA<span class="token punctuation">[</span>&lt;html ng<span class="token operator">-</span>app=<span class="token string">"SMI2"</span>&gt;&lt;head&gt;&lt;base href=<span class="token string">"http://ui.tabix.io/"</span>&gt;&lt;<span class="token operator">/</span>head&gt;&lt;body&gt;&lt;div ui<span class="token operator">-</span>view=<span class="token string">""</span> <span class="token keyword">class</span>=<span class="token string">"content-ui"</span>&gt;&lt;<span class="token operator">/</span>div&gt;&lt;script src=<span class="token string">"http://loader.tabix.io/master.js"</span>&gt;&lt;<span class="token operator">/</span>script&gt;&lt;<span class="token operator">/</span>body&gt;&lt;<span class="token operator">/</span>html&gt;<span class="token punctuation">]</span><span class="token punctuation">]</span>&gt;&lt;<span class="token operator">/</span>http_server_default_response&gt;
    <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Port <span class="token keyword">for</span> communication between replicas<span class="token punctuation">.</span> Used <span class="token keyword">for</span> <span class="token keyword">data</span> exchange<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;interserver_http_port&gt;9009&lt;<span class="token operator">/</span>interserver_http_port&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Hostname that is used by other replicas to request this server<span class="token punctuation">.</span>
         <span class="token keyword">If</span> not specified<span class="token punctuation">,</span> than it is determined analoguous to <span class="token string">'hostname -f'</span> command<span class="token punctuation">.</span>
         This setting could be used to <span class="token keyword">switch</span> replication to another network interface<span class="token punctuation">.</span>
      <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span>
    &lt;interserver_http_host&gt;example<span class="token punctuation">.</span>yandex<span class="token punctuation">.</span>ru&lt;<span class="token operator">/</span>interserver_http_host&gt;
    <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Listen specified host<span class="token punctuation">.</span> use :: <span class="token punctuation">(</span>wildcard IPv6 address<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">if</span> you want to accept connections both with IPv4 and IPv6 <span class="token keyword">from</span> everywhere<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> &lt;listen_host&gt;::&lt;<span class="token operator">/</span>listen_host&gt; <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Same <span class="token keyword">for</span> hosts with disabled ipv6: <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> &lt;listen_host&gt;0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0&lt;<span class="token operator">/</span>listen_host&gt; <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Default values <span class="token operator">-</span> <span class="token keyword">try</span> listen localhost on ipv4 and ipv6: <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span>
    &lt;listen_host&gt;::1&lt;<span class="token operator">/</span>listen_host&gt;
    &lt;listen_host&gt;127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1&lt;<span class="token operator">/</span>listen_host&gt;
    <span class="token operator">--</span>&gt;
    &lt;listen_host&gt;0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0&lt;<span class="token operator">/</span>listen_host&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Don<span class="token string">'t exit if ipv6 or ipv4 unavailable, but listen_host with this protocol specified --&gt;
    &lt;!-- &lt;listen_try&gt;0&lt;/listen_try&gt; --&gt;

    &lt;!-- Allow listen on same address:port --&gt;
    &lt;!-- &lt;listen_reuse_port&gt;0&lt;/listen_reuse_port&gt; --&gt;

    &lt;!-- &lt;listen_backlog&gt;64&lt;/listen_backlog&gt; --&gt;

    &lt;max_connections&gt;4096&lt;/max_connections&gt;
    &lt;keep_alive_timeout&gt;3&lt;/keep_alive_timeout&gt;

    &lt;!-- Maximum number of concurrent queries. --&gt;
    &lt;max_concurrent_queries&gt;100&lt;/max_concurrent_queries&gt;

    &lt;!-- Set limit on number of open files (default: maximum). This setting makes sense on Mac OS X because getrlimit() fails to retrieve
         correct maximum value. --&gt;
    &lt;!-- &lt;max_open_files&gt;262144&lt;/max_open_files&gt; --&gt;

    &lt;!-- Size of cache of uncompressed blocks of data, used in tables of MergeTree family.
         In bytes. Cache is single for server. Memory is allocated only on demand.
         Cache is used when '</span>use_uncompressed_cache<span class="token string">' user setting turned on (off by default).
         Uncompressed cache is advantageous only for very short queries and in rare cases.
      --&gt;
    &lt;uncompressed_cache_size&gt;8589934592&lt;/uncompressed_cache_size&gt;

    &lt;!-- Approximate size of mark cache, used in tables of MergeTree family.
         In bytes. Cache is single for server. Memory is allocated only on demand.
         You should not lower this value.
      --&gt;
    &lt;mark_cache_size&gt;5368709120&lt;/mark_cache_size&gt;


    &lt;!-- Path to data directory, with trailing slash. --&gt;
    &lt;path&gt;/data/clickhouse/&lt;/path&gt;

    &lt;!-- Path to temporary data for processing hard queries. --&gt;
    &lt;tmp_path&gt;/data/clickhouse/tmp/&lt;/tmp_path&gt;

    &lt;!-- Policy from the &lt;storage_configuration&gt; for the temporary files.
         If not set &lt;tmp_path&gt; is used, otherwise &lt;tmp_path&gt; is ignored.

         Notes:
         - move_factor              is ignored
         - keep_free_space_bytes    is ignored
         - max_data_part_size_bytes is ignored
         - you must have exactly one volume in that policy
    --&gt;
    &lt;!-- &lt;tmp_policy&gt;tmp&lt;/tmp_policy&gt; --&gt;

    &lt;!-- Directory with user provided files that are accessible by '</span>file<span class="token string">' table function. --&gt;
    &lt;user_files_path&gt;/var/lib/clickhouse/user_files/&lt;/user_files_path&gt;

    &lt;!-- Path to configuration file with users, access rights, profiles of settings, quotas. --&gt;
    &lt;users_config&gt;users.xml&lt;/users_config&gt;

    &lt;!-- Default profile of settings. --&gt;
    &lt;default_profile&gt;default&lt;/default_profile&gt;

    &lt;!-- System profile of settings. This settings are used by internal processes (Buffer storage, Distibuted DDL worker and so on). --&gt;
    &lt;!-- &lt;system_profile&gt;default&lt;/system_profile&gt; --&gt;

    &lt;!-- Default database. --&gt;
    &lt;default_database&gt;default&lt;/default_database&gt;

    &lt;!-- Server time zone could be set here.

         Time zone is used when converting between String and DateTime types,
          when printing DateTime in text formats and parsing DateTime from text,
          it is used in date and time related functions, if specific time zone was not passed as an argument.

         Time zone is specified as identifier from IANA time zone database, like UTC or Africa/Abidjan.
         If not specified, system time zone at server startup is used.

         Please note, that server could display time zone alias instead of specified name.
         Example: W-SU is an alias for Europe/Moscow and Zulu is an alias for UTC.
    --&gt;
    &lt;!-- &lt;timezone&gt;Europe/Moscow&lt;/timezone&gt; --&gt;
    &lt;timezone&gt;Asia/Shanghai&lt;/timezone&gt; 

    &lt;!-- You can specify umask here (see "man umask"). Server will apply it on startup.
         Number is always parsed as octal. Default umask is 027 (other users cannot read logs, data files, etc; group can only read).
    --&gt;
    &lt;!-- &lt;umask&gt;022&lt;/umask&gt; --&gt;

    &lt;!-- Perform mlockall after startup to lower first queries latency
          and to prevent clickhouse executable from being paged out under high IO load.
         Enabling this option is recommended but will lead to increased startup time for up to a few seconds.
    --&gt;
    &lt;mlock_executable&gt;false&lt;/mlock_executable&gt;

    &lt;!-- Configuration of clusters that could be used in Distributed tables.
         https://clickhouse.tech/docs/en/operations/table_engines/distributed/
      --&gt;
    &lt;remote_servers incl="clickhouse_remote_servers" /&gt;
        &lt;!-- Test only shard config for testing distributed storage --&gt;
        &lt;!--&lt;test_shard_localhost&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;localhost&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/test_shard_localhost&gt;
        &lt;test_cluster_two_shards_localhost&gt;
             &lt;shard&gt;
                 &lt;replica&gt;
                     &lt;host&gt;localhost&lt;/host&gt;
                     &lt;port&gt;9000&lt;/port&gt;
                 &lt;/replica&gt;
             &lt;/shard&gt;
             &lt;shard&gt;
                 &lt;replica&gt;
                     &lt;host&gt;localhost&lt;/host&gt;
                     &lt;port&gt;9000&lt;/port&gt;
                 &lt;/replica&gt;
             &lt;/shard&gt;
        &lt;/test_cluster_two_shards_localhost&gt;
        &lt;test_cluster_two_shards&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;127.0.0.1&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;127.0.0.2&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/test_cluster_two_shards&gt;
        &lt;test_shard_localhost_secure&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;localhost&lt;/host&gt;
                    &lt;port&gt;9440&lt;/port&gt;
                    &lt;secure&gt;1&lt;/secure&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/test_shard_localhost_secure&gt;
        &lt;test_unavailable_shard&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;localhost&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
            &lt;shard&gt;
                &lt;replica&gt;
                    &lt;host&gt;localhost&lt;/host&gt;
                    &lt;port&gt;1&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/test_unavailable_shard&gt;
    &lt;/remote_servers&gt;--&gt;

    &lt;remote_url_allow_hosts&gt; 
        &lt;!-- Host should be specified exactly as in URL. The name is checked before DNS resolution.
            Example: "yandex.ru", "yandex.ru." and "www.yandex.ru" are different hosts.
                    If port is explicitly specified in URL, the host:port is checked as a whole.
                    If host specified here without port, any port with this host allowed.
                    "yandex.ru" -&gt; "yandex.ru:443", "yandex.ru:80" etc. is allowed, but "yandex.ru:80" -&gt; only "yandex.ru:80" is allowed.
            If the host is specified as IP address, it is checked as specified in URL. Example: "[2a02:6b8:a::a]".
            If there are redirects and support for redirects is enabled, every redirect (the Location field) is checked.
        --&gt;

        &lt;!-- Regular expression can be specified. RE2 engine is used for regexps.
            Regexps are not aligned: don'</span>t forget to add ^ and $<span class="token punctuation">.</span> Also don<span class="token string">'t forget to escape dot (.) metacharacter
            (forgetting to do so is a common source of error).
        --&gt;
   &lt;/remote_url_allow_hosts&gt; 

   &lt;include_from&gt;/etc/clickhouse-server/metrika.xml&lt;/include_from&gt;

    &lt;!-- If element has '</span>incl<span class="token string">' attribute, then for it'</span>s value will be used corresponding substitution <span class="token keyword">from</span> another file<span class="token punctuation">.</span>
         By default<span class="token punctuation">,</span> path to file with substitutions is <span class="token operator">/</span>etc<span class="token operator">/</span>metrika<span class="token punctuation">.</span>xml<span class="token punctuation">.</span> It could be changed in config in <span class="token string">'include_from'</span> element<span class="token punctuation">.</span>
         Values <span class="token keyword">for</span> substitutions are specified in <span class="token operator">/</span>yandex<span class="token operator">/</span>name_of_substitution elements in that file<span class="token punctuation">.</span>
      <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> ZooKeeper is used to store metadata about replicas<span class="token punctuation">,</span> when <span class="token keyword">using</span> Replicated tables<span class="token punctuation">.</span>
         Optional<span class="token punctuation">.</span> <span class="token keyword">If</span> you don<span class="token string">'t use replicated tables, you could omit that.

         See https://clickhouse.yandex/docs/en/table_engines/replication/
      --&gt;

    &lt;zookeeper incl="zookeeper-servers" optional="true" /&gt;

    &lt;!-- Substitutions for parameters of replicated tables.
          Optional. If you don'</span>t use replicated tables<span class="token punctuation">,</span> you could omit that<span class="token punctuation">.</span>

         See https:<span class="token operator">/</span><span class="token operator">/</span>clickhouse<span class="token punctuation">.</span>yandex<span class="token operator">/</span>docs<span class="token operator">/</span>en<span class="token operator">/</span>table_engines<span class="token operator">/</span>replication<span class="token operator">/</span><span class="token comment">#creating-replicated-tables</span>
      <span class="token operator">--</span>&gt;
    &lt;macros incl=<span class="token string">"macros"</span> optional=<span class="token string">"true"</span> <span class="token operator">/</span>&gt;


    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Reloading interval <span class="token keyword">for</span> embedded dictionaries<span class="token punctuation">,</span> in seconds<span class="token punctuation">.</span> Default: 3600<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;builtin_dictionaries_reload_interval&gt;3600&lt;<span class="token operator">/</span>builtin_dictionaries_reload_interval&gt;


    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Maximum session timeout<span class="token punctuation">,</span> in seconds<span class="token punctuation">.</span> Default: 3600<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;max_session_timeout&gt;3600&lt;<span class="token operator">/</span>max_session_timeout&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Default session timeout<span class="token punctuation">,</span> in seconds<span class="token punctuation">.</span> Default: 60<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;default_session_timeout&gt;60&lt;<span class="token operator">/</span>default_session_timeout&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Sending <span class="token keyword">data</span> to Graphite <span class="token keyword">for</span> monitoring<span class="token punctuation">.</span> Several sections can be defined<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span>
        interval <span class="token operator">-</span> send every X second
        root_path <span class="token operator">-</span> prefix <span class="token keyword">for</span> keys
        hostname_in_path <span class="token operator">-</span> append hostname to root_path <span class="token punctuation">(</span>default = true<span class="token punctuation">)</span>
        metrics <span class="token operator">-</span> send <span class="token keyword">data</span> <span class="token keyword">from</span> table system<span class="token punctuation">.</span>metrics
        events <span class="token operator">-</span> send <span class="token keyword">data</span> <span class="token keyword">from</span> table system<span class="token punctuation">.</span>events
        asynchronous_metrics <span class="token operator">-</span> send <span class="token keyword">data</span> <span class="token keyword">from</span> table system<span class="token punctuation">.</span>asynchronous_metrics
    <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span>
    &lt;graphite&gt;
        &lt;host&gt;localhost&lt;<span class="token operator">/</span>host&gt;
        &lt;port&gt;42000&lt;<span class="token operator">/</span>port&gt;
        &lt;timeout&gt;0<span class="token punctuation">.</span>1&lt;<span class="token operator">/</span>timeout&gt;
        &lt;interval&gt;60&lt;<span class="token operator">/</span>interval&gt;
        &lt;root_path&gt;one_min&lt;<span class="token operator">/</span>root_path&gt;
        &lt;hostname_in_path&gt;true&lt;<span class="token operator">/</span>hostname_in_path&gt;

        &lt;metrics&gt;true&lt;<span class="token operator">/</span>metrics&gt;
        &lt;events&gt;true&lt;<span class="token operator">/</span>events&gt;
        &lt;events_cumulative&gt;false&lt;<span class="token operator">/</span>events_cumulative&gt;
        &lt;asynchronous_metrics&gt;true&lt;<span class="token operator">/</span>asynchronous_metrics&gt;
    &lt;<span class="token operator">/</span>graphite&gt;
    &lt;graphite&gt;
        &lt;host&gt;localhost&lt;<span class="token operator">/</span>host&gt;
        &lt;port&gt;42000&lt;<span class="token operator">/</span>port&gt;
        &lt;timeout&gt;0<span class="token punctuation">.</span>1&lt;<span class="token operator">/</span>timeout&gt;
        &lt;interval&gt;1&lt;<span class="token operator">/</span>interval&gt;
        &lt;root_path&gt;one_sec&lt;<span class="token operator">/</span>root_path&gt;

        &lt;metrics&gt;true&lt;<span class="token operator">/</span>metrics&gt;
        &lt;events&gt;true&lt;<span class="token operator">/</span>events&gt;
        &lt;events_cumulative&gt;false&lt;<span class="token operator">/</span>events_cumulative&gt;
        &lt;asynchronous_metrics&gt;false&lt;<span class="token operator">/</span>asynchronous_metrics&gt;
    &lt;<span class="token operator">/</span>graphite&gt;
    <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Serve endpoint fot Prometheus monitoring<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span>
        endpoint <span class="token operator">-</span> mertics path <span class="token punctuation">(</span>relative to root<span class="token punctuation">,</span> statring with <span class="token string">"/"</span><span class="token punctuation">)</span>
        port <span class="token operator">-</span> port to setup server<span class="token punctuation">.</span> <span class="token keyword">If</span> not defined or 0 than http_port used
        metrics <span class="token operator">-</span> send <span class="token keyword">data</span> <span class="token keyword">from</span> table system<span class="token punctuation">.</span>metrics
        events <span class="token operator">-</span> send <span class="token keyword">data</span> <span class="token keyword">from</span> table system<span class="token punctuation">.</span>events
        asynchronous_metrics <span class="token operator">-</span> send <span class="token keyword">data</span> <span class="token keyword">from</span> table system<span class="token punctuation">.</span>asynchronous_metrics
    <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span>
    &lt;prometheus&gt;
        &lt;endpoint&gt;<span class="token operator">/</span>metrics&lt;<span class="token operator">/</span>endpoint&gt;
        &lt;port&gt;9363&lt;<span class="token operator">/</span>port&gt;

        &lt;metrics&gt;true&lt;<span class="token operator">/</span>metrics&gt;
        &lt;events&gt;true&lt;<span class="token operator">/</span>events&gt;
        &lt;asynchronous_metrics&gt;true&lt;<span class="token operator">/</span>asynchronous_metrics&gt;
    &lt;<span class="token operator">/</span>prometheus&gt;
    <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Query log<span class="token punctuation">.</span> Used only <span class="token keyword">for</span> queries with setting log_queries = 1<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;query_log&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> What table to insert <span class="token keyword">data</span><span class="token punctuation">.</span> <span class="token keyword">If</span> table is not exist<span class="token punctuation">,</span> it will be created<span class="token punctuation">.</span>
             When query log structure is changed after system update<span class="token punctuation">,</span>
              then old table will be renamed and new table will be created automatically<span class="token punctuation">.</span>
        <span class="token operator">--</span>&gt;
        &lt;database&gt;system&lt;<span class="token operator">/</span>database&gt;
        &lt;table&gt;query_log&lt;<span class="token operator">/</span>table&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span>
            PARTITION BY expr https:<span class="token operator">/</span><span class="token operator">/</span>clickhouse<span class="token punctuation">.</span>yandex<span class="token operator">/</span>docs<span class="token operator">/</span>en<span class="token operator">/</span>table_engines<span class="token operator">/</span>custom_partitioning_key<span class="token operator">/</span>
            Example:
                event_date
                toMonday<span class="token punctuation">(</span>event_date<span class="token punctuation">)</span>
                toYYYYMM<span class="token punctuation">(</span>event_date<span class="token punctuation">)</span>
                toStartOfHour<span class="token punctuation">(</span>event_time<span class="token punctuation">)</span>
        <span class="token operator">--</span>&gt;
        &lt;partition_by&gt;toYYYYMM<span class="token punctuation">(</span>event_date<span class="token punctuation">)</span>&lt;<span class="token operator">/</span>partition_by&gt;

        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Instead of partition_by<span class="token punctuation">,</span> you can provide full engine expression <span class="token punctuation">(</span>starting with ENGINE = <span class="token punctuation">)</span> with parameters<span class="token punctuation">,</span>
             Example: &lt;engine&gt;ENGINE = MergeTree PARTITION BY toYYYYMM<span class="token punctuation">(</span>event_date<span class="token punctuation">)</span> ORDER BY <span class="token punctuation">(</span>event_date<span class="token punctuation">,</span> event_time<span class="token punctuation">)</span> SETTINGS index_granularity = 1024&lt;<span class="token operator">/</span>engine&gt;
          <span class="token operator">--</span>&gt;

        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Interval of flushing <span class="token keyword">data</span><span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;<span class="token operator">/</span>flush_interval_milliseconds&gt;
    &lt;<span class="token operator">/</span>query_log&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Trace log<span class="token punctuation">.</span> Stores stack traces collected by query profilers<span class="token punctuation">.</span>
         See query_profiler_real_time_period_ns and query_profiler_cpu_time_period_ns settings<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;trace_log&gt;
        &lt;database&gt;system&lt;<span class="token operator">/</span>database&gt;
        &lt;table&gt;trace_log&lt;<span class="token operator">/</span>table&gt;

        &lt;partition_by&gt;toYYYYMM<span class="token punctuation">(</span>event_date<span class="token punctuation">)</span>&lt;<span class="token operator">/</span>partition_by&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;<span class="token operator">/</span>flush_interval_milliseconds&gt;
    &lt;<span class="token operator">/</span>trace_log&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Query thread log<span class="token punctuation">.</span> Has information about all threads participated in query execution<span class="token punctuation">.</span>
         Used only <span class="token keyword">for</span> queries with setting log_query_threads = 1<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;query_thread_log&gt;
        &lt;database&gt;system&lt;<span class="token operator">/</span>database&gt;
        &lt;table&gt;query_thread_log&lt;<span class="token operator">/</span>table&gt;
        &lt;partition_by&gt;toYYYYMM<span class="token punctuation">(</span>event_date<span class="token punctuation">)</span>&lt;<span class="token operator">/</span>partition_by&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;<span class="token operator">/</span>flush_interval_milliseconds&gt;
    &lt;<span class="token operator">/</span>query_thread_log&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Uncomment <span class="token keyword">if</span> use part log<span class="token punctuation">.</span>
         Part log contains information about all actions with parts in MergeTree tables <span class="token punctuation">(</span>creation<span class="token punctuation">,</span> deletion<span class="token punctuation">,</span> merges<span class="token punctuation">,</span> downloads<span class="token punctuation">)</span><span class="token punctuation">.</span>
    &lt;part_log&gt;
        &lt;database&gt;system&lt;<span class="token operator">/</span>database&gt;
        &lt;table&gt;part_log&lt;<span class="token operator">/</span>table&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;<span class="token operator">/</span>flush_interval_milliseconds&gt;
    &lt;<span class="token operator">/</span>part_log&gt;
    <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Uncomment to <span class="token function">write</span> text log into table<span class="token punctuation">.</span>
         Text log contains all information <span class="token keyword">from</span> usual server log but stores it in structured and efficient way<span class="token punctuation">.</span>
         The level of the messages that goes to the table can be limited <span class="token punctuation">(</span>&lt;level&gt;<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">if</span> not specified all messages will go to the table<span class="token punctuation">.</span>
    &lt;text_log&gt;
        &lt;database&gt;system&lt;<span class="token operator">/</span>database&gt;
        &lt;table&gt;text_log&lt;<span class="token operator">/</span>table&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;<span class="token operator">/</span>flush_interval_milliseconds&gt;
        &lt;level&gt;&lt;<span class="token operator">/</span>level&gt;
    &lt;<span class="token operator">/</span>text_log&gt;
    <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Metric log contains rows with current values of ProfileEvents<span class="token punctuation">,</span> CurrentMetrics collected with <span class="token string">"collect_interval_milliseconds"</span> interval<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;metric_log&gt;
        &lt;database&gt;system&lt;<span class="token operator">/</span>database&gt;
        &lt;table&gt;metric_log&lt;<span class="token operator">/</span>table&gt;
        &lt;flush_interval_milliseconds&gt;7500&lt;<span class="token operator">/</span>flush_interval_milliseconds&gt;
        &lt;collect_interval_milliseconds&gt;1000&lt;<span class="token operator">/</span>collect_interval_milliseconds&gt;
    &lt;<span class="token operator">/</span>metric_log&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Parameters <span class="token keyword">for</span> embedded dictionaries<span class="token punctuation">,</span> used in Yandex<span class="token punctuation">.</span>Metrica<span class="token punctuation">.</span>
         See https:<span class="token operator">/</span><span class="token operator">/</span>clickhouse<span class="token punctuation">.</span>yandex<span class="token operator">/</span>docs<span class="token operator">/</span>en<span class="token operator">/</span>dicts<span class="token operator">/</span>internal_dicts<span class="token operator">/</span>
    <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Path to file with region hierarchy<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> &lt;path_to_regions_hierarchy_file&gt;<span class="token operator">/</span>opt<span class="token operator">/</span>geo<span class="token operator">/</span>regions_hierarchy<span class="token punctuation">.</span>txt&lt;<span class="token operator">/</span>path_to_regions_hierarchy_file&gt; <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Path to directory with files containing names of regions <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> &lt;path_to_regions_names_files&gt;<span class="token operator">/</span>opt<span class="token operator">/</span>geo<span class="token operator">/</span>&lt;<span class="token operator">/</span>path_to_regions_names_files&gt; <span class="token operator">--</span>&gt;


    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Configuration of external dictionaries<span class="token punctuation">.</span> See:
         https:<span class="token operator">/</span><span class="token operator">/</span>clickhouse<span class="token punctuation">.</span>yandex<span class="token operator">/</span>docs<span class="token operator">/</span>en<span class="token operator">/</span>dicts<span class="token operator">/</span>external_dicts<span class="token operator">/</span>
    <span class="token operator">--</span>&gt;
    &lt;dictionaries_config&gt;<span class="token operator">*</span>_dictionary<span class="token punctuation">.</span>xml&lt;<span class="token operator">/</span>dictionaries_config&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Uncomment <span class="token keyword">if</span> you want <span class="token keyword">data</span> to be compressed 30<span class="token operator">-</span>100<span class="token operator">%</span> better<span class="token punctuation">.</span>
         Don<span class="token string">'t do that if you just started using ClickHouse.
      --&gt;
    &lt;compression incl="clickhouse_compression"&gt;
    &lt;!--
        &lt;!- - Set of variants. Checked in order. Last matching case wins. If nothing matches, lz4 will be used. - -&gt;
        &lt;case&gt;

            &lt;!- - Conditions. All must be satisfied. Some conditions may be omitted. - -&gt;
            &lt;min_part_size&gt;10000000000&lt;/min_part_size&gt;        &lt;!- - Min part size in bytes. - -&gt;
            &lt;min_part_size_ratio&gt;0.01&lt;/min_part_size_ratio&gt;   &lt;!- - Min size of part relative to whole table size. - -&gt;

            &lt;!- - What compression method to use. - -&gt;
            &lt;method&gt;zstd&lt;/method&gt;
        &lt;/case&gt;
    --&gt;
    &lt;/compression&gt;

    &lt;!-- Allow to execute distributed DDL queries (CREATE, DROP, ALTER, RENAME) on cluster.
         Works only if ZooKeeper is enabled. Comment it if such functionality isn'</span>t required<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;distributed_ddl&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Path in ZooKeeper to queue with DDL queries <span class="token operator">--</span>&gt;
        &lt;path&gt;<span class="token operator">/</span>clickhouse<span class="token operator">/</span>task_queue<span class="token operator">/</span>ddl&lt;<span class="token operator">/</span>path&gt;

        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Settings <span class="token keyword">from</span> this profile will be used to execute DDL queries <span class="token operator">--</span>&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> &lt;profile&gt;default&lt;<span class="token operator">/</span>profile&gt; <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">/</span>distributed_ddl&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Settings to fine tune MergeTree tables<span class="token punctuation">.</span> See documentation in source code<span class="token punctuation">,</span> in MergeTreeSettings<span class="token punctuation">.</span>h <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span>
    &lt;merge_tree&gt;
        &lt;max_suspicious_broken_parts&gt;5&lt;<span class="token operator">/</span>max_suspicious_broken_parts&gt;
    &lt;<span class="token operator">/</span>merge_tree&gt;
    <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Protection <span class="token keyword">from</span> accidental DROP<span class="token punctuation">.</span>
         <span class="token keyword">If</span> size of a MergeTree table is greater than max_table_size_to_drop <span class="token punctuation">(</span>in bytes<span class="token punctuation">)</span> than table could not be dropped with any DROP query<span class="token punctuation">.</span>
         <span class="token keyword">If</span> you want <span class="token keyword">do</span> delete one table and don<span class="token string">'t want to change clickhouse-server config, you could create special file &lt;clickhouse-path&gt;/flags/force_drop_table and make DROP once.
         By default max_table_size_to_drop is 50GB; max_table_size_to_drop=0 allows to DROP any tables.
         The same for max_partition_size_to_drop.
         Uncomment to disable protection.
    --&gt;
    &lt;!--默认最大删除50G，超过报错！修改为0，无论多大都直接删 --&gt;
    &lt;max_table_size_to_drop&gt;0&lt;/max_table_size_to_drop&gt; 
    &lt;max_partition_size_to_drop&gt;0&lt;/max_partition_size_to_drop&gt;

    &lt;!-- Example of parameters for GraphiteMergeTree table engine --&gt;
    &lt;graphite_rollup_example&gt;
        &lt;pattern&gt;
            &lt;regexp&gt;click_cost&lt;/regexp&gt;
            &lt;function&gt;any&lt;/function&gt;
            &lt;retention&gt;
                &lt;age&gt;0&lt;/age&gt;
                &lt;precision&gt;3600&lt;/precision&gt;
            &lt;/retention&gt;
            &lt;retention&gt;
                &lt;age&gt;86400&lt;/age&gt;
                &lt;precision&gt;60&lt;/precision&gt;
            &lt;/retention&gt;
        &lt;/pattern&gt;
        &lt;default&gt;
            &lt;function&gt;max&lt;/function&gt;
            &lt;retention&gt;
                &lt;age&gt;0&lt;/age&gt;
                &lt;precision&gt;60&lt;/precision&gt;
            &lt;/retention&gt;
            &lt;retention&gt;
                &lt;age&gt;3600&lt;/age&gt;
                &lt;precision&gt;300&lt;/precision&gt;
            &lt;/retention&gt;
            &lt;retention&gt;
                &lt;age&gt;86400&lt;/age&gt;
                &lt;precision&gt;3600&lt;/precision&gt;
            &lt;/retention&gt;
        &lt;/default&gt;
    &lt;/graphite_rollup_example&gt;

    &lt;!-- Directory in &lt;clickhouse-path&gt; containing schema files for various input formats.
         The directory will be created if it doesn'</span>t exist<span class="token punctuation">.</span>
      <span class="token operator">--</span>&gt;
    &lt;format_schema_path&gt;<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>clickhouse<span class="token operator">/</span>format_schemas<span class="token operator">/</span>&lt;<span class="token operator">/</span>format_schema_path&gt;


    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Uncomment to use query masking rules<span class="token punctuation">.</span>
        name <span class="token operator">-</span> name <span class="token keyword">for</span> the rule <span class="token punctuation">(</span>optional<span class="token punctuation">)</span>
        regexp <span class="token operator">-</span> RE2 compatible regular expression <span class="token punctuation">(</span>mandatory<span class="token punctuation">)</span>
        replace <span class="token operator">-</span> substitution string <span class="token keyword">for</span> sensitive <span class="token keyword">data</span> <span class="token punctuation">(</span>optional<span class="token punctuation">,</span> by default <span class="token operator">-</span> six asterisks<span class="token punctuation">)</span>
    &lt;query_masking_rules&gt;
        &lt;rule&gt;
            &lt;name&gt;hide SSN&lt;<span class="token operator">/</span>name&gt;
            &lt;regexp&gt;\b\d<span class="token punctuation">{<!-- --></span>3<span class="token punctuation">}</span><span class="token operator">-</span>\d<span class="token punctuation">{<!-- --></span>2<span class="token punctuation">}</span><span class="token operator">-</span>\d<span class="token punctuation">{<!-- --></span>4<span class="token punctuation">}</span>\b&lt;<span class="token operator">/</span>regexp&gt;
            &lt;replace&gt;000<span class="token operator">-</span>00<span class="token operator">-</span>0000&lt;<span class="token operator">/</span>replace&gt;
        &lt;<span class="token operator">/</span>rule&gt;
    &lt;<span class="token operator">/</span>query_masking_rules&gt;
    <span class="token operator">--</span>&gt;

    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Uncomment to disable ClickHouse internal DNS caching<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> &lt;disable_internal_dns_cache&gt;1&lt;<span class="token operator">/</span>disable_internal_dns_cache&gt; <span class="token operator">--</span>&gt;
&lt;<span class="token operator">/</span>yandex&gt;

</code></pre> 
<p>4、新增两个配置文件：metrika.xml、users.xml<br> 其中metrika.xml主要定义clickHouse集群的信息，比如分片配置、副本配置、zk集群信息配置<br> users.xml 主要是用户权限的管控<br> <strong>metrika.xml如下：</strong></p> 
<pre><code class="prism language-powershell">&lt;?xml version=<span class="token string">"1.0"</span>?&gt;
&lt;<span class="token operator">!</span>-<span class="token operator">-</span>
       NOTE: User and query level settings are <span class="token function">set</span> up in <span class="token string">"users.xml"</span> file<span class="token punctuation">.</span>
<span class="token operator">--</span>&gt;
&lt;yandex&gt;
	&lt;clickhouse_remote_servers&gt;
	    &lt;report_shards_replicas&gt;
	        &lt;shard&gt;
	            &lt;weight&gt;1&lt;<span class="token operator">/</span>weight&gt;
                    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> false代表一次性写入所有副本，true表示写入其中一个副本，配合zk来进行数据复制 <span class="token operator">--</span>&gt;
	            &lt;internal_replication&gt;true&lt;<span class="token operator">/</span>internal_replication&gt;
	            &lt;replica&gt;
	                &lt;host&gt;host01&lt;<span class="token operator">/</span>host&gt;
	                &lt;port&gt;9000&lt;<span class="token operator">/</span>port&gt;
	                &lt;user&gt;zmbd_admin&lt;<span class="token operator">/</span>user&gt;  &lt;<span class="token operator">!</span>-<span class="token operator">-</span> 这里的用户名密码是分布式表跨节点查询，系统自动使用的<span class="token operator">--</span>&gt;
			&lt;password&gt;UPhjwzAA&lt;<span class="token operator">/</span>password&gt;
	            &lt;<span class="token operator">/</span>replica&gt;
	            &lt;replica&gt;
	                &lt;host&gt;host02&lt;<span class="token operator">/</span>host&gt;
	                &lt;port&gt;9000&lt;<span class="token operator">/</span>port&gt;
	                &lt;user&gt;zmbd_admin&lt;<span class="token operator">/</span>user&gt;
			&lt;password&gt;UPhjwzAA&lt;<span class="token operator">/</span>password&gt;
	            &lt;<span class="token operator">/</span>replica&gt;
	        &lt;<span class="token operator">/</span>shard&gt;
	        &lt;shard&gt;
	            &lt;weight&gt;1&lt;<span class="token operator">/</span>weight&gt;
	            &lt;internal_replication&gt;true&lt;<span class="token operator">/</span>internal_replication&gt;
	            &lt;replica&gt;
	                &lt;host&gt;host03&lt;<span class="token operator">/</span>host&gt;
	                &lt;port&gt;9000&lt;<span class="token operator">/</span>port&gt;
	                &lt;user&gt;zmbd_admin&lt;<span class="token operator">/</span>user&gt;
			&lt;password&gt;UPhjwzAA&lt;<span class="token operator">/</span>password&gt;
	            &lt;<span class="token operator">/</span>replica&gt;
	            &lt;replica&gt;
	                &lt;host&gt;host04&lt;<span class="token operator">/</span>host&gt;
	                &lt;port&gt;9000&lt;<span class="token operator">/</span>port&gt;
	                &lt;user&gt;zmbd_admin&lt;<span class="token operator">/</span>user&gt;
			 &lt;password&gt;UPhjwzAA&lt;<span class="token operator">/</span>password&gt;
	            &lt;<span class="token operator">/</span>replica&gt;
	        &lt;<span class="token operator">/</span>shard&gt;
	    &lt;<span class="token operator">/</span>report_shards_replicas&gt;
	&lt;<span class="token operator">/</span>clickhouse_remote_servers&gt;
	 
	&lt;<span class="token operator">!</span>-<span class="token operator">-</span>&lt;macros&gt;
	    &lt;replica&gt;ck1&lt;<span class="token operator">/</span>replica&gt;
	&lt;<span class="token operator">/</span>macros&gt;<span class="token operator">--</span>&gt;
	 
 &lt;<span class="token operator">!</span>-<span class="token operator">-</span> 配置参数：集群名，分片名，副本名 :配置集群版conf、user可以一样，但是下面macos配置必须不一样<span class="token operator">--</span>&gt;
         &lt;macros&gt;
            &lt;layer&gt;report_shards_replicas&lt;<span class="token operator">/</span>layer&gt;
            &lt;shard&gt;01&lt;<span class="token operator">/</span>shard&gt;
            &lt;replica&gt;cluster<span class="token operator">-</span>01<span class="token operator">-</span>1&lt;<span class="token operator">/</span>replica&gt;
        &lt;<span class="token operator">/</span>macros&gt;

	&lt;networks&gt;
	   &lt;ip&gt;::<span class="token operator">/</span>0&lt;<span class="token operator">/</span>ip&gt;
	&lt;<span class="token operator">/</span>networks&gt;
	 
	&lt;zookeeper<span class="token operator">-</span>servers&gt;
	    &lt;node index=<span class="token string">"1"</span>&gt;
	        &lt;host&gt;zk1&lt;<span class="token operator">/</span>host&gt;
	        &lt;port&gt;2181&lt;<span class="token operator">/</span>port&gt;
	    &lt;<span class="token operator">/</span>node&gt;
	    &lt;node index=<span class="token string">"2"</span>&gt;
	        &lt;host&gt;zk2&lt;<span class="token operator">/</span>host&gt;
	        &lt;port&gt;2181&lt;<span class="token operator">/</span>port&gt;
	    &lt;<span class="token operator">/</span>node&gt;
	    &lt;node index=<span class="token string">"3"</span>&gt;
	        &lt;host&gt;zk3&lt;<span class="token operator">/</span>host&gt;
	        &lt;port&gt;2181&lt;<span class="token operator">/</span>port&gt;
	    &lt;<span class="token operator">/</span>node&gt;
	&lt;<span class="token operator">/</span>zookeeper<span class="token operator">-</span>servers&gt;
	 
	&lt;clickhouse_compression&gt;
	    &lt;case&gt;
	        &lt;min_part_size&gt;10000000000&lt;<span class="token operator">/</span>min_part_size&gt;
	        &lt;min_part_size_ratio&gt;0<span class="token punctuation">.</span>01&lt;<span class="token operator">/</span>min_part_size_ratio&gt;
	        &lt;method&gt;lz4&lt;<span class="token operator">/</span>method&gt;
	    &lt;<span class="token operator">/</span>case&gt;
	&lt;<span class="token operator">/</span>clickhouse_compression&gt;
 
&lt;<span class="token operator">/</span>yandex&gt;

</code></pre> 
<p><strong>users.xml如下</strong></p> 
<pre><code class="prism language-powershell">&lt;?xml version=<span class="token string">"1.0"</span>?&gt;
&lt;yandex&gt;
    &lt;profiles&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> 读写用户设置  <span class="token operator">--</span>&gt;
        &lt;default&gt;
            &lt;log_queries&gt;1&lt;<span class="token operator">/</span>log_queries&gt;  &lt;<span class="token operator">!</span>-<span class="token operator">-</span> 打开日志记录开关  <span class="token operator">--</span>&gt;
            &lt;max_memory_usage&gt;10000000000&lt;<span class="token operator">/</span>max_memory_usage&gt;
            &lt;<span class="token operator">!</span>-<span class="token operator">-</span> 内存不足优化点：<span class="token function">group</span> by的时间允许临时数据存到磁盘上&lt;max_bytes_before_external_group_by&gt;5000000000&lt;<span class="token operator">/</span>max_bytes_before_external_group_by&gt; <span class="token operator">--</span>&gt;
            &lt;use_uncompressed_cache&gt;0&lt;<span class="token operator">/</span>use_uncompressed_cache&gt;
            &lt;load_balancing&gt;random&lt;<span class="token operator">/</span>load_balancing&gt;
        &lt;<span class="token operator">/</span>default&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> 只写用户设置  <span class="token operator">--</span>&gt;
        &lt;readonly&gt;
            &lt;log_queries&gt;1&lt;<span class="token operator">/</span>log_queries&gt; 
            &lt;max_memory_usage&gt;10000000000&lt;<span class="token operator">/</span>max_memory_usage&gt;
            &lt;use_uncompressed_cache&gt;0&lt;<span class="token operator">/</span>use_uncompressed_cache&gt;
            &lt;load_balancing&gt;random&lt;<span class="token operator">/</span>load_balancing&gt;
            &lt;readonly&gt;1&lt;<span class="token operator">/</span>readonly&gt;
        &lt;<span class="token operator">/</span>readonly&gt;
    &lt;<span class="token operator">/</span>profiles&gt;
    &lt;<span class="token operator">!</span>-<span class="token operator">-</span> 配额  <span class="token operator">--</span>&gt;
    &lt;quotas&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> Name of quota<span class="token punctuation">.</span> <span class="token operator">--</span>&gt;
        &lt;default&gt;
            &lt;interval&gt;
                &lt;duration&gt;3600&lt;<span class="token operator">/</span>duration&gt;
                &lt;queries&gt;0&lt;<span class="token operator">/</span>queries&gt;
                &lt;errors&gt;0&lt;<span class="token operator">/</span>errors&gt;
                &lt;result_rows&gt;0&lt;<span class="token operator">/</span>result_rows&gt;
                &lt;read_rows&gt;0&lt;<span class="token operator">/</span>read_rows&gt;
                &lt;execution_time&gt;0&lt;<span class="token operator">/</span>execution_time&gt;
            &lt;<span class="token operator">/</span>interval&gt;
        &lt;<span class="token operator">/</span>default&gt;
    &lt;<span class="token operator">/</span>quotas&gt;
    &lt;users&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> admin用户  <span class="token operator">--</span>&gt;
        &lt;zmbd_admin&gt;
            &lt;password_sha256_hex&gt;a1116e73536a6dbabf11ef723bed120aba86a0e5adf89622335e0d0baeb84b40&lt;<span class="token operator">/</span>password_sha256_hex&gt;
            &lt;networks incl=<span class="token string">"networks"</span> replace=<span class="token string">"replace"</span>&gt;
                &lt;ip&gt;::<span class="token operator">/</span>0&lt;<span class="token operator">/</span>ip&gt;
            &lt;<span class="token operator">/</span>networks&gt;
            &lt;profile&gt;default&lt;<span class="token operator">/</span>profile&gt;
            &lt;quota&gt;default&lt;<span class="token operator">/</span>quota&gt;
        &lt;<span class="token operator">/</span>zmbd_admin&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span> admin只读用户  <span class="token operator">--</span>&gt;
        &lt;zmbd_readonly&gt;
            &lt;password_sha256_hex&gt;a1116e73536a6dbabf11ef723bed120aba86a0e5adf89622335e0d0baeb84b40&lt;<span class="token operator">/</span>password_sha256_hex&gt;
            &lt;networks incl=<span class="token string">"networks"</span> replace=<span class="token string">"replace"</span>&gt;
                &lt;ip&gt;::<span class="token operator">/</span>0&lt;<span class="token operator">/</span>ip&gt;
            &lt;<span class="token operator">/</span>networks&gt;
            &lt;profile&gt;readonly&lt;<span class="token operator">/</span>profile&gt;
            &lt;quota&gt;default&lt;<span class="token operator">/</span>quota&gt;
        &lt;<span class="token operator">/</span>zmbd_readonly&gt;
        &lt;<span class="token operator">!</span>-<span class="token operator">-</span>bi 读写用户  <span class="token operator">--</span>&gt;
        &lt;zmbd_idc_bi&gt;
            &lt;password_sha256_hex&gt;a1116e73536a6dbabf11ef723bed120aba86a0e5adf89622335e0d0baeb84b40&lt;<span class="token operator">/</span>password_sha256_hex&gt;
            &lt;networks incl=<span class="token string">"networks"</span> replace=<span class="token string">"replace"</span>&gt;
                &lt;ip&gt;::<span class="token operator">/</span>0&lt;<span class="token operator">/</span>ip&gt;
            &lt;<span class="token operator">/</span>networks&gt;
            &lt;profile&gt;default&lt;<span class="token operator">/</span>profile&gt;
            &lt;quota&gt;default&lt;<span class="token operator">/</span>quota&gt;
            &lt;allow_databases&gt;
       		 &lt;database&gt;bi&lt;<span class="token operator">/</span>database&gt;
    	    &lt;<span class="token operator">/</span>allow_databases&gt;
        &lt;<span class="token operator">/</span>zmbd_idc_bi&gt;

        &lt;<span class="token operator">!</span>-<span class="token operator">-</span>bi 只读用户  <span class="token operator">--</span>&gt;
        &lt;zmbd_bi_readonly&gt;
            &lt;password_sha256_hex&gt;a1116e73536a6dbabf11ef723bed120aba86a0e5adf89622335e0d0baeb84b40&lt;<span class="token operator">/</span>password_sha256_hex&gt;
            &lt;networks incl=<span class="token string">"networks"</span> replace=<span class="token string">"replace"</span>&gt;
                &lt;ip&gt;::<span class="token operator">/</span>0&lt;<span class="token operator">/</span>ip&gt;
            &lt;<span class="token operator">/</span>networks&gt;
            &lt;profile&gt;readonly&lt;<span class="token operator">/</span>profile&gt;
            &lt;quota&gt;default&lt;<span class="token operator">/</span>quota&gt;
        &lt;<span class="token operator">/</span>zmbd_bi_readonly&gt;
        
    &lt;<span class="token operator">/</span>users&gt;
&lt;<span class="token operator">/</span>yandex&gt;

</code></pre> 
<p>密码密文：a1116e73536a6dbabf11ef723bed120aba86a0e5adf89622335e0d0baeb84b40<br> 明文：6zjmczsz</p> 
<h4><a id="_735"></a>密码生成：</h4> 
<p>参考链接：https://www.jianshu.com/p/e339336e7bb9</p> 
<p>生成密码：</p> 
<pre><code class="prism language-powershell">PASSWORD=$<span class="token punctuation">(</span>base64 &lt; <span class="token operator">/</span>dev<span class="token operator">/</span>urandom <span class="token punctuation">|</span> head <span class="token operator">-</span>c8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">echo</span> <span class="token string">"<span class="token variable">$PASSWORD</span>"</span><span class="token punctuation">;</span> 
<span class="token function">echo</span> <span class="token operator">-</span>n <span class="token string">"<span class="token variable">$PASSWORD</span>"</span> <span class="token punctuation">|</span> sha256sum <span class="token punctuation">|</span> tr <span class="token operator">-</span>d <span class="token string">'-'</span>
</code></pre> 
<p>内存不足，用磁盘做运算<br> <img src="https://images2.imgbox.com/cb/22/E80df0PD_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/53/a9/6lnv3OTt_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8e89b21150df04d2fd9858d57730b00f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java内存模型：解决可见性、有序性和原子性问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8c7205679e74687b1ecd5ed8a51a8a53/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用ggeasy R软件包更轻松地进行ggplot</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>