<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>R语言快速读取数据vroom - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/ac2f4be310c15eb53708863a585fbd69/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="R语言快速读取数据vroom">
  <meta property="og:description" content="R语言快速读取大文件 想象一下，一辆赛车在巴音布鲁克赛道上，嗖的一声飞驰而过，这种场景是不是很酷！R语言中，如果用vroom读取一个GB级别的大文件，也能体会到这种速度感。
今天分享的一个R小技巧是读取大文件的最佳方式，尤其是GB以上的文件，比如常见的csv、tsv、txt等类型的文件。还可以批量读取、远程读取、自动解压缩，用起来体验非常不错。
如何使用？ install.packages(&#34;vroom&#34;)
library(vroom)
# install.packages(&#34;pak&#34;)
pak::pak(&#34;tidyverse/vroom&#34;)
首先安装一下，这个包是属于tidyverse生态圈，由Rstudio公司官方维护，主要是用C&#43;&#43;进行优化。
官方宣称的速度可以达到1.23 GB/s
读取一个1.55G的文件，使用传统方式一分半，用vroom几秒钟就完成
vroom有自动识别文件格式功能，所以不管是csv，还是tsv文件都只需要同一个读取指令vroom(”xxx.csv”)就可以。
读取CSV文件 vroom::vroom(&#34;mtcars.tsv&#34;,
col_types = list(cyl = &#34;i&#34;, gear = &#34;f&#34;,hp = &#34;i&#34;, disp = &#34;_&#34;,
drat = &#34;_&#34;, vs = &#34;l&#34;, am = &#34;l&#34;, carb = &#34;i&#34;)
)
#&amp;gt; # A tibble: 32 × 10
#&amp;gt; model mpg cyl hp wt qsec vs am gear carb
#&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt; &amp;lt;lgl&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;int&amp;gt;">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-11T22:20:08+08:00">
    <meta property="article:modified_time" content="2024-03-11T22:20:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">R语言快速读取数据vroom</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <section id="nice" style="font-size: 16px; color: black; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;"> 
 <h2 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; font-size: 1.4em; color: #16a085; margin: 0.4em auto; text-align: center; border-bottom: 5px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">R语言快速读取大文件</span><span class="suffix"></span></h2> 
 <figure style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"> 
  <img src="https://images2.imgbox.com/80/df/Tm40SjZU_o.png" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px; border-radius: 5px;"> 
 </figure> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;">想象一下，一辆赛车在巴音布鲁克赛道上，嗖的一声飞驰而过，这种场景是不是很酷！R语言中，如果用vroom读取一个GB级别的大文件，也能体会到这种速度感。</p> 
 <figure style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"> 
  <img src="https://images2.imgbox.com/0b/e3/o56csEj0_o.jpg" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px; border-radius: 5px;"> 
 </figure> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;">今天分享的一个R小技巧是读取大文件的最佳方式，尤其是GB以上的文件，比如常见的csv、tsv、txt等类型的文件。还可以批量读取、远程读取、自动解压缩，用起来体验非常不错。</p> 
 <h3 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: #009688; padding-left: 12px; margin: 1em auto; font-size: 1.2em; border-left: 7px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">如何使用？</span><span class="suffix"></span></h3> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; background: #fff; color: black; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; border: 2px solid #d5ebe1; border-radius: 10px; padding: 10px;">install.packages(<span class="hljs-string" style="color: #c41a16; line-height: 26px;">"vroom"</span>)<br>library(vroom)<br><br><span class="hljs-comment" style="color: #007400; line-height: 26px;"># install.packages("pak")</span><br>pak::pak(<span class="hljs-string" style="color: #c41a16; line-height: 26px;">"tidyverse/vroom"</span>)<br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;">首先安装一下，这个包是属于tidyverse生态圈，由Rstudio公司官方维护，主要是用C++进行优化。</p> 
 <figure style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"> 
  <img src="https://images2.imgbox.com/33/df/2UfjMpUj_o.png" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px; border-radius: 5px;"> 
 </figure> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;">官方宣称的速度可以达到1.23 GB/s</p> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;"><img src="https://images2.imgbox.com/eb/9c/rW1H11Do_o.png" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px; border-radius: 5px;"> 读取一个1.55G的文件，使用传统方式一分半，用vroom几秒钟就完成</p> 
 <figure style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"> 
  <img src="https://images2.imgbox.com/59/69/Vkb11Azs_o.png" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px; border-radius: 5px;"> 
 </figure> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;">vroom有自动识别文件格式功能，所以不管是csv，还是tsv文件都只需要同一个读取指令vroom(”xxx.csv”)就可以。</p> 
 <h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; margin: 0.9em auto; padding-left: 21px; font-size: 1.1em; border-left: 10px solid #451261;"><span class="prefix" style="display: none;"></span><span class="content">读取CSV文件</span><span class="suffix" style="display: none;"></span></h4> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; background: #fff; color: black; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; border: 2px solid #d5ebe1; border-radius: 10px; padding: 10px;">vroom::vroom(<span class="hljs-string" style="color: #c41a16; line-height: 26px;">"mtcars.tsv"</span>,<br>  col_types = list(cyl = <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"i"</span>, gear = <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"f"</span>,hp = <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"i"</span>, disp = <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"_"</span>,<br>                   drat = <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"_"</span>, vs = <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"l"</span>, am = <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"l"</span>, carb = <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"i"</span>)<br>)<br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt; # A tibble: 32 × 10</span><br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt;   model           mpg   cyl    hp    wt  qsec vs    am    gear   carb</span><br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;fct&gt; &lt;int&gt;</span><br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt; 1 Mazda RX4      21       6   110  2.62  16.5 FALSE TRUE  4         4</span><br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt; 2 Mazda RX4 Wag  21       6   110  2.88  17.0 FALSE TRUE  4         4</span><br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt; 3 Datsun 710     22.8     4    93  2.32  18.6 TRUE  TRUE  4         1</span><br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt; # ℹ 29 more rows</span><br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;">使用vroom包的vroom函数来读取一个名为"mtcars.tsv"的TSV文件（制表符分隔的值）。它指定了列的类型通过col_types参数。按照指定的列类型读取TSV文件，忽略不需要的列，确保数据以正确的格式被导入R环境中。</p> 
 <h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; margin: 0.9em auto; padding-left: 21px; font-size: 1.1em; border-left: 10px solid #451261;"><span class="prefix" style="display: none;"></span><span class="content">批量读取多个文件</span><span class="suffix" style="display: none;"></span></h4> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; background: #fff; color: black; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; border: 2px solid #d5ebe1; border-radius: 10px; padding: 10px;">library(nycflights13)<br>purrr::iwalk(<br>  split(flights, flights<span class="hljs-variable" style="color: #3F6E74; line-height: 26px;">$carrier</span>),<br>  ~ { .x<span class="hljs-variable" style="color: #3F6E74; line-height: 26px;">$carrier</span>[[1]]; vroom::vroom_write(head(.x, 2), glue::glue(<span class="hljs-string" style="color: #c41a16; line-height: 26px;">"flights_{.y}.tsv"</span>), delim = <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"\t"</span>) }<br>)<br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;">使用vroom包的vroom_write函数，这个函数的目的是将数据写入文件。head(.x, 2)取每个航空公司的前两条航班记录；glue::glue("flights_{.y}.tsv")使用glue包生成文件名，文件名包含航空公司代码；最后指定文件的分隔符为制表符（\t），生成的文件是.tsv格式。</p> 
 <h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; margin: 0.9em auto; padding-left: 21px; font-size: 1.1em; border-left: 10px solid #451261;"><span class="prefix" style="display: none;"></span><span class="content">直接读写压缩文件</span><span class="suffix" style="display: none;"></span></h4> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; background: #fff; color: black; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; border: 2px solid #d5ebe1; border-radius: 10px; padding: 10px;">vroom_write(flights, <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"flights.tsv.gz"</span>)<br><br><span class="hljs-comment" style="color: #007400; line-height: 26px;"># Check file sizes to show file is compressed</span><br>fs::file_size(c(<span class="hljs-string" style="color: #c41a16; line-height: 26px;">"flights.tsv"</span>, <span class="hljs-string" style="color: #c41a16; line-height: 26px;">"flights.tsv.gz"</span>))<br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt; 29.62M  7.87M</span><br><br><span class="hljs-comment" style="color: #007400; line-height: 26px;"># Read the file back in</span><br>data &lt;- vroom(<span class="hljs-string" style="color: #c41a16; line-height: 26px;">"flights.tsv.gz"</span>)<br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;">vroom_write函数可以将数据从R中导出为文件，比如这里直接导出为压缩文件，减少储存空间。</p> 
 <h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; margin: 0.9em auto; padding-left: 21px; font-size: 1.1em; border-left: 10px solid #451261;"><span class="prefix" style="display: none;"></span><span class="content">读取指定列的数据</span><span class="suffix" style="display: none;"></span></h4> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; background: #fff; color: black; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; border: 2px solid #d5ebe1; border-radius: 10px; padding: 10px;">data &lt;- vroom(<span class="hljs-string" style="color: #c41a16; line-height: 26px;">"flights.tsv"</span>, col_select = c(year, flight, tailnum))<br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt; Observations: 336,776</span><br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt; Variables: 3</span><br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt; chr [1]: tailnum</span><br><span class="hljs-comment" style="color: #007400; line-height: 26px;">#&gt; dbl [2]: year, flight</span><br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;">有的时候只需要部分数据，并不想全部导入，就可以用这种方法。</p> 
 <hr style="height: 1px; margin-top: 10px; margin-bottom: 10px; border: none; border-top: 1px solid black; margin: 30px 0;"> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify; padding: 0px; letter-spacing: 1px; margin-bottom: 20px;">今天分享的小技巧就到这里结束啦，感谢您的阅读，如果感觉有所收获欢迎点在转发分享。这个方法在处理生物信息学大量数据时还是挺有用的，避免把时间浪费在文件读写上，让数据分析更加的丝滑流畅！</p> 
</section> 
<p>本文由<a href="https://mdnice.com/?platform=4" rel="nofollow"> mdnice </a>多平台发布</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/544cbddb69a0ff5e80f13eba5c53b068/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构-＞双向链表带你体验开火车（哨兵）与拼接火车（应用）厢的乐趣</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9b3c3ceff686d9564cadefcb03b85240/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【机器学习算法】: MeanShift算法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>