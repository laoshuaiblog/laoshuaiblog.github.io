<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>NGINX最常用的指令（最全的查询） - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/2428058f2ac4f2e337c7a682ce0dfaeb/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="NGINX最常用的指令（最全的查询）">
  <meta property="og:description" content="服务管理
sudo systemctl status nginx # nginx当前状态
sudo systemctl reload nginx # 重新加载 nginx
sudo systemctl restart nginx # 重启nginx
sudo nginx -t # 检查语法
nginx # 启动
nginx -s reload # 重启
nginx -s stop # 关闭进程
nginx -s quit # 平滑关闭nginx
nginx -V # 查看nginx的安装状态，
Docker 安装
docker run --name some-nginx -v /some/content:/usr/share/nginx/html:ro -d nginx
简单代理
location / {
proxy_pass http://127.0.0.1:3000;
proxy_redirect off;
proxy_set_header Host $host;
}">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-12-08T11:44:29+08:00">
    <meta property="article:modified_time" content="2022-12-08T11:44:29+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">NGINX最常用的指令（最全的查询）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">服务管理</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">sudo</span><span style="color:#222222;"> systemctl status nginx </span><span style="color:#999999;"># nginx</span><span style="color:#999999;">当前状态</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">sudo systemctl reload nginx </span><span style="color:#999999;"># </span><span style="color:#999999;">重新加载</span><span style="color:#999999;"> nginx</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">sudo systemctl restart nginx </span><span style="color:#999999;"># </span><span style="color:#999999;">重启</span><span style="color:#999999;">nginx</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">sudo nginx -t   </span><span style="color:#999999;"># </span><span style="color:#999999;">检查语法</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">nginx           </span><span style="color:#999999;"># </span><span style="color:#999999;">启动</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">nginx -s reload </span><span style="color:#999999;"># </span><span style="color:#999999;">重启</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">nginx -s stop   </span><span style="color:#999999;"># </span><span style="color:#999999;">关闭进程</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">nginx -s quit   </span><span style="color:#999999;"># </span><span style="color:#999999;">平滑关闭</span><span style="color:#999999;">nginx</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">nginx -V        </span><span style="color:#999999;"># </span><span style="color:#999999;">查看</span><span style="color:#999999;">nginx</span><span style="color:#999999;">的安装状态，</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">Docker </span></strong><strong><span style="color:#000000;">安装</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">docker</span><span style="color:#222222;"> run --name some-nginx -v /some/content:/usr/share/nginx/html:ro -d nginx</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">简单代理</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://127.0.0.1:3000;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">proxy_redirect</span>      <span style="color:#8a7304;">off</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;">    Host </span><span style="color:#d96322;">$host</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">全局变量</span></strong></span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$args</span></p> </td><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">这个变量等于请求行中的参数，同 $query_string</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$remote_port</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">客户端的端口</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$content_length</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">请求头中的 Content-length 字段</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$remote_user</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">已经经过 Auth Basic Module 验证的用户名</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$content_type</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">请求头中的 Content-Type 字段</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$request_filename</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">当前请求的文件路径，由 root 或alias指令与URI请求生成</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$document_root</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">当前请求在 root 指令中指定的值</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$scheme</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">HTTP</span><span style="color:#222222;">方法（如http，https）</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$host</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">请求主机头字段，否则为服务器名称</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$hostname</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">主机名</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$http_user_agent</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">客户端agent信息</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$http_cookie</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">客户端cookie信息</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$server_protocol</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">请求使用的协议，通常是HTTP/1.0或HTTP/1.1</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$server_addr</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">服务器地址，在完成一次系统调用后可以确定这个值</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$server_name</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">服务器名称</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$server_port</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">请求到达服务器的端口号</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$limit_rate</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">这个变量可以限制连接速率</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$request_method</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">客户端请求的动作，如 GET/POST</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$request_uri</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">包含请求参数的原始URI，不包含主机名，如：/foo/bar.php?arg=baz</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$remote_addr</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">客户端的IP地址</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$uri</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">不带请求参数的当前URI，$uri不包含主机名，如 /foo/bar.html</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$document_uri</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">与 $uri 相同</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">$nginx_version</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">nginx </span><span style="color:#222222;">版本</span></p> </td></tr></tbody></table> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">更多全局变量查看官方文档</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">监听端口</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;      </span><span style="color:#999999;"># </span><span style="color:#999999;">标准</span><span style="color:#999999;"> HTTP </span><span style="color:#999999;">协议</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">443</span><span style="color:#222222;"> ssl; </span><span style="color:#999999;"># </span><span style="color:#999999;">标准</span><span style="color:#999999;"> HTTPS </span><span style="color:#999999;">协议</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">443</span><span style="color:#222222;"> ssl http2; </span><span style="color:#999999;"># </span><span style="color:#999999;">对于</span><span style="color:#999999;"> http2</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span><span style="color:#222222;"> [::]:</span><span style="color:#a82e2e;">80</span><span style="color:#222222;">; </span><span style="color:#999999;"># </span><span style="color:#999999;">使用</span><span style="color:#999999;"> IPv6 </span><span style="color:#999999;">在</span><span style="color:#999999;"> 80 </span><span style="color:#999999;">上收听</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">仅收听使用</span><span style="color:#999999;"> IPv6</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span><span style="color:#222222;"> [::]:</span><span style="color:#a82e2e;">80</span><span style="color:#222222;"> ipv6only=</span><span style="color:#8a7304;">on</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">域名 (server_name)</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">监听</span><span style="color:#999999;"> example.com</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> example.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">监听多个域</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> example.com www.example.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">监听所有子域</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span> <span style="color:#d96322;">*.example.com</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">监听所有顶级域</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span> <span style="color:#d96322;">example.*</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">监听未指定的主机名（监听</span><span style="color:#999999;"> IP </span><span style="color:#999999;">地址本身）</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span> <span style="color:#00753b;">""</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">负载均衡(简单实例)</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">upstream</span> <span style="color:#00753b;">node_js</span> <span style="color:#00753b;">{<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">0.0.0.0</span><span style="color:#00753b;">:3000;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">0.0.0.0</span><span style="color:#00753b;">:4000;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">127.155.142.421</span><span style="color:#00753b;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">负载均衡(权重)</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">upstream</span><span style="color:#222222;"> test {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server</span><span style="color:#222222;"> localhost:</span><span style="color:#a82e2e;">8080</span><span style="color:#222222;"> weight=</span><span style="color:#a82e2e;">9</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server</span><span style="color:#222222;"> localhost:</span><span style="color:#a82e2e;">8081</span><span style="color:#222222;"> weight=</span><span style="color:#a82e2e;">1</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">upstream ip_hash</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">upstream </span><span style="color:#00753b;">test {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  ip_hash;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  server </span><span style="color:#00753b;">localhost:8080;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  server </span><span style="color:#00753b;">localhost:8081;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">解决负载均衡 session 的问题</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">upstream fair</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">upstream </span><span style="color:#00753b;">backend {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  fair;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  server </span><span style="color:#00753b;">localhost:8080;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  server </span><span style="color:#00753b;">localhost:8081;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">响应时间短的优先分配</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">server </span></strong><strong><span style="color:#000000;">可选参数</span></strong></span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">weight</span></p> </td><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">访问权重数值越高，收到请求越多</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">fail_timeout</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">指定的时间内必须提供响应</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">max_fails</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">尝试失败服务器连接的最大次数</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">down</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">标记一个服务器不再接受任何请求</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">backup</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">有服务器宕机，标记的机器接收请求</span></p> </td></tr></tbody></table> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">配置示例</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">upstream</span> <span style="color:#00753b;">test</span> <span style="color:#00753b;">{<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">127.0.0.1</span><span style="color:#00753b;">:83</span> <span style="color:#00753b;">weight=9;</span> <span style="color:#999999;"># </span><span style="color:#999999;">权重</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">127.0.0.1</span><span style="color:#00753b;">:83</span> <span style="color:#00753b;">weight=1;</span> <span style="color:#999999;"># </span><span style="color:#999999;">权重</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">失败超时时间</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">127.0.0.1</span><span style="color:#00753b;">:83</span> <span style="color:#00753b;">max_fails=3;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">127.0.0.1</span><span style="color:#00753b;">:83</span> <span style="color:#00753b;">weight=3</span> <span style="color:#00753b;">down;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">upstream url_hash</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">upstream</span><span style="color:#222222;"> backend {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">hash</span> <span style="color:#d96322;">$request_uri</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">hash_method</span><span style="color:#222222;"> crc32;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server</span><span style="color:#222222;"> localhost:</span><span style="color:#a82e2e;">8080</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server</span><span style="color:#222222;"> localhost:</span><span style="color:#a82e2e;">8081</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">按访问url的hash结果来分配请求</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">upstream keepalive</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">upstream</span> <span style="color:#00753b;">memcached_backend</span> <span style="color:#00753b;">{<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">127.0.0.1</span><span style="color:#00753b;">:11211;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">10.0.0.2</span><span style="color:#00753b;">:11211;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#00753b;">keepalive</span> <span style="color:#a82e2e;">32</span><span style="color:#00753b;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">激活缓存以连接到上游服务器</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">子文件夹中的代理</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span><span style="color:#222222;"> /folder/ { </span><span style="color:#999999;"># / </span><span style="color:#999999;">很重要！</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://127.0.0.1:3000/; </span><span style="color:#999999;"># / </span><span style="color:#999999;">很重要！</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">proxy_redirect</span>      <span style="color:#8a7304;">off</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;">    Host            </span><span style="color:#d96322;">$host</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;">    X-Real-IP       </span><span style="color:#d96322;">$remote_addr</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;">    X-Forwarded-For </span><span style="color:#d96322;">$proxy_add_x_forwarded_for</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">反向代理</span></strong></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">基础</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> example.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  </span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://0.0.0.0:3000;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">其中</span><span style="color:#999999;"> 0.0.0.0:3000 </span><span style="color:#999999;">是绑定在</span> </span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># 0.0.0.0</span><span style="color:#999999;">端口</span><span style="color:#999999;">3000 </span><span style="color:#999999;">列表上的</span><span style="color:#999999;"> Node.js </span><span style="color:#999999;">服务器</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">基础 + (upstream)</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">upstream</span><span style="color:#222222;"> node_js {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server</span> <span style="color:#a82e2e;">0.0.0.0:3000</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">其中</span><span style="color:#999999;"> 0.0.0.0:3000 </span><span style="color:#999999;">是绑定在</span> </span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># 0.0.0.0</span><span style="color:#999999;">端口</span><span style="color:#999999;">3000 </span><span style="color:#999999;">列表上的</span><span style="color:#999999;"> Node.js </span><span style="color:#999999;">服务器</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> example.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  </span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://node_js;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">升级连接（适用于支持 WebSockets 的应用程序）</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">upstream</span><span style="color:#222222;"> node_js {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server</span> <span style="color:#a82e2e;">0.0.0.0:3000</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> example.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  </span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://node_js;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_redirect</span> <span style="color:#8a7304;">off</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_http_version</span> <span style="color:#a82e2e;">1</span><span style="color:#222222;">.</span><span style="color:#a82e2e;">1</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> Upgrade </span><span style="color:#d96322;">$http_upgrade</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> Connection </span><span style="color:#00753b;">"upgrade"</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> Host </span><span style="color:#d96322;">$host</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"> </span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">适用于 Node.js、Streamlit、Jupyter 等</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">静态资源（传统 Web 服务器）</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> example.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">root</span><span style="color:#222222;"> /path/to/website;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># root /www/data/ </span><span style="color:#999999;">示例，如果里面没有</span><span style="color:#999999;">'root'</span><span style="color:#999999;">，它将寻找</span><span style="color:#999999;"> /www/data/index.html</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> /images/ { </span><span style="color:#999999;"># </span><span style="color:#999999;">如果里面没有</span><span style="color:#999999;">“root”</span><span style="color:#999999;">，它将寻找</span><span style="color:#999999;"> /www/data/images/index.html</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> /videos/ { </span><span style="color:#999999;"># </span><span style="color:#999999;">由于里面有</span><span style="color:#999999;">“root”</span><span style="color:#999999;">，它会寻找</span><span style="color:#999999;"> /www/media/videos/index.html</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">root</span><span style="color:#222222;"> /www/media;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">HTTPS </span></strong><strong><span style="color:#000000;">协议</span></strong></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">大多数 SSL 选项取决于您的应用程序做什么或需要什么</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">443</span><span style="color:#222222;"> ssl http2;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> example.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">ssl</span> <span style="color:#8a7304;">on</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">ssl_certificate</span><span style="color:#222222;"> /path/to/cert.pem;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">ssl_certificate_key</span><span style="color:#222222;"> /path/to/privkey.pem;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">ssl_stapling</span> <span style="color:#8a7304;">on</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">ssl_stapling_verify</span> <span style="color:#8a7304;">on</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">ssl_trusted_certificate</span><span style="color:#222222;"> /path/to/fullchain.pem;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">ssl_protocols</span><span style="color:#222222;"> TLSv1 TLSv1.</span><span style="color:#a82e2e;">1</span><span style="color:#222222;"> TLSv1.</span><span style="color:#a82e2e;">2</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">ssl_session_timeout</span> <span style="color:#a82e2e;">1d</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">ssl_session_cache</span><span style="color:#222222;"> shared:SSL:</span><span style="color:#a82e2e;">50m</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">add_header</span><span style="color:#222222;"> Strict-Transport-Security max-age=</span><span style="color:#a82e2e;">15768000</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">您可以使用 Let's Encrypt 轻松保护您的网站/应用程序。去 lets-encrypt 获取更多信息</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">重定向(301永久)</span></strong></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">将 www.example.com 重定向到 example.com</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> www.example.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">return</span> <span style="color:#a82e2e;">301</span><span style="color:#222222;"> http://example.com</span><span style="color:#d96322;">$request_uri</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">将 http 重定向到 https</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> example.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">return</span> <span style="color:#a82e2e;">301</span><span style="color:#222222;"> https://example.com</span><span style="color:#d96322;">$request_uri</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">重定向(302临时)</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> yourdomain.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">return</span> <span style="color:#a82e2e;">302</span><span style="color:#222222;"> http://otherdomain.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">永久重定向到 HTTPS 安全域</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> yourdomain.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">return</span> <span style="color:#a82e2e;">301</span><span style="color:#222222;"> https://</span><span style="color:#d96322;">$host$request_uri</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">重定向参数</span></strong></span></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">permanent</span></p> </td><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">永久性重定向。日志中的状态码为 301</span></p> </td></tr><tr><td style="border-color:#e8e8e8;vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">redirect</span></p> </td><td style="vertical-align:top;"> <p style="margin-left:0;text-align:left;"><span style="color:#222222;">临时重定向。日志中的状态码为 302</span></p> </td></tr></tbody></table> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">HTTP </span></strong><strong><span style="color:#000000;">请求端真实的IP</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> X-Forwarded-For </span><span style="color:#d96322;">$remote_addr</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">示例</span></strong></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">websocket </span></strong><strong><span style="color:#000000;">的代理 keepalive</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#999999;"># Upstreams</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">upstream</span><span style="color:#222222;"> backend {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">server</span> <span style="color:#a82e2e;">127.0.0.1:3000</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">keepalive</span> <span style="color:#a82e2e;">5</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#999999;"># HTTP Server</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> your_hostname.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">error_log</span><span style="color:#222222;"> /var/log/nginx/rocketchat.access.log;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://backend;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_http_version</span> <span style="color:#a82e2e;">1</span><span style="color:#222222;">.</span><span style="color:#a82e2e;">1</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> Upgrade </span><span style="color:#d96322;">$http_upgrade</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> Connection </span><span style="color:#00753b;">"upgrade"</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> Host </span><span style="color:#d96322;">$http_host</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> X-Real-IP </span><span style="color:#d96322;">$remote_addr</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> X-Forward-For </span><span style="color:#d96322;">$proxy_add_x_forwarded_for</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> X-Forward-Proto http;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> X-Nginx-Proxy </span><span style="color:#8a7304;">true</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_redirect</span> <span style="color:#8a7304;">off</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">Apache </span></strong><strong><span style="color:#000000;">的反向代理</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> domain.tld;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">access_log</span><span style="color:#222222;"> /log/domain.tld.access.log;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">error_log</span><span style="color:#222222;"> /log/domain.tld.</span><span style="color:#8a7304;">error</span><span style="color:#222222;">.log;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">root</span><span style="color:#222222;"> /var/www/domain.tld/htdocs;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">将请求传递给</span><span style="color:#999999;"> Apache </span><span style="color:#999999;">后端</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://backend;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">使用后备处理静态文件</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span> <span style="color:#d96322;">~* \.(ogg|ogv|svg|svgz|eot|otf|woff|woff2|ttf|m4a|mp4|ttf|rss|atom|jpe?g|gif|cur|heic|png|tiff|ico|zip|webm|mp3|aac|tgz|gz|rar|bz2|doc|xls|exe|ppt|tar|mid|midi|wav|bmp|rtf|swf|webp)$</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">add_header</span> <span style="color:#00753b;">"Access-Control-Allow-Origin"</span> <span style="color:#00753b;">"*"</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">access_log</span> <span style="color:#8a7304;">off</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">log_not_found</span> <span style="color:#8a7304;">off</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">expires</span><span style="color:#222222;"> max;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">try_files</span> <span style="color:#d96322;">$uri</span> <span style="color:#d96322;">@fallback</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">如果找不到文件，则回退以将请求传递给</span><span style="color:#999999;"> Apache</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span> <span style="color:#d96322;">@fallback</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://backend;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">Gitlab </span></strong><strong><span style="color:#000000;">的反向代理</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;">#</span><span style="color:#999999;">侦听的</span><span style="color:#999999;">80</span><span style="color:#999999;">端口</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span>       <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;">  git.example.cn;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;">   http://localhost:3000;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">以下是一些反向代理的配置可删除</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_redirect</span>             <span style="color:#8a7304;">off</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">后端的</span><span style="color:#999999;">Web</span><span style="color:#999999;">服务器可以通过</span><span style="color:#999999;">X-Forwarded-For</span><span style="color:#999999;">获取用户真实</span><span style="color:#999999;">IP</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;">           Host </span><span style="color:#d96322;">$host</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">client_max_body_size</span>       <span style="color:#a82e2e;">10m</span><span style="color:#222222;">;  </span><span style="color:#999999;"># </span><span style="color:#999999;">允许客户端请求的最大单文件字节数</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">client_body_buffer_size</span>    <span style="color:#a82e2e;">128k</span><span style="color:#222222;">; </span><span style="color:#999999;"># </span><span style="color:#999999;">缓冲区代理缓冲用户端请求的最大字节数</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_connect_timeout</span>      <span style="color:#a82e2e;">300</span><span style="color:#222222;">;  </span><span style="color:#999999;"># nginx</span><span style="color:#999999;">跟后端服务器连接超时时间</span><span style="color:#999999;">(</span><span style="color:#999999;">代理连接超时</span><span style="color:#999999;">)</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_send_timeout</span>         <span style="color:#a82e2e;">300</span><span style="color:#222222;">;  </span><span style="color:#999999;"># </span><span style="color:#999999;">后端服务器数据回传时间</span><span style="color:#999999;">(</span><span style="color:#999999;">代理发送超时</span><span style="color:#999999;">)</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_read_timeout</span>         <span style="color:#a82e2e;">300</span><span style="color:#222222;">;  </span><span style="color:#999999;"># </span><span style="color:#999999;">连接成功后，后端服务器响应时间</span><span style="color:#999999;">(</span><span style="color:#999999;">代理接收超时</span><span style="color:#999999;">)</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">设置代理服务器（</span><span style="color:#999999;">nginx</span><span style="color:#999999;">）保存用户头信息的缓冲区大小</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_buffer_size</span>          <span style="color:#a82e2e;">4k</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># proxy_buffers</span><span style="color:#999999;">缓冲区，网页平均在</span><span style="color:#999999;">32k</span><span style="color:#999999;">以下的话，这样设置</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_buffers</span>              <span style="color:#a82e2e;">4</span> <span style="color:#a82e2e;">32k</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">高负荷下缓冲大小（</span><span style="color:#999999;">proxy_buffers*2</span><span style="color:#999999;">）</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_busy_buffers_size</span>    <span style="color:#a82e2e;">64k</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">重定向整个网站</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">server {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  server_name old-site.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">return</span> <span style="color:#a82e2e;">301</span><span style="color:#222222;"> $scheme</span><span style="color:#d96322;">://new-site</span><span style="color:#222222;">.com$request_uri;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">重定向单页</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> = /oldpage.html {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">return</span> <span style="color:#a82e2e;">301</span><span style="color:#222222;"> http://example.org/newpage.html;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">重定向整个子路径</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span><span style="color:#222222;"> /old-site {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">rewrite</span><span style="color:#d96322;"> ^/old-site/(.*)</span><span style="color:#222222;"> http://example.org/new-site/</span><span style="color:#d96322;">$1</span> <span style="color:#8a7304;">permanent</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">负载均衡</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">upstream</span> <span style="color:#00753b;">example</span> <span style="color:#00753b;">{<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">ip_hash;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># upstream</span><span style="color:#999999;">的负载均衡，</span><span style="color:#999999;">weight</span><span style="color:#999999;">是权重，可以根据机器配置定义权重。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># weigth</span><span style="color:#999999;">参数表示权值，权值越高被分配到的几率越大。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">192.168.122.11</span><span style="color:#00753b;">:8081</span> <span style="color:#00753b;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">127.0.0.1</span><span style="color:#00753b;">:82</span> <span style="color:#00753b;">weight=3;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">127.0.0.1</span><span style="color:#00753b;">:83</span> <span style="color:#00753b;">weight=3</span> <span style="color:#00753b;">down;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">127.0.0.1</span><span style="color:#00753b;">:84</span> <span style="color:#00753b;">weight=3;</span> <span style="color:#00753b;">max_fails=3</span>  <span style="color:#00753b;">fail_timeout=20s;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server</span> <span style="color:#a82e2e;">127.0.0.1</span><span style="color:#00753b;">:85</span> <span style="color:#00753b;">weight=4;;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">keepalive</span> <span style="color:#a82e2e;">32</span><span style="color:#00753b;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">server</span> <span style="color:#00753b;">{<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;">#</span><span style="color:#999999;">侦听的</span><span style="color:#999999;">80</span><span style="color:#999999;">端口</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">listen</span>       <span style="color:#a82e2e;">80</span><span style="color:#00753b;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">server_name</span>  <span style="color:#00753b;">git.example.cn;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">location</span> <span style="color:#00753b;">/</span> <span style="color:#00753b;">{<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">在这里设置一个代理，和</span><span style="color:#999999;"> upstream </span><span style="color:#999999;">的名字一样</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#00753b;">proxy_pass</span>   <span style="color:#00753b;">http://example;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#00753b;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">内容缓存</span></strong></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">允许浏览器基本上永久地缓存静态内容。 Nginx 将为您设置 Expires 和 Cache-Control 头信息</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span><span style="color:#222222;"> /static {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">root</span><span style="color:#222222;"> /data;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">expires</span><span style="color:#222222;"> max;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">如果要求浏览器永远不会缓存响应（例如用于跟踪请求），请使用 -1</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">location = </span><span style="color:#00753b;">/empty.gif {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">    empty_gif;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">    expires </span><span style="color:#00753b;">-1;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">跨域问题</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> api.xxx.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    </span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">add_header</span> <span style="color:#00753b;">'Access-Control-Allow-Origin'</span> <span style="color:#00753b;">'*'</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">add_header</span> <span style="color:#00753b;">'Access-Control-Allow-Credentials'</span> <span style="color:#00753b;">'true'</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">add_header</span> <span style="color:#00753b;">'Access-Control-Allow-Methods'</span> <span style="color:#00753b;">'GET,POST,HEAD'</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://127.0.0.1:3000;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> X-Real-IP </span><span style="color:#d96322;">$remote_addr</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> X-Forwarded-For </span><span style="color:#d96322;">$proxy_add_x_forwarded_for</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_set_header</span><span style="color:#222222;"> Host  </span><span style="color:#d96322;">$http_host</span><span style="color:#222222;">;    </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  } </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">重定向 URI 来解决跨域问题</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">upstream</span><span style="color:#222222;"> test {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server</span> <span style="color:#a82e2e;">127.0.0.1:8080</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server</span><span style="color:#222222;"> localhost:</span><span style="color:#a82e2e;">8081</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> api.xxx.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / { </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">root</span><span style="color:#222222;">  html;                   </span><span style="color:#999999;"># </span><span style="color:#999999;">去请求</span><span style="color:#999999;">../html</span><span style="color:#999999;">文件夹里的文件</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">index</span><span style="color:#222222;">  index.html index.htm;  </span><span style="color:#999999;"># </span><span style="color:#999999;">首页响应地址</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">用于拦截请求，匹配任何以</span><span style="color:#999999;"> /api/</span><span style="color:#999999;">开头的地址，</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">匹配符合以后，停止往下搜索正则。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#d96322;"> ^~/api/</span><span style="color:#222222;">{ </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">代表重写拦截进来的请求，并且只能对域名后边的除去传递的参数外的字符串起作用</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">例如</span><span style="color:#999999;">www.a.com/api/msg?meth=1&amp;par=2</span><span style="color:#999999;">重写，只对</span><span style="color:#999999;">/api/msg</span><span style="color:#999999;">重写。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># rewrite</span><span style="color:#999999;">后面的参数是一个简单的正则</span><span style="color:#999999;"> ^/api/(.*)$</span><span style="color:#999999;">，</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># $1</span><span style="color:#999999;">代表正则中的第一个</span><span style="color:#999999;">()</span><span style="color:#999999;">，</span><span style="color:#999999;">$2</span><span style="color:#999999;">代表第二个</span><span style="color:#999999;">()</span><span style="color:#999999;">的值，以此类推。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">rewrite</span><span style="color:#d96322;"> ^/api/(.*)$</span><span style="color:#222222;"> /</span><span style="color:#d96322;">$1</span> <span style="color:#8a7304;">break</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    </span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">把请求代理到其他主机</span> </span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">其中</span><span style="color:#999999;"> http://www.b.com/ </span><span style="color:#999999;">写法和</span><span style="color:#999999;"> http://www.b.com</span><span style="color:#999999;">写法的区别如下</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">如果你的请求地址是他</span><span style="color:#999999;"> http://server/html/test.jsp</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">配置一：</span><span style="color:#999999;"> http://www.b.com/ </span><span style="color:#999999;">后面有</span><span style="color:#999999;">“/” </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;">#         </span><span style="color:#999999;">将反向代理成</span><span style="color:#999999;"> http://www.b.com/html/test.jsp </span><span style="color:#999999;">访问</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">配置一：</span><span style="color:#999999;"> http://www.b.com </span><span style="color:#999999;">后面没有有</span><span style="color:#999999;">“/” </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;">#         </span><span style="color:#999999;">将反向代理成</span><span style="color:#999999;"> http://www.b.com/test.jsp </span><span style="color:#999999;">访问</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://test;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">如果</span><span style="color:#999999;"> proxy_pass  URL </span><span style="color:#999999;">是</span><span style="color:#999999;"> http://a.xx.com/platform/ </span><span style="color:#999999;">这种情况</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># proxy_cookie_path</span><span style="color:#999999;">应该设置成</span><span style="color:#999999;"> /platform/ / (</span><span style="color:#999999;">注意两个斜杠之间有空格</span><span style="color:#999999;">)</span><span style="color:#999999;">。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_cookie_path</span><span style="color:#222222;"> /platfrom/ /;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># </span><span style="color:#999999;">设置</span><span style="color:#999999;"> Cookie </span><span style="color:#999999;">头通过</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">proxy_pass_header</span><span style="color:#222222;"> Set-Cookie;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  } </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">跳转到带 www 的域上面</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span> <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">配置正常的带</span><span style="color:#999999;">www</span><span style="color:#999999;">的域名</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> www.wangchujiang.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">root</span><span style="color:#222222;"> /home/www/wabg/download;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">try_files</span> <span style="color:#d96322;">$uri</span> <span style="color:#d96322;">$uri</span><span style="color:#222222;">/ /index.html =</span><span style="color:#a82e2e;">404</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">将不带</span><span style="color:#999999;"> www </span><span style="color:#999999;">的</span><span style="color:#999999;"> wangchujiang.com </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">永久性重定向到</span><span style="color:#999999;"> https://www.wangchujiang.com</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;"> wangchujiang.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">rewrite</span><span style="color:#d96322;"> ^(.*)</span><span style="color:#222222;"> https://www.wangchujiang.com</span><span style="color:#d96322;">$1</span> <span style="color:#8a7304;">permanent</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">代理转发</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">upstream</span><span style="color:#222222;"> server-api {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># api </span><span style="color:#999999;">代理服务地址</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server</span> <span style="color:#a82e2e;">127.0.0.1:3110</span><span style="color:#222222;">;    </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">upstream</span><span style="color:#222222;"> server-resource {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">静态资源</span> <span style="color:#999999;">代理服务地址</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server</span> <span style="color:#a82e2e;">127.0.0.1:3120</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span>       <span style="color:#a82e2e;">3111</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;">  localhost; </span><span style="color:#999999;"># </span><span style="color:#999999;">这里指定域名</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">root</span><span style="color:#222222;"> /home/www/server-statics;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">匹配</span><span style="color:#999999;"> api </span><span style="color:#999999;">路由的反向代理到</span><span style="color:#999999;">API</span><span style="color:#999999;">服务</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#d96322;"> ^~/api/</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">rewrite</span><span style="color:#d96322;"> ^/(.*)$</span><span style="color:#222222;"> /</span><span style="color:#d96322;">$1</span> <span style="color:#8a7304;">break</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://server-api;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">假设这里验证码也在</span><span style="color:#999999;">API</span><span style="color:#999999;">服务中</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#d96322;"> ^~/captcha</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">rewrite</span><span style="color:#d96322;"> ^/(.*)$</span><span style="color:#222222;"> /</span><span style="color:#d96322;">$1</span> <span style="color:#8a7304;">break</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://server-api;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">假设你的图片资源全部在另外一个服务上面</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#d96322;"> ^~/img/</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">rewrite</span><span style="color:#d96322;"> ^/(.*)$</span><span style="color:#222222;"> /</span><span style="color:#d96322;">$1</span> <span style="color:#8a7304;">break</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://server-resource;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">路由在前端，后端没有真实路由，</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">路由不存在的</span><span style="color:#999999;"> 404 </span><span style="color:#999999;">状态的页面返回</span><span style="color:#999999;"> /index.html</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">使用场景，用在</span><span style="color:#999999;"> React/Vue</span><span style="color:#999999;">项目没有真实路由</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">try_files</span> <span style="color:#d96322;">$uri</span> <span style="color:#d96322;">$uri</span><span style="color:#222222;">/ /index.html =</span><span style="color:#a82e2e;">404</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;">#                      </span><span style="color:#999999;">空格很重要</span><span style="color:#999999;"> ^</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">屏蔽 IP</span></strong></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">可以放到 http, server, location, limit_except 语句块</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">include blockip</span><span style="color:#a82e2e;">.conf</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">在 blockip.conf 里面输入内容，如：</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">deny</span> <span style="color:#a82e2e;">165.91.122.67</span><span style="color:#00753b;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">deny</span> <span style="color:#00753b;">IP;</span>            <span style="color:#999999;"># </span><span style="color:#999999;">屏蔽单个</span><span style="color:#999999;"> ip </span><span style="color:#999999;">访问</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">allow</span> <span style="color:#00753b;">IP;</span>           <span style="color:#999999;"># </span><span style="color:#999999;">允许单个</span><span style="color:#999999;"> ip </span><span style="color:#999999;">访问</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">deny</span> <span style="color:#00753b;">all;</span>           <span style="color:#999999;"># </span><span style="color:#999999;">屏蔽所有</span><span style="color:#999999;"> ip </span><span style="color:#999999;">访问</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">allow</span> <span style="color:#00753b;">all;</span>          <span style="color:#999999;"># </span><span style="color:#999999;">允许所有</span><span style="color:#999999;"> ip </span><span style="color:#999999;">访问</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">deny</span> <span style="color:#a82e2e;">123.0.0.0</span><span style="color:#00753b;">/8;</span>   <span style="color:#999999;"># </span><span style="color:#999999;">屏蔽整个段即从</span><span style="color:#999999;"> 123.0.0.1 </span><span style="color:#999999;">到</span><span style="color:#999999;"> 123.255.255.254 </span><span style="color:#999999;">访问的命令</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">deny</span> <span style="color:#a82e2e;">124.45.0.0</span><span style="color:#00753b;">/16;</span> <span style="color:#999999;"># </span><span style="color:#999999;">屏蔽</span><span style="color:#999999;">IP</span><span style="color:#999999;">段即从</span><span style="color:#999999;"> 123.45.0.1 </span><span style="color:#999999;">到</span><span style="color:#999999;"> 123.45.255.254 </span><span style="color:#999999;">访问的命令</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">deny</span> <span style="color:#a82e2e;">123.45.6.0</span><span style="color:#00753b;">/24;</span> <span style="color:#999999;"># </span><span style="color:#999999;">屏蔽</span><span style="color:#999999;">IP</span><span style="color:#999999;">段即从</span><span style="color:#999999;"> 123.45.6.1 </span><span style="color:#999999;">到</span><span style="color:#999999;"> 123.45.6.254 </span><span style="color:#999999;">访问的命令</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#999999;"># </span><span style="color:#999999;">如果你想实现这样的应用，除了几个</span><span style="color:#999999;">IP</span><span style="color:#999999;">外，其他全部拒绝</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">allow</span> <span style="color:#a82e2e;">1.1.1.1</span><span style="color:#00753b;">;</span> </span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">allow</span> <span style="color:#a82e2e;">1.1.1.2</span><span style="color:#00753b;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#00753b;">deny</span> <span style="color:#00753b;">all;</span> </span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">强制将 http 重定向到 https</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#a82e2e;">server</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">listen</span>       <span style="color:#a82e2e;">80</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_name</span><span style="color:#222222;">  example.com;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">rewrite</span><span style="color:#d96322;"> ^</span><span style="color:#222222;"> https://</span><span style="color:#d96322;">$http_host$request_uri</span><span style="color:#222222;">? </span><span style="color:#8a7304;">permanent</span><span style="color:#222222;">; </span><span style="color:#999999;"># </span><span style="color:#999999;">强制将</span><span style="color:#999999;"> http </span><span style="color:#999999;">重定向到</span><span style="color:#999999;"> https</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">在错误页面和</span><span style="color:#999999;">“</span><span style="color:#999999;">服务器</span><span style="color:#999999;">”</span><span style="color:#999999;">响应头字段中启用或禁用发射</span><span style="color:#999999;">nginx</span><span style="color:#999999;">版本。</span> <span style="color:#999999;">防止黑客利用版本漏洞攻击</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">server_tokens</span> <span style="color:#8a7304;">off</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">代理转发连接替换</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span><span style="color:#d96322;"> ^~/api/upload</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">rewrite</span><span style="color:#d96322;"> ^/(.*)$</span><span style="color:#222222;"> /wfs/v1/upload </span><span style="color:#8a7304;">break</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">proxy_pass</span><span style="color:#222222;"> http://wfs-api;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">将地址 /api/upload 替换为 /wfs/v1/upload</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">爬虫 User-Agent 过滤</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span><span style="color:#222222;"> / {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">if</span><span style="color:#222222;"> (</span><span style="color:#d96322;">$http_user_agent</span> <span style="color:#d96322;">~* "python|curl|java|wget|httpclient|okhttp")</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">return</span> <span style="color:#a82e2e;">503</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># </span><span style="color:#999999;">正常处理</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#999999;"># ...</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">图片防盗链</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span> <span style="color:#d96322;">~* \.(gif|jpg|png|swf|flv)$</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">root</span><span style="color:#222222;"> html;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">valid_referers</span> <span style="color:#8a7304;">none</span> <span style="color:#8a7304;">blocked</span> <span style="color:#d96322;">*.nginx.com</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">if</span><span style="color:#222222;"> (</span><span style="color:#d96322;">$invalid_referer</span><span style="color:#222222;">) {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">rewrite</span><span style="color:#d96322;"> ^/</span><span style="color:#222222;"> www.nginx.cn;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#999999;"># return 404;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">虚拟目录配置</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span><span style="color:#222222;"> /img/ {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">alias</span><span style="color:#222222;"> /var/www/image/;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#999999;"># </span><span style="color:#999999;">访问</span><span style="color:#999999;"> /img/ </span><span style="color:#999999;">目录里面的文件时，</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#999999;"># </span><span style="color:#999999;">会自动去</span><span style="color:#999999;"> /var/www/image/ </span><span style="color:#999999;">目录找文件</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span><span style="color:#222222;"> /img/ {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">root</span><span style="color:#222222;"> /var/www/image;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#999999;"># </span><span style="color:#999999;">访问</span><span style="color:#999999;"> /img/ </span><span style="color:#999999;">目录下的文件时，</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#999999;"># </span><span style="color:#999999;">会去</span><span style="color:#999999;"> /var/www/image/img/ </span><span style="color:#999999;">目录下找文件</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">屏蔽文件目录</span></strong></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">通用备份和归档文件</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span> <span style="color:#d96322;">~* "\.(old|orig|original|php#|php~|php_bak|save|swo|aspx?|tpl|sh|bash|bak?|cfg|cgi|dll|exe|git|hg|ini|jsp|log|mdb|out|sql|svn|swp|tar|rdf)$"</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">deny</span><span style="color:#222222;"> all;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">拒绝访问 .git 和 .svn 目录</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span> <span style="color:#d96322;">~ (.git|.svn)</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">deny</span><span style="color:#222222;"> all;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><span style="color:#222222;">拒绝访问隐藏文件和目录</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span> <span style="color:#d96322;">~ /\.(?!well-known\/)</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">deny</span><span style="color:#222222;"> all;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">防盗图配置</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span> <span style="color:#d96322;">~ \/public\/(css|js|img)\/.*\.(js|css|gif|jpg|jpeg|png|bmp|swf)</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">valid_referers</span> <span style="color:#8a7304;">none</span> <span style="color:#8a7304;">blocked</span> <span style="color:#d96322;">*.jslite.io</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">if</span><span style="color:#222222;"> (</span><span style="color:#d96322;">$invalid_referer</span><span style="color:#222222;">) {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">      <span style="color:#114ba6;">rewrite</span><span style="color:#d96322;"> ^/</span><span style="color:#222222;">  http://wangchujiang.com/piratesp.png;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">  }</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">阻止常见攻击</span></strong></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">base64</span></strong><strong><span style="color:#000000;">编码的网址</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span> <span style="color:#d96322;">~* "(base64_encode)(.*)(\()"</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">deny</span><span style="color:#222222;"> all;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">javascript eval() url</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span> <span style="color:#d96322;">~* "(eval\()"</span><span style="color:#222222;"> {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">    <span style="color:#114ba6;">deny</span><span style="color:#222222;"> all;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">Gzip </span></strong><strong><span style="color:#000000;">配置</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">gzip</span>  <span style="color:#8a7304;">on</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">gzip_buffers</span> <span style="color:#a82e2e;">16</span> <span style="color:#a82e2e;">8k</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">gzip_comp_level</span> <span style="color:#a82e2e;">6</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">gzip_http_version</span> <span style="color:#a82e2e;">1</span><span style="color:#222222;">.</span><span style="color:#a82e2e;">1</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">gzip_min_length</span> <span style="color:#a82e2e;">256</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">gzip_proxied</span><span style="color:#222222;"> any;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">gzip_vary</span> <span style="color:#8a7304;">on</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">gzip_types</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">    text/javascript application/javascript application/x-javascript</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">    text/x-json application/json application/x-web-app-manifest+json</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">    text/css text/plain text/x-component</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">    font/opentype application/x-font-ttf application/vnd.ms-fontobject</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">    image/x-icon;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">gzip_disable</span>  <span style="color:#00753b;">"msie6"</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#FFFFFF;"><strong><span style="color:#000000;">使网站不可索引</span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">add_header</span><span style="color:#222222;"> X-Robots-Tag </span><span style="color:#00753b;">"noindex"</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#114ba6;">location</span><span style="color:#222222;"> = /robots.txt {<!-- --></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;">  <span style="color:#114ba6;">return</span> <span style="color:#a82e2e;">200</span> <span style="color:#00753b;">"User-agent: *\nDisallow: /\n"</span><span style="color:#222222;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#fafafa;"><span style="color:#222222;">}</span></span></p> 
<p style="margin-left:0;text-align:justify;"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/262b23bbb94ad798a5ab20873730eb1c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">@Validated注解不生效问题汇总大全</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d3375dca12b0fbb6fe0ecb9ff0bba452/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">针对mysql批量删除表</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>