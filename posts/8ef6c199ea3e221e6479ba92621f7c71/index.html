<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>知攻善防应急靶场-Linux(1) - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/8ef6c199ea3e221e6479ba92621f7c71/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="知攻善防应急靶场-Linux(1)">
  <meta property="og:description" content="前言： 堕落了三个月，现在因为被找实习而困扰，着实自己能力不足，从今天开始 每天沉淀一点点 ，准备秋招 加油
注意： 本文章参考qax的网络安全应急响应和知攻善防实验室靶场，记录自己的学习过程，还希望各位博主 师傅 大佬 勿喷，还希望大家指出错误
靶场前言： 前景需要：小王急匆匆地找到小张，小王说&#34;李哥，我dev服务器被黑了&#34;,快救救我！！
靶场要求： 1.攻击者IP地址 2.三个flag(flag格式flag{xxxxx}) 过程 ： 1.攻击者IP地址： 这个来说比较好找 方法很多
首先查看本机IP得到为 192.168.122.1
ifconfig 我们使用lastb指令进行查看用户登入错误的登入列表
lastb 可以发现 ip 192.168.85.129 进行多次ssh登入，我们再使用 cat /var/log/secure 指令可以记录大多数的账号密码 以及登入成功与否
cat /var/log/secure 发现该 192.168.75.129 成功登入本机 我们可以继续查看有没有其他的 ip进行登入
查询有哪些IP在爆破命令：
grep &#34;Failed password&#34; /var/log/secure |grep -E -o &#34;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&#34;|uniq -c 发现只有这个IP
统计登录成功的IP有哪些？命令：
grep &#34;Accepted &#34; /var/log/secure | awk &#39;{print $11}&#39; | sort | uniq -c | sort -nr | more 查询管理员最近登录情况命令 grep &#34;">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-24T15:34:54+08:00">
    <meta property="article:modified_time" content="2024-03-24T15:34:54+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">知攻善防应急靶场-Linux(1)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>前言：</h4> 
<blockquote> 
 <p>堕落了三个月，现在因为被找实习而困扰，着实自己能力不足，从今天开始 每天沉淀一点点 ，准备秋招 加油</p> 
</blockquote> 
<h4>注意：</h4> 
<blockquote> 
 <p>本文章参考qax的网络安全应急响应和知攻善防实验室靶场，记录自己的学习过程，还希望各位博主 师傅 大佬 勿喷，还希望大家指出错误</p> 
</blockquote> 
<h4>靶场前言： </h4> 
<blockquote> 
 <p>前景需要：小王急匆匆地找到小张，小王说"李哥，我dev服务器被黑了",快救救我！！</p> 
</blockquote> 
<h4>靶场要求： </h4> 
<pre><code>1.攻击者IP地址
2.三个flag(flag格式flag{xxxxx})
</code></pre> 
<h4>过程 ：</h4> 
<h5>1.攻击者IP地址：</h5> 
<p>这个来说比较好找 方法很多</p> 
<p>首先查看本机IP得到为 192.168.122.1</p> 
<pre><code>ifconfig
</code></pre> 
<p><img alt="" height="176" src="https://images2.imgbox.com/37/b5/aHNRCvFH_o.png" width="692"></p> 
<p>我们使用lastb指令进行查看用户登入错误的登入列表</p> 
<p><img alt="" height="199" src="https://images2.imgbox.com/8b/4e/APGLY7NK_o.png" width="1083"></p> 
<pre><code class="language-java">lastb</code></pre> 
<p><img alt="" height="124" src="https://images2.imgbox.com/b1/03/Ao6NkBmX_o.png" width="670"></p> 
<p>可以发现 ip 192.168.85.129  进行多次ssh登入，我们再使用 cat /var/log/secure 指令可以记录大多数的账号密码 以及登入成功与否</p> 
<pre><code class="language-java">cat /var/log/secure</code></pre> 
<p><img alt="" height="85" src="https://images2.imgbox.com/21/10/7BGciAMV_o.png" width="692"></p> 
<p>发现该 192.168.75.129 成功登入本机 我们可以继续查看有没有其他的 ip进行登入</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">查询有哪些IP在爆破命令：</span></span></p> 
<pre><code class="language-java">grep "Failed password" /var/log/secure |grep -E -o "(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"|uniq -c</code></pre> 
<p><img alt="" height="67" src="https://images2.imgbox.com/ef/95/VKI6Xq0Y_o.png" width="692"></p> 
<p>发现只有这个IP</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">统计登录成功的IP有哪些？命令：</span></span></p> 
<pre><code class="language-java">grep "Accepted " /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more</code></pre> 
<p><img alt="" height="50" src="https://images2.imgbox.com/48/be/LJU7fXCP_o.png" width="692"></p> 
<p><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">查询管理员最近登录情况命令</span></span> </p> 
<pre><code class="language-java"> grep "Accepted " /var/log/secure | awk '{print $1,$2,$3,$9,$11}'</code></pre> 
<p><img alt="" height="57" src="https://images2.imgbox.com/3a/7c/nauZqRKI_o.png" width="692"> 通过这些完全可以确定该攻击者IP就是 192.168.75.129</p> 
<h5>2.寻找flag</h5> 
<p> 我们知道该攻击者已经登入了root用户 ，我们可以在 root账户下排查是否有黑客执行的命令</p> 
<pre><code class="language-java">cd /root
cat .bash_history </code></pre> 
<p>我们发现了第一个flag,还发现了黑客编辑了开机启动文件<code>rc.local</code>，查看一下这个文件 </p> 
<p><img alt="" height="170" src="https://images2.imgbox.com/23/39/4SLooTiJ_o.png" width="595"></p> 
<p>得到第二个flag </p> 
<p><img alt="" height="240" src="https://images2.imgbox.com/e2/7e/H2Yd8KSc_o.png" width="692"> 我们看看攻击者有没有新添什么uid=0的用户</p> 
<pre><code class="language-java">cat /etc/passwd</code></pre> 
<p><img alt="" height="185" src="https://images2.imgbox.com/24/4b/jdMqfi8n_o.png" width="692"></p> 
<p>最后一个用户是<code>redis</code>用户，说明该机器上存在<code>redis</code>服务 使用下面指令发现确实存在</p> 
<p><img alt="" height="36" src="https://images2.imgbox.com/06/75/Hidi7lMM_o.png" width="692"></p> 
<p>那我们就可以查看redis的日志了</p> 
<pre><code class="language-java">cat redis.log-20240324 </code></pre> 
<p><img alt="" height="94" src="https://images2.imgbox.com/c3/c7/75aDJz3u_o.png" width="692"></p> 
<p>发现确实 192.168.75.129 成功进行登入，那结合之前的ssh爆破登入就可以得到该攻击者是通过写入ssh密钥进行登录，然后通过写入开机启动文件进行权限维持。 我们可以查看linux的敏感目录</p> 
<p> 果然是这样的 ，通过<code>redis</code>未授权写入ssh密钥进行登录<img alt="" height="136" src="https://images2.imgbox.com/47/fd/T8JmwuGD_o.png" width="692"></p> 
<p>那我们就可以检查命令文件是否被替换</p> 
<pre><code class="language-java">rpm -Vf /usr/bin/*
rpm -Vf /usr/sbin/*
#rpm -Vf /usr/bin/xxx
#S 关键字代表文件大小发生了变化
#5 关键字代表文件的 md5 值发生了变化
#T 代表文件时间发生了变化
</code></pre> 
<p><img alt="" height="157" src="https://images2.imgbox.com/24/f0/7eda5n1q_o.png" width="579"></p> 
<p>得到 /etc/redis.conf文件被修改了 我们访问得到第三个flag</p> 
<p><img alt="" height="194" src="https://images2.imgbox.com/e4/8c/Jx4F45mX_o.png" width="717"></p> 
<h4>提交 ：</h4> 
<p><img alt="" height="444" src="https://images2.imgbox.com/80/11/StXqZj1X_o.png" width="692"></p> 
<h4>总结 ：</h4> 
<blockquote> 
 <p>1.该攻击者IP为 192.168.75.129</p> 
 <p>2.攻击获得root时间为3月 18日 20：23：07</p> 
 <p>3.攻击用户：root用户</p> 
 <p>4.攻击方式：通过<code>redis</code>未授权写入ssh密钥进行登录</p> 
 <p>5.攻击者编辑了开机启动文件/etc/rc.d<strong>/<code>rc.local,并修改了</code></strong> /etc/redis.conf ，但攻击者并没有留下后门</p> 
</blockquote> 
<h4>清除加固 ：</h4> 
<blockquote> 
 <p>1.封禁该IP </p> 
 <p>2.redis服务端要以root权限运行</p> 
 <p>3.更改服务器ssh默认端口。</p> 
 <p>4.修复/etc/redis.conf文件和删除/etc/rc.d<strong>/<code>rc.local文件</code></strong></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/06432ddd0b0826a6f380643d7437424c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">go的限流</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/699d0607f4a0bd3c17a180231a761e57/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于SSM&#43;Jsp&#43; sqlserver的学校访客登记系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>