<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于使用ggplot2作多组双条件的小提琴图＋箱线图 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/dc16df2d49ead60dd41be6f25902d2e3/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="关于使用ggplot2作多组双条件的小提琴图＋箱线图">
  <meta property="og:description" content="0.使用的R包
library(&#34;readxl&#34;)
library(&#34;dplyr&#34;)
library(&#34;ggplot2&#34;)
library(&#34;ggthemes&#34;)
1.处理的数据
我们这里处理的数据是两到三列的数据框，每个组（基因）需要有两个condition（多个也行）对应。我们这里画的图是polyA的长度。
2.使用ggplot2作图
p &amp;lt;- ggplot(total_gene_data, aes(gene, lena, fill = condition)) &#43; ###aes后面是x，y轴的值
geom_violin(aes(fill = condition),width = 0.7, scale = &#34;width&#34;, size = 0.8) ###width参数设为0.7,
加上箱线图
p &amp;lt;- ggplot(total_gene_data, aes(gene, lena, fill = condition)) &#43;
geom_violin(aes(fill = condition),width = 0.7, scale = &#34;width&#34;, size = 0.8) &#43;
geom_boxplot(width = 0.2, position = position_dodge(0.7), ###position调整会对不齐
outlier.shape = NA, cex = 0.8) ###NA这里不画出离群值
自定义颜色 —— —— 使用 scale_fill_manual">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-09-23T12:32:41+08:00">
    <meta property="article:modified_time" content="2023-09-23T12:32:41+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于使用ggplot2作多组双条件的小提琴图＋箱线图</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong> 0.使用的R包</strong></p> 
<blockquote> 
 <p>library("readxl")<br> library("dplyr")<br> library("ggplot2")<br> library("ggthemes")</p> 
</blockquote> 
<p><strong> 1.处理的数据</strong></p> 
<p>我们这里处理的数据是两到三列的数据框，每个组（基因）需要有两个condition（多个也行）对应。我们这里画的图是polyA的长度。</p> 
<p><img alt="" height="769" src="https://images2.imgbox.com/20/0b/4sYYIz76_o.png" width="617"></p> 
<p><strong>2.使用ggplot2作图</strong></p> 
<blockquote> 
 <p>p &lt;- ggplot(total_gene_data, aes(gene, lena, fill = condition)) +      ###aes后面是x，y轴的值<br>   geom_violin(aes(fill = condition),width = 0.7, scale = "width", size = 0.8)   </p> 
 <p> ###width参数设为0.7,</p> 
</blockquote> 
<p><img alt="" height="756" src="https://images2.imgbox.com/fe/2e/Mp6f58Ce_o.png" width="1200"></p> 
<p></p> 
<p><strong>加上箱线图</strong></p> 
<blockquote> 
 <p> p &lt;- ggplot(total_gene_data, aes(gene, lena, fill = condition)) +<br>   geom_violin(aes(fill = condition),width = 0.7, scale = "width", size = 0.8) +<br>   geom_boxplot(width = 0.2, position = position_dodge(0.7),          ###position调整会对不齐<br>                outlier.shape = NA, cex = 0.8)                                          ###NA这里不画出离群值</p> 
</blockquote> 
<p><img alt="" height="761" src="https://images2.imgbox.com/2c/1a/RVZAyTI6_o.png" width="1200"></p> 
<p></p> 
<p><strong>自定义颜色 —— —— 使用</strong> scale_fill_manual</p> 
<blockquote> 
 <p>p &lt;- ggplot(total_gene_data, aes(gene, lena, fill = condition)) +<br>   geom_violin(aes(fill = condition),width = 0.7, scale = "width", size = 0.8) +<br>   geom_boxplot(width = 0.2, position = position_dodge(0.7),  <br>                outlier.shape = NA, cex = 0.8) +<br>   scale_fill_manual(values = c("#0255E8", "#E81D22"))</p> 
</blockquote> 
<p><img alt="" height="758" src="https://images2.imgbox.com/c3/3c/xLRAKnKn_o.png" width="1200"></p> 
<p></p> 
<p><strong>添加显著性***号</strong></p> 
<blockquote> 
 <p>p &lt;- p + stat_compare_means(aes(condition = condition),                 #按分组进行统计检验<br>                             method = "t.test",                            #非配对t检验<br>                             symnum.args = list(cutpoint=c(0,0.0005,0.005,0.05,1),<br>                                                symbols=c("***","**","*", NA)),<br>                             label = "p.signif",<br>                             label.y = location$lena + 4,                                   #添加显著性符号的位置<br>                             size= 8)</p> 
</blockquote> 
<p><img alt="" height="894" src="https://images2.imgbox.com/26/c1/5F0iFvWj_o.png" width="1200"></p> 
<p></p> 
<p><strong>加上背景</strong></p> 
<blockquote> 
 <p><strong>p &lt;- p + theme_bw()+<br>   theme(panel.grid.major=element_blank(),<br>         panel.grid.minor=element_blank(),                 <br>         axis.text.x = element_text(angle=60,size=16,vjust = 1,hjust =1,family = "Bangers", color = "black", face = "bold"),                                                   <br>         axis.text.y = element_text(size =16, face = "bold", family = "Bangers", color = "black"),<br>         axis.title.y = element_text(size = 20, color = "black", face = "bold.italic"),<br>         legend.text = element_text(size = 15, family = "Playfair"),<br>         legend.title = element_blank())</strong></p> 
</blockquote> 
<p><img alt="" height="881" src="https://images2.imgbox.com/6c/5b/7FjNeecs_o.png" width="1200"></p> 
<p></p> 
<p>这个时候图差不多花完了，但是效果可能不太好，因为箱线图和小提琴图是一样的颜色，如果两者都需要自定义颜色，实现起来难度很大。因为ggplot2里面自定义两者的颜色是同一个函数。本人仅成功过将箱线图改成白色。</p> 
<blockquote> 
 <p>p &lt;- ggplot(total_gene_data, aes(gene, lena, fill = condition)) +<br>   geom_violin(aes(fill = condition),width = 0.7, scale = "width", size = 0.8) +<br>   geom_boxplot(aes(fill = "white", colour = condition), width = 0.2, position = position_dodge(0.7),<br>                outlier.shape = NA, cex = 0.8) +<br>   scale_fill_manual(values = c("#0255E8", "#E81D22","white")) +<br>   scale_colour_manual(values = c("black", "black"))+<br>   theme(legend.title = element_blank())+<br>   theme_classic(base_size = 20)+<br>   ##geom_jitter(aes(fill = condition), shape = 21, position = position_jitterdodge(dodge.width = 0.9))+<br>   labs(title = NULL, x = NULL, y = "Poly(A) length", ) </p> 
</blockquote> 
<p></p> 
<p>这样唯一的缺点是旁边的图例会出现问题，手动删掉即可。 </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9edfd89c07578197a7aa5dfad2dddbb7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java高级之多线程基本概念及其优点、创建线程的2种方式、解决线程安全的3种方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e4c146f0da3ed8156805356fed39132d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于springboot框架的智慧社区家政服务系统的设计与实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>