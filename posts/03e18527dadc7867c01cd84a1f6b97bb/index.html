<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ggplot2设置坐标轴范围_ggplot2|详解八大基本绘图要素 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/03e18527dadc7867c01cd84a1f6b97bb/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="ggplot2设置坐标轴范围_ggplot2|详解八大基本绘图要素">
  <meta property="og:description" content="本文首发于微信公众号“ 生信补给站 ”，期待您的关注！！！ &#34;一张统计图形就是从数据到几何对象(geometric object, 缩写为geom, 包括点、线、条形等)的图形属性(aesthetic attributes, 缩写为aes, 包括颜色、形状、大小等)的一个映射。此外, 图形中还可能包含数据的统计变换(statistical transformation, 缩写为stats), 最后绘制在某个特定的坐标系(coordinate system, 缩写为coord)中, 而分面(facet, 指将绘图窗口划分为若干个子窗口)则可以用来生成数据中不同子集的图形。&#34; ​ ----- Hadley Wickham 一 ggplot2 背景介绍 ggplot2是由Hadley Wickham创建的一个十分强大的可视化R包。按照ggplot2的绘图理念，Plot(图)= data(数据集)&#43; Aesthetics(美学映射)&#43; Geometry(几何对象)。本文将从ggplot2的八大基本要素逐步介绍这个强大的R可视化包。
数据（Data）和映射（Mapping）几何对象（Geometric）标尺（Scale）统计变换（Statistics）坐标系统（Coordinante）图层（Layer）分面（Facet）主题（Theme） 二 数据(data) 和 映射（Mapping） 数据：用于绘制图形的数据，本文主要使用经典的mtcars数据集和diamonds数据集子集为例来画图。
#install.packages(&#34;ggplot2&#34;) library(ggplot2) data(diamonds) set.seed(1234) diamond &amp;lt;- diamonds[sample(nrow(diamonds), 2000), ] head(diamond) 映射：aes()函数是ggplot2中的映射函数, 所谓的映射即为数据集中的数据关联到相应的图形属性过程中一种对应关系, 图形的颜色，形状，分组等都可以通过通过数据集中的变量映射。
#使用diamonds的数据子集作为绘图数据，克拉(carat)数为X轴变量，价格(price)为Y轴变量。
p &amp;lt;- ggplot(data = diamond, mapping = aes(x = carat, y = price)) #将钻石的颜色（color）映射颜色属性：
p &amp;lt;- ggplot(data=diamond, mapping=aes(x=carat, y=price, shape=cut, colour=color))p&#43;geom_point() #绘制点图 #将钻石的切工（cut）映射到形状属性：">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-11-20T06:57:46+08:00">
    <meta property="article:modified_time" content="2020-11-20T06:57:46+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ggplot2设置坐标轴范围_ggplot2|详解八大基本绘图要素</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/f2/f6/qFxvd4g2_o.png" alt="725d7fda0d6b16ed76882b4a9e7061bb.png"> 
 </div> 
 <blockquote> 
  <i>本文首发于微信公众号<b>“ 生信补给站 ”</b>，期待您的关注！！！</i> 
  <br> "一张统计图形就是从数据到几何对象(geometric object, 缩写为geom, 包括点、线、条形等)的图形属性(aesthetic attributes, 缩写为aes, 包括颜色、形状、大小等)的一个映射。此外, 图形中还可能包含数据的统计变换(statistical transformation, 缩写为stats), 最后绘制在某个特定的坐标系(coordinate system, 缩写为coord)中, 而分面(facet, 指将绘图窗口划分为若干个子窗口)则可以用来生成数据中不同子集的图形。" 
  <br> ​ ----- Hadley Wickham 
 </blockquote> 
 <h4>一 ggplot2 背景介绍</h4> 
 <p><b>ggplot2</b>是由<b>Hadley Wickham</b>创建的一个十分强大的可视化R包。按照<b>ggplot2</b>的绘图理念，Plot(图)= data(数据集)+ Aesthetics(美学映射)+ Geometry(几何对象)。本文将从ggplot2的八大基本要素逐步介绍这个强大的R可视化包。</p> 
 <ul><li>数据（Data）和映射（Mapping）</li><li>几何对象（Geometric）</li><li>标尺（Scale）</li><li>统计变换（Statistics）</li><li>坐标系统（Coordinante）</li><li>图层（Layer）</li><li>分面（Facet）</li><li>主题（Theme）</li></ul> 
 <h4>二 数据(data) 和 映射（Mapping）</h4> 
 <p><b>数据：</b>用于绘制图形的数据，本文主要使用经典的mtcars数据集和diamonds数据集子集为例来画图。</p> 
 <div class="has"> 
  <pre><code>#install.packages("ggplot2")
library(ggplot2)
data(diamonds)
set.seed(1234)
diamond &lt;- diamonds[sample(nrow(diamonds), 2000), ]
head(diamond)</code></pre> 
 </div> 
 <p><b>映射：aes()</b>函数是ggplot2中的映射函数, 所谓的映射即为数据集中的数据关联到相应的图形属性过程中一种对应关系, 图形的颜色，形状，分组等都可以通过通过数据集中的变量映射。</p> 
 <p>#使用diamonds的数据子集作为绘图数据，克拉(carat)数为X轴变量，价格(price)为Y轴变量。</p> 
 <div class="has"> 
  <pre><code>p &lt;- ggplot(data = diamond, mapping = aes(x = carat, y = price))</code></pre> 
 </div> 
 <p>#将钻石的颜色（color）映射<b>颜色</b>属性：</p> 
 <div class="has"> 
  <pre><code>p &lt;- ggplot(data=diamond, mapping=aes(x=carat, y=price, shape=cut, colour=color))p+geom_point() #绘制点图</code></pre> 
 </div> 
 <p>#将钻石的切工（cut）映射到<b>形状</b>属性：</p> 
 <div class="has"> 
  <pre><code>p &lt;- ggplot(data=diamond, mapping=aes(x=carat, y=price, shape=cut))p+geom_point() #绘制点图</code></pre> 
 </div> 
 <p>#将钻石的切工（cut）映射到<b>分组</b>属性：</p> 
 <div class="has"> 
  <pre><code>#默认分组设置, 即group=1p + geom_boxplot()
#分组(group)也是ggplot2种映射关系的一种, 如果需要把观测点按额外的离散变量进行分组处理, 必须修改默认的分组设置。
p1 &lt;- ggplot(data=diamond, mapping=aes(x=carat, y=price, group=factor(cut)))
p1 + geom_boxplot()</code></pre> 
 </div> 
 <p>注意：不同的几何对象，要求的属性会有些不同，这些属性也可以在几何对象映射时提供，以下语法与上面的aes中是一样的。</p> 
 <div class="has"> 
  <pre><code>#结果与上述一致
ggplot(data = diamond)+geom_point(aes(x=carat, y=price, colour=color))
ggplot(data = diamond) +geom_point(aes(x=carat, y=price, shape=cut))
ggplot(data = diamond) +geom_boxplot(aes(x=carat, y=price, group=factor(cut)))
ggplot(data = diamond) +geom_point(aes(x=carat, y=price, colour=color,shape=cut))</code></pre> 
 </div> 
 <p><b>注：ggplot2支持图层，可以把不同的图层中共用的映射提供给ggplot函数，而某一几何对象才需要的映射参数提供给geom_xxx函数。</b></p> 
 <h4>三 几何对象（Geometric）</h4> 
 <p><b>几何对象</b>代表我们在图中实际看到的图形元素，如点、线、多边形等。数据与映射部分介绍了ggplot函数执行各种属性映射，只需要添加不同的几何对象图层，即可绘制出相应的图形。</p> 
 <p>此处介绍几种常用的几何对象，geom_histogram用于直方图，geom_bar用于画柱状图，geom_boxplot用于画箱式图等。</p> 
 <h4>直方图</h4> 
 <p><b>单变量连续变量</b>：可绘制直方图展示，提供一个连续变量，画出数据的分布。</p> 
 <p>#以价格（price）变量为例，且按照不同的切工填充颜色</p> 
 <div class="has"> 
  <pre><code>ggplot(diamond)+geom_histogram(aes(x=price, fill=cut))</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/5d/79/Pl0aFtI0_o.png" alt="e16ba8064e67c6b87d6b7aa1c8ba1ae2.png"> 
 </div> 
 <p>#设置position="dodge"，side-by-side地画直方图</p> 
 <div class="has"> 
  <pre><code>ggplot(diamond)+geom_histogram(aes(x=price, fill=cut), position="dodge")</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/da/55/2FyCTpG3_o.png" alt="1e1a3ed7f2d687e558fc1e2ced2d52c5.png"> 
 </div> 
 <p>#设置使用position="fill"，按相对比例画直方图</p> 
 <div class="has"> 
  <pre><code>ggplot(diamond)+geom_histogram(aes(x=price, fill=cut), position="fill")</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/8e/3a/GXSRa7lS_o.png" alt="fc7415eb7547317e2dd21afa7946bdf9.png"> 
 </div> 
 <h4>柱状图</h4> 
 <p><b>单变量分类变量</b>：可使用柱状图展示，提供一个x分类变量，画出数据的分布。</p> 
 <p>#以透明度（clarity）变量为例，且按照不同的切工填充颜色，柱子的高度即为此分类下的数目。</p> 
 <p>ggplot(diamond)+geom_bar(aes(x=clarity, fill=cut))</p> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/38/0e/aeFwpuXU_o.png" alt="0524aab6ac01205f2835e0c6752d84d7.png"> 
 </div> 
 <p><b>注：ggplot2会通过x变量自动计算各个分类的数目。</b></p> 
 <p>#直接指定个数，需要通过stat参数，指定geom_bar按特定高度画图</p> 
 <div class="has"> 
  <pre><code>ggplot()+geom_bar(aes(x=c(LETTERS[1:5]),y=1:5), stat="identity")</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/a0/bf/N2aEXn1s_o.png" alt="84ae9347a9582f95cc8b902726a6939f.png"> 
 </div> 
 <p>区分与联系：</p> 
 <p>直方图把连续型的数据按照一个个等长的分区（bin）切分，然后计数画柱形图。</p> 
 <p>柱状图是把分类数据，按类别计数。</p> 
 <h4>箱式图</h4> 
 <p>箱线图通过绘制观测数据的五数总括，即最小值、下四分位数、中位数、上四分位数以及最大值，描述了变量值的分布情况。同时箱线图能够显示出离群点（outlier），通过箱线图能够很容易识别出数据中的异常值。</p> 
 <p>#按切工(cut)分类，对价格(price)变量画箱式图，再按照color变量分别填充颜色。</p> 
 <div class="has"> 
  <pre><code>ggplot(diamond,aes(x=cut, y=price,fill=color))+geom_boxplot()ggplot(diamond)+geom_boxplot(aes(x=cut, y=price,fill=color))</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/d7/a7/JyMw4Eu5_o.png" alt="44711ec7094ab9eb6be3cf4e181acaee.png"> 
 </div> 
 <p><b>以上可见，通过映射和几何对象就可以将数据集中的变量数值变成几何图形以及几何图形的各种图形元素。</b></p> 
 <p>注：每一种几何对象所能涉及的aes()类型有区别，在绘制对应对象的时候，要注意选择正确的映射方式，以下仅供参考：</p> 
 <h4>四、标尺（Scale）</h4> 
 <p>在对图形属性进行映射之后，使用标尺可以控制这些属性的显示方式，比如坐标刻度，颜色属性等。</p> 
 <p>ggplot2的scale系列函数有很多，命名和用法是有一定规律的。一般使用三个单词用_连接，如scale_fill_gradient和 scale_x_continuous，</p> 
 <ul><li>第一个都是scale</li><li>第二个是color fill x y linetype shape size等可更改的参数</li><li>第三个是具体的类型</li></ul> 
 <p>此处仅介绍<b>颜色设置</b>和<b>坐标轴设置</b>函数的一些用法，其他类似。</p> 
 <h4>1 颜色标尺设置（color fill）</h4> 
 <h4>1.1 颜色标尺“第二个”单词选择方法</h4> 
 <p>颜色的函数名第二个单词有color和fill两个，对应分组使用的颜色函数即可。</p> 
 <p>比如柱状图，fill是柱子的填充颜色，这时就使用scale_fill系列函数来更改颜色。</p> 
 <p>比如点图使用color分组，则使用scale_color_系列函数来更改颜色。</p> 
 <h4>1.2 颜色标尺“第三个”单词选择方法</h4> 
 <p>根据第三个单词的不同，更换的颜色分为以下几种</p> 
 <p>1）离散型：在颜色变量是离散变量的时候使用，比如分类时每一类对应一种颜色</p> 
 <ul><li>manual 直接指定分组使用的颜色</li><li>hue 通过改变色相（hue）饱和度（chroma）亮度（luminosity）来调整颜色</li><li>brewer 使用ColorBrewer的颜色</li><li>grey 使用不同程度的灰色</li></ul> 
 <p>2）连续型：颜色变量是连续变量的时候使用，比如0-100的数，数值越大颜色越深这样</p> 
 <ul><li>gradient 创建渐变色</li><li>distiller 使用ColorBrewer的颜色</li><li>identity 使用color变量对应的颜色，对离散型和连续型都有效</li></ul> 
 <h4>1.3 更改离散型变量的颜色函数</h4> 
 <p>#数据，映射以及几何对象</p> 
 <div class="has"> 
  <pre><code>p &lt;- ggplot(diamond, aes(color))+geom_bar(aes(fill=cut)) #左上</code></pre> 
 </div> 
 <p><b>manual 直接指定分组使用的颜色</b></p> 
 <p>#values参数指定颜色</p> 
 <div class="has"> 
  <pre><code>#直接指定颜色 （右上）
p + scale_fill_manual(values=c("red", "blue", "green","yellow","orange"))
#对应分组指定 （左下）
p + scale_fill_manual(values=c("Fair" = "red", "Good" = "blue", "Very Good" = "green" , Premium = "orange", Ideal = "yellow"))
#更改图例名字,对应指定并更改图例标签 （右下）
p + scale_fill_manual("class", values=c("red", "blue", "green","yellow","orange"),                       breaks = c("Fair", "Good", "Very Good","Premium","Ideal"),                       labels = c("一般", "好", "很好", "高级", "理想"))</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/3a/f0/AWVUkh6X_o.png" alt="e9789caefd97d97e18e1568b9f06a561.png"> 
 </div> 
 <p><b>brewer 使用ColorBrewer的颜色</b></p> 
 <p>#palette参数调用色板</p> 
 <div class="has"> 
  <pre><code>library(RColorBrewer)
#主要是palette参数调用色板
p + scale_fill_brewer() 
# 默认使用Blues调色板中的颜色（左）
p + scale_fill_brewer(palette = "Greens") 
#使用Greens调色板中的颜色 （右）
p + scale_fill_brewer(palette = "Greens",direction = -1)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/2b/f2/iQ4KxWfF_o.png" alt="24ef44285179437f250146f421f6e923.png"> 
 </div> 
 <p><b>grey 使用不同程度的灰色</b></p> 
 <p>#通过start end 两个参数指定，0为黑，1为白，都在0-1范围内</p> 
 <div class="has"> 
  <pre><code>p + scale_fill_grey()  
# 左图
#设定灰度范围
p + scale_fill_grey(start=1, end=0)  
# 右图
p + scale_fill_grey(start=1, end=0.5)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/60/e2/xJAAy8Bp_o.png" alt="8c73587706f377314f652ef9d201258a.png"> 
 </div> 
 <h4>1.4 更改连续型变量的颜色函数</h4> 
 <p>#构建数据集</p> 
 <div class="has"> 
  <pre><code>df &lt;- data.frame(x = runif(100),y = runif(100),z1 = rnorm(100))
p &lt;- ggplot(df, aes(x, y)) + geom_point(aes(colour = z1))</code></pre> 
 </div> 
 <p><b>gradient 创建渐变色</b>#参数设定节点颜色</p> 
 <div class="has"> 
  <pre><code>#设置两端颜色p + scale_color_gradient(low = "white", high = "black")
#设置中间过渡色
p + scale_color_gradient2(low = "red", mid = "white", high = "blue")
#使用R预设调色板
p + scale_color_gradientn(colours =rainbow(10))
#legeng展示指定标签
p + scale_color_gradient(low = "white", high = "black",                        breaks=c(1,2,0.5),  labels=c("a","b","c"))
#legend名称
p + scale_color_gradient("black", low = "white", high = "black",                           limits=c(0.5,2))</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/fb/fd/1Zumb4jx_o.png" alt="880d03cd90285f11cac85cf65cc5a75c.png"> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/09/59/ZgqeWqBK_o.png" alt="7e164812c1ee5f27d302641d12cd11d8.png"> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/0e/57/armvfUJI_o.png" alt="80e495cacc7363ed2641b9aaaa55b083.png"> 
 </div> 
 <p><b>distiller 使用ColorBrewer的颜色</b></p> 
 <p>#将ColorBrewer的颜色应用到连续变量上</p> 
 <div class="has"> 
  <pre><code>p + scale_color_distiller(palette = "Spectral")
p + scale_color_distiller(palette = "Greens")</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/4a/e0/MCGk4PeR_o.png" alt="dfc0f1ec81c9be5b0bb8fe916a121171.png"> 
 </div> 
 <h4>2 坐标轴标尺修改（x , y）</h4> 
 <p>本部分主要是对坐标轴做如下改变，</p> 
 <ul><li>更改坐标轴名称</li><li>更改x轴上标数的位置和内容</li><li>显示对一个轴做统计变换</li><li>只展示一个区域内的点</li><li>更改刻度标签的位置</li></ul> 
 <p>实现上面的这些可以使用scale_x等函数，同时像xlab这样的函数实现其中某一方面的功能，但是用起来更加方便</p> 
 <p>因为这里的数据也有连续和离散之分，所以也要使用不同的函数来实现。</p> 
 <div class="has"> 
  <pre><code># 横坐标是离散变量，纵坐标是连续变量
p &lt;- ggplot(mtcars, aes(factor(cyl), mpg)) + geom_point()
# 更改坐标轴名称
p + scale_x_discrete("cyl")
# 更改横轴标度
p + scale_x_discrete(labels = c("4"="a","6"="b","8"="c"))
# 指定横轴顺序以及展示部分
p + scale_x_discrete(limits=c("6","4"))</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/57/cc/OrTbvye7_o.png" alt="9d276572c2de5479f2c5b9815d4c2a8e.png"> 
 </div> 
 <div class="has"> 
  <pre><code># 连续变量可以更改标度（图与上相似，略）
p + scale_y_continuous("ylab_mpg")p + scale_y_continuous(breaks = c(10,20,30))
p + scale_y_continuous(breaks = c(10,20,30), labels=scales::dollar)
p + scale_y_continuous(limits = c(10,30))
# 连续变量可以更改标度，还可以进行统计变换
p + scale_y_reverse() # 纵坐标翻转，小数在上面，大数在下面
p + scale_y_log10()
p + scale_y_continuous(trans = "log10")
p + scale_y_sqrt()
# 更改刻度标签的位置
p + scale_x_discrete(position = "top") +  scale_y_continuous(position = "right")</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/ab/ac/ZjR7GrWL_o.png" alt="c8d03b44579effc88ab0199ef5e82ae1.png"> 
 </div> 
 <p>注：除使用scale参数进行设置外，后面会介绍使用更简单易用的函数。</p> 
 <h4>五 统计变换（Statistics）</h4> 
 <p>ggplot2提供了多种统计变换方式，此处介绍两种较常用的。</p> 
 <h4>1 stat_summary</h4> 
 <p>要求数据源的y能够被分组，每组不止一个元素, 或增加一个分组映射，即aes(x= , y = , group = )</p> 
 <div class="has"> 
  <pre><code>library(Hmisc)
g &lt;- ggplot(mtcars,aes(cyl, mpg)) + geom_point()
#mean_cl_bool对mpg进行运算，返回均值，最大值，最小值；其他可用smean.cl.normal,smean.sdl,smedian.hilow。
g + stat_summary(fun.data = "mean_cl_boot", color = "red", size = 2)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/4c/8a/z1IQ9J0W_o.png" alt="6cb0b525f03276f0852a23014c408f6b.png"> 
 </div> 
 <p>#fun.y 对y的汇总函数，返回单个数字，y通常会被分组汇总后每组返回1个数字</p> 
 <div class="has"> 
  <pre><code>g + stat_summary(fun.y = "mean", color = "red", size = 2, geom = "point") # 计算各组均值</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/9d/11/rY3xF3lf_o.png" alt="263bee5aaf4466ba93906b93b6195258.png"> 
 </div> 
 <p># 增加1组颜色变量映射，然后求均值并连线</p> 
 <div class="has"> 
  <pre><code>g + aes(color = factor(vs)) + stat_summary(fun.y = mean, geom = "line")</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/d6/6d/n6m5loAH_o.png" alt="a4580b20801b15492f227472350ae113.png"> 
 </div> 
 <p>#fun.ymax 表示取y的最大值，输入数字向量，每组返回1个数字</p> 
 <div class="has"> 
  <pre><code>g + stat_summary(fun.y = mean, fun.ymin = min, fun.ymax = max, color = "red") # 计算各组均值，最值</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/58/7f/ThxhW3mt_o.png" alt="e39eca973cd82269e2608bbc31fb6497.png"> 
 </div> 
 <h4>2 stat_smooth</h4> 
 <p>对原始数据进行某种统计变换计算，然后在图上表示出来，例如对散点图上加一条回归线。</p> 
 <p>#添加默认曲线</p> 
 <p>#method 表示指定平滑曲线的统计函数，如lm线性回归, glm广义线性回归, loess多项式回归, gam广义相加模型(mgcv包), rlm稳健回归(MASS包)</p> 
 <div class="has"> 
  <pre><code>ggplot(mpg, aes(displ, hwy)) +geom_point() +stat_smooth()
ggplot(mpg, aes(displ, hwy)) +geom_point() +geom_smooth() +stat_smooth(method = lm, se = TRUE)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/69/94/qHrlhuF5_o.png" alt="2e4deb679564f55cf74942dd39de0b95.png"> 
 </div> 
 <p>#formula 表示指定平滑曲线的方程，如 y~x, y~poly(x, 2), y~log(2) ，需要与method参数搭配使用</p> 
 <div class="has"> 
  <pre><code>ggplot(mpg, aes(displ, hwy)) +geom_point() +stat_smooth(method = lm, formula = y ~ splines::bs(x, 3), se = FALSE)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/cf/1a/65Es8J3R_o.png" alt="b8b931b9d14a12fb9065b6fb9c44a696.png"> 
 </div> 
 <p>#se 表示是否显示平滑曲线的置信区间，默认TRUE显示；level = 0.95</p> 
 <div class="has"> 
  <pre><code>ggplot(mpg, aes(displ, hwy, color = class))  + geom_point() + stat_smooth(se = FALSE, method = lm)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/87/cf/ZLu0f1kx_o.png" alt="04a0491b0b6f27b44604691dac59f3e2.png"> 
 </div> 
 <p>注：以下为ggplot2提供的其他统计变换方式，也可以自己写函数基于原始数据进行计算。</p> 
 <div class="has"> 
  <pre><code>stat_abline       stat_contour      stat_identity     stat_summarystat_bin          stat_density      stat_qq           stat_summary2dstat_bin2d        stat_density2d    stat_quantile     stat_summary_hexstat_bindot       stat_ecdf         stat_smooth       stat_uniquestat_binhex       stat_function     stat_spoke        stat_vlinestat_boxplot      stat_hline        stat_sum          stat_ydensity</code></pre> 
 </div> 
 <h4>六 坐标系统（Coordinante）</h4> 
 <p>坐标系统控制坐标轴，可以进行变换，例如XY轴翻转，笛卡尔坐标和极坐标转换，以满足我们的各种需求。</p> 
 <h4>1 coord_flip()实现坐标轴翻转</h4> 
 <div class="has"> 
  <pre><code>ggplot(diamond)+geom_bar(aes(x=cut, fill=cut))+coord_flip()</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/0f/5e/OpbhduzR_o.png" alt="1b67e8e73e0515de000f755bb3eeff75.png"> 
 </div> 
 <h4>2 coord_polar()实现极坐标转换</h4> 
 <p>#靶心图</p> 
 <div class="has"> 
  <pre><code>ggplot(diamond)+geom_bar(aes(x=factor(1), fill=cut))+coord_polar()</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/ed/fe/IZe5QuGT_o.png" alt="ac76278e543e5b5a268fbb67135d06e7.png"> 
 </div> 
 <p>#饼图</p> 
 <div class="has"> 
  <pre><code>ggplot(diamond)+geom_bar(aes(x=factor(1), fill=cut))+coord_polar(theta="y")</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/77/e8/lgIdDGb8_o.png" alt="c20ffd13fc304a91c23c34fe036425d5.png"> 
 </div> 
 <p>#风玫瑰图(windrose)</p> 
 <div class="has"> 
  <pre><code>ggplot(diamond)+geom_bar(aes(x=clarity, fill=cut))+coord_polar()</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/ba/d4/0Uz28AvL_o.png" alt="7209fa8fc63874d2726456a8699a8660.png"> 
 </div> 
 <h4>七 图层（Layer）</h4> 
 <p>ggplot的强大之处在于直接使用+号即可实现叠加图层，前面散点图添加拟合曲线即为图层叠加。</p> 
 <div class="has"> 
  <pre><code>ggplot(mpg, aes(displ, hwy)) +geom_point() +geom_smooth() +stat_smooth(method = lm, se = TRUE)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/0c/46/OrV23cLZ_o.png" alt="eec106cec4b15460cbbb3ca84cd4b4ea.png"> 
 </div> 
 <p>ggplot函数可以设置数据和映射，每个图层设置函数（geom_xxx和stat_xxx）也都可以设置数据和映射，这虽然便利，但也可能产生一些混乱。</p> 
 <p>ggplot2的图层设置函数对映射的数据类型是有较严格要求的，比如geom_point和geom_line函数要求x映射的数据类型为数值向量，而geom_bar函数要使用因子型数据。如果数据类型不符合映射要求就得做类型转换，在组合图形时还得注意图层的先后顺序。</p> 
 <h4>八 分面（Facet）</h4> 
 <p>分面设置在ggplot2应该也是要经常用到的一项画图内容，在数据对比以及分类显示上有着极为重要的作用，</p> 
 <p><b>facet_wrap 和 facet_grid</b>是两个经常要用到的分面函数。</p> 
 <p><b>1 facet_wrap</b>：基于一个因子进行设置，形式为：~变量（~单元格）</p> 
 <p>#cyl变量进行分面</p> 
 <div class="has"> 
  <pre><code>p&lt;-ggplot(mtcars,aes(mpg,hp))+geom_point()p+facet_wrap(~cyl)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/8c/61/K9OVHcyV_o.png" alt="013ab0f09c3133e60c5965cbee7f100e.png"> 
 </div> 
 <p>#每个分面单独的坐标刻度，单独对x轴设置 #scales参数fixed表示固定坐标轴刻度，free表示反馈坐标轴刻度，也可以单独设置成free_x或free_y</p> 
 <div class="has"> 
  <pre><code>p+facet_wrap(~cyl,scales="free")</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/eb/d0/CxUhAfuR_o.png" alt="b2ad53075c6694a25e9fe4a379b72243.png"> 
 </div> 
 <p>#每个分面单独的坐标刻度，单独对y轴设置 #nrow,ncol参数为数值，表示 分面设置成几行和几列</p> 
 <div class="has"> 
  <pre><code>p+facet_wrap(~carb,scales="free",nrow=1)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/fa/2d/BpsDPT7r_o.png" alt="4d0370429d413e9eeb03724ceb70fa2d.png"> 
 </div> 
 <p>对nrow设置后的效果图表变得比较拥挤，正常情况下，facet_wrap自然生成的图片，只设置scale = free 会相对比较好看。</p> 
 <p><b>2</b> <b>facet_grid：基于两个因子进行设置，形式为：变量~变量（行~列），如果把一个因子用点表示，也可以达到facet_wrap的效果，也可以用加号设置成两个以上变量</b></p> 
 <div class="has"> 
  <pre><code>p+facet_grid(vs~cyl)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/f1/c4/zit6Zelo_o.png" alt="29bbdf1936bd2812439c4d7bb645e8ee.png"> 
 </div> 
 <div class="has"> 
  <pre><code>#space 表示分面空间是否可以按照数据进行缩放，参数和scales一样p+facet_grid(vs~cyl,scales="free",space="free")</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/05/2d/VnkbdUHh_o.png" alt="6b601d7e3a3e71a4aff71b57a94bee27.png"> 
 </div> 
 <p>从上图可以看出把scales 和space 都设置成free之后，不仅坐标刻度不一样了，连每个分面的大小也不一样了。</p> 
 <div class="has"> 
  <pre><code>#margins 通过TRUE或者FALSE表示否设置而一个总和的分面变量，默认情况为FALSE，即不设置p+facet_grid(vs~cyl,margins=TRUE)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/4e/e8/4hkF4hZS_o.png" alt="a96026a8a6f92eb330542ff954b62f46.png"> 
 </div> 
 <p>分面可以让我们按照某种给定的条件，对数据进行分组，然后分别画图。</p> 
 <h4>九 主题（Theme）</h4> 
 <p>ggplot画图之后，需要根据需求对图进行”精雕细琢“，title, xlab, ylab毋庸置疑，其他的细节也需修改。</p> 
 <h4>1 theme参数修改</h4> 
 <p>详细参数可参考：ggplot2-theme（主题）</p> 
 <div class="has"> 
  <pre><code>p &lt;- ggplot(data = diamond) +geom_point(aes(x=carat, y=price, colour=color,shape=cut))

p + labs(title="学习ggplot2可视化",subtitle = "参数好多",caption = "熟能生巧")+

theme(plot.title=element_text(face="bold.italic",color="steelblue",size=24, hjust=0.5,vjust=0.5,angle=360,lineheight=113))</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/45/2e/ODnSJY1a_o.png" alt="15b5af291029d2599ac57c3b8a7aefd3.png"> 
 </div> 
 <p>下面为theme的相关参数，可以细节修改处，之后的后面会继续补充。</p> 
 <div class="has"> 
  <pre><code>function (base_size = 12, base_family = "") {     theme(line = element_line(colour = "black", size = 0.5, linetype = 1,         lineend = "butt"), rect = element_rect(fill = "white",         colour = "black", size = 0.5, linetype = 1), text = element_text(family = base_family,         face = "plain", colour = "black", size = base_size, hjust = 0.5,         vjust = 0.5, angle = 0, lineheight = 0.9), axis.text = element_text(size = rel(0.8),         colour = "grey50"), strip.text = element_text(size = rel(0.8)),         axis.line = element_blank(), axis.text.x = element_text(vjust = 1),         axis.text.y = element_text(hjust = 1), axis.ticks = element_line(colour = "grey50"),         axis.title.x = element_text(), axis.title.y = element_text(angle = 90),         axis.ticks.length = unit(0.15, "cm"), axis.ticks.margin = unit(0.1,             "cm"), legend.background = element_rect(colour = NA),         legend.margin = unit(0.2, "cm"), legend.key = element_rect(fill = "grey95",             colour = "white"), legend.key.size = unit(1.2, "lines"),         legend.key.height = NULL, legend.key.width = NULL, legend.text = element_text(size = rel(0.8)),         legend.text.align = NULL, legend.title = element_text(size = rel(0.8),             face = "bold", hjust = 0), legend.title.align = NULL,         legend.position = "right", legend.direction = NULL, legend.justification = "center",         legend.box = NULL, panel.background = element_rect(fill = "grey90",             colour = NA), panel.border = element_blank(), panel.grid.major = element_line(colour = "white"),         panel.grid.minor = element_line(colour = "grey95", size = 0.25),         panel.margin = unit(0.25, "lines"), strip.background = element_rect(fill = "grey80",             colour = NA), strip.text.x = element_text(), strip.text.y = element_text(angle = -90),         plot.background = element_rect(colour = "white"), plot.title = element_text(size = rel(1.2)),         plot.margin = unit(c(1, 1, 0.5, 0.5), "lines"), complete = TRUE) }</code></pre> 
 </div> 
 <h4>2 ggplot2 默认主题</h4> 
 <p>除此外，ggplot2提供一些已经写好的主题，比如theme_grey()为默认主题，theme_bw()为白色背景主题，theme_classic()为经典主题。</p> 
 <div class="has"> 
  <pre><code>p + theme_classic()</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/75/f8/nklL56iD_o.png" alt="fa1935d91b6549f40741964c2a8682a9.png"> 
 </div> 
 <h4>3 ggplot2 扩展包主题</h4> 
 <div class="has"> 
  <pre><code>library(ggthemes)p + theme_stata()</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/64/f1/HhTquG6a_o.png" alt="cada64142aaa18ddc04dcca4935f6898.png"> 
 </div> 
 <p>除上述外，ggthemes包还提供其他主题，小伙伴们自己尝试吧。</p> 
 <div class="has"> 
  <pre><code>theme_economist theme_economist_whitetheme_wsj      theme_exceltheme_few        theme_foundationtheme_igray     theme_solarizedtheme_stata  theme_tufte</code></pre> 
 </div> 
 <h4>4 自定义主题</h4> 
 <p>可根据常见需要自定义常用主题</p> 
 <div class="has"> 
  <pre><code>theme_MJ &lt;- function(..., bg='white'){    require(grid)    theme_classic(...) +        theme(rect=element_rect(fill=bg),              plot.margin=unit(rep(1,4), 'lines'),              panel.border=element_rect(fill='transparent', color='transparent'),              panel.grid=element_blank(),              axis.title = element_text(color='black', vjust=0.1),              axis.ticks.length = unit(-0.1,"lines"),              axis.ticks = element_line(color='black'),              legend.title=element_blank(),              legend.key=element_rect(fill='transparent', color='transparent'))}

p + theme_MJ() + labs(title="学习ggplot2可视化",subtitle = "参数好多记不住?",caption = "熟能生巧！")</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/5f/99/jtWrYRSg_o.png" alt="6f03392bdc93d111e9577826a30e89d4.png"> 
 </div> 
 <p>以上就是ggplot2的八大要素，七颗龙珠可召唤神龙，八大要素合理使用可画出“神龙”， ！！！</p> 
 <p>【关注“生信补给站”公众号，对话框回复 ggplot2 即可获得上述R代码】</p> 
 <p>更多关于生信，R，Python的内容请扫码关注小号，谢谢。</p> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/57/34/4uMolknK_o.png" alt="120132056157f461e50cfcb581492962.png"> 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/58e9e208dda6ef4c46b8ef5721251128/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">苹果电脑投屏到电视_小米电视投屏方式大盘点，值得收藏</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5a42999b924f7fcc026d5bdf15bf58ff/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vscode remote ssh_win10 下安装Vscode</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>