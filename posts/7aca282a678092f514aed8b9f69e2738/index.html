<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Clickhouse遇到密码错误如何修改密码 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/7aca282a678092f514aed8b9f69e2738/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Clickhouse遇到密码错误如何修改密码">
  <meta property="og:description" content="输入错误密码报错
root@DAILACHDBUD001:/var/log# clickhouse-client ClickHouse client version 23.4.2.11 (official build). Connecting to localhost:9000 as user default. Password for user (default): Connecting to localhost:9000 as user default. Code: 516. DB::Exception: Received from localhost:9000. DB::Exception: default: Authentication failed: password is incorrect, or there is no user with such name. If you have installed ClickHouse and forgot password you can reset it in the configuration file. The password for default user is typically located at /etc/clickhouse-server/users.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-01T21:32:33+08:00">
    <meta property="article:modified_time" content="2023-12-01T21:32:33+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Clickhouse遇到密码错误如何修改密码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>输入错误密码报错</p> 
<pre><code class="prism language-bash">root@DAILACHDBUD001:/var/log<span class="token comment"># clickhouse-client</span>
ClickHouse client version <span class="token number">23.4</span>.2.11 <span class="token punctuation">(</span>official build<span class="token punctuation">)</span>.
Connecting to localhost:9000 as user default.
Password <span class="token keyword">for</span> user <span class="token punctuation">(</span>default<span class="token punctuation">)</span>:
Connecting to localhost:9000 as user default.
Code: <span class="token number">516</span>. DB::Exception: Received from localhost:9000. DB::Exception: default: Authentication failed: password is incorrect, or there is no user with such name.

If you have installed ClickHouse and forgot password you can reset it <span class="token keyword">in</span> the configuration file.
The password <span class="token keyword">for</span> default user is typically located at /etc/clickhouse-server/users.d/default-password.xml
and deleting this <span class="token function">file</span> will reset the password.
See also /etc/clickhouse-server/users.xml on the server where ClickHouse is installed.

<span class="token builtin class-name">.</span> <span class="token punctuation">(</span>AUTHENTICATION_FAILED<span class="token punctuation">)</span>
</code></pre> 
<p>解决方法<br> clickhouse 密码有三种设置方式：明文、SHA256 和 SHA1 三种方式。</p> 
<p>我们打开记录默认的登录账号密码的配置文件/etc/clickhouse-server/users.d/default-password.xml，发现默认密码是SHA256加密算法生成，由password_sha256_hex标签定义，我们只需要在/etc/clickhouse-server/users.d/default-password.xml重新设置新密码对应的SHA256字符串并不需要管/etc/clickhouse-server/users.xml配置文件，或把/etc/clickhouse-server/users.d/default-password.xml文件删除掉并在/etc/clickhouse-server/user.xml文件中修改账户密码。</p> 
<p>明文:明文密码放在标签,当 password 标签为空时，代表免密码登录。<br> SHA256:SHA256密码放在&lt;password_sha256_hex&gt;&lt;/password_sha256_hex&gt;，明文密码字符串Won123_De1可以通过echo 的命令加-sha256或sha256sum显示成SHA256的密码，有如下两种方法</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> Won123_De1 <span class="token operator">|</span> openssl dgst <span class="token parameter variable">-sha256</span>
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> Won123_De1 <span class="token operator">|</span> sha256sum <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'-'</span>
</code></pre> 
<p>SHA1：SHA1密码放在&lt;password_double_sha1_hex&gt;&lt;/password_double_sha1_hex&gt;，明文密码字符串Won123_De1可以通过echo 的命令加sha1sum显示成SHA256的密码，方法如下</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> Won123_De1 <span class="token operator">|</span> sha1sum <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'-'</span> <span class="token operator">|</span> xxd <span class="token parameter variable">-r</span> <span class="token parameter variable">-p</span> <span class="token operator">|</span> sha1sum <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'-'</span>
</code></pre> 
<p>安装的时候设置密码，需要修改密码，则只需要修改/etc/clickhouse-server/users.d/default-password.xml中密码，不需要管/etc/clickhouse-server/users.xml配置文件，同时需要修改/etc/clickhouse-server/config.xml配置文件中关于replication配置的密码，则需要defaultXX&lt;password_sha256_hex&gt;YY&lt;/password_sha256_hex&gt;三项包括明文密码项XX一起，否则报错<code>DB::Exception: Received from DAILACHDBUD003:9000. DB::Exception: default: Authentication failed</code></p> 
<p>/etc/clickhouse-server/users.d/default-password.xml如下两种形式都行<br> 形式1</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>yandex<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>users<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>default<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>Won123_De<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/password<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/default<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/users<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/yandex<span class="token operator">&gt;</span>
</code></pre> 
<p>形式2</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>yandex<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>users<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>default<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>password <span class="token assign-left variable">remove</span><span class="token operator">=</span><span class="token string">'1'</span> /<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>password_sha256_hex<span class="token operator">&gt;</span>9174c7d10af863c34f4fc684413740431cda606273ea1cea905d3f08cb84c82<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/password_sha256_hex<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/default<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/users<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/yandex<span class="token operator">&gt;</span>
</code></pre> 
<p>/etc/clickhouse-server/config.xml配置文件中关于replication配置的密码修改信息如下<br> 修改前密码Good123!</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>host<span class="token operator">&gt;</span>DAILACHDBUD00<span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>/host<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span><span class="token number">900</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/port<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>user<span class="token operator">&gt;</span>default<span class="token operator">&lt;</span>/user<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>Good123<span class="token operator">!</span><span class="token operator">&lt;</span>/password<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>password_sha256_hex<span class="token operator">&gt;</span>6481ef8efdab023b7c54b4e1832191f7f15498dff380e316ab1b1d711561a14d<span class="token operator">&lt;</span>/password_sha256_hex<span class="token operator">&gt;</span>
</code></pre> 
<p>修改后密码Won123_De1</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>host<span class="token operator">&gt;</span>DAILACHDBUD00<span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>/host<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span><span class="token number">900</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/port<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>user<span class="token operator">&gt;</span>default<span class="token operator">&lt;</span>/user<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>Won123_De<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/password<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>password_sha256_hex<span class="token operator">&gt;</span>9174c7d10af863c34f4fc684413740431cda606273ea1cea905d3f08cb84c82<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/password_sha256_hex<span class="token operator">&gt;</span>
</code></pre> 
<p>新建用户Lukes使用明文密码如下，则会在/var/lib/clickhouse/access/users.list文件中新增Lukes8f40b0e7-0c32-0e06-d01a-94af37ef43bf和新建一个文件/var/lib/clickhouse/access/8f40b0e7-0c32-0e06-d01a-94af37ef43bf.sql，这个.sql文件内容为ATTACH USER</p> 
<pre><code class="prism language-bash">Lukes IDENTIFIED WITH plaintext_password BY <span class="token string">'Se0ertl_o1'</span> SETTINGS PROFILE ID<span class="token punctuation">(</span><span class="token string">'4bfbe653-9137-0ea6-b97d-dc391ec9a919'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
create user Lukes on cluster cluster_2shared2replicas IDENTIFIED WITH plaintext_password by <span class="token string">'Se0ertl_o1'</span> <span class="token function">host</span> any SETTINGS PROFILE default<span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8a90ed42a54cffdcc6f6e01133871c3c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Clickhouse集群的搭建方法及搭建过程中报错的解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/48ce56ef29405aea824da963f2696fd7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Clickhouse表引擎的总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>