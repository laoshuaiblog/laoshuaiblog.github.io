<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>内核调试方法 三 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/2d3490d3707e6e0ed2aaa5b6323c2849/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="内核调试方法 三">
  <meta property="og:description" content="目录[-]
· 大海里的鱼有很多，而我们需要的是鱼钩一只
· 一些前言
· 作者前言
· 知识从哪里来
· 为什么撰写本文档
· 为什么需要汇编级调试
· ***第一部分：基础知识***
· 总纲：内核世界的陷阱
· 源码阅读的陷阱
· 代码调试的陷阱
· 原理理解的陷阱
· 建立调试环境
· 发行版的选择和安装
· 为什么选debian
· debian与ubuntu
· 从0安装debian
· debian重要命令
· 中文环境设置
· debian的键盘设置更改
· 英文Locale下使用中文输入法
· pdf乱码的解决
· 建立编译环境
· 安装交叉编译工具
· 交叉编译工具下载网址
· 安装arm-linux-gnueabi-XXX 工具集
· 什么是EABI
· 安装arm-elf-XXX 工具集
· bin工具集的使用
· arm-linux-gnueabi-gcc
· arm-linux-gnueabi-gdb
· qemu的使用
· initrd.img的原理与制作
· 安装与使用">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2014-02-19T15:32:18+08:00">
    <meta property="article:modified_time" content="2014-02-19T15:32:18+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">内核调试方法 三</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p align="left"><br> <br> </p> 
<p align="left"><span style="color:white; background:mediumvioletred">目录[-]</span></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h1_1" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">大海里的鱼有很多，而我们需要的是鱼钩一只</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_2" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">一些前言</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_3" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">作者前言</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_4" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">知识从哪里来</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_5" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">为什么撰写本文档</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_6" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">为什么需要汇编级调试</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_7" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">***</span><span style="color:#4466BB">第一部分：基础知识***</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_8" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">总纲：内核世界的陷阱</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_9" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">源码阅读的陷阱</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_10" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">代码调试的陷阱</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_11" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">原理理解的陷阱</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_12" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">建立调试环境</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_13" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">发行版的选择和安装</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_14" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">为什么选debian</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_15" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">debian</span><span style="color:#4466BB">与ubuntu</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_16" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">从0</span><span style="color:#4466BB">安装debian</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_17" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">debian</span><span style="color:#4466BB">重要命令</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_18" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">中文环境设置</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_19" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">debian</span><span style="color:#4466BB">的键盘设置更改</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_20" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">英文Locale</span><span style="color:#4466BB">下使用中文输入法</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_21" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">pdf</span><span style="color:#4466BB">乱码的解决</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_22" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">建立编译环境</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_23" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">安装交叉编译工具</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_24" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">交叉编译工具下载网址</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_25" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">安装arm-linux-gnueabi-XXX </span><span style="color:#4466BB">工具集</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_26" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">什么是EABI</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_27" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">安装arm-elf-XXX </span><span style="color:#4466BB">工具集</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_28" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">bin</span><span style="color:#4466BB">工具集的使用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_29" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">arm-linux-gnueabi-gcc</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_30" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">arm-linux-gnueabi-gdb</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_31" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">qemu</span><span style="color:#4466BB">的使用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_32" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">initrd.img</span><span style="color:#4466BB">的原理与制作</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_33" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">安装与使用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_34" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">x86</span><span style="color:#4466BB">虚拟调试环境的建立</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_35" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">基于qemu</span><span style="color:#4466BB">和内核内置kgdb</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_36" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">基于qemu</span><span style="color:#4466BB">和qemu</span><span style="color:#4466BB">内置gdbstub</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_37" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">arm</span><span style="color:#4466BB">虚拟调试环境的建立</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_38" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">利用qemu</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_39" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">利用qemu</span><span style="color:#4466BB">安装debian linux</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_40" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">利用qemu</span><span style="color:#4466BB">安装能进行内核调试的系统</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_41" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">利用skyeye</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_42" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">skyeye</span><span style="color:#4466BB">虚拟机的内核调试</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_43" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">skyeye</span><span style="color:#4466BB">的安装与使用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_44" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">快速试玩</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_45" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">快速配置能调试的环境</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_46" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">为s3c2410</span><span style="color:#4466BB">配置2.6.26</span><span style="color:#4466BB">内核</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_47" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">使用最新的skyeye</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_48" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">arm</span><span style="color:#4466BB">开发板调试环境的建立</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_49" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">基于串口</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_50" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">基于网口</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_51" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">gdb</span><span style="color:#4466BB">基础</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_52" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">基本命令</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_53" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">gdb</span><span style="color:#4466BB">之gui</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_54" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">gdb</span><span style="color:#4466BB">技巧</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_55" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">gdb</span><span style="color:#4466BB">宏</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_56" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">参考资料</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_57" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">gdb</span><span style="color:#4466BB">宏的使用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_58" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">实例</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_59" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">链表遍历类</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_60" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">功能增强类</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_61" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">汇编基础--X86</span><span style="color:#4466BB">篇</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_62" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">用户手册</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_63" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">AT&amp;T</span><span style="color:#4466BB">汇编格式</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_64" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">内联汇编</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_65" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">汇编与C</span><span style="color:#4466BB">函数的相互调用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_66" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用链形成和参数传递</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_67" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">寄存器的角色与保护</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_68" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用链的形成</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_69" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">栈帧结构与参数传递</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_70" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">完整的调用过程</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_71" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用链回溯的代码实现</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_72" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">C</span><span style="color:#4466BB">难点的汇编解释</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_73" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">例1</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_74" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">例2</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_75" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">例3</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_76" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">例4</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_77" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">优化级别的影响</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_78" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">优化选项</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_79" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">例子</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_80" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">汇编基础--ARM</span><span style="color:#4466BB">篇</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_81" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">用户手册</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_82" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用链形成和参数传递</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_83" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">壮观的标准</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_84" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">别名的烦恼</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_85" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">寄存器的角色与保护</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_86" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">条件执行</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_87" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用链的形成</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_88" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">栈帧结构与参数传递</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_89" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">完整的调用过程</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_90" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用链回溯的实现</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_91" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">源码浏览工具</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_92" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用图生成工具</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_93" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">find + grep</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_94" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">wine + SI</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_95" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">优缺点</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_96" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">安装wine</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_97" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">安装SI</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_98" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">SI</span><span style="color:#4466BB">的设置</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_99" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">SI</span><span style="color:#4466BB">的使用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_100" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">global</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_101" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">Source-Navigator</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_102" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">vim + cscope/ctags</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_103" rel="nofollow noopener noreferrer"><span style="color:#4466BB">优缺点</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_104" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">安装cscope/ctags</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_105" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">命令选项</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_106" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">使用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_107" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">建立索引</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_108" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">利用vim</span><span style="color:#4466BB">浏览源码</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h5_109" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">快捷键的使用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_110" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">kscope</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_111" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">lxr</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_112" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">SI</span><span style="color:#4466BB">等与gdb</span><span style="color:#4466BB">的特点</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_113" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用链、调用树和调用图</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_114" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">理想调用链</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_115" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">函数指针调用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_116" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用链的层次</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_117" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">非理想调用链</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_118" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用树与调用图</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_119" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用树的定义</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_120" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用树的作用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_121" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用树的分类</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_122" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用树的显示</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_123" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用树的拼接</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_124" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调用图</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_125" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">穿越盲区</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_126" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">穿越gdb</span><span style="color:#4466BB">的盲区</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_127" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">进程切换</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_128" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">中断异常</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_129" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">系统调用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_130" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">穿越交叉索引工具的盲区</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_131" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">函数指针</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_132" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">查看函数的参数</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_133" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">工程方法</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_134" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">二叉断点</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_135" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">给调用指令下断点</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_136" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">绕过时钟中断的干扰</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_137" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">bug </span><span style="color:#4466BB">与 OOPS</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_138" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">网站</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_139" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">***</span><span style="color:#4466BB">第二部分：内核分析***</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_140" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">调试相关子系统</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_141" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">kgdb</span><span style="color:#4466BB">源码分析</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_142" rel="nofollow noopener noreferrer"><span style="color:#4466BB">sysrq</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_143" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">oprofile</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_144" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">kprobes</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_145" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">驱动分析</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_146" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">载入模块符号</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_147" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">seq_file.c</span><span style="color:#4466BB">的分析</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_148" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">module.c</span><span style="color:#4466BB">的分析</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_149" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">中断处理过程</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_150" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">s3c24xx</span><span style="color:#4466BB">内存初始化分析</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_151" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">虚拟地址空间</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_152" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">用户层的观察窗</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_153" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">交互，从内核层分析</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_154" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">理解设备模型</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_155" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">面向对象的实现</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_156" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">设备模型的分层</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_157" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">外围支持机制</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_158" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">sysfs</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h4_159" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">hotplug</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_160" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">文件系统</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_161" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">***</span><span style="color:#4466BB">第三部分：其他工具***</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_162" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">strace</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_163" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">ltrace</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_164" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">SystemTap</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_165" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">MEMWATCH</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_166" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">YAMD</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_167" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">Magic SysRq</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_168" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">附录：社区交流相关</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_169" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">补丁提交相关文档</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_170" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">补丁制作与提交示范</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_171" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">多补丁发送工具</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_172" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">git</span><span style="color:#4466BB">使用</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_173" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">附录：内核参考书籍文章</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_174" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">内核git</span><span style="color:#4466BB">库</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_175" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">书籍</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_176" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">子系统官方网站</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h3_177" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">参考文章</span></a></p> 
<p align="left">·  <a target="_blank" href="http://my.oschina.net/fgq611/blog/112929#OSC_h2_178" rel="nofollow noopener noreferrer"> <span style="color:#4466BB">私人备忘</span></a></p> 
<p align="left"><strong><span style="color:#333333"> </span></strong></p> 
<p align="left"><strong><span style="color:#333333"> </span></strong></p> 
<p align="left"><strong><span style="color:#333333">大海里的鱼有很多，而我们需要的是鱼钩一只</span></strong></p> 
<p align="left"><span style="color:#333333">本文档由大家一起自由编写，修改和扩充，sniper</span>负责维护。引用外来的文章要注明作者和来处。本文档所有命令都是在ubuntu/debian下的操 作。选取的内核源码从文档开始编写时最新的内核版本–2.6.26开始，而且会随着linux的更新而不断更换新的版本。所以文档的内容可能前后不一致。 相信大家有能力克服这个问题。</p> 
<p align="left"><span style="color:#333333">本文档的字符图示在linux</span>环境下显示正常，在window下显示有细微的错乱。</p> 
<p align="left"><span style="color:#333333">本文档唯一的更新网址是：<a target="_blank" href="http://wiki.zh-kernel.org/sniper" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.zh-kernel.org/sniper</span></a> </span>转载请保留此网址。</p> 
<p align="left"><span style="color:#333333">有任何建议请发邮件：<a target="_blank" href="mailto:s3c24xx@gmail.com" rel="nofollow noopener noreferrer"><span style="color:#FF8373">s3c24xx@gmail.com</span></a></span></p> 
<p align="left"><span style="color:#333333">有任何问题请到邮件列表提问：<a target="_blank" href="http://zh-kernel.org/mailman/listinfo/linux-kernel" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://zh-kernel.org/mailman/listinfo/linux-kernel</span></a></span></p> 
<p align="left"><span style="color:#333333">一些和内核调试分析有关的小工具放在：</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://code.google.com/p/root-kit/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://code.google.com/p/root-kit/</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">一些前言</span></strong></p> 
<p align="left"><strong><span style="color:#333333">作者前言</span></strong></p> 
<p align="left"><span style="color:#333333">一个人默默地敲打这篇文章也有段时间了。在这个过程里，没有收到任何的赞誉，也没接到任何的板砖，没有任何的反馈。就这么敲打着，修理着。但是本人从没怀疑这篇文档的价值，这是因为，本人就是这篇文档的亲身收益者。在这里把它“无私”奉献出来，乃是出于对于某类同道者锲而不舍孜孜以求的“德性”的认 同和“同情”，你的痛苦我表示感同身受，你的迷茫我愿意一起分担。一定有人能从个文档受益，这便已让我知足。其实，写这个文档并非是件苦差，而是字字都是有感而发的，不吐不快的结果。这里的句句都是本人教训和经验的记录。</span></p> 
<p align="left"><span style="color:#333333">谈到调试器，世上存在两种截然不同的看法。其中一种，是超级解霸的作者，他认为“程序不是写出来的，好程序绝对是调试出来的”。对于这个观点，本人持着极不认同的态度。而第二种相反观点的人，便是linux</span>之父linus了。他认为调试器只会“误人子弟”，只会导致人们迷于表象而不去真正理解源码本身。并以此为由，长期没把kgdb内置到内核中。对于调试器调试bug会引入错误的修正这个观点，我认为还是有点道理的。但是他以此为由而不把它集合到内核中，这个做法我就认为是毫无道理了。因为linus本人就说过：“我只使用GDB，而且我总是并不把它作为调试器来使用，只是将其作为一个可以用来分析程序的分解器来使用。”既然他可以这样做，为什么就认定他人使用gdb的目的一定就是用来调试bug而不是另有所用呢？本人之所以这样说，这是因为本人正 也是使用gdb主要是用来辅助分析内核代码而不是主要用来调试错误的。这也正就是本文的主题。</p> 
<p align="left"><span style="color:#333333">世上从不缺少解决问题的答案，缺少的是解决问题的方法。现在，linux</span>的世界里已经不缺少牛书了，将尽一千页一本的满载答案的砖头书接踵而来，但 是渐渐地发现，看书看到后面就忘了前面，回到前面有忘了后面，甚至一个章节还没看完，那个子系统已经被完全重写了。慢慢地，就会怀疑“我是不是真的变老了？真的不行了？”但是我们从没想过：“凭什么我们就如此受制于人？他就能搞懂，而我就不行呢？”。其实，我们需要的是一种重其意而忘其形的根本之道，需 要的是一种兵来将挡，火来水淹的通用解决方法。而绝不是淹没于牛人们的结论中。否则，遇到一个新的问题，就只能埋怨牛人的书还不够厚，以至于没把你需要的东西也包括进去了。牛人一定有一套牛方法，而他在书中不详说，我不认为是他故意“留一手”，而是认为这是对自身觉得习以为常的事物的一种疏忽。牛人的研究 结果其实不是最重要的，他的研究方法和手段才是最重要的事情。而我，也渐渐地发现，调试器能带给我们很多有用的提示，使得我们能不断的寻找到思考的灵感和方向，也使得学习变得非常的有趣性和有目的性。我想，利用调试器辅助源码分析，是不是正是很多牛人正在做的而没有说出来的事情呢？无论答案如何，本人还是 觉得，调试器是个好东西，不要轻易把它搁置在一旁。虽然很多高人也许已经是深安此道，甚至已经不需要它的提示了，但是它依然有益于我等功力尚浅的人。把这种经验和技巧记录下来，让需要这项技巧的人少化时间去摸索，这绝对不是一件坏事。</p> 
<p align="left"><span style="color:#333333">正是因为这个原因，随着文档慢慢地变大，也更加的觉得文档的题目起得有点不恰当了，题目起作“内核动态分析指南”更恰当点。文档的主旨是利用调试器动态分析内核，调试错误只是这个过程的副产品罢了。不过，这个新的名字实在是不够现在名字“刺眼”，所以也就没有启用它。</span></p> 
<p align="left"><span style="color:#333333">说了这么多的废话和出格的话，无非是有两个目的：这个文章慢慢的变得这么长了，如果没有半句的“人”话，没有半句的现实世界中的语句。那估计本人不是变成了机器人，阅读的人也会变成了机器人。顺便借这段文字交交朋友。另一个目的呢，是说不应拘束于工具，工具是死的，人是活的。如果某些工具确能带给我 们某些有益的提示，我们就可以去尝试它，取起优点而舍其糟粕。</span></p> 
<p align="left"><span style="color:#333333">引用的原文：</span></p> 
<p align="left"><span style="color:#333333">Linus </span><span style="color:#333333">谈调试器和内核如何发展： <a target="_blank" href="http://www.bitscn.com/linux/kernel/200604/7493.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.bitscn.com/linux/kernel/200604/7493.html</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">知识从哪里来</span></strong></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">永远不要忘记的三大帮助命令</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">XXX -h(xxx </span><span style="color:#333333">–help)</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">man -a XXX</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">info XXX</span></p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">如何安装帮助文档</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">$ sudo synaptic </span><span style="color:#333333">界面出来后，在“组别”－&gt;</span>“文档”选取你要的文档进行安装</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">或$apt-cache search Documentation | grep XXX </span>搜索需要的文档进行安装</p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">从软件/</span>工具的官方网站阅读/下载文档</p> 
<p align="left"><span style="color:#333333">4. </span><span style="color:#333333">从irc</span>获取帮助 irc.freenode.net</p> 
<p align="left"><span style="color:#333333">5. </span><span style="color:#333333">从邮件列表获取帮助 mailist <a target="_blank" href="http://lkml.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://lkml.org/</span></a> <a target="_blank" href="http://marc.info/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://marc.info/</span></a></span></p> 
<p align="left"><span style="color:#333333">6. </span><span style="color:#333333">发行版社区文档或社区 <a target="_blank" href="https://help.ubuntu.com/community/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">https://help.ubuntu.com/community/</span></a> <a target="_blank" href="http://wiki.ubuntu.org.cn/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.ubuntu.org.cn/</span></a></span></p> 
<p align="left"><span style="color:#333333">7. </span><span style="color:#333333">利用google</span>搜索文档或阅读他人文章</p> 
<p align="left"><span style="color:#333333">8. </span><span style="color:#333333">利用google</span>搜索lkml</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.google.cn/advanced_search?hl=zh-CN" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.google.cn/advanced_search?hl=zh-CN</span></a> </span><span style="color:#333333">网域那里填上lkml.org</span></p> 
<p align="left"><span style="color:#333333">9. </span><span style="color:#333333">获取内核文档</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">源码本身</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">源码中的注释</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">内核源码附带的文档 Documentation</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">相关的教科书</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">论文 免费论文引擎  <a target="_blank" href="http://citeseerx.ist.psu.edu/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://citeseerx.ist.psu.edu/</span></a></span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">内核子系统的官方网站</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">获取内核源码目录Documentation/DocBook/ </span>下已经编译好的书籍</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">找到最新版本的文档</span></p> 
 <p align="left"><span style="color:#333333">$ apt-cache search linux-doc  </span> </p> 
 <p align="left"><span style="color:#333333">安装最新的文档</span><span style="color:#333333">    </span></p> 
 <p align="left"><span style="color:#333333">$ sudo apt-get installlinux-doc-2.6.24    </span></p> 
 <p align="left"><span style="color:#333333">阅读</span><span style="color:#333333">Documentation/DocBook/ </span><span style="color:#333333">下已经编译好的书籍（</span><span style="color:#333333">html</span><span style="color:#333333">格式）</span></p> 
 <p align="left"><span style="color:#333333">$ firefox/usr/share/doc/linux-doc-2.6.24/html/index.html         </span></p> 
</div> 
<p align="left"><span style="color:#333333">10. </span><span style="color:#333333">买书</span></p> 
<p align="left"><span style="color:#333333">11. </span><span style="color:#333333">书籍最后面的参考书目</span></p> 
<p align="left"><span style="color:#333333">12. </span><span style="color:#333333">文章末尾的参考文章</span></p> 
<p align="left"><span style="color:#333333">13. </span><span style="color:#333333">电子书搜索网站</span></p> 
<p align="left"><span style="color:#333333">emule: </span><span style="color:#333333">只要知道书名，windows</span>下用emule基本可以找到所有的英文版电子书。</p> 
<p align="left"><span style="color:#333333">但在linux</span>不行，可能是我的设置问题。</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://rapidshare.com/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://rapidshare.com/index.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.netbks.com/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.netbks.com/</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">为什么撰写本文档</span></strong></p> 
<p align="left"><span style="color:#333333">todo:</span><span style="color:#333333">学习方法，学习曲线，参考书籍的特点和不足，本文档的任务</span></p> 
<p align="left"><span style="color:#333333">内核学习曲线</span></p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">只读书不看源码</span></p> 
<p align="left"><span style="color:#333333">参考书籍：Linux KernelDevelopment</span></p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">参考源码读书(</span>读书为主)</p> 
<p align="left"><span style="color:#333333">参考书籍：understandingthe linux kernel</span></p> 
<p align="left"><span style="color:#333333">3.</span><span style="color:#333333">参考书读源码(</span>看源码为主)</p> 
<p align="left"><span style="color:#333333">参考书籍：情景分析</span></p> 
<p align="left"><span style="color:#333333">4.</span><span style="color:#333333">只看源码不/</span>少读书(提交补丁为主)</p> 
<p align="left"><span style="color:#333333">参考：lkml,main-tree,mm-tree</span></p> 
<p align="left"><span style="color:#333333">linux</span><span style="color:#333333">内核分析方法：</span></p> 
<p align="left"><span style="color:#333333">按分析的对象分：</span></p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">代码： 分析的对象是源代码</span></p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">数据： 分析的对象是内核运行时产生的数据</span></p> 
<p align="left"><span style="color:#333333">按观察对象的状态分：</span></p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">静态： 观察的目标对象是静止不动的</span></p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">动态： 观察的目标对象是动态变化的</span></p> 
<p align="left"><span style="color:#333333">所以综合地看，分析方法的种类有：</span></p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">静态代码：</span></p> 
<p align="left"><span style="color:#333333">最原始的方式，阅读源代码</span></p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">动态代码：</span></p> 
<p align="left"><span style="color:#333333">利用某些工具或手段，动态分析源代码。又分为</span></p> 
<p align="left"><span style="color:#333333">a. </span><span style="color:#333333">利用lxr,cscope, source insight</span>等工具交叉索引源代码</p> 
<p align="left"><span style="color:#333333">b. </span><span style="color:#333333">利用git,web-git</span>通过阅读增量patch等形式观察源码的进化</p> 
<p align="left"><span style="color:#333333">c. </span><span style="color:#333333">利用调试器跟随内核的运行动态观察内核正在运行的代码片段</span></p> 
<p align="left"><span style="color:#333333">3.</span><span style="color:#333333">静态数据：</span></p> 
<p align="left"><span style="color:#333333">观察的对象是内核在运行时产生或收集汇总出来的数据。又分为</span></p> 
<p align="left"><span style="color:#333333">a. </span><span style="color:#333333">代码中printk</span>语句打印出来的内核信息</p> 
<p align="left"><span style="color:#333333">b. </span><span style="color:#333333">系统出错产生的oops,panic</span>信息</p> 
<p align="left"><span style="color:#333333">c. </span><span style="color:#333333">借助systemtap</span>等类似工具提取的内核数据汇总</p> 
<p align="left"><span style="color:#333333">4.</span><span style="color:#333333">动态数据：</span></p> 
<p align="left"><span style="color:#333333">借助内核调试器实时观察内核不断产生的数据</span></p> 
<p align="left"><span style="color:#333333">可见内核调试器是最强大的内核分析工具，但它也不是“全功能”的工具。</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">主要地，本文档聚焦于描述如何利用gdb</span>对内核进行源码级别和汇编级别的观察和调试。</p> 
<p align="left"><span style="color:#333333">而这种调试的目的有两个:</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">确定bug</span>产生的引入点。这部分内容放于本文档第一部分。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">配合源码阅读工具(source insight,kscope</span>等)，观察内核实时运行的状况，观察内核数据的产生和变化，以及观察各个函数的动态调用关系，从而以一种精确的动态的和验证性的方式来理解内核运作的原理。这部分内容放于本文档第二部分</p> 
<p align="left"><span style="color:#333333">前者是调试器应用的主要价值，而后者却是本文档的兴趣所在。</span></p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">因为需要观察用户层和内核层的交互，演示调试工具的全面功能等原因，本文档内容不完全局限于内核层。</span></p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">另外，为了提供内核调试知识的全面叙述，我们对其他调试工具，其他调试的问题比如检测内存泄露等内容，也会进行说明。此部分内容放于本文档的第三部分。</span></p> 
<p align="left"><strong><span style="color:#333333">为什么需要汇编级调试</span></strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">逆向工程的需要</span></p> 
<p align="left"><span style="color:#333333">例子1</span>：NT 内核的进程调度分析笔记 <a target="_blank" href="http://www.whitecell.org/list.php?id=11" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.whitecell.org/list.php?id=11</span></a></p> 
<p align="left"><span style="color:#333333">例子2: NT </span>下动态切换进程分析笔记 <a target="_blank" href="http://www.whitecell.org/list.php?id=13" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.whitecell.org/list.php?id=13</span></a></p> 
<p align="left"><span style="color:#333333">在windows</span>的世界里，内核源码和具体原理是不公开的。但很多牛人就凭一个破烂调试器阅读反汇编代码就能得到内部真相，可见调试器汇编级调试威力之大。但是在linux是源码公开的情况下，就没必要干那样的辛苦活了。但是因为以下原因，汇编级调试还是必要的。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">汇编比C</span>语言更低层</p> 
<p align="left"><span style="color:#333333">有时(</span>比如代码优化)情况下，因为C代码经过了编译器的处理，调试器在c源码调试这个级别下给出的信息是无法理解的，甚至看起来是错误的。但是如果直接对 调试器给出的反汇编代码进行分析，就不会受到那类问题的束缚。也就是说，进行汇编级别的调试能最大程度的利用调试器的功能。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">汇编是C</span>语义的解释</p> 
<p align="left"><span style="color:#333333">当你对某句C</span>语言不是很理解时，看看编译器是怎么想的，是个很不错的办法。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">能锻炼汇编源码的阅读能力</span></p> 
<p align="left"><span style="color:#333333">另一方面，内核中本来存在很多汇编源代码，进行汇编级调试也是锻炼阅读汇编源码能力的最有效方法。</span></p> 
<p align="left"><span style="color:#333333">当然，汇编级调试虽然强大，但代价也是很昂贵。和源码级调试相比，分析汇编代码花的时间要多上几十倍。所以，在源码公开的情况下，应该以源码级调试为主，特殊情况下才需要汇编级调试。</span></p> 
<p align="left"><strong><span style="color:#333333"> </span></strong></p> 
<p align="left"><strong><span style="color:#333333">***</span><span style="color:#333333">第一部分：基础知识***</span></strong></p> 
<p align="left"><strong><span style="color:#333333">总纲：内核世界的陷阱</span></strong></p> 
<p align="left"><span style="color:#333333">也是阅读理解其他任何大型代码会遇到的问题。下面各节的内容都是围绕这些小项展开的。如果有的内容不知所云，先看后面内容，再回头看这里。</span></p> 
<p align="left"><span style="color:#333333">［先从其他地方复制过来，等待充实］</span></p> 
<p align="left"><strong><span style="color:#333333">源码阅读的陷阱</span></strong></p> 
<p align="left"><span style="color:#333333">源码不但是越来越大，更是越来越“刁”了。“刁”到了就是借助源码交叉索引工具也有它索引不到的地方。所以目前，即使是从源码阅读的角度而不是从调试的角度，只利用阅读工具不借助调试工具的话，源码都无法阅读。</span></p> 
<p align="left"><span style="color:#333333">源码“刁”到源码解析工具都无法解析的因素有：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">汇编源码包括内嵌汇编 可能无法被你的源码阅读工具所解析</span></p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">汇编代码和C</span>代码之间的调用关系 无法被被源码阅读工具解析</p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">利用函数指针的函数调用 无法被被源码阅读工具解析</span></p> 
<p align="left"><span style="color:#333333">4. </span><span style="color:#333333">宏“假函数” 可能无法被被源码阅读工具解析(SI</span>不能解析，lxr能)</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">比如</span><span style="color:#333333">page_buffers()</span><span style="color:#333333">。定义是：</span></p> 
 <p align="left"><span style="color:#333333">#define page_buffers(page)                                         \</span></p> 
 <p align="left"><span style="color:#333333">      ({                                                           \</span></p> 
 <p align="left"><span style="color:#333333">               BUG_ON(!PagePrivate(page));                         \</span></p> 
 <p align="left"><span style="color:#333333">               ((structbuffer_head *)page_private(page)); \</span></p> 
 <p align="left"><span style="color:#333333">      })</span></p> 
</div> 
<p align="left"><span style="color:#333333">5. </span><span style="color:#333333">利用宏在编译时动态生成的函数体 无法被被源码阅读工具解析</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">比如</span><span style="color:#333333">fs/buffer.c</span><span style="color:#333333">中有一大批类似函数。比如</span><span style="color:#333333">buffer_unwritten()</span></p> 
 <p align="left"><span style="color:#333333">定义在</span><span style="color:#333333">buffer_head.h</span></p> 
 <p align="left"><span style="color:#333333"> 82 #define BUFFER_FNS(bit, name)                                           \</span></p> 
 <p align="left"><span style="color:#333333">..</span><span style="color:#333333">省略</span></p> 
 <p align="left"><span style="color:#333333"> 91 static inline int buffer_##name(conststruct buffer_head *bh)           \</span></p> 
 <p align="left"><span style="color:#333333"> 92 {                                                                      \</span></p> 
 <p align="left"><span style="color:#333333"> 93        return test_bit(BH_##bit, &amp;(bh)-&gt;b_state);                      \</span></p> 
 <p align="left"><span style="color:#333333"> 94 }</span></p> 
 <p align="left"><span style="color:#333333">..</span></p> 
 <p align="left"><span style="color:#333333">130 BUFFER_FNS(Unwritten, unwritten)</span></p> 
 <p align="left"><span style="color:#333333">这类函数一般是短小的内嵌函数，用</span><span style="color:#333333">gdb</span><span style="color:#333333">调试时都看不出来。只能靠字符搜索再加上一点机灵。</span></p> 
</div> 
<p align="left"><span style="color:#333333">6. </span><span style="color:#333333">函数/</span>变量的某类c扩展属性标记， 可能导致该函数/变量无法被被源码阅读工具解析</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">比如</span><span style="color:#333333">static struct vfsmount *bd_mnt __read_mostly;</span><span style="color:#333333">中的</span><span style="color:#333333">bd_mnt</span></p> 
</div> 
<p align="left"><span style="color:#333333">7. </span><span style="color:#333333">其他语种的保留关键字，可能无法被你的源码阅读工具所解析</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">如默认配置的</span><span style="color:#333333">SI</span><span style="color:#333333">无法解析</span><span style="color:#333333">struct class</span><span style="color:#333333">，当然，这个问题和内核无关。</span></p> 
</div> 
<p align="left"><span style="color:#333333">但是借助调试器，就能直接而轻易地解决上述源码解析工具难以解决的问题。</span></p> 
<p align="left"><strong><span style="color:#333333">代码调试的陷阱</span></strong></p> 
<p align="left"><span style="color:#333333">搭建调试环境</span></p> 
<p align="left"><span style="color:#333333">gdb</span><span style="color:#333333">调试器的陷阱</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">宏“假函数”</span></p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">内嵌函数</span></p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">代码优化</span></p> 
<p align="left"><span style="color:#333333">4. </span><span style="color:#333333">汇编码</span></p> 
<p align="left"><span style="color:#333333">5. </span><span style="color:#333333">进程切换</span></p> 
<p align="left"><span style="color:#333333">6. </span><span style="color:#333333">中断处理</span></p> 
<p align="left"><span style="color:#333333">7. </span><span style="color:#333333">系统调用</span></p> 
<p align="left"><strong><span style="color:#333333">原理理解的陷阱</span></strong></p> 
<p align="left"><span style="color:#333333">0. </span><span style="color:#333333">链接器脚本和make</span>语法</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">下面这些杂七杂八的文件对内核整体原理的理解起着决定性的作用。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">内核中的链接脚本</span></p> 
 <p align="left"><span style="color:#333333">linux-2.6$ find ./ -name"*lds*"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">内核中的重要宏文件</span></p> 
 <p align="left"><span style="color:#333333">module_param* macros</span></p> 
 <p align="left"><span style="color:#333333">include/linux/moduleparam.h</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">*__initcall Macros</span></p> 
 <p align="left"><span style="color:#333333">include/linux/init.h</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">内核中的汇编文件</span></p> 
 <p align="left"><span style="color:#333333">linux-2.6$ find ./ -name "*.S"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">内核中的</span><span style="color:#333333">Makefile</span></p> 
 <p align="left"><span style="color:#333333">linux-2.6$ find ./ -name"Makefile"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">内核中的配置文件</span></p> 
 <p align="left"><span style="color:#333333">linux-2.6$ find ./ -name"*config*"</span></p> 
</div> 
<p align="left"><span style="color:#333333">1. C</span><span style="color:#333333">与汇编代码的相互调用</span></p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">各子系统间的接口互动</span></p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">内核的设计思想及其代码编写和运行形式</span></p> 
<p align="left"><span style="color:#333333">a) </span><span style="color:#333333">基于对象的思想</span></p> 
<p align="left"><span style="color:#333333">例子：文件系统，设备模型</span></p> 
<p align="left"><span style="color:#333333">b) </span><span style="color:#333333">“发布—订阅”模型</span></p> 
<p align="left"><span style="color:#333333">例子：notificationchain</span></p> 
<p align="left"><strong><span style="color:#333333">建立调试环境</span></strong></p> 
<p align="left"><strong><span style="color:#333333">发行版的选择和安装</span></strong></p> 
<p align="left"><strong><span style="color:#333333">为什么选debian</span></strong></p> 
<p align="left"><span style="color:#333333">［如题］ <a target="_blank" href="http://www.debian.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.debian.org/</span></a> <a target="_blank" href="http://www.emdebian.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.emdebian.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">为什么本人选择debian</span>？因为：引用内容来之<a target="_blank" href="http://www.debian.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">www.debian.org</span></a></p> 
<p align="left"><span style="color:#333333">“Debian </span>计划 是一个致力于创建一个自由操作系统的合作组织。...屁话省略...屁话..N多屁话之后: 当然，人们真正需要的是应用软件，也就是帮助他们完成工作的程序: 从文档编辑，到电子商务，到游戏娱乐，到软件开发。Debian 带来了超过 18733 个 软件包 (为了能在您的机器上轻松的安装，这些软件包都已经被编译包装为一种方便的格式) —这些全部都是 自由 软件。”</p> 
<p align="left"><span style="color:#333333">原因终于看到了，选择debian</span>是因为本人比较懒，比较笨。而debian正好迎合了我这种人的需求。</p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">它”带来了超过 18733 </span>个 软件包”。18733这个数目非常不直观，而且或许是N年前的数据了。我们可以到debian的ftp看看，现在它可供安装的软件和工具达到了5个DVD的容量。难以想象，在这5个DVD容量的工具库中，还会找不到我所想要的东西。</p> 
<p align="left"><span style="color:#333333">2. debian</span><span style="color:#333333">有一个非常出名的安装包管理机制。你需要做的就是，打开“立新得”软件，然后在一个小方框里写上你需要东西的相关信息，然后再点点一个叫做“搜索”的小方块。接着，debian</span>就会在它5个DVD大的工具库中寻找你想要的工具。在结果返回后，选择好你的工具，再点点一个叫做“应用”的小方块， 过一会，就可以使用你的工具了。</p> 
<p align="left"><span style="color:#333333">再也没有了“缺少什么什么包”的烦人提示了，一切都这么简单，又这么强大。这，正是我想要的。</span></p> 
<p align="left"><strong><span style="color:#333333">debian</span><span style="color:#333333">与ubuntu</span></strong></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">两者区别，版本外号，支持社区，source list</span>等] 1. ubuntu的易用性比debian要好。尤其是中文支持，还有ubuntu国内有活跃的社区。 2. 虽然ubuntu是基于debian的，apt 软件库也能获取到debian的软件，但它毕竟是不同的系统环境，理念不同，对于一些偏门或太旧或太新的软件时，ubuntu往往不支持，安装不了。比 如，gcc-3.4-arm-linux-gnu这个包，发行时间已久，ubuntu下安装不了，但在debian下则可以。<a target="_blank" href="http://www.ubuntu.com/community/ubuntustory/debian" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ubuntu.com/community/ubuntustory/debian</span></a></p> 
<p align="left"><span style="color:#333333">如不特别说明，本文档所有命令都是在ubuntuHardy Heron8.04</span>版本 和debian testing版本下的操作。</p> 
<p align="left"><strong><span style="color:#333333">从0</span>安装debian</strong></p> 
<p align="left"><span style="color:#333333">［如果想领教古典linux</span>相对于windows的特色，请安装一次debian吧。尽管和以前比，已经很智能了。但安装了debian，选了中文环境， 发现汉字都是歪歪倒倒的。而且没有汉字输入法，装了汉字输入法后，却用不了。不知道是我笨还是程序有bug.所以不得不用英文写下本烂文，怕把安装过程给 忘了。需要翻译回中文］</p> 
<p align="left"><span style="color:#333333">How to install andconfigure a debian system from zero</span></p> 
<p align="left"><span style="color:#333333">1.install the systemwith one CD</span></p> 
<p align="left"><span style="color:#333333">Download CD iso filefrom debian official website, and burn it into a CD. Note that, we can justdownload the first CD iso but not DVDs or the whole serials of CDs, because thefirst CD has already contained all the basis components of dedian system andmany other most common applications. We can use the first CD to install debiansystem, and then to install some other needed programs from it if needed. Inthis way, you can save much time spent on touching many inrelatived things.</span></p> 
<p align="left"><span style="color:#333333">2.installapplication &amp; tool from CD</span></p> 
<p align="left"><span style="color:#333333">ou can install somecommon apllications from the CD with the following commnad: apt-get installexpected-application. Why can we do that without any more configuration? Why isit not need to has a ability to access internet? Well, Let</span><span style="color:#333333">’slook at the file named sourse.list which idenifying where to get software</span>’s pakage?? deb cdrom:[Debian GNU/Linux testing _Lenny_ - OfficialSnapshot i386 CD Binary-1 20080605-15:01]/ lenny main It means that system tryto get somethig from your CD, so obviously that you can get some the mostcommon but not all the tools available in debian official apllicationrepository.</p> 
<p align="left"><span style="color:#333333">3.try to access theinternet</span></p> 
<p align="left"><span style="color:#333333">Thank to the firstCD, we can do that easily. Fist, install the tool ppp contained in CD and its</span><span style="color:#333333">’configuration tool pppoeconfig. All these steps are described in file ADSL</span>（PPPOE）接入指南.txt</p> 
<p align="left"><span style="color:#333333">4.search any usefulinformation through the internet</span></p> 
<p align="left"><span style="color:#333333">now, we have built abase debian system, but it is too simple. I want to do some some thing, forexample, to chat with some other people with pidgin, but it is not contained inthe first CD, which just downloaded by you. And you may want to search somehelps with google,etc. Just to do it, google is a most useful tool.</span></p> 
<p align="left"><span style="color:#333333">5.search theinternet updating source</span></p> 
<p align="left"><span style="color:#333333">I think you have getmuch thing through the google. But the most important thing is to get a availableupdate source for your system, and change the source.list</span><span style="color:#333333">–thatis /etc/apt/source.list. Now, I have got a good one, and it seems good. Don</span>’t forget to turn on the security entry in the orgion filesource.list. That file looks like following after my updataion:</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#deb cdrom:[Debian GNU/Linux testing_Lenny_ - Official Snapshot i386 CD Binary-1 20080605-15:01]/ lenny main</span></p> 
 <p align="left"><span style="color:#333333">deb http://ftp.debian.org/debian/ lennymain contrib non-free </span></p> 
 <p align="left"><span style="color:#333333">deb http://security.debian.org/lenny/updates main</span></p> 
 <p align="left"><span style="color:#333333">deb-src http://security.debian.org/lenny/updates main</span></p> 
</div> 
<p align="left"><span style="color:#333333">You should note thatthe internet address is debian office</span><span style="color:#333333">’s, but It takessome while to get it. And my searching tool is google. :) Oh, we shoul run acommand to update the new configuration to system before using it, don</span>’t ferget: apt-get update</p> 
<p align="left"><span style="color:#333333">6.get helpfrom IRC</span></p> 
<p align="left"><span style="color:#333333">Well, we havealready been able to get some applications or tools from internet with commandapte-get or wget,etc.. But I think the first thing to do is to get and installa very valuable tool named pidgin which can bring you into IRC world.Because Many experiance and kind person live in channel #debian ofirc.freenode.net. You can get help from it very quickly. How to configurepidgin? Sorry, I don</span><span style="color:#333333">’t like to answer such a problem , please just to googleit or try it by yourselft. I am not so kind as some guys livingin IRC : )</span></p> 
<p align="left"><span style="color:#333333">7.get and installsynaptic</span></p> 
<p align="left"><span style="color:#333333">If you ever usedubuntu, you should agree that synaptic is good tool to update you system. Itcan save you much time of searching tools, typing commnad, or managing thedownloaded tools. But Unfortunately, such a important tool is not installed inthe default system, and it is not contained in the first CD. So, We can just toget it with command </span><span style="color:#333333">“apt-get install synaptic</span>”. Afterdoing that successfully, I don’t want to type thatcommand anymore. It’s so tedious to me.</p> 
<p align="left"><span style="color:#333333">8.get more toolswith the help of synaptic</span></p> 
<p align="left"><span style="color:#333333">synaptic is my GODin the linux world. Without it, I will become crazy. But now, I have owned it,so I can fly very freely in the internet sky. Just to search any tools and toupdate your system. And now, the CD used to install debian can be discarded, ifyou will never reinstall or rescure the system with it in future.</span></p> 
<p align="left"><span style="color:#333333">Now, the sun hasraise up, and you have found the road to reback to civilization. Why? Just toask your google and synaptic. :)</span></p> 
<p align="left"><strong><span style="color:#333333">debian</span><span style="color:#333333">重要命令</span></strong></p> 
<p align="left"><span style="color:#333333">［来源］《APT and Dpkg </span>快速参考表》 <a target="_blank" href="http://i18n.linux.net.cn/others/APT_and_Dpkg.php" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://i18n.linux.net.cn/others/APT_and_Dpkg.php</span></a></p> 
<p align="left"><span style="color:#333333">Apt </span><span style="color:#333333">不止是apt-get</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.erwinwang.com/node/10" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.erwinwang.com/node/10</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">中文环境设置</span></strong></p> 
<p align="left"><strong><span style="color:#333333">debian</span><span style="color:#333333">的键盘设置更改</span></strong></p> 
<p align="left"><span style="color:#333333">默认安装的debian</span>，键盘的设置可能有问题。比如“｜”打不出来。值得一提的是，这个设置甚至是和qemu的monitor模式相关联的。也就是说，qemu下有的字符也打不出来。如果有这个问题，按下面步骤设置</p> 
<p align="left"><span style="color:#333333">System</span><span style="color:#333333">→Preferences</span>→Keyboard→Layouts</p> 
<p align="left"><span style="color:#333333">然后通过“Add</span>”增加China,并设置它为默认，或者同时把其他的删除掉。</p> 
<p align="left"><strong><span style="color:#333333">英文Locale</span>下使用中文输入法</strong></p> 
<p align="left"><span style="color:#333333">说明，中文环境比英文环境有很多缺点。比如编译时编译器的提示都给汉化了，有如，minicom</span>的中文汉化界面是错乱的，而且minicom无法设置。本 人一般是英文环境＋中文输入法。先安装好好中文环境，系统中就有了中文输入法和其他一些和中文有关的东西。然后转到英文环境下，按照下面做法更改scim 的配置文件即可。</p> 
<p align="left"><span style="color:#333333">来自：<a target="_blank" href="http://wiki.ubuntu.org.cn/index.php?title=%E8%8B%B1%E6%96%87Locale%E4%B8%8B%E4%BD%BF%E7%94%A8%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95&amp;variant=zh-cn" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.ubuntu.org.cn/index.php?title=%E8%8B%B1%E6%96%87Locale%E4%B8%8B%E4%BD%BF%E7%94%A8%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95&amp;variant=zh-cn</span></a></span></p> 
<p align="left"><span style="color:#333333">编辑/etc/gtk-2.0/gtk.immodules(</span>如果存在的话) 或者 /usr/lib/gtk-2.0/2.10.0/immodule-files.d/libgtk2.0-0.immodules 文件，在xim 的 local 增加 en 也就是说：</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">"xim" "X InputMethod" "gtk20" "/usr/share/locale" "ko:ja:th:zh"</span></p> 
 <p align="left"><span style="color:#333333">改成：</span></p> 
 <p align="left"><span style="color:#333333">"xim" "X InputMethod" "gtk20" "/usr/share/locale""en:ko:ja:th:zh"</span></p> 
 <p align="left"><span style="color:#333333">注意，一定要重启一下机器。</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">pdf</span><span style="color:#333333">乱码的解决</span></strong></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$sudo apt-get installxpdf-chinese-simplified xpdf-chinese-traditional poppler-data</span></p> 
</div> 
<p align="left"><span style="color:#333333">参考：</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wiki.ubuntu.org.cn/PDF%E6%96%87%E6%A1%A3%E7%9A%84%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.ubuntu.org.cn/PDF%E6%96%87%E6%A1%A3%E7%9A%84%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">建立编译环境</span></strong></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ sudo apt-get install build-essentialautoconf automake1.9 cvs subversion libncurses5-dev git rar unrar p7zip-fullcabextract</span></p> 
</div> 
<p align="left"><span style="color:#333333">其余的根据出错的提示，利用“立新得”搜索，然后进行安装。没有“立新得”界面程序的可以在终端下利用以下命令来搜索和安装。</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ sudo apt-get update</span></p> 
 <p align="left"><span style="color:#333333">$ apt-cache search XXX</span></p> 
 <p align="left"><span style="color:#333333">$ sudo apt-get install XXX</span></p> 
</div> 
<p align="left"><span style="color:#333333">双硬盘系统切换设置的grub</span>设置，私人备忘用</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">title           Microsoft Windows XP Professional</span></p> 
 <p align="left"><span style="color:#333333">root            (hd1,0)</span></p> 
 <p align="left"><span style="color:#333333">savedefault</span></p> 
 <p align="left"><span style="color:#333333">makeactive</span></p> 
 <p align="left"><span style="color:#333333">map             (hd0) (hd1)</span></p> 
 <p align="left"><span style="color:#333333">map             (hd1) (hd0)</span></p> 
 <p align="left"><span style="color:#333333">chainloader     +1</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">安装交叉编译工具</span></strong></p> 
<p align="left"><strong><span style="color:#333333">交叉编译工具下载网址</span></strong></p> 
<p align="left"><span style="color:#333333">下面是几个交叉编译工具下载网址，需要手动安装时，对比一下编译器的名称可以找到合适的下载地址。debian</span>维护有自己的已经打包成.deb形式安装包，在debian软件库中。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">http://www.codesourcery.com/gnu_toolchains/arm/download.html</span></p> 
 <p align="left"><span style="color:#333333">（据说是</span><span style="color:#333333">arm</span><span style="color:#333333">公司推荐的）</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Download Sourcery G++ Lite Edition forARM</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Target OS      Download </span></p> 
 <p align="left"><span style="color:#333333">EABI         Sourcery G++ Lite 2008q1-126</span></p> 
 <p align="left"><span style="color:#333333">                All versions...</span></p> 
 <p align="left"><span style="color:#333333">uClinux        SourceryG++ Lite 2008q1-152</span></p> 
 <p align="left"><span style="color:#333333">                All versions...</span></p> 
 <p align="left"><span style="color:#333333">GNU/Linux      Sourcery G++ Lite 2008q1-126</span></p> 
 <p align="left"><span style="color:#333333">                All versions...</span></p> 
 <p align="left"><span style="color:#333333">SymbianOS      Sourcery G++ Lite 2008q1-126</span></p> 
 <p align="left"><span style="color:#333333">                All versions...</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">到底是选</span><span style="color:#333333">EABI</span><span style="color:#333333">还是</span><span style="color:#333333">GNU/LINUX</span><span style="color:#333333">呢？应该是后者</span><span style="color:#333333">....</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">点</span><span style="color:#333333">GNU/LINUX</span><span style="color:#333333">的连接进去，可看到</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Download                     MD5 Checksum</span></p> 
 <p align="left"><span style="color:#333333">IA32 GNU/Linux Installer        93eee13a08dd739811cd9b9b3e2b3212</span></p> 
 <p align="left"><span style="color:#333333">IA32 Windows Installer        fac5b0cee1d9639c9f15e018e6d272ad</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Documentation</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Title                              Format</span></p> 
 <p align="left"><span style="color:#333333">Assembler (PDF)                 PDF</span></p> 
 <p align="left"><span style="color:#333333">Binary Utilities (PDF)          PDF</span></p> 
 <p align="left"><span style="color:#333333">C Library (GLIBC) (PDF)         PDF</span></p> 
 <p align="left"><span style="color:#333333">Compiler (PDF)                           PDF</span></p> 
 <p align="left"><span style="color:#333333">Debugger (PDF)                           PDF</span></p> 
 <p align="left"><span style="color:#333333">Getting Started Guide (PDF)     PDF</span></p> 
 <p align="left"><span style="color:#333333">Linker (PDF)                    PDF</span></p> 
 <p align="left"><span style="color:#333333">Preprocessor (PDF)              PDF</span></p> 
 <p align="left"><span style="color:#333333">Profiler (PDF)                           PDF</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Advanced Packages</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Expert users may prefer packages inthese formats.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Download               MD5 Checksum</span></p> 
 <p align="left"><span style="color:#333333">IA32 GNU/Linux TAR     4f11b0fa881864f220ab1bd84666108b</span></p> 
 <p align="left"><span style="color:#333333">IA32 Windows TAR       ed6d25fd68301e728a1fba4cd5cb913f</span></p> 
 <p align="left"><span style="color:#333333">Source TAR             2db28fb2aa80134e7d34d42b7039d866</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">  </span><span style="color:#333333">名字标识不是很明显，进去看才知道。比如，</span><span style="color:#333333">IA32 GNU/Linux Installer</span><span style="color:#333333">对应的安装包</span></p> 
 <p align="left"><span style="color:#333333">名字叫</span><span style="color:#333333">arm-2008q1-126-arm-none-linux-gnueabi.bin</span></p> 
 <p align="left"><span style="color:#333333">  </span><span style="color:#333333">为什么有个</span><span style="color:#333333">none</span><span style="color:#333333">？迷茫中</span><span style="color:#333333">..</span></p> 
 <p align="left"><span style="color:#333333">---------------------------------</span></p> 
 <p align="left"><span style="color:#333333">http://ftp.snapgear.org:9981/pub/snapgear/tools/arm-linux/</span></p> 
 <p align="left"><span style="color:#333333">[DIR] Parent Directory                30-Sep-2003 15:44      -  </span></p> 
 <p align="left"><span style="color:#333333">[  ] arm-linux-tools-20031127.tar.gz 26-Nov-2007 16:56   141M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] arm-linux-tools-20051123.tar.gz 24-Nov-2005 00:50   228M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] arm-linux-tools-20061213.tar.gz 13-Dec-2006 13:31   230M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] arm-linux-tools-20070808.tar.gz 30-Nov-2007 03:21   271M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] binutils-2.16.tar.gz           16-Nov-2005 15:44  15.6M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] binutils-2.17.tar.gz           06-Dec-2007 10:24  17.4M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] build-arm-linux-3.4.4          02-Aug-2006 14:32     6k  </span></p> 
 <p align="left"><span style="color:#333333">[  ] build-arm-linux-4.2.1          30-Jul-2008 10:13     7k  </span></p> 
 <p align="left"><span style="color:#333333">[  ] elf2flt-20060707.tar.gz        17-Jan-2008 22:23   101k  </span></p> 
 <p align="left"><span style="color:#333333">[  ] elf2flt-20060708.tar.gz        30-Jul-2008 10:14   110k  </span></p> 
 <p align="left"><span style="color:#333333">[  ] gcc-3.4.4.tar.bz2              16-Nov-2005 15:39  26.3M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] gcc-4.2.1.tar.bz2              06-Dec-2007 10:11  42.0M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] genext2fs-1.3.tar.gz           03-Sep-2003 10:23    19k  </span></p> 
 <p align="left"><span style="color:#333333">[  ] glibc-2.3.3.tar.gz             16-Nov-2005 15:49  16.7M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] glibc-2.3.6.tar.gz             06-Dec-2007 10:39  17.9M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] glibc-linuxthreads-2.3.3.tar.gz 16-Nov-2005 15:49   303k  </span></p> 
 <p align="left"><span style="color:#333333">[  ] glibc-linuxthreads-2.3.6.tar.gz 06-Dec-2007 10:39   320k  </span></p> 
 <p align="left"><span style="color:#333333">--------------------------</span></p> 
 <p align="left"><span style="color:#333333">http://www.handhelds.org/download/projects/toolchain/</span></p> 
 <p align="left"><span style="color:#333333">[DIR] Parent Directory                                                  -   </span></p> 
 <p align="left"><span style="color:#333333">[  ] README                                       28-Jul-2004 17:37  788   </span></p> 
 <p align="left"><span style="color:#333333">[DIR] archive/                                     28-Jul-2004 17:34    -   </span></p> 
 <p align="left"><span style="color:#333333">[  ] arm-linux-gcc-3.3.2.tar.bz2                   03-Nov-2003 10:23   71M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] arm-linux-gcc-3.4.1.tar.bz2                   29-Jul-2004 14:01   41M  </span></p> 
 <p align="left"><span style="color:#333333">[DIR] beta/                                         28-Jul-200417:36    -   </span></p> 
 <p align="left"><span style="color:#333333">[  ] crosstool-0.27-gcc3.4.1.tar.gz                28-Jul-2004 17:21  2.0M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] gcc-build-cross-3.3                           31-Oct-200315:43  5.1K  </span></p> 
 <p align="left"><span style="color:#333333">[DIR] jacques/                                      24-Jul-2001 18:45    -   </span></p> 
 <p align="left"><span style="color:#333333">[  ] kernel-headers-sa-2.4.19-rmk6-pxa1-hh5.tar.gz 12-Mar-2003 17:42  4.7M  </span></p> 
 <p align="left"><span style="color:#333333">[DIR] monmotha/                                    13-Aug-2002 17:54    -   </span></p> 
 <p align="left"><span style="color:#333333">[DIR] osx/                                         14-Dec-2003 11:45    -   </span></p> 
 <p align="left"><span style="color:#333333">[DIR] pb/                                          22-Nov-2002 20:10    -   </span></p> 
 <p align="left"><span style="color:#333333">[DIR] source/                                      18-Mar-2004 16:12    -   </span></p> 
 <p align="left"><span style="color:#333333">------------------------------------</span></p> 
 <p align="left"><span style="color:#333333">http://ftp.arm.linux.org.uk/pub/armlinux/toolchain/</span></p> 
 <p align="left"><span style="color:#333333">[DIR] Parent Directory                                     -   </span></p> 
 <p align="left"><span style="color:#333333">[  ] Oerlikon-DevKit-XScalev2.tar.gz 07-Feb-2003 22:30  3.7K  </span></p> 
 <p align="left"><span style="color:#333333">[  ] cross-2.95.3.tar.bz2           20-Jul-2001 21:12   35M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] cross-3.0.tar.bz2              20-Jul-2001 22:27   39M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] cross-3.2.tar.bz2              23-Aug-2002 11:04   81M  </span></p> 
 <p align="left"><span style="color:#333333">[  ] cross-3.2.tar.gz               23-Aug-2002 10:01   93M  </span></p> 
 <p align="left"><span style="color:#333333">[DIR] src-2.95.3/                     14-Jan-2002 17:52    -   </span></p> 
 <p align="left"><span style="color:#333333">[DIR] src-3.2/                        23-Aug-2002 10:53    -   </span></p> 
 <p align="left"><span style="color:#333333">--------------------------------------------</span></p> 
 <p align="left"><span style="color:#333333">http://linux.omap.com/pub/toolchain/</span></p> 
 <p align="left"><span style="color:#333333">[DIR] Parent Directory                             -   </span></p> 
 <p align="left"><span style="color:#333333">[  ] obsolete-gcc-3.3.2.t..&gt; 15-May-2004 12:18   76M  </span></p> 
 <p align="left"><span style="color:#333333">---------------------------</span></p> 
 <p align="left"><span style="color:#333333">http://www.uclinux.org/pub/uClinux/arm-elf-tools/</span></p> 
 <p align="left"><span style="color:#333333">To install the Linux binaries, login asroot and run "sh ./XXX-elf-tools-20030314.sh".</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">m68k-elf-20030314/arm-elf-20030314</span></p> 
 <p align="left"><span style="color:#333333">   Get the m68k binaries or the ARM binaries. The source is here.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">m68k-elf-20020410/arm-elf-20011219</span></p> 
 <p align="left"><span style="color:#333333">   Get the m68k binaries or the ARM binaries. The source is here.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">m68k-elf-20020218/arm-elf-20011219</span></p> 
 <p align="left"><span style="color:#333333">   Get the m68k binaries or the ARM binaries. The source is here.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">m68k/arm-elf-20011219</span></p> 
 <p align="left"><span style="color:#333333">   Get the m68k binaries or the ARM binaries. The source is here.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   You can also get Bernhard Kuhn's RPMs here.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">m68k-elf-20010716</span></p> 
 <p align="left"><span style="color:#333333">   Get the binaries here and the source from here.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">m68k-elf-20010712</span></p> 
 <p align="left"><span style="color:#333333">   Get the binaries here and the source from here.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">m68k-elf-20010610</span></p> 
 <p align="left"><span style="color:#333333">   Get the binaries here and the source from here.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">m68k-elf-20010228</span></p> 
 <p align="left"><span style="color:#333333">   The binaries are in two files, the compilers and the g++ headers. Thesource is here. </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">安装arm-linux-gnueabi-XXX</span>工具集</strong></p> 
<p align="left"><span style="color:#333333">debian</span><span style="color:#333333">有自己维护的一套交叉编译工具集</span></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">参考]<a target="_blank" href="http://www.emdebian.org/tools/crosstools.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.emdebian.org/tools/crosstools.html</span></a></span></p> 
<p align="left"><span style="color:#333333">工具库： <a target="_blank" href="http://www.emdebian.org/debian/pool/main/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.emdebian.org/debian/pool/main/</span></a></span></p> 
<p align="left"><span style="color:#333333">步骤：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">往/etc/apt/sources.list</span>文件加入下面软件源</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">deb http://buildd.emdebian.org/debian/unstable main</span></p> 
 <p align="left"><span style="color:#333333">deb-srchttp://buildd.emdebian.org/debian/ unstable main</span></p> 
 <p align="left"><span style="color:#333333">deb http://buildd.emdebian.org/debian/testing main</span></p> 
 <p align="left"><span style="color:#333333">deb-srchttp://buildd.emdebian.org/debian/ testing main</span></p> 
</div> 
<p align="left"><span style="color:#333333">然后：</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">安装</span><span style="color:#333333"> emdebian-archive-keyring package </span></p> 
 <p align="left"><span style="color:#333333">$ sudo apt-get installemdebian-archive-keyring</span></p> 
 <p align="left"><span style="color:#333333">更新</span></p> 
 <p align="left"><span style="color:#333333">$ sudo apt-get update</span></p> 
</div> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">安装交叉编译器</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ sudo apt-get install libc6-armel-crosslibc6-dev-armel-cross binutils-arm-linux-gnueabi gcc-4.3-arm-linux-gnueabig++-4.3-arm-linux-gnueabi</span></p> 
</div> 
<p align="left"><span style="color:#333333">注意，在ubuntu8.04</span>下，只能安装4.2版。把上面文字中的4.3全部换为4.2即可。</p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">安装交叉调试器</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$sudo apt-get installgdb-arm-linux-gnueabi</span></p> 
</div> 
<p align="left"><span style="color:#333333">注意:</span></p> 
<p align="left"><span style="color:#333333">a. </span><span style="color:#333333">安装时使用名称：gdb-arm-linux-gnueabi</span>，调用时使用命令名是：arm-linux-gnueabi-gdb</p> 
<p align="left"><span style="color:#333333">b. ubuntu</span><span style="color:#333333">下,arm-linux-gnueabi-gdb</span>和gdb有冲突。</p> 
<p align="left"><span style="color:#333333">解决方法：</span></p> 
<p align="left"><span style="color:#333333">需要使用arm-linux-gnueabi-gdb</span>时先卸载gdb,记下卸载gdb时与gdb一起被卸载的软件名，然后安装arm-linux- gnueabi-gdb。 想换回gdb时，在反操作。apt-install remove arm-linux-gnueabi-gdb 然后apt-get install gdb以及之前和gdb一起被卸载包。可以写个脚本自动完成这些操作。本人环境下的脚本是：</p> 
<p align="left"><span style="color:#333333">脚本1.install-armgdb.sh</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#! /bin/sh</span></p> 
 <p align="left"><span style="color:#333333">sudo apt-get remove gdb</span></p> 
 <p align="left"><span style="color:#333333">sudo apt-get install gdb-arm-linux-gnueabi</span></p> 
</div> 
<p align="left"><span style="color:#333333">脚本2. install-gdb.sh</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#! /bin/sh</span></p> 
 <p align="left"><span style="color:#333333">sudo apt-get removegdb-arm-linux-gnueabi</span></p> 
 <p align="left"><span style="color:#333333">sudo apt-get install apport apport-gtkapport-qt bug-buddy cgdb gdb python-apport xxgdb</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">什么是EABI</span></strong></p> 
<p align="left"><span style="color:#333333">答： 来自AAPCS</span></p> 
<p align="left"><span style="color:#333333">ABI</span><span style="color:#333333">：Application Binary Interface:</span></p> 
<p align="left"><span style="color:#333333">1</span><span style="color:#333333">）.The specifications to which an executable must conform in order to execute in aspecific execution environment. For example, the Linux ABI for the ARMArchitecture.</span></p> 
<p align="left"><span style="color:#333333">2</span><span style="color:#333333">）.A particular aspect of the specifications to which independently producedrelocatable files must conform in order to be statically linkable andexecutable. For example, the C++ ABI for the ARM Architecture, the Run-time ABIfor the ARM Architecture, the C Library ABI for the ARM Architecture.</span></p> 
<p align="left"><span style="color:#333333">ARM-based </span><span style="color:#333333">…based on the ARM architecture </span>…</p> 
<p align="left"><span style="color:#333333">EABI</span><span style="color:#333333">：An ABI suited to the needs of embedded (sometimes called free standing)applications.</span></p> 
<p align="left"><span style="color:#333333">参考：</span></p> 
<p align="left"><span style="color:#333333">ABI/EABI/OABI <a target="_blank" href="http://blog.csdn.net/hongjiujing/archive/2008/07/21/2686556.aspx" rel="noopener noreferrer"><span style="color:#FF8373">http://blog.csdn.net/hongjiujing/archive/2008/07/21/2686556.aspx</span></a></span></p> 
<p align="left"><span style="color:#333333">Re: </span><span style="color:#333333">关于kernelARM_EABI <a target="_blank" href="http://zh-kernel.org/pipermail/linux-kernel/2008-January/002793.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://zh-kernel.org/pipermail/linux-kernel/2008-January/002793.html</span></a></span></p> 
<p align="left"><span style="color:#333333">Why ARM</span><span style="color:#333333">’sEABI matters <a target="_blank" href="http://www.linuxdevices.com/articles/AT5920399313.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxdevices.com/articles/AT5920399313.html</span></a></span></p> 
<p align="left"><span style="color:#333333">Why switch toEABI? <a target="_blank" href="http://www.applieddata.net/forums/topic.asp?TOPIC_ID=2305" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.applieddata.net/forums/topic.asp?TOPIC_ID=2305</span></a></span></p> 
<p align="left"><span style="color:#333333">ArmEabiPort <a target="_blank" href="http://wiki.debian.org/ArmEabiPort" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.debian.org/ArmEabiPort</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">安装arm-elf-XXX </span>工具集</strong></p> 
<p align="left"><span style="color:#333333">注：arm-elf-XXX </span>工具集是用于uclinux的</p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">依据要求搜索下载相应的arm-elf-tools</span>安装包。比如arm-elf-tools-20030315.sh</p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">安装：$ ./arm-elf-tools-20030315.sh</span></p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">如果，该安装包年代过老，比如arm-elf-tools-20030315.sh</span>，会出现下面的错误提示 “tail: 无法打开“ 43” 读取数据: 没有那个文件或目录。”。 这时需要修改安装包源码。方法：vi arm-elf-tools-20030315.sh, 搜索tail，在它后面加 -n .比如 把tail ${SKIP} ${SCRIPT} | gunzip |tar xvf -改成如下：tail -n ${SKIP} ${SCRIPT} | gunzip | tarxvf -</p> 
<p align="left"><span style="color:#333333">4.</span><span style="color:#333333">如何卸载已安装的arm-elf-tools</span>？ 答，重新安装一次，注意看终端提示。或直接viarm-elf-tools-20030315.sh,看脚本的内容，</p> 
<p align="left"><strong><span style="color:#333333">bin</span><span style="color:#333333">工具集的使用</span></strong></p> 
<p align="left"><span style="color:#333333">［该怎么称呼这类工具？待详述］</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">arm-elf-addr2line   arm-elf-elf2flt     arm-elf-gdb         arm-elf-objdump     arm-elf-size</span></p> 
 <p align="left"><span style="color:#333333">arm-elf-ar          arm-elf-flthdr      arm-elf-ld          arm-elf-protoize    arm-elf-strings</span></p> 
 <p align="left"><span style="color:#333333">arm-elf-as          arm-elf-g++         arm-elf-ld.real     arm-elf-ranlib      arm-elf-strip</span></p> 
 <p align="left"><span style="color:#333333">arm-elf-c++         arm-elf-gasp        arm-elf-nm          arm-elf-readelf     arm-elf-unprotoize</span></p> 
 <p align="left"><span style="color:#333333">arm-elf-c++filt     arm-elf-gcc         arm-elf-objcopy     arm-elf-run  </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">arm-linux-gnueabi-addr2line  arm-linux-gnueabi-g++        arm-linux-gnueabi-gprof      arm-linux-gnueabi-readelf</span></p> 
 <p align="left"><span style="color:#333333">arm-linux-gnueabi-ar         arm-linux-gnueabi-g++-4.2    arm-linux-gnueabi-ld         arm-linux-gnueabi-size</span></p> 
 <p align="left"><span style="color:#333333">arm-linux-gnueabi-as         arm-linux-gnueabi-gcc        arm-linux-gnueabi-nm         arm-linux-gnueabi-strings</span></p> 
 <p align="left"><span style="color:#333333">arm-linux-gnueabi-c++filt    arm-linux-gnueabi-gcc-4.2    arm-linux-gnueabi-objcopy    arm-linux-gnueabi-strip</span></p> 
 <p align="left"><span style="color:#333333">arm-linux-gnueabi-cpp        arm-linux-gnueabi-gdb        arm-linux-gnueabi-objdump    </span></p> 
 <p align="left"><span style="color:#333333">arm-linux-gnueabi-cpp-4.2    arm-linux-gnueabi-gdbtui     arm-linux-gnueabi-ranlib      </span></p> 
</div> 
<p align="left"><span style="color:#333333">如何获取这些工具的命令选项？ 看章节“知识从哪里来” 一般是用命 xxxxxx </span>–help就能得到简单的命令选项列表</p> 
<p align="left"><span style="color:#333333">下载arm-linux-gnueabi-</span>手册地址 <a target="_blank" href="http://www.codesourcery.com/gnu_toolchains/arm/portal/release324" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.codesourcery.com/gnu_toolchains/arm/portal/release324</span></a></p> 
<p align="left"><span style="color:#333333">然后搜索”arm</span>”，便能找到处理器相关的特殊命令选项</p> 
<p align="left"><strong><span style="color:#333333">arm-linux-gnueabi-gcc</span></strong></p> 
<p align="left"><span style="color:#333333">查看arm</span>处理器相关的编译选项</p> 
<p align="left"><span style="color:#333333">$ viarch/arm/Makefile</span></p> 
<p align="left"><span style="color:#333333">阅读Makefile</span>文件，并联系源码根目录下的.config文件，便能知道arm-linux-gnueabi-gcc用了哪些编译选项。再到手册中查找，便能知道这些选项是干什么用的，但手册中说的不是很详细。另外查找有用解释的方法的是，利用make ARCH=armCROSS_COMPILE=arm-linux-gnueabi- menuconfig，找到与命令选项有关联的CONFIG_XXX的菜单项，看它的帮助说明.比如</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ vi arch/arm/Makefile</span></p> 
 <p align="left"><span style="color:#333333">....</span></p> 
 <p align="left"><span style="color:#333333">ifeq ($(CONFIG_AEABI),y)</span></p> 
 <p align="left"><span style="color:#333333">CFLAGS_ABI      :=-mabi=aapcs-linux -mno-thumb-interwork</span></p> 
 <p align="left"><span style="color:#333333">else</span></p> 
 <p align="left"><span style="color:#333333">CFLAGS_ABI      :=$(callcc-option,-mapcs-32,-mabi=apcs-gnu) $(call cc-option,-mno-thumb-interwork,)</span></p> 
 <p align="left"><span style="color:#333333">endif</span></p> 
 <p align="left"><span style="color:#333333">.. </span></p> 
</div> 
<p align="left"><span style="color:#333333">再查看CONFIG_AEABI</span>的帮助文档 $ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- menuconfig 找到CONFIG_AEABI相关的菜单，看它的帮助文档，便能知道选项-mabi=aapcs-linux-mno-thumb-interwork的整体效果怎样的。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333"> ┌───────────────────── Use the ARM EABI to compile the kernel──────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333"> │ CONFIG_AEABI:                                                                     │  </span></p> 
 <p align="left"><span style="color:#333333"> │                                                                                  │  </span></p> 
 <p align="left"><span style="color:#333333"> │ This option allows for the kernel to be compiled using the latest                 │  </span></p> 
 <p align="left"><span style="color:#333333"> │ ARM ABI (aka EABI).  This isonly useful if you are using a user                  │  </span></p> 
 <p align="left"><span style="color:#333333"> │ space environment that is also compiled with EABI.                                │  </span></p> 
 <p align="left"><span style="color:#333333"> │                                                                                  │  </span></p> 
 <p align="left"><span style="color:#333333"> │ Since there are major incompatibilities between the legacy ABIand                │  </span></p> 
 <p align="left"><span style="color:#333333"> │ EABI, especially with regard to structure member alignment, this                  │  </span></p> 
 <p align="left"><span style="color:#333333"> │ option also changes the kernel syscall calling convention to                      │  </span></p> 
 <p align="left"><span style="color:#333333"> │ disambiguate both ABIs and allow for backward compatibilitysupport               │  </span></p> 
 <p align="left"><span style="color:#333333"> │ (selected with CONFIG_OABI_COMPAT).                                              │  </span></p> 
 <p align="left"><span style="color:#333333"> │                                                                                  │  </span></p> 
 <p align="left"><span style="color:#333333"> │ To use this you need GCC version 4.0.0 or later.                                  │  </span></p> 
 <p align="left"><span style="color:#333333"> │                                                                                  │  </span></p> 
 <p align="left"><span style="color:#333333"> │ Symbol: AEABI [=n]                                                               │  </span></p> 
 <p align="left"><span style="color:#333333"> │ Prompt: Use the ARM EABI to compile the kernel                                    │  </span></p> 
 <p align="left"><span style="color:#333333"> │   Defined atarch/arm/Kconfig:554                                                │  </span></p> 
 <p align="left"><span style="color:#333333"> │   Location:                                                                      │  </span></p> 
 <p align="left"><span style="color:#333333"> │     -&gt; Kernel Features      </span> </p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">arm-linux-gnueabi-gcc</span><span style="color:#333333">的主要编译选项有如下几个。但是在编译内核时，这些选项是不需要手工去写的，而是通过make menuconfig</span>生成包含了编译选项配置信息的.config文件。在make编译内核时，再利用Makefile文件中的规则结合.config文 件提取出那些选项。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">太多了，手册吧</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">arm-linux-gnueabi-gdb</span></strong></p> 
<p align="left"><span style="color:#333333">注意它的默认选项设置</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ arm-linux-gnueabi-gdb</span></p> 
 <p align="left"><span style="color:#333333">(gdb) show arm</span></p> 
 <p align="left"><span style="color:#333333">abi: The current ARM ABI is "auto" (currently "APCS").</span></p> 
 <p align="left"><span style="color:#333333">apcs32: Usage of ARM 32-bit mode is on.</span></p> 
 <p align="left"><span style="color:#333333">disassembler:  The disassembly style is "std".</span></p> 
 <p align="left"><span style="color:#333333">fpu: The current ARM floating point model is "auto" (currently"fpa").</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
</div> 
<p align="left"><span style="color:#333333">但是，如果如果在命令后有参数vmlinux</span>的话，它会自动识别出内核的abi，从而自动设置了gdb的abi。比如，在编译内核时，如果选了CONFIG_AEABI，则gdb的提示如下</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ arm-linux-gnueabi-gdb vmlinux </span> </p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">(gdb) show arm</span></p> 
 <p align="left"><span style="color:#333333">abi: The current ARM ABI is "auto" (currently"AAPCS").  &lt;--</span><span style="color:#333333">注意</span></p> 
 <p align="left"><span style="color:#333333">apcs32: Usage of ARM 32-bit mode is on.</span></p> 
 <p align="left"><span style="color:#333333">disassembler:  The disassembly style is "std".</span></p> 
 <p align="left"><span style="color:#333333">fpu: The current ARM floating point model is "auto" (currently"softvfp").</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">qemu</span><span style="color:#333333">的使用</span></strong></p> 
<p align="left"><span style="color:#333333">参考手册</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://bellard.org/qemu/user-doc.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://bellard.org/qemu/user-doc.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wiki.debian.org.tw/index.php/QEMU" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.debian.org.tw/index.php/QEMU</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.h7.dion.ne.jp/~qemu-win/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.h7.dion.ne.jp/~qemu-win/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://bellard.org/qemu/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://bellard.org/qemu/</span></a></span></p> 
<p align="left"><span style="color:#333333">邮件列表</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://lists.gnu.org/archive/html/qemu-devel/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://lists.gnu.org/archive/html/qemu-devel/</span></a></span></p> 
<p align="left"><span style="color:#333333">参考文章</span></p> 
<p align="left"><span style="color:#333333">“QEMU</span>安装使用全攻略” <a target="_blank" href="http://forum.ubuntu.org.cn/viewtopic.php?p=248267&amp;sid=f4e95025bdaf6a24a218315d03ad9933" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://forum.ubuntu.org.cn/viewtopic.php?p=248267&amp;sid=f4e95025bdaf6a24a218315d03ad9933</span></a></p> 
<p align="left"><span style="color:#333333">［补充命令］引用自<a target="_blank" href="http://bbs.chinaunix.net/viewthread.php?tid=779540" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://bbs.chinaunix.net/viewthread.php?tid=779540</span></a></span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">安装过程中，要求换盘：</span></p> 
 <p align="left"><span style="color:#333333">在</span><span style="color:#333333">qemu</span><span style="color:#333333">中按</span><span style="color:#333333">ctrl+alt+2</span><span style="color:#333333">切换到</span><span style="color:#333333">qemu monitor</span><span style="color:#333333">模式</span><span style="color:#333333">输入</span><span style="color:#333333">?</span><span style="color:#333333">或</span><span style="color:#333333">help</span><span style="color:#333333">可以查看可用命令及使用说明。</span></p> 
 <p align="left"><span style="color:#333333">(</span><span style="color:#333333">在其他版本的</span><span style="color:#333333">qemu</span><span style="color:#333333">中，运行</span><span style="color:#333333">qemu</span><span style="color:#333333">加载</span><span style="color:#333333">OS</span><span style="color:#333333">后，这个</span><span style="color:#333333">shell</span><span style="color:#333333">就会自动变成</span><span style="color:#333333">qemu monitor</span><span style="color:#333333">模式</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333">change device filename -- change aremovable media</span></p> 
 <p align="left"><span style="color:#333333">看来它就是用来换盘的了</span><span style="color:#333333"> : change cdrom /rhel4/EL_disc2.iso</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">切换回安装界面</span><span style="color:#333333">ctrl+alt+1</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">monitor</span><span style="color:#333333">下还有几个常用的命令：</span></p> 
 <p align="left"><span style="color:#333333">savevm filename </span><span style="color:#333333">将整个虚拟机当前状态保存起来</span></p> 
 <p align="left"><span style="color:#333333">loadvm filename </span><span style="color:#333333">恢复</span><span style="color:#333333"> (</span><span style="color:#333333">最初我没用</span><span style="color:#333333">change</span><span style="color:#333333">换盘时</span><span style="color:#333333">,</span><span style="color:#333333">就是先</span><span style="color:#333333">savevm-&gt;</span><span style="color:#333333">重新运行</span><span style="color:#333333">qemu-&gt;loadvm)</span></p> 
 <p align="left"><span style="color:#333333">sendkey keys </span><span style="color:#333333">向</span><span style="color:#333333">VM</span><span style="color:#333333">中发送按键，例如你想在虚拟机里切换到另一个终端，按下了</span><span style="color:#333333">ctrl-alt-F2</span></p> 
 <p align="left"><span style="color:#333333">不幸的是，切换的却是你的主系统，所以就需要用</span><span style="color:#333333"> sendkey</span><span style="color:#333333">了</span><span style="color:#333333"> sendkeyctrl-alt-f2</span></p> 
 <p align="left"><span style="color:#333333">还有其他几个命令，自己看看啦。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">经过</span><span style="color:#333333">N</span><span style="color:#333333">久终于装好了，现在可以启动试试：</span></p> 
 <p align="left"><span style="color:#333333">[root@LFS distro]#qemu redhat.img-enable-audio -user-net -m 64</span></p> 
 <p align="left"><span style="color:#333333">-user-net </span><span style="color:#333333">相当于</span><span style="color:#333333">VMware</span><span style="color:#333333">的</span><span style="color:#333333">nat</span><span style="color:#333333">，主系统可以上，虚拟机就可以</span></p> 
 <p align="left"><span style="color:#333333">-m 64    </span><span style="color:#333333">使用</span><span style="color:#333333">64M</span><span style="color:#333333">内存，缺省下使用</span><span style="color:#333333">128M</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">ctrl-alt-f </span><span style="color:#333333">全屏</span></p> 
 <p align="left"><span style="color:#333333">ctrl-alt   </span><span style="color:#333333">主机</span><span style="color:#333333">/</span><span style="color:#333333">虚拟机鼠标切换</span></p> 
 <p align="left"><span style="color:#333333">qemu</span><span style="color:#333333">还有一些其他参数，输入</span><span style="color:#333333">qemu</span><span style="color:#333333">可以查看其相关说明</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">initrd.img</span><span style="color:#333333">的原理与制作</span></strong></p> 
<p align="left"><span style="color:#333333">［扩展，原理，相关命令。下面的skyeye</span>可能需要这部分知识］</p> 
<p align="left"><span style="color:#333333">“Linux2.6 </span>内核的 Initrd 机制解析” <a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-k26initrd/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-k26initrd/</span></a></p> 
<p align="left"><span style="color:#333333">“Introducinginitramfs, a new model for initial RAM disks</span>” <a target="_blank" href="http://www.linuxdevices.com/articles/AT4017834659.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxdevices.com/articles/AT4017834659.html</span></a></p> 
<p align="left"><span style="color:#333333">””深入理解 Linux 2.6 </span>的 initramfs 機制 (上)“ <a target="_blank" href="http://blog.linux.org.tw/~jserv/archives/001954.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.linux.org.tw/~jserv/archives/001954.html</span></a></p> 
<p align="left"><span style="color:#333333">MKINITRAMFS <a target="_blank" href="http://www.manpage.org/cgi-bin/man/man2html?8+mkinitramfs" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.manpage.org/cgi-bin/man/man2html?8+mkinitramfs</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">安装与使用</span></strong></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ sudo apt-get install initramfs-tools </span></p> 
 <p align="left"><span style="color:#333333">$ mkinitramfs /lib/modules/2.6.26/ -oinitrd.img-2.6.26</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">x86</span><span style="color:#333333">虚拟调试环境的建立</span></strong></p> 
<p align="left"><span style="color:#333333">参考</span></p> 
<p align="left"><span style="color:#333333">“debugging-linux-kernel-without-kgdb</span>” <a target="_blank" href="http://memyselfandtaco.blogspot.com/2008/06/debugging-linux-kernel-without-kgdb.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://memyselfandtaco.blogspot.com/2008/06/debugging-linux-kernel-without-kgdb.html</span></a></p> 
<p align="left"><span style="color:#333333">“使用 KGDB </span>调试 Linux 内核” <a target="_blank" href="http://blog.chinaunix.net/u/8057/showart_1087126.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u/8057/showart_1087126.html</span></a></p> 
<p align="left"><span style="color:#333333">“透過虛擬化技術體驗 kgdb (1)</span>” <a target="_blank" href="http://blog.linux.org.tw/~jserv/archives/002045.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.linux.org.tw/~jserv/archives/002045.html</span></a></p> 
<p align="left"><strong><span style="color:#333333">基于qemu</span>和内核内置kgdb</strong></p> 
<p align="left"><span style="color:#333333">缺点：相对于下节的“基于qemu</span>和qemu内置gdbstub”，这个方法配置麻烦。</p> 
<p align="left"><span style="color:#333333">优点：真机远程调试时只能使用内置kgdb</span>这个方法。</p> 
<p align="left"><span style="color:#333333">［等待扩展，,,,</span>］</p> 
<p align="left"><span style="color:#333333">终极参考</span></p> 
<p align="left"><span style="color:#333333">“Using kgdb and thekgdb Internals</span>” <a target="_blank" href="http://www.kernel.org/pub/linux/kernel/people/jwessel/kgdb/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.kernel.org/pub/linux/kernel/people/jwessel/kgdb/index.html</span></a></p> 
<p align="left"><span style="color:#333333">参考文章</span></p> 
<p align="left"><span style="color:#333333">“使用 KGDB </span>调试 Linux 内核” <a target="_blank" href="http://blog.chinaunix.net/u/8057/showart_1087126.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u/8057/showart_1087126.html</span></a></p> 
<p align="left"><strong><span style="color:#333333">基于qemu</span>和qemu内置gdbstub</strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">参考文章</span></p> 
<p align="left"><span style="color:#333333">“Debugging LinuxKernel Without KGDB Patch (Qemu + GDB)</span>” <a target="_blank" href="http://memyselfandtaco.blogspot.com/2008/06/debugging-linux-kernel-without-kgdb.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://memyselfandtaco.blogspot.com/2008/06/debugging-linux-kernel-without-kgdb.html</span></a></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">优缺点</span></p> 
<p align="left"><span style="color:#333333">优点：相对上节，优点是操作简单，几乎不需要什么配置</span></p> 
<p align="left"><span style="color:#333333">缺点：真机的远程调试，就只能利用内核的内置kgdb</span>了</p> 
<p align="left"><span style="color:#333333">说明：</span></p> 
<p align="left"><span style="color:#333333">如果长时间调试固定版本的内核，采取下面的把调试用内核安装的虚拟机内部就可以了。但是如果是要频繁地更换新内核或修改被调试内核，就需要采取把内核挂在虚拟机外部的形式。也就是用 -kernel </span>在虚拟机外面挂个内核， 再利用-append传递起内核启动参数等。［待研究］</p> 
<p align="left"><span style="color:#333333">［太概过了，待扩展...</span>］</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">调试用内核的安装过程：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">利用qemu</span>安装一个系统.</p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">在真机中配置并编译一个用于安装到虚拟系统中的新内核，注意配置时的选择</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">＊</span><span style="color:#333333">配置和启动</span></p> 
 <p align="left"><span style="color:#333333">1. </span><span style="color:#333333">内核选项</span></p> 
 <p align="left"><span style="color:#333333">同时，为了能在系统运行时中断系统并出发远程</span><span style="color:#333333"> gdb</span><span style="color:#333333">，必须打开内核</span><span style="color:#333333"> Magic Sys-Rq </span><span style="color:#333333">键选项</span><span style="color:#333333">：</span><span style="color:#333333">[</span><span style="color:#333333">后记，没实验去掉会怎样，估计没影响</span><span style="color:#333333">]</span></p> 
 <p align="left"><span style="color:#333333">CONFIG_MAGIC_SYSRQ=y</span></p> 
 <p align="left"><span style="color:#333333">打开内核符号调试：</span></p> 
 <p align="left"><span style="color:#333333">CONFIG_DEBUG_INFO=y</span></p> 
</div> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">在真机下编译好虚拟机新内核的源码</span></p> 
<p align="left"><span style="color:#333333">4. </span><span style="color:#333333">结束qemu</span>，用以下命令在真机上挂载虚拟硬盘。然后把编译好的整个源码目录都拷贝到挂载好的虚拟硬盘上（真机上保留一份源码）。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ sudo mount -o loop,offset=32256debian.img /mnt</span></p> 
</div> 
<p align="left"><span style="color:#333333">拷贝完后，在真机上卸载虚拟硬盘</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ sudo umount /mnt</span></p> 
</div> 
<p align="left"><span style="color:#333333">5.</span><span style="color:#333333">启动虚拟机，进入旧系统，在新内核源码根目录下用以下命令给qemu</span>的虚拟系统安装一个新的内核</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">拷贝模块</span></p> 
 <p align="left"><span style="color:#333333">$ make modules_install</span></p> 
 <p align="left"><span style="color:#333333">安装内核</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$ make install</span></p> 
 <p align="left"><span style="color:#333333">制作</span><span style="color:#333333">initrd.img</span></p> 
 <p align="left"><span style="color:#333333">$ cd /boot</span></p> 
 <p align="left"><span style="color:#333333">$ mkinitramfs /lib/modules/2.6.26/ -oinitrd.img-2.6.26</span></p> 
 <p align="left"><span style="color:#333333">检查</span><span style="color:#333333">/boot/grub/menu.lst </span><span style="color:#333333">文件内容是否妥当</span></p> 
</div> 
<p align="left"><span style="color:#333333">6.</span><span style="color:#333333">用以下命令重启虚拟系统，并选择进入新系统，确认新系统是否安装成功。</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ shutdown -r now</span></p> 
</div> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">调试：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">在真机新内核源码目录下建立一个文件 .gdbinit </span>内容是</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">target remote localhost:1234</span></p> 
 <p align="left"><span style="color:#333333">b start_kernel</span></p> 
 <p align="left"><span style="color:#333333">＃</span><span style="color:#333333">c</span></p> 
</div> 
<p align="left"><span style="color:#333333">注意我把c</span>注释掉是因为ddd和gdb有切换的需要。见”gdb技巧”</p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">用以下命令启动虚拟机</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">qemu -hda debian.img -cdrom../debian-testing-i386-CD-1.iso -m 500 -S -s</span></p> 
</div> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">在真机新内核源码目录下运行</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">gdb ./vmlinux</span></p> 
</div> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">实验记录]</span></p> 
<p align="left"><span style="color:#333333">实验过了，.config</span>中不选择kgdb，利用qemu照样能调试。也不能调试start_kernel以前的代码。比如head_32.S中的代码。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">CONFIG_HAVE_ARCH_KGDB=y</span></p> 
 <p align="left"><span style="color:#333333"># CONFIG_KGDB is not set</span></p> 
</div> 
<p align="left"><span style="color:#333333">但是不知CONFIG_HAVE_ARCH_KGDB</span>是在menuconfig菜单的哪里。想试试把这项去了qemu还能不能调试。</p> 
<p align="left"><span style="color:#333333">经测试，取消CONFIG_HAVE_ARCH_KGDB</span>后，qemu也能进行调试。情况不变。看来qemu能完全脱离内核中的kgdb就能调试内核。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">调试截图</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">步骤</span><span style="color:#333333">2</span><span style="color:#333333">：</span></p> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:/new/myqemu/debian-x86$ qemu-hda debian.img -cdrom ../debian-testing-i386-CD-1.iso -m 500 -S -s</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">步骤</span><span style="color:#333333">3:</span></p> 
 <p align="left"><span style="color:#333333">由下图我们注意到：</span><span style="color:#333333">“</span><span style="color:#333333">基于</span><span style="color:#333333">qemu</span><span style="color:#333333">和</span><span style="color:#333333">qemu</span><span style="color:#333333">内置</span><span style="color:#333333">gdbstub”</span><span style="color:#333333">这个方法的调试，最早只能从函数</span><span style="color:#333333">start_kernel () </span><span style="color:#333333">开始进行。</span></p> 
 <p align="left"><span style="color:#333333">内核在</span><span style="color:#333333">start_kernel ()</span><span style="color:#333333">之前的初始化过程就无法观察了。这就是这个方法的最大缺点。但下节利用</span><span style="color:#333333">skyeye</span><span style="color:#333333">调试</span><span style="color:#333333">arm-linux</span><span style="color:#333333">的</span></p> 
 <p align="left"><span style="color:#333333">方法就可以从第一个机器指令开始进行。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:/storage/myqemu/new/linux-2.6.26$gdb ./vmlinux </span></p> 
 <p align="left"><span style="color:#333333">GNU gdb 6.8-debian</span></p> 
 <p align="left"><span style="color:#333333">Copyright (C) 2008 Free SoftwareFoundation, Inc.</span></p> 
 <p align="left"><span style="color:#333333">License GPLv3+: GNU GPL version 3 orlater &lt;http://gnu.org/licenses/gpl.html&gt;</span></p> 
 <p align="left"><span style="color:#333333">This is free software: you are free tochange and redistribute it.</span></p> 
 <p align="left"><span style="color:#333333">There is NO WARRANTY, to the extentpermitted by law.  Type "showcopying"</span></p> 
 <p align="left"><span style="color:#333333">and "show warranty" fordetails.</span></p> 
 <p align="left"><span style="color:#333333">This GDB was configured as"i486-linux-gnu"...</span></p> 
 <p align="left"><span style="color:#333333">0x0000fff0 in ?? ()</span></p> 
 <p align="left"><span style="color:#333333">Breakpoint 1 at 0xc037f5ca: fileinit/main.c, line 535.</span></p> 
 <p align="left"><span style="color:#333333">(gdb) c</span></p> 
 <p align="left"><span style="color:#333333">Continuing.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Breakpoint 1, start_kernel () atinit/main.c:535</span></p> 
 <p align="left"><span style="color:#333333">535   {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">调试示意图：</span></p> 
 <p align="left"><span style="color:#333333">给</span><span style="color:#333333">sys_read</span><span style="color:#333333">下断点</span></p> 
 <p align="left"><span style="color:#333333">(gdb) b sys_read</span></p> 
 <p align="left"><span style="color:#333333">Breakpoint 2 at 0xc017585e: filefs/read_write.c, line 360.</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">用快捷键</span><span style="color:#333333"> ctrl+x+2 </span><span style="color:#333333">打开</span><span style="color:#333333">tui,</span><span style="color:#333333">并按</span><span style="color:#333333">c</span><span style="color:#333333">继续运行，而后拦截到</span><span style="color:#333333">sys_read</span></p> 
 <p align="left"><span style="color:#333333">  ┌──fs/read_write.c────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">  │354     {                                                                                                               │</span></p> 
 <p align="left"><span style="color:#333333">  │355             struct file*file;                                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │356             ssize_t ret =-EBADF;                                                                                   │</span></p> 
 <p align="left"><span style="color:#333333">  │357             intfput_needed;                                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │358                                                                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │359             file =fget_light(fd, &amp;fput_needed);                                                                    │</span></p> 
 <p align="left"><span style="color:#333333">B+&gt;│360             if (file) {                                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │361                     loff_tpos = file_pos_read(file);                                                               │</span></p> 
 <p align="left"><span style="color:#333333">  │362                     ret =vfs_read(file, buf, count, &amp;pos);                                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │363                    file_pos_write(file, pos);                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │364                    fput_light(file, fput_needed);                                                                  │</span></p> 
 <p align="left"><span style="color:#333333">  │365             }                                                                                                       │</span></p> 
 <p align="left"><span style="color:#333333">   │366                                                                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │367             return ret;                                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017585a &lt;sys_read&gt;          push   %ebp                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017585b &lt;sys_read+1&gt;        mov    %esp,%ebp                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017585d &lt;sys_read+3&gt;        push   %esi                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">B+&gt;│0xc017585e&lt;sys_read+4&gt;         mov    $0xfffffff7,%esi                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0175863 &lt;sys_read+9&gt;        push   %ebx                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0175864 &lt;sys_read+10&gt;       sub    $0xc,%esp                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0175867 &lt;sys_read+13&gt;       mov    0x8(%ebp),%eax                                                                   │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017586a &lt;sys_read+16&gt;       lea    -0xc(%ebp),%edx                                                                  │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017586d &lt;sys_read+19&gt;       call   0xc0175f65&lt;fget_light&gt;                                                          │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0175872 &lt;sys_read+24&gt;       test   %eax,%eax                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0175874 &lt;sys_read+26&gt;       mov    %eax,%ebx                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0175876 &lt;sys_read+28&gt;       je     0xc01758b1&lt;sys_read+87&gt;                                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0175878 &lt;sys_read+30&gt;       mov    0x24(%ebx),%edx                                                                  │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017587b &lt;sys_read+33&gt;       mov    0x20(%eax),%eax                                                                  │</span></p> 
 <p align="left"><span style="color:#333333">  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333">remote Thread 42000 In: sys_read                                                                   Line: 360  PC: 0xc017585e </span></p> 
 <p align="left"><span style="color:#333333">(gdb) c</span></p> 
 <p align="left"><span style="color:#333333">Continuing.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Breakpoint 2, sys_read (fd=3,buf=0xbfc781a4 "", count=512) at fs/read_write.c:360</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">arm</span><span style="color:#333333">虚拟调试环境的建立</span></strong></p> 
<p align="left"><strong><span style="color:#333333">利用qemu</span></strong></p> 
<p align="left"><strong><span style="color:#333333">利用qemu</span>安装debian linux</strong></p> 
<p align="left"><span style="color:#333333">目标：</span></p> 
<p align="left"><span style="color:#333333">本节在qemu</span>虚拟机上安装一个基于arm的“桌面“系统，可以有X桌面，该虚拟系统能利用apt-get从debian的软件库下载数不完的用交 叉编译已经编译好的arm下的程序和工具。除了虚拟处理器是arm外，简直就是PC机。可以进行应用程序的本机(在虚拟机内进行)调试。但是，本人装的时 候，如果选了安装桌面环境，内核就启动失败，好像是提示文件系统出错。［成功的麻烦把过程贴出来］</p> 
<p align="left"><span style="color:#333333">过程是:</span></p> 
<p align="left"><span style="color:#333333">Debian on anemulated ARM machine <a target="_blank" href="http://www.aurel32.net/info/debian_arm_qemu.php" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.aurel32.net/info/debian_arm_qemu.php</span></a></span></p> 
<p align="left"><span style="color:#333333">下面是过程的提炼步骤,</span>方便查看。</p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">创建虚拟硬盘</span></p> 
<p align="left"><span style="color:#333333">$ qemu-img create -fqcow hda.img 40G</span></p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">下载必要文件</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ wgethttp://people.debian.org/~aurel32/arm-versatile/vmlinuz-2.6.18-6-versatile</span></p> 
 <p align="left"><span style="color:#333333">$ wgethttp://people.debian.org/~aurel32/arm-versatile/initrd.img-2.6.18-6-versatile </span></p> 
 <p align="left"><span style="color:#333333">$ wgethttp://ftp.de.debian.org/debian/dists/etch/main/installer-arm/current/images/rpc/netboot/initrd.gz</span></p> 
</div> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">安装系统</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">qemu-system-arm -M versatilepb -kernelvmlinuz-2.6.18-6-versatile -initrd initrd.gz -hda hda.img -append"root=/dev/ram" </span></p> 
 <p align="left"><span style="color:#333333">在安装过程中，为了节省时间，在这步</span><span style="color:#333333">choose a mirror of the debian archive</span></p> 
 <p align="left"><span style="color:#333333">选</span><span style="color:#333333">http </span><span style="color:#333333">回车</span><span style="color:#333333"> ;</span></p> 
 <p align="left"><span style="color:#333333">debian archive mirror country </span> <span style="color:#333333">选</span><span style="color:#333333">taiwan </span><span style="color:#333333">回车</span><span style="color:#333333">; </span></p> 
 <p align="left"><span style="color:#333333">debian archive mirror </span><span style="color:#333333">选</span><span style="color:#333333">ftp.tw.debian.org</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">安装好基本系统后，不要选择安装</span><span style="color:#333333">Desktop environment</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">安装完成后，它提示你把光盘拿掉并重启系统时，终止掉</span><span style="color:#333333">qemu</span><span style="color:#333333">。并用下一步的命令启动</span><span style="color:#333333">qemu.</span><span style="color:#333333">不要回车，否则又重新安装。</span></p> 
</div> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">第一次启动系统</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ qemu-system-arm -M versatilepb -kernelvmlinuz-2.6.18-6-versatile -initrd initrd.img-2.6.18-6-versatile -hda hda.img-append "root=/dev/sda1"</span></p> 
</div> 
<p align="left"><span style="color:#333333">4. </span><span style="color:#333333">把旧的内核,intrd.img</span>制作工具安装到虚拟机的系统内（操作在虚拟机内）</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ apt-get install initramfs-tools</span></p> 
 <p align="left"><span style="color:#333333">$ wget http://people.debian.org/~aurel32/arm-versatile/linux-image-2.6.18-6-versatile_2.6.18.dfsg.1-18etch1+versatile_arm.deb</span></p> 
 <p align="left"><span style="color:#333333">$ su -c "dpkg -ilinux-image-2.6.18-6-versatile_2.6.18.dfsg.1-18etch1+versatile_arm.deb" </span></p> 
</div> 
<p align="left"><span style="color:#333333">5.</span><span style="color:#333333">其他更多的玩法请看原文<a target="_blank" href="http://www.aurel32.net/info/debian_arm_qemu.php" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.aurel32.net/info/debian_arm_qemu.php</span></a></span></p> 
<p align="left"><span style="color:#333333">参考：</span></p> 
<p align="left"><span style="color:#333333">Debian ARM Linux onQemu</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://909ers.apl.washington.edu/~dushaw/ARM/#SYSTEM" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://909ers.apl.washington.edu/~dushaw/ARM/#SYSTEM</span></a></span></p> 
<p align="left"><span style="color:#333333">Running Linux forARM processors under QEMU</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://iomem.com/index.php?archives/2-Running-Linux-for-ARM-processors-under-QEMU.html&amp;serendipity" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://iomem.com/index.php?archives/2-Running-Linux-for-ARM-processors-under-QEMU.html&amp;serendipity</span></a>[entrypage]=2</span></p> 
<p align="left"><span style="color:#333333">Debian on anemulated ARM machine</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.aurel32.net/info/debian_arm_qemu.php" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.aurel32.net/info/debian_arm_qemu.php</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">利用qemu</span>安装能进行内核调试的系统</strong></p> 
<p align="left"><span style="color:#333333">［暂时没法子，期待扩展。下面这个例子可以，但没尝试。估计这个方法与下节的利用skyeye</span>的方法相比，没有优势。因为这个方法可能也是不能进行全程调试。但是下面网站的资料还是有一定参考价值的。］</p> 
<p align="left"><span style="color:#333333">使用qemu-jk2410</span>做為學習環境：</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wiki.jk2410.org/wiki/%E4%BD%BF%E7%94%A8qemu-jk2410%E5%81%9A%E7%82%BA%E5%AD%B8%E7%BF%92%E7%92%B0%E5%A2%83" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.jk2410.org/wiki/%E4%BD%BF%E7%94%A8qemu-jk2410%E5%81%9A%E7%82%BA%E5%AD%B8%E7%BF%92%E7%92%B0%E5%A2%83</span></a></span></p> 
<p align="left"><span style="color:#333333">另外：看看下面这个站点，</span></p> 
<p align="left"><span style="color:#333333">Firmware Linux</span><span style="color:#333333">： <a target="_blank" href="http://landley.net/code/firmware/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://landley.net/code/firmware/</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">利用skyeye</span></strong></p> 
<p align="left"><strong><span style="color:#333333">skyeye</span><span style="color:#333333">虚拟机的内核调试</span></strong></p> 
<p align="left"><span style="color:#333333">相对于利用qemu</span>的方式，用skyeye虚拟机调试内核有个很重要的</p> 
<p align="left"><span style="color:#333333">优点是：</span></p> 
<p align="left"><span style="color:#333333">调试可以从第一条机器指令开始。这对研究系统启动过程提供了极大的便利。</span></p> 
<p align="left"><strong><span style="color:#333333">skyeye</span><span style="color:#333333">的安装与使用</span></strong></p> 
<p align="left"><span style="color:#333333">该文非常好，好像没啥要扩充的</span></p> 
<p align="left"><span style="color:#333333">SkyEye</span><span style="color:#333333">硬件模拟平台，第二部分: </span>安装与使用</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-skyeye/part2/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-skyeye/part2/</span></a></span></p> 
<p align="left"><span style="color:#333333">SkyEye UserManual <a target="_blank" href="http://www.skyeye.org/wiki/UserManual" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.skyeye.org/wiki/UserManual</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://skyeye.wiki.sourceforge.net/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://skyeye.wiki.sourceforge.net/</span></a></span></p> 
<p align="left"><span style="color:#333333">参考文档：</span></p> 
<p align="left"><span style="color:#333333">Linux-2.6.20 on XXXplatform</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://skyeye.wiki.sourceforge.net/Linux" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://skyeye.wiki.sourceforge.net/Linux</span></a></span></p> 
<p align="left"><span style="color:#333333">uClinux-dist-20070130on XXX platform</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://skyeye.wiki.sourceforge.net/uClinux" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://skyeye.wiki.sourceforge.net/uClinux</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxfans.org/bbs/thread-182101-1-1.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxfans.org/bbs/thread-182101-1-1.html</span></a></span></p> 
<p align="left"><span style="color:#333333">安装:</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">安装主程序</span></p> 
<p align="left"><span style="color:#333333">在ubuntu</span>系统能进行在线安装,但版本是v1.2,不是最新的</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$sudo apt-get install skyeye</span></p> 
</div> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">测试套件</span></p> 
<p align="left"><span style="color:#333333">测试套件下载后解压开即可</span></p> 
<p align="left"><span style="color:#333333">地址：<a target="_blank" href="http://sourceforge.net/project/showfiles.php?group_id=85554" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceforge.net/project/showfiles.php?group_id=85554</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">快速试玩</span></strong></p> 
<p align="left"><span style="color:#333333">目的:</span></p> 
<p align="left"><span style="color:#333333">尽可能快的成功运行一个arm linux</span>虚拟机。如果您化了很长时间也无法编译出一个能运行的内核，或写不出一个恰当的skyeye.conf时，在你的热情受到打击之前，我想这节是你急需的。</p> 
<p align="left"><span style="color:#333333">操作步骤：</span></p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">依照上节说明安装好主程序，下载并解压好测试套件</span></p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">进入测试套件的目录 skyeye-testsuite-1.2.5/linux/s3c2410/s3c2410x-2.6.14</span></p> 
<p align="left"><span style="color:#333333">可以看到有三个文件initrd.imgskyeye.conf vmlinux</span></p> 
<p align="left"><span style="color:#333333">3.</span><span style="color:#333333">运行虚拟机</span></p> 
<p align="left"><span style="color:#333333">$skyeye -e vmlinux</span></p> 
<p align="left"><span style="color:#333333">注意下面的提示，说明平时要注意在启动命令前加上sudo</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">NOTICE: you should be root at first !!!</span></p> 
 <p align="left"><span style="color:#333333">NOTICE: you should inmod linux kernelnet driver tun.o!!!</span></p> 
 <p align="left"><span style="color:#333333">NOTICE: if you don't make device node,you should do commands:</span></p> 
 <p align="left"><span style="color:#333333">NOTICE:    mkdir /dev/net; mknod /dev/net/tun c 10 200</span></p> 
 <p align="left"><span style="color:#333333">NOTICE: now the net simulation function cannot support!!!</span></p> 
 <p align="left"><span style="color:#333333">NOTICE: Please read SkyEye.README andtry again!!!</span></p> 
</div> 
<p align="left"><span style="color:#333333">4.</span><span style="color:#333333">可以看到，一个2.6.14 </span>版本的linux跑起来了，还带有一个lcd.</p> 
<p align="left"><strong><span style="color:#333333">快速配置能调试的环境</span></strong></p> 
<p align="left"><span style="color:#333333">参考：</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://skyeye.wiki.sourceforge.net/linux_2_6_17_lubbock" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://skyeye.wiki.sourceforge.net/linux_2_6_17_lubbock</span></a></span></p> 
<p align="left"><span style="color:#333333">环境条件：</span></p> 
<p align="left"><span style="color:#333333">1. ubuntu hardy 8.04</span></p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">安装了debian</span>提供的交叉编译工具套件 arm-linux-gnueabi- (4.2版本)</p> 
<p align="left"><span style="color:#333333">目标：</span></p> 
<p align="left"><span style="color:#333333">这小节能得到基于pxa</span>平台（类似s3c2410，也基于arm核心）的linux2.6.20内核的虚拟系统，具备调试功能。相比“基于qemu 和qemu内置gdbstub”该节，利用skyeye的调试有那节所没有的优点：调试时可以从内核运行的第一条指令开始［这就是模拟硬件调试？］。</p> 
<p align="left"><span style="color:#333333">参考手册：</span></p> 
<p align="left"><span style="color:#333333">XScale PXA250</span><span style="color:#333333">开发手册 <a target="_blank" href="http://soft.laogu.com/download/intelpxa250.pdf" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://soft.laogu.com/download/intelpxa250.pdf</span></a></span></p> 
<p align="left"><span style="color:#333333">ARMv5 </span><span style="color:#333333">体系结构参考手册 <a target="_blank" href="http://www.arm.com/community/university/eulaarmarm.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.arm.com/community/university/eulaarmarm.html</span></a></span></p> 
<p align="left"><span style="color:#333333">操作步骤：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">下载linux-2.6.20(</span>由于交叉编译器太新，如果利用linux-2.6.17则编译不过)</p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">修改文件include/asm-arm/arch-pxa/memory.h </span>第18行</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#define PHYS_OFFSET UL(0xa0000000)</span></p> 
 <p align="left"><span style="color:#333333">为</span></p> 
 <p align="left"><span style="color:#333333">#define PHYS_OFFSET UL(0xc0000000)</span></p> 
</div> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">下载内核配置选项，放置于linux-2.6.20</span>源码的根目录下 <a target="_blank" href="http://skyeye.wiki.sourceforge.net/space/showimage/skyeye_2.6.17_lubbock.config" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://skyeye.wiki.sourceforge.net/space/showimage/skyeye_2.6.17_lubbock.config</span></a></p> 
<p align="left"><span style="color:#333333">这个下载好的配置文件已经帮我们做了的两件事</span></p> 
<p align="left"><span style="color:#333333">首先，在block device</span>菜单下配置了ramdisk和initrd的支持</p> 
<p align="left"><span style="color:#333333">其次，把内核原来的启动参数改为</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">root=/dev/ram0 console=ttyS0initrd=0xc0800000,0x00800000 rw mem=64M</span></p> 
</div> 
<p align="left"><span style="color:#333333">4. </span><span style="color:#333333">把下载到的skyeye_2.6.17_lubbock.config</span>更名为.config</p> 
<p align="left"><span style="color:#333333">5. </span><span style="color:#333333">编译内核</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">make ARCH=armCROSS_COMPILE=arm-linux-gnueabi-</span></p> 
</div> 
<p align="left"><span style="color:#333333">6. </span><span style="color:#333333">创建文件 skyeye.conf</span>，内容如下：</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">cpu: pxa25x</span></p> 
 <p align="left"><span style="color:#333333">mach: pxa_lubbock</span></p> 
 <p align="left"><span style="color:#333333">mem_bank: map=I, type=RW,addr=0x40000000, size=0x0c000000</span></p> 
 <p align="left"><span style="color:#333333">mem_bank: map=M, type=RW,addr=0xc0000000, size=0x00800000</span></p> 
 <p align="left"><span style="color:#333333">mem_bank: map=M, type=RW,addr=0xc0800000, size=0x00800000, file=./initrd.img</span></p> 
 <p align="left"><span style="color:#333333">mem_bank: map=M, type=RW,addr=0xc1000000, size=0x00800000</span></p> 
 <p align="left"><span style="color:#333333">mem_bank: map=M, type=RW,addr=0xc1800000, size=0x02800000</span></p> 
</div> 
<p align="left"><span style="color:#333333">7. </span><span style="color:#333333">从skyeye</span>的测试套件中拷贝initrd.img到linux-2.6.20源码根目录下。该initrd.img的路径是：</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">skyeye-testsuite-1.2.5/linux/pxa/2.6.x/</span></p> 
</div> 
<p align="left"><span style="color:#333333">8. </span><span style="color:#333333">运行内核看看,</span>在linux-2.6.20源码根目录下运行下面的命令。可以看到，内核成功运行</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">sudo skyeye -e vmlinux</span></p> 
</div> 
<p align="left"><span style="color:#333333">调试：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">在linux-2.6.20</span>源码根目录下运行命令：</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">sudo skyeye -d -e vmlinux  </span></p> 
</div> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">在源码根目录下新开一个终端，并运行：</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">arm-linux-gnueabi-gdb ./vmlinux</span></p> 
</div> 
<p align="left"><span style="color:#333333">gdb</span><span style="color:#333333">界面出来后</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) target remote:12345</span></p> 
</div> 
<p align="left"><span style="color:#333333">之后可以看到，下断点，查看汇编等一切调试功能和x86</span>下都一样。</p> 
<p align="left"><span style="color:#333333">3. ddd</span><span style="color:#333333">下如何调用arm-linux-gnueabi-gdb ? </span>答</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ ddd --debugger arm-linux-gnueabi-gdb./vmlinux</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">为s3c2410</span>配置2.6.26内核</strong></p> 
<p align="left"><span style="color:#333333">［启动过程中有若干错误提示，但内核能启动成功并运行。有待研究］</span></p> 
<p align="left"><span style="color:#333333">目标：</span></p> 
<p align="left"><span style="color:#333333">得到一个基于s3c2410cpu</span>的2.6.26最新稳定内核的虚拟系统，能进行全程的内核调试，即调试能从第一条机器指令开始进行。</p> 
<p align="left"><span style="color:#333333">参考：</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://skyeye.wiki.sourceforge.net/Linux" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://skyeye.wiki.sourceforge.net/Linux</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxfans.org/bbs/thread-182101-1-1.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxfans.org/bbs/thread-182101-1-1.html</span></a></span></p> 
<p align="left"><span style="color:#333333">环境条件：</span></p> 
<p align="left"><span style="color:#333333">1. ubuntu hardy 8.04</span></p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">安装了debian</span>提供的交叉编译工具套件 arm-linux-gnueabi- (4.2版本)</p> 
<p align="left"><span style="color:#333333">操作步骤：</span></p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">依据“安装交叉编译工具”这节，安装好交叉编译工具</span></p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">修改源码</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">将</span><span style="color:#333333">include/asm-arm/arch-s3c2410/map.h</span><span style="color:#333333">里的</span></p> 
 <p align="left"><span style="color:#333333">#define S3C2410_CS6 (0x30000000)</span></p> 
 <p align="left"><span style="color:#333333">改为</span></p> 
 <p align="left"><span style="color:#333333">#define S3C2410_CS6 (0xc0000000)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">将</span><span style="color:#333333">include/asm-arm/arch-s3c2410/memory.h</span><span style="color:#333333">里的</span></p> 
 <p align="left"><span style="color:#333333">#define PHYS_OFFSET UL(0x30000000)</span></p> 
 <p align="left"><span style="color:#333333">改为</span></p> 
 <p align="left"><span style="color:#333333">#define PHYS_OFFSET UL(0xc0000000)</span></p> 
</div> 
<p align="left"><span style="color:#333333">3.</span><span style="color:#333333">把默认.config</span>替换为s3c2410版本</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">make ARCH=armCROSS_COMPILE=arm-linux-gnueabi- s3c2410_defconfig</span></p> 
</div> 
<p align="left"><span style="color:#333333">3.</span><span style="color:#333333">修改配置文件</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">make ARCH=armCROSS_COMPILE=arm-linux-gnueabi- menuconfig</span></p> 
 <p align="left"><span style="color:#333333">进入</span><span style="color:#333333">[Device Driver] -&gt;[ Character Driver] -&gt; [SerialDriver] </span><span style="color:#333333">等菜单下</span><span style="color:#333333"> ,</span></p> 
 <p align="left"><span style="color:#333333">取消</span><span style="color:#333333">8250/16550 and compatible serial support</span><span style="color:#333333">的选择</span></p> 
</div> 
<p align="left"><span style="color:#333333">4.</span><span style="color:#333333">修改内核启动命令</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">在</span><span style="color:#333333">Boot option --&gt; Default kernel command string </span><span style="color:#333333">里输入</span></p> 
 <p align="left"><span style="color:#333333">mem=32M console=ttySAC0 root=/dev/raminitrd=0xc0800000,0x00800000 ramdisk_size=2048 rw</span></p> 
</div> 
<p align="left"><span style="color:#333333">5.</span><span style="color:#333333">编译</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">make ARCH=armCROSS_COMPILE=arm-linux-gnueabi-</span></p> 
</div> 
<p align="left"><span style="color:#333333">6.</span><span style="color:#333333">从skyeye</span>的测试套件中拷贝相应的文件initrd.img和skyeye.conf到linux-2.6.26源码根目录下。这两个文件的位于</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">skyeye-testsuite-1.25/linux/s3c2410/s3c2410x-2.6.14/</span><span style="color:#333333">中</span></p> 
</div> 
<p align="left"><span style="color:#333333">7.</span><span style="color:#333333">启动虚拟机</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:~/dt/linux-2.6.26$ sudoskyeye -e vmlinux</span></p> 
</div> 
<p align="left"><span style="color:#333333">8.</span><span style="color:#333333">启动完成后那激动人心的logo</span>如下</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">Welcome to</span></p> 
 <p align="left"><span style="color:#333333">    _      _____      __  __    _      _</span></p> 
 <p align="left"><span style="color:#333333">   / \    /  __ \   /  \_/  \  ||    |_|                 </span></p> 
 <p align="left"><span style="color:#333333">  / _ \   | |  | |  //\   /\ \ | |     _ ____ _   _  _  _ </span></p> 
 <p align="left"><span style="color:#333333"> / /_\ \  | |__| | / /  \_/  \\| |    | |  _ \| | | |\ \/ /</span></p> 
 <p align="left"><span style="color:#333333"> //___\ \ | |__\ \ | |       | || |___ | ||_| | |_| |/    \</span></p> 
 <p align="left"><span style="color:#333333">/_/   \_\| |   \_\|_|       |_||_____||_|_| |_|\____|\_/\_/</span></p> 
 <p align="left"><span style="color:#333333">         </span></p> 
 <p align="left"><span style="color:#333333">ARMLinux for Skyeye </span></p> 
 <p align="left"><span style="color:#333333">For further information please check:</span></p> 
 <p align="left"><span style="color:#333333">http://www.skyeye.org/</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">BusyBox v1.4.1 (2007-02-10 01:19:06 CST)Built-in shell (ash)</span></p> 
 <p align="left"><span style="color:#333333">Enter 'help' for a list of built-incommands.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">/bin/ash: can't access tty; job controlturned off</span></p> 
 <p align="left"><span style="color:#333333">/ $ uname -a</span></p> 
 <p align="left"><span style="color:#333333">Linux skyeye 2.6.26 #2 Sun Oct 519:56:57 CST 2008 armv4tl unknown</span></p> 
 <p align="left"><span style="color:#333333">/ $ </span></p> 
</div> 
<p align="left"><span style="color:#333333">调试：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">在linux-2.6.26</span>源码根目录下新建文件”.gdbinit”，内容是：</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) target remote:12345</span></p> 
</div> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">在linux-2.6.26</span>源码根目录下命令：</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">sudo skyeye -d -e vmlinux  </span></p> 
</div> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">在源码根目录下新开一个终端，并运行：</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">arm-linux-gnueabi-gdb ./vmlinux</span></p> 
</div> 
<p align="left"><span style="color:#333333">之后可以看到，下断点，查看汇编等一切调试功能和x86</span>下都一样。</p> 
<p align="left"><span style="color:#333333">4. ddd</span><span style="color:#333333">下如何调用arm-linux-gnueabi-gdb ? </span>答</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ ddd --debugger arm-linux-gnueabi-gdb./vmlinux</span></p> 
</div> 
<p align="left"><span style="color:#333333">截图：</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">步骤</span><span style="color:#333333">2:</span></p> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:~/</span><span style="color:#333333">桌面</span><span style="color:#333333">/test/linux-2.6.26_s3c2410$ sudo skyeye -d -e vmlinux </span></p> 
 <p align="left"><span style="color:#333333">big_endian is false.</span></p> 
 <p align="left"><span style="color:#333333">arch: arm</span></p> 
 <p align="left"><span style="color:#333333">cpu info: armv4, arm920t, 41009200,ff00fff0, 2 </span></p> 
 <p align="left"><span style="color:#333333">mach info: name s3c2410x, mach_init addr0x805f030</span></p> 
 <p align="left"><span style="color:#333333">lcd_mod:1</span></p> 
 <p align="left"><span style="color:#333333">dbct info: Note: DBCT not compiled in.This option will be ignored</span></p> 
 <p align="left"><span style="color:#333333">uart_mod:0, desc_in:, desc_out:,converter:</span></p> 
 <p align="left"><span style="color:#333333">SKYEYE: use arm920t mmu ops</span></p> 
 <p align="left"><span style="color:#333333">Loaded RAM   ./initrd.img</span></p> 
 <p align="left"><span style="color:#333333">start addr is set to 0xc0008000 by execfile.</span></p> 
 <p align="left"><span style="color:#333333">debugmode= 1, filename = skyeye.conf,server TCP port is 12345</span></p> 
 <p align="left"><span style="color:#333333">------------------------</span></p> 
 <p align="left"><span style="color:#333333">步骤</span><span style="color:#333333">3:</span></p> 
 <p align="left"><span style="color:#333333">fqh@ubuntu:~/</span><span style="color:#333333">桌面</span><span style="color:#333333">/test/linux-2.6.26_s3c2410$ arm-linux-gnueabi-gdb vmlinux</span></p> 
 <p align="left"><span style="color:#333333">GNU gdb 6.8-debian</span></p> 
 <p align="left"><span style="color:#333333">Copyright (C) 2008 Free SoftwareFoundation, Inc.</span></p> 
 <p align="left"><span style="color:#333333">License GPLv3+: GNU GPL version 3 orlater &lt;http://gnu.org/licenses/gpl.html&gt;</span></p> 
 <p align="left"><span style="color:#333333">This is free software: you are free tochange and redistribute it.</span></p> 
 <p align="left"><span style="color:#333333">There is NO WARRANTY, to the extentpermitted by law.  Type "showcopying"</span></p> 
 <p align="left"><span style="color:#333333">and "show warranty" fordetails.</span></p> 
 <p align="left"><span style="color:#333333">This GDB was configured as"--host=i486-linux-gnu --target=arm-linux-gnueabi"...</span></p> 
 <p align="left"><span style="color:#333333">stext () at arch/arm/kernel/head.S:80</span></p> 
 <p align="left"><span style="color:#333333">80             msr      cpsr_c, #PSR_F_BIT | PSR_I_BIT | SVC_MODE@ ensure svc mode</span></p> 
 <p align="left"><span style="color:#333333">Current language:  auto; currently asm</span></p> 
 <p align="left"><span style="color:#333333">(gdb) source extendinstr //</span><span style="color:#333333">载入辅助的</span><span style="color:#333333">gdb</span><span style="color:#333333">宏</span></p> 
 <p align="left"><span style="color:#333333">--------------</span></p> 
 <p align="left"><span style="color:#333333">用快捷键</span><span style="color:#333333"> ctrl+x+2 </span><span style="color:#333333">打开</span><span style="color:#333333">tui</span><span style="color:#333333">模式后的图示，可看到调试是从第一条指令开始的。这对研究系统启动过程提供了极大的便利。</span></p> 
 <p align="left"><span style="color:#333333">  ┌──arch/arm/kernel/head.S────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│80              msr     cpsr_c, #PSR_F_BIT | PSR_I_BIT | SVC_MODE@ ensure svc mode                 │</span></p> 
 <p align="left"><span style="color:#333333">  │81                                                     @ and irqs disabled                         │</span></p> 
 <p align="left"><span style="color:#333333">  │82              mrc     p15, 0, r9, c0, c0              @ get processor id                          │</span></p> 
 <p align="left"><span style="color:#333333">  │83              bl      __lookup_processor_type         @ r5=procinfo r9=cpuid                      │</span></p> 
 <p align="left"><span style="color:#333333">  │84              movs    r10, r5                         @ invalid processor(r5=0)?                 │</span></p> 
 <p align="left"><span style="color:#333333">  │85              beq     __error_p                       @ yes, error 'p'                            │</span></p> 
 <p align="left"><span style="color:#333333">  │86              bl      __lookup_machine_type           @ r5=machinfo                               │</span></p> 
 <p align="left"><span style="color:#333333">  │87              movs    r8, r5                          @ invalid machine(r5=0)?                   │</span></p> 
 <p align="left"><span style="color:#333333">  │88              beq     __error_a                       @ yes, error 'a'                            │</span></p> 
 <p align="left"><span style="color:#333333">  │89              bl      __vet_atags                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │90              bl      __create_page_tables                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  └────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│0xc0008000 &lt;stext&gt;     msr    CPSR_c, #211    ; 0xd3                                              │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0008004 &lt;stext+4&gt;   mrc    15, 0, r9, cr0, cr0,{0}                                            │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0008008 &lt;stext+8&gt;   bl     0xc00082f8&lt;__lookup_processor_type&gt;                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc000800c &lt;stext+12&gt;  movs   r10, r5                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0008010 &lt;stext+16&gt;  beq    0xc0008190&lt;__error_p&gt;                                              │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0008014 &lt;stext+20&gt;  bl     0xc0008358&lt;__lookup_machine_type&gt;                                   │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0008018 &lt;stext+24&gt;  movs   r8, r5                                                              │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc000801c &lt;stext+28&gt;  beq    0xc00081e8&lt;__error_a&gt;                                              │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0008020 &lt;stext+32&gt;  bl     0xc00083a0&lt;__vet_atags&gt;                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0008024 &lt;stext+36&gt;  bl     0xc0008078&lt;__create_page_tables&gt;                                    │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0008028 &lt;stext+40&gt;  ldr    sp, [pc, #240]  ; 0xc0008120 &lt;__switch_data&gt;                         │</span></p> 
 <p align="left"><span style="color:#333333">  └────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333">remote Thread 42000 In: stext                                                 Line: 80   PC: 0xc0008000 </span></p> 
 <p align="left"><span style="color:#333333">(gdb) b sys_read  //</span><span style="color:#333333">下断点</span></p> 
 <p align="left"><span style="color:#333333">Breakpoint 1 at 0xc008cc4c: filefs/read_write.c, line 354.</span></p> 
 <p align="left"><span style="color:#333333">(gdb) c</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">----------------</span></p> 
 <p align="left"><span style="color:#333333">调试示意图</span></p> 
 <p align="left"><span style="color:#333333">效果可能与你机器上看到的不一样。这个例子中，每个</span><span style="color:#333333">gdb</span><span style="color:#333333">单步指令都会自动显示</span><span style="color:#333333">backtrace</span><span style="color:#333333">。这是因为本人使用了章节</span><span style="color:#333333">“gdb</span><span style="color:#333333">宏</span><span style="color:#333333">”</span><span style="color:#333333">中的</span><span style="color:#333333">extendinstr</span><span style="color:#333333">宏。</span></p> 
 <p align="left"><span style="color:#333333">  ┌──include/asm/thread_info.h──────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">  │91       */                                                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │92      static inline structthread_info *current_thread_info(void) __attribute_const__;                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │93                                                                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │94      static inline structthread_info *current_thread_info(void)                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │95      {                                                                                                               │</span></p> 
 <p align="left"><span style="color:#333333">  │96              register unsignedlong sp asm ("sp");                                                                   │</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│97              return(struct thread_info *)(sp &amp; ~(THREAD_SIZE - 1));                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │98      }                                                                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │99                                                                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │100     /* thread informationallocation */                                                                              │</span></p> 
 <p align="left"><span style="color:#333333">  │101     #ifdefCONFIG_DEBUG_STACK_USAGE                                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │102     #definealloc_thread_info(tsk) \                                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │103             ((structthread_info *)__get_free_pages(GFP_KERNEL | __GFP_ZERO, \                                       │</span></p> 
 <p align="left"><span style="color:#333333">  │104                    THREAD_SIZE_ORDER))                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d480 &lt;fget_light&gt;        mov    r12, sp                                                                           │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d484 &lt;fget_light+4&gt;      push   {r11, r12, lr, pc}                                                               │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d488 &lt;fget_light+8&gt;      sub    r11, r12, #4    ; 0x4                                                            │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d48c &lt;fget_light+12&gt;     bic    r3, sp, #8128   ; 0x1fc0                                                         │</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│0xc008d490 &lt;fget_light+16&gt;      bic   r3, r3, #63     ; 0x3f                                                            │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d494 &lt;fget_light+20&gt;     ldr    r3, [r3, #12]                                                                    │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d498 &lt;fget_light+24&gt;     mov    r12, #0 ; 0x0                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d49c &lt;fget_light+28&gt;     ldr    r2, [r3, #560]                                                                   │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d4a0 &lt;fget_light+32&gt;     str    r12, [r1]                                                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d4a4 &lt;fget_light+36&gt;     ldr    r3, [r2]                                                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d4a8 &lt;fget_light+40&gt;     cmp    r3, #1  ; 0x1                                                                    │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d4ac &lt;fget_light+44&gt;     bne    0xc008d4d0&lt;fget_light+80&gt;                                                       │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d4b0 &lt;fget_light+48&gt;     ldr    r2, [r2, #4]                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc008d4b4 &lt;fget_light+52&gt;     ldr    r3, [r2]                                                                         │</span></p> 
 <p align="left"><span style="color:#333333">  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333">remote Thread 42000 In: fget_light                                                                 Line: 97   PC: 0xc008d490 </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Program received signal SIGHUP, Hangup.</span></p> 
 <p align="left"><span style="color:#333333">0xc008d490 in fget_light (fd=1, fput_needed=0xc1c17ed4)at include/asm/thread_info.h:97</span></p> 
 <p align="left"><span style="color:#333333">-------------------</span></p> 
 <p align="left"><span style="color:#333333">#0 0xc008d490 in fget_light (fd=1, fput_needed=0xc1c17ed4) atinclude/asm/thread_info.h:97</span></p> 
 <p align="left"><span style="color:#333333">#1 0xc008cc5c in sys_read (fd=1, buf=0xc1196800 "", count=512) atfs/read_write.c:359</span></p> 
 <p align="left"><span style="color:#333333">#2 0xc000ac7c in rd_load_image (from=0xc02b43bc "/initrd.image")at init/do_mounts_rd.c:108</span></p> 
 <p align="left"><span style="color:#333333">#3 0xc000bbe8 in initrd_load () at init/do_mounts_initrd.c:121</span></p> 
 <p align="left"><span style="color:#333333">#4 0xc00094c0 in prepare_namespace () at init/do_mounts.c:384</span></p> 
 <p align="left"><span style="color:#333333">#5 0xc0008a9c in kernel_init (unused=&lt;value optimized out&gt;) atinit/main.c:878</span></p> 
 <p align="left"><span style="color:#333333">#6 0xc0048484 in sys_waitid (which=&lt;value optimized out&gt;,upid=-1044283692, infop=0x0, options=0, ru=Cannot access memory at</span></p> 
 <p align="left"><span style="color:#333333">address 0x4</span></p> 
 <p align="left"><span style="color:#333333">) at kernel/exit.c:1689</span></p> 
 <p align="left"><span style="color:#333333">Backtrace stopped: previous frame innerto this frame (corrupt stack?)</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">使用最新的skyeye</span></strong></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">新版本的改进</span></p> 
<p align="left"><span style="color:#333333">在ubuntu</span>下利用在线安装命令所安装的skyeye是旧的版本，新版本修正了旧版本的一些小问题。比如，旧版本在调试时会出现下面一些烦人的小提示。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">Can't send signals to this remotesystem.  SIGHUP not sent.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Program received signal SIGHUP, Hangup.</span></p> 
</div> 
<p align="left"><span style="color:#333333">但是，两个版本并不是完全兼容的，主要是skyeye.conf</span>的处理上。不过，幸好这些都是很容易解决的问题。</p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">新版本的安装</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://sourceforge.net/project/showfiles.php?group_id=85554" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceforge.net/project/showfiles.php?group_id=85554</span></a></span></p> 
<p align="left"><span style="color:#333333">到上面的网站下载最新版本，目前是skyeye-1.2.6_rc1</span>。解压后用下面命令编译就可以了</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$./configure</span></p> 
 <p align="left"><span style="color:#333333">$ make STATIC=1</span></p> 
</div> 
<p align="left"><span style="color:#333333">然后把在源码根目录下生成的skyeye</span>拷到内核目录下运行即可。这样系统中的老版本skyeye还照样可以使用。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">sudo ./skyeye -d -e vmlinux</span></p> 
</div> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">新老版本的兼容问题</span></p> 
<p align="left"><span style="color:#333333">主要是skyeye.conf</span>的格式识别上。老版本要求load_address,load_address_mask不能写在skyeye.conf文件内部，只能用-l选项指定。如果运行老版本时提示skyeye.conf出错，你就得去查查那里，并手动修改处理一下即可。</p> 
<p align="left"><strong><span style="color:#333333">arm</span><span style="color:#333333">开发板调试环境的建立</span></strong></p> 
<p align="left"><strong><span style="color:#333333">基于串口</span></strong></p> 
<p align="left"><span style="color:#333333">为qq2440</span>平台移植2.6.26或更新内核，并建立kgdb调试环境</p> 
<p align="left"><span style="color:#333333">进行中...</span></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">移植中的一些零碎的笔记]</span></p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">内核版本</span></p> 
<p align="left"><span style="color:#333333">使用linus</span>的git，但是已知2.6.25中arm已经支持kgdb了。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:/storage/linus-git/linux-2.6$git-describe </span></p> 
 <p align="left"><span style="color:#333333">v2.6.27-rc9-2-g85ba94b</span></p> 
</div> 
<p align="left"><span style="color:#333333">2.</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">arm</span><span style="color:#333333">体系的默认配置文件在</span></p> 
 <p align="left"><span style="color:#333333">arch/arm/configs</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">make ARCH=armCROSS_COMPILE=arm-linux-gnueabi- s3c2410_defconfig</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">make ARCH=armCROSS_COMPILE=arm-linux-gnueabi- menuconfig</span></p> 
 <p align="left"><span style="color:#333333">选取以下选现</span></p> 
 <p align="left"><span style="color:#333333">CONFIG_DEBUG_INFO=y</span></p> 
 <p align="left"><span style="color:#333333">CONFIG_KGDB=y</span></p> 
 <p align="left"><span style="color:#333333">CONFIG_KGDB_SERIAL_CONSOLE=y</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">make ARCH=armCROSS_COMPILE=arm-linux-gnueabi-</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">移植环境</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">windows</span><span style="color:#333333">：硬盘安装的真实系统</span><span style="color:#333333">(XP)</span></p> 
 <p align="left"><span style="color:#333333">ubuntu: </span><span style="color:#333333">运行在</span><span style="color:#333333">windows</span><span style="color:#333333">下的</span><span style="color:#333333">vmware</span><span style="color:#333333">虚拟机中</span></p> 
 <p align="left"><span style="color:#333333">qq2440</span><span style="color:#333333">开发板</span><span style="color:#333333">:</span><span style="color:#333333">真实开发板</span><span style="color:#333333">,IP</span><span style="color:#333333">是</span><span style="color:#333333">192.168.1.230</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">第一天</span><span style="color:#333333">:(</span><span style="color:#333333">完成</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333">熟悉开发板，</span><span style="color:#333333">PC</span><span style="color:#333333">机，虚拟机的网络互连</span></p> 
 <p align="left"><span style="color:#333333">理解内核启动过程</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">开发板与</span><span style="color:#333333">PC</span><span style="color:#333333">机</span><span style="color:#333333">(XP)PING</span><span style="color:#333333">不通的原因有</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">1. PC</span><span style="color:#333333">机开着防火</span></p> 
 <p align="left"><span style="color:#333333">2. PC</span><span style="color:#333333">机上的</span><span style="color:#333333">VMWARE</span><span style="color:#333333">的网络设置有问题（先卸载确认）</span></p> 
 <p align="left"><span style="color:#333333">3. </span><span style="color:#333333">安全类软件造成，比如卡巴司机</span><span style="color:#333333">(</span><span style="color:#333333">先卸载，不行重装系统</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">ubuntu</span><span style="color:#333333">的网络配置分两种情况，一种是平时上网用的，一种是和开发板通讯用的。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">平时使用虚拟机</span><span style="color:#333333">ubuntu</span><span style="color:#333333">上网的配置：</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">连接方式选出</span><span style="color:#333333">NAT: used to share the host's IP address</span></p> 
 <p align="left"><span style="color:#333333">虚拟系统启动后</span><span style="color:#333333">,</span><span style="color:#333333">桌面右上角的</span></p> 
 <p align="left"><span style="color:#333333">wiredconnection-&gt;properties-&gt;configuration</span><span style="color:#333333">选</span><span style="color:#333333">automatic configuration(DHCP)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">开发板挂载</span><span style="color:#333333">ubuntu</span><span style="color:#333333">虚拟系统中的</span><span style="color:#333333">nfs</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">1.</span><span style="color:#333333">虚拟机本身的网络设置不用动</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">2.</span><span style="color:#333333">虚拟系统如</span><span style="color:#333333">ubuntu</span><span style="color:#333333">的网卡设置改为桥接</span></p> 
 <p align="left"><span style="color:#333333">edit virtual machinesettings-&gt;virtual machine setting-&gt;hardware-&gt;ethernet</span></p> 
 <p align="left"><span style="color:#333333">-&gt;bridged:connected directly to thephysical network</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">3.</span><span style="color:#333333">虚拟系统启动后</span><span style="color:#333333">,</span><span style="color:#333333">桌面右上角的</span><span style="color:#333333">manual network configuration</span><span style="color:#333333">要改</span><span style="color:#333333">.</span></p> 
 <p align="left"><span style="color:#333333">点左键</span><span style="color:#333333">-&gt;network settings-&gt;wiredconnection-&gt;properties:enable roaming mode</span><span style="color:#333333">不选，</span></p> 
 <p align="left"><span style="color:#333333">connection settings</span></p> 
 <p align="left"><span style="color:#333333">configuration:static IP address</span></p> 
 <p align="left"><span style="color:#333333">IP address:192.168.1.111 </span><span style="color:#333333">与</span><span style="color:#333333">PC</span><span style="color:#333333">机</span><span style="color:#333333">IP</span><span style="color:#333333">，开发板</span><span style="color:#333333">IP</span><span style="color:#333333">同个网段</span></p> 
 <p align="left"><span style="color:#333333">subnet mask:255.255.255.0</span></p> 
 <p align="left"><span style="color:#333333">gateway address:</span><span style="color:#333333">空</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">PC</span><span style="color:#333333">机网络信息：</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Ethernet adapter </span><span style="color:#333333">本地连接：</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       Connection-specific DNS Suffix  .:</span></p> 
 <p align="left"><span style="color:#333333">       IP Address. . . . . . . . . . . . : 192.168.1.100  </span></p> 
 <p align="left"><span style="color:#333333">       Subnet Mask . . . . . . . . . . . : 255.255.255.0</span></p> 
 <p align="left"><span style="color:#333333">       Default Gateway . . . . . . . . . :</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">开发板的网络信息：</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">[root@(none) /]# ifconfig</span></p> 
 <p align="left"><span style="color:#333333">eth0     Link encap:Ethernet  HWaddr08:00:3E:26:0A:5B  </span></p> 
 <p align="left"><span style="color:#333333">         inet addr:192.168.1.230  Bcast:192.168.1.255  Mask:255.255.255.0</span></p> 
 <p align="left"><span style="color:#333333">         UP BROADCAST RUNNING MULTICAST MTU:1500  Metric:1</span></p> 
 <p align="left"><span style="color:#333333">         RX packets:1011 errors:0 dropped:0 overruns:0 frame:0</span></p> 
 <p align="left"><span style="color:#333333">         TX packets:610 errors:0 dropped:0 overruns:0 carrier:0</span></p> 
 <p align="left"><span style="color:#333333">         collisions:0 txqueuelen:1000 </span></p> 
 <p align="left"><span style="color:#333333">         RX bytes:111858 (109.2 KiB)  TXbytes:57276 (55.9 KiB)</span></p> 
 <p align="left"><span style="color:#333333">         Interrupt:53 Base address:0x300 </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">windows</span><span style="color:#333333">打开</span><span style="color:#333333">ubuntu</span><span style="color:#333333">中的</span><span style="color:#333333">samba</span><span style="color:#333333">共享目录的方法</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">\\192.168.1.111</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">ubuntu</span><span style="color:#333333">中</span><span style="color:#333333">nfs</span><span style="color:#333333">服务的安装和启用</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$ sudo apt-get install nfs-common</span></p> 
 <p align="left"><span style="color:#333333">$ sudo apt-get install nfs-kernel-server</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$ sudo vi /etc/exports</span></p> 
 <p align="left"><span style="color:#333333">/new/root_nfs *(rw,sync)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$ sudo /etc/init.d/nfs-kernel-serverstart</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">4. </span><span style="color:#333333">檢查</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$ showmount -e localhost</span></p> 
 <p align="left"><span style="color:#333333">开发板挂载</span><span style="color:#333333">nfs</span><span style="color:#333333">成功后可看到显示结果是</span></p> 
 <p align="left"><span style="color:#333333">All mount points on localhost:</span></p> 
 <p align="left"><span style="color:#333333">192.168.1.230:/new/root_nfs</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">开发板挂载</span><span style="color:#333333">ubuntu</span><span style="color:#333333">中的</span><span style="color:#333333">nfs</span></p> 
 <p align="left"><span style="color:#333333">(</span><span style="color:#333333">此时运行的文件系统还是在开发板上</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">mount -t nfs -o nolock192.168.1.111:/new/root_nfs /tmp/fuck</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">192.168.1.111</span><span style="color:#333333">：</span><span style="color:#333333">ubuntu</span><span style="color:#333333">的</span><span style="color:#333333">IP</span></p> 
 <p align="left"><span style="color:#333333">/tmp/fuck:</span><span style="color:#333333">开发板中的挂载点</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">[root@(none) /]# mount -t nfs -o nolock192.168.1.111:/new/root_nfs /tmp/fuck</span></p> 
 <p align="left"><span style="color:#333333">[root@(none) /]# cd /tmp/fuck/</span></p> 
 <p align="left"><span style="color:#333333">[root@(none) fuck]# ls</span></p> 
 <p align="left"><span style="color:#333333">bin              lib              proc             usr</span></p> 
 <p align="left"><span style="color:#333333">dev              linuxrc          sbin             var</span></p> 
 <p align="left"><span style="color:#333333">etc              mnt              shanghaitan.mp3  www</span></p> 
 <p align="left"><span style="color:#333333">home             opt              tmp</span></p> 
 <p align="left"><span style="color:#333333">-----</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">通过</span><span style="color:#333333">nfs</span><span style="color:#333333">启动开发板</span></p> 
 <p align="left"><span style="color:#333333">(</span><span style="color:#333333">挂载的文件系统是在</span><span style="color:#333333">ubuntu</span><span style="color:#333333">虚拟系统上</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">下面文字来自于：</span><span style="color:#333333">Embedded Linux Primer: A Practical,Real-World Approach</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">ip=192.168.1.139:192.168.1.1:192.168.1.1:255.255.255.0:coyote1:eth0:off</span></p> 
 <p align="left"><span style="color:#333333">ip=&lt;client-ip&gt;:&lt;server-ip&gt;:&lt;gw-ip&gt;:&lt;netmask&gt;:&lt;hostname&gt;:&lt;device&gt;:&lt;PROTO&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Here, client-ip is the target's IPaddress; server-ip is the address of the NFS server; gw-ip is the gateway(router), in case the server-ip is on a different subnet; and netmask definesthe class of IP addressing. hostname is a string that is passed as the targethostname; device is the Linux device name, such as eth0; and PROTO defines theprotocol used to obtain initial IP parameters.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">本人的实际操作的命令参数是：</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">param set linux_cmd_line"console=ttySAC0 root=/dev/nfs nfsroot=192.168.1.111:/new/root_nfsip=192.168.1.130:192.168.1.111:192.168.1.111:255.255.255.0:sbc2440.arm9.net:eth0:off"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">注意把编辑器的换行功能去掉后，再复制上面的命令。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">192.168.1.130</span><span style="color:#333333">是开发板的</span><span style="color:#333333">IP</span><span style="color:#333333">，系统启动后，用</span><span style="color:#333333">ifconfig</span><span style="color:#333333">就会显示这个</span><span style="color:#333333">IP</span><span style="color:#333333">地址。可以随意设置，当然要满足和</span><span style="color:#333333">PC</span><span style="color:#333333">机，</span><span style="color:#333333">ubuntu</span><span style="color:#333333">的</span><span style="color:#333333">IP</span><span style="color:#333333">在同个网段，而且不能冲突的先前条件。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">130:192.168.1.111</span><span style="color:#333333">：</span><span style="color:#333333">nfs</span><span style="color:#333333">的</span><span style="color:#333333">server,</span><span style="color:#333333">也就是</span><span style="color:#333333">ubuntu</span><span style="color:#333333">的</span><span style="color:#333333">IP</span></p> 
 <p align="left"><span style="color:#333333">按住空格健重启开发板</span><span style="color:#333333">,</span><span style="color:#333333">出现：</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">+---------------------------------------------+</span></p> 
 <p align="left"><span style="color:#333333">| S3C2440A USB Downloader ver R0.03 2004Jan  |</span></p> 
 <p align="left"><span style="color:#333333">+---------------------------------------------+</span></p> 
 <p align="left"><span style="color:#333333">USB: IN_ENDPOINT:1 OUT_ENDPOINT:3</span></p> 
 <p align="left"><span style="color:#333333">FORMAT:&lt;ADDR(DATA):4&gt;+&lt;SIZE(n+10):4&gt;+&lt;DATA:n&gt;+&lt;CS:2&gt;</span></p> 
 <p align="left"><span style="color:#333333">NOTE: Power off/on or press the resetbutton for 1 sec</span></p> 
 <p align="left"><span style="color:#333333">     in order to get a valid USB device address.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">NAND device: Manufacture ID: 0xec, ChipID: 0x76 (Samsung K9D1208V0M)</span></p> 
 <p align="left"><span style="color:#333333">Found saved vivi parameters.</span></p> 
 <p align="left"><span style="color:#333333">Press Return to start the LINUX/Wincenow, any other key for vivi</span></p> 
 <p align="left"><span style="color:#333333">type "help" for help.</span></p> 
 <p align="left"><span style="color:#333333">Supervivi&gt; menu                   </span> </p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">##### FriendlyARM BIOS for 2440 #####</span></p> 
 <p align="left"><span style="color:#333333">[x] bon part 0 320k 2368k </span></p> 
 <p align="left"><span style="color:#333333">[v] Download vivi </span></p> 
 <p align="left"><span style="color:#333333">[k] Download linux kernel </span></p> 
 <p align="left"><span style="color:#333333">[y] Download root_yaffs image </span> </p> 
 <p align="left"><span style="color:#333333">[c] Download root_cramfs image </span> </p> 
 <p align="left"><span style="color:#333333">[n] Download Nboot </span></p> 
 <p align="left"><span style="color:#333333">[e] Download Eboot </span></p> 
 <p align="left"><span style="color:#333333">[i] Download WinCE NK.nb0 </span></p> 
 <p align="left"><span style="color:#333333">[w] Download WinCE NK.bin </span></p> 
 <p align="left"><span style="color:#333333">[d] Download &amp; Run </span></p> 
 <p align="left"><span style="color:#333333">[f] Format the nand flash </span></p> 
 <p align="left"><span style="color:#333333">[p] Partition for Linux </span></p> 
 <p align="left"><span style="color:#333333">[b] Boot the system </span></p> 
 <p align="left"><span style="color:#333333">[s] Set the boot parameters </span></p> 
 <p align="left"><span style="color:#333333">[t] Print the TOC struct of wince </span> </p> 
 <p align="left"><span style="color:#333333">[q] Goto shell of vivi </span></p> 
 <p align="left"><span style="color:#333333">Enter your selection: s //&lt;--</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">##### Parameter Menu #####</span></p> 
 <p align="left"><span style="color:#333333">[r] Reset parameter table to defaulttable </span></p> 
 <p align="left"><span style="color:#333333">[s] Set parameter </span></p> 
 <p align="left"><span style="color:#333333">[v] View the parameter table  </span> </p> 
 <p align="left"><span style="color:#333333">[w] Write the parameter table to flashmemeory </span></p> 
 <p align="left"><span style="color:#333333">[q] Quit                           </span> </p> 
 <p align="left"><span style="color:#333333">Enter your selection: s //&lt;--</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Enter the parameter's name(mach_type,media_type, linux_cmd_line, etc): linux_cmd_line</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Enter the parameter's value(if the valuecontains space, enclose it with "): "console=ttySAC0 root=/dev/nfsnfsroot=192.168.1.111:/new/root_nfsip=192.168.1.130:192.168.1.111:192.168.1.111:255.255.255.0:sbc2440.arm9.net:eth0:off"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Change linux command line to"console=ttySAC0 root=/dev/nfs nfsroot=192.168.1.111:/new/root_nfsip=192.168.1.130:192.168.1.111:192.168.1.111:255.255.255.0:sbc2440.arm9.net:eth0:off"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">##### Parameter Menu #####</span></p> 
 <p align="left"><span style="color:#333333">[r] Reset parameter table to defaulttable </span></p> 
 <p align="left"><span style="color:#333333">[s] Set parameter </span></p> 
 <p align="left"><span style="color:#333333">[v] View the parameter table  </span> </p> 
 <p align="left"><span style="color:#333333">[w] Write the parameter table to flashmemeory </span></p> 
 <p align="left"><span style="color:#333333">[q] Quit </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Enter your selection: w  //&lt;--</span></p> 
 <p align="left"><span style="color:#333333">Found block size = 0x0000c000</span></p> 
 <p align="left"><span style="color:#333333">Erasing...    ... done</span></p> 
 <p align="left"><span style="color:#333333">Writing...    ... done</span></p> 
 <p align="left"><span style="color:#333333">Written 49152 bytes</span></p> 
 <p align="left"><span style="color:#333333">Saved vivi private data</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">第二天：</span><span style="color:#333333">(</span><span style="color:#333333">完成</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333">文件系统制作</span></p> 
 <p align="left"><span style="color:#333333">理解系统启动过程</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">先实验在</span><span style="color:#333333">skyeye</span><span style="color:#333333">下能不能成功，学习一下文件系统的制作。而后再下载到开发板实验</span></p> 
 <p align="left"><span style="color:#333333">dd if=/dev/zero of=./test.image bs=1kcount=8192  </span></p> 
 <p align="left"><span style="color:#333333">块大小单位：</span><span style="color:#333333">1k,8120</span><span style="color:#333333">块，</span><span style="color:#333333">8M</span></p> 
 <p align="left"><span style="color:#333333">mke2fs ./test.image</span></p> 
 <p align="left"><span style="color:#333333">格式化</span></p> 
 <p align="left"><span style="color:#333333">mkdir fuckroot</span></p> 
 <p align="left"><span style="color:#333333">tar -xzvf root_mini.tgz</span></p> 
 <p align="left"><span style="color:#333333">sudo mount -o loop test.image./fuckroot/</span></p> 
 <p align="left"><span style="color:#333333">cp -r root_mini/* fuckroot/ </span></p> 
 <p align="left"><span style="color:#333333">sudo umount fuckroot/</span></p> 
 <p align="left"><span style="color:#333333">可以将文件系统映像压缩后再使用：</span></p> 
 <p align="left"><span style="color:#333333">gzip -v9 test.image &gt; test.image.gz</span></p> 
 <p align="left"><span style="color:#333333">本人这个文件系统解压后的大小是</span><span style="color:#333333">6.4M,</span><span style="color:#333333">制作成</span><span style="color:#333333">8M</span><span style="color:#333333">大的</span><span style="color:#333333">test.image</span><span style="color:#333333">，压缩成</span><span style="color:#333333">test.image.gz</span><span style="color:#333333">后只有</span><span style="color:#333333">2.9M</span><span style="color:#333333">大。</span></p> 
 <p align="left"><span style="color:#333333">但是利用</span><span style="color:#333333">skyeye</span><span style="color:#333333">启动时，解压花的时间比较长。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">命令行中的</span><span style="color:#333333">ramdisk_size</span><span style="color:#333333">太小，修改</span><span style="color:#333333">.</span></p> 
 <p align="left"><span style="color:#333333">mem=32M console=ttySAC0 root=/dev/raminitrd=0xc0800000,0x00800000 ramdisk_size=8192 rw initcall_debug</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">ramdisk_size=N</span></p> 
 <p align="left"><span style="color:#333333">This parameter tells the RAM disk driverto set up RAM disks of N k size. </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">问题，文件系统没创建</span><span style="color:#333333">console</span><span style="color:#333333">设备节点：</span></p> 
 <p align="left"><span style="color:#333333">RAMDISK: Loading 8192KiB [1 disk] intoram disk... done.</span></p> 
 <p align="left"><span style="color:#333333">VFS: Mounted root (ext2 filesystem).</span></p> 
 <p align="left"><span style="color:#333333">Freeing init memory: 132K</span></p> 
 <p align="left"><span style="color:#333333">Warning: unable to open an initialconsole.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">创建</span><span style="color:#333333">rootfs</span><span style="color:#333333">过程中，在</span><span style="color:#333333">/dev</span><span style="color:#333333">目录下手动创建如下节点：</span></p> 
 <p align="left"><span style="color:#333333">mknod -m 660 null c 1 3</span></p> 
 <p align="left"><span style="color:#333333">mknod -m 660 console c 5 1</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">结果：</span></p> 
 <p align="left"><span style="color:#333333">VFS: Mounted root (ext2 filesystem).</span></p> 
 <p align="left"><span style="color:#333333">Freeing init memory: 132K</span></p> 
 <p align="left"><span style="color:#333333">hwclock: Could not access RTC: No suchfile or directory</span></p> 
 <p align="left"><span style="color:#333333">mknod: /dev/pts/0: No such file ordirectory</span></p> 
 <p align="left"><span style="color:#333333">mount: Mounting none on /tmp failed:Invalid argument</span></p> 
 <p align="left"><span style="color:#333333">mount: Mounting none on /var failed:Invalid argument</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 44:cannot create /dev/vc/0: Directory nonexistent</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 45:cannot create /dev/vc/0: Directory nonexistent</span></p> 
 <p align="left"><span style="color:#333333">/etc/rc.d/init.d/httpd: /etc/rc.d/init.d/httpd:16: /sbin/boa: not found</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 48:cannot create /dev/vc/0: Directory nonexistent</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 49:cannot create /dev/vc/0: Directory nonexistent</span></p> 
 <p align="left"><span style="color:#333333">/etc/rc.d/init.d/leds:/etc/rc.d/init.d/leds: 16: /etc/init.d/rcS: /etc/init.d/rcS: 52: cannot create/dev/vc/0: Directory nonexistent</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 53:cannot create /dev/vc/0: Directory nonexistent</span></p> 
 <p align="left"><span style="color:#333333">                        </span></p> 
 <p align="left"><span style="color:#333333">/sbin/led-player: not found</span></p> 
 <p align="left"><span style="color:#333333">SIOCSIFADDR: No such device</span></p> 
 <p align="left"><span style="color:#333333">SIOCGIFFLAGS: No such device</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 59:/sbin/madplay: not found</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Please press Enter to activate thisconsole. </span></p> 
 <p align="left"><span style="color:#333333">-sh: can't access tty; job controlturned off</span></p> 
 <p align="left"><span style="color:#333333">id: unknown uid 0</span></p> 
 <p align="left"><span style="color:#333333">[@FriendlyARM /]# ls</span></p> 
 <p align="left"><span style="color:#333333">bin         home        lost+found  sbin       var</span></p> 
 <p align="left"><span style="color:#333333">dev         lib         mnt         tmp         www</span></p> 
 <p align="left"><span style="color:#333333">etc         linuxrc     proc       usr</span></p> 
 <p align="left"><span style="color:#333333">[@FriendlyARM /dev]# ls</span></p> 
 <p align="left"><span style="color:#333333">console dsp      fb0      mixer   null     sda1     tty1    video0</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">还有一堆提示，但总算系统能跑了。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">现在我的心头大患是</span><span style="color:#333333">udev</span><span style="color:#333333">的问题，因为</span><span style="color:#333333">2.6.26</span><span style="color:#333333">内核中没有</span><span style="color:#333333">devfs</span><span style="color:#333333">了。但有下面这篇文章参考</span></p> 
 <p align="left"><span style="color:#333333">udev</span><span style="color:#333333">轻松上路</span></p> 
 <p align="left"><span style="color:#333333">http://www.linuxforum.net/forum/showflat.php?Cat=&amp;Board=embedded&amp;Number=628054&amp;page=0&amp;view=collapsed&amp;sb=5&amp;o=0&amp;fpart=</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">第三天：</span><span style="color:#333333">(</span><span style="color:#333333">完成</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333">移植内核</span><span style="color:#333333">2.6.27-rc9</span><span style="color:#333333">到</span><span style="color:#333333">qq2440</span><span style="color:#333333">开发板，实现基本功能，能挂载板上文件系统</span><span style="color:#333333">.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">步骤：</span></p> 
 <p align="left"><span style="color:#333333">1.</span><span style="color:#333333">使用</span><span style="color:#333333">vivi</span><span style="color:#333333">修改</span><span style="color:#333333">mach_type</span><span style="color:#333333">参数</span></p> 
 <p align="left"><span style="color:#333333">2.</span><span style="color:#333333">修改时钟频率</span></p> 
 <p align="left"><span style="color:#333333">3.</span><span style="color:#333333">修改源码正确分区</span></p> 
 <p align="left"><span style="color:#333333">4.</span><span style="color:#333333">禁止</span><span style="color:#333333">nand</span><span style="color:#333333">的</span><span style="color:#333333">ECC</span><span style="color:#333333">校验</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">分述：</span></p> 
 <p align="left"><span style="color:#333333">问题</span><span style="color:#333333">1.</span><span style="color:#333333">表现</span></p> 
 <p align="left"><span style="color:#333333">UncompressingLinux.................................................................................................................done, booting the kernel.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Error: unrecognized/unsupported machineID (r1 = 0x0000030e).</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Available machine support:</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">ID (hex)        NAME</span></p> 
 <p align="left"><span style="color:#333333">000000c1        SMDK2410</span></p> 
 <p align="left"><span style="color:#333333">0000015b        IPAQ-H1940</span></p> 
 <p align="left"><span style="color:#333333">0000039f        Acer-N35</span></p> 
 <p align="left"><span style="color:#333333">00000290        Acer-N30</span></p> 
 <p align="left"><span style="color:#333333">0000014b        Simtec-BAST</span></p> 
 <p align="left"><span style="color:#333333">000002a8        Nex Vision - Otom 1.1</span></p> 
 <p align="left"><span style="color:#333333">00000400        AML_M5900</span></p> 
 <p align="left"><span style="color:#333333">000001db        Thorcom-VR1000</span></p> 
 <p align="left"><span style="color:#333333">00000454        QT2410</span></p> 
 <p align="left"><span style="color:#333333">000003fe        SMDK2413</span></p> 
 <p align="left"><span style="color:#333333">000003f1        SMDK2412</span></p> 
 <p align="left"><span style="color:#333333">00000377        S3C2413</span></p> 
 <p align="left"><span style="color:#333333">00000474        VSTMS</span></p> 
 <p align="left"><span style="color:#333333">000002de        Simtec-Anubis</span></p> 
 <p align="left"><span style="color:#333333">0000034a        Simtec-OSIRIS</span></p> 
 <p align="left"><span style="color:#333333">00000250        IPAQ-RX3715</span></p> 
 <p align="left"><span style="color:#333333">0000016a        SMDK2440</span></p> 
 <p align="left"><span style="color:#333333">000002a9        NexVision - Nexcoder 2440</span></p> 
 <p align="left"><span style="color:#333333">0000043c        SMDK2443</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Please check your kernel config and/orbootloader.</span></p> 
 <p align="left"><span style="color:#333333">解决方法：</span></p> 
 <p align="left"><span style="color:#333333">##### Parameter Menu #####</span></p> 
 <p align="left"><span style="color:#333333">[r] Reset parameter table to defaulttable </span></p> 
 <p align="left"><span style="color:#333333">[s] Set parameter </span></p> 
 <p align="left"><span style="color:#333333">[v] View the parameter table  </span> </p> 
 <p align="left"><span style="color:#333333">[w] Write the parameter table to flashmemeory </span></p> 
 <p align="left"><span style="color:#333333">[q] Quit </span></p> 
 <p align="left"><span style="color:#333333">Enter your selection: s</span></p> 
 <p align="left"><span style="color:#333333">Enter the parameter's name(mach_type,media_type, linux_cmd_line, etc): mach_type</span></p> 
 <p align="left"><span style="color:#333333">Enter the parameter's value(if the valuecontains space, enclose it with "): 362 //&lt;---</span></p> 
 <p align="left"><span style="color:#333333">Change 'mach_type' value.0x0000030e(782) to 0x0000016a(362)</span></p> 
 <p align="left"><span style="color:#333333">问题</span><span style="color:#333333">2.</span><span style="color:#333333">表现</span></p> 
 <p align="left"><span style="color:#333333">UncompressingLinux.................................................................................................................done, booting the kernel.</span></p> 
 <p align="left"><span style="color:#333333">8?'·{e#???;?·7'0??3G?#?G'?</span><span style="color:#333333">乱码</span></p> 
 <p align="left"><span style="color:#333333">解决方法：</span></p> 
 <p align="left"><span style="color:#333333">static void __init smdk2440_map_io(void)</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      s3c24xx_init_io(smdk2440_iodesc,ARRAY_SIZE(smdk2440_iodesc));</span></p> 
 <p align="left"><span style="color:#333333">      s3c24xx_init_clocks(12000000);//</span><span style="color:#333333">修改处，原为</span><span style="color:#333333">16934400</span></p> 
 <p align="left"><span style="color:#333333">      s3c24xx_init_uarts(smdk2440_uartcfgs,ARRAY_SIZE(smdk2440_uartcfgs));</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333">问题</span><span style="color:#333333">3.</span><span style="color:#333333">表现</span></p> 
 <p align="left"><span style="color:#333333">VFS: Cannot open root device"mtdblock2" or unknown-block(31,2)</span></p> 
 <p align="left"><span style="color:#333333">Please append a correct"root=" boot option; here are the available partitions:</span></p> 
 <p align="left"><span style="color:#333333">1f00         16 mtdblock0 (driver?)</span></p> 
 <p align="left"><span style="color:#333333">1f01       2048 mtdblock1 (driver?)</span></p> 
 <p align="left"><span style="color:#333333">1f02       4096 mtdblock2 (driver?)</span></p> 
 <p align="left"><span style="color:#333333">1f03       2048 mtdblock3 (driver?)</span></p> 
 <p align="left"><span style="color:#333333">1f04       4096 mtdblock4 (driver?)</span></p> 
 <p align="left"><span style="color:#333333">1f05     10240 mtdblock5 (driver?)</span></p> 
 <p align="left"><span style="color:#333333">1f06     24576 mtdblock6 (driver?)</span></p> 
 <p align="left"><span style="color:#333333">1f07     16384 mtdblock7 (driver?)</span></p> 
 <p align="left"><span style="color:#333333">Kernel panic - not syncing: VFS: Unableto mount root fs on unknown-block(31,2)</span></p> 
 <p align="left"><span style="color:#333333">解决：</span></p> 
 <p align="left"><span style="color:#333333">依据</span><span style="color:#333333">nand</span><span style="color:#333333">分区修改源码：</span></p> 
 <p align="left"><span style="color:#333333">static struct mtd_partitionsmdk_default_nand_part[] = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      [0]= {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               .name    = "vivi",</span></p> 
 <p align="left"><span style="color:#333333">               .size    = 0x00030000,</span></p> 
 <p align="left"><span style="color:#333333">               .offset  = 0,</span></p> 
 <p align="left"><span style="color:#333333">      },</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      [1]= {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               .name    = "kernel",</span></p> 
 <p align="left"><span style="color:#333333">               .offset= 0x00050000,</span></p> 
 <p align="left"><span style="color:#333333">               .size    = 0x00200000,</span></p> 
 <p align="left"><span style="color:#333333">      },</span></p> 
 <p align="left"><span style="color:#333333">      [2]= {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               .name    = "root",</span></p> 
 <p align="left"><span style="color:#333333">               .offset= 0x00250000,</span></p> 
 <p align="left"><span style="color:#333333">               .size    = 0x03dac000,</span></p> 
 <p align="left"><span style="color:#333333">      },</span></p> 
 <p align="left"><span style="color:#333333">};</span></p> 
 <p align="left"><span style="color:#333333">问题</span><span style="color:#333333">4.</span><span style="color:#333333">表现</span></p> 
 <p align="left"><span style="color:#333333">Kernel panic - not syncing: VFS: Unableto mount root fs on unknown-block(31,2)</span></p> 
 <p align="left"><span style="color:#333333">导致上面</span><span style="color:#333333">panic</span><span style="color:#333333">的原因是没有禁止</span><span style="color:#333333">Flash ECC</span><span style="color:#333333">校验</span></p> 
 <p align="left"><span style="color:#333333">解决：</span></p> 
 <p align="left"><span style="color:#333333">s3c2410_nand_init_chip()</span></p> 
 <p align="left"><span style="color:#333333">..</span></p> 
 <p align="left"><span style="color:#333333">      if(set-&gt;disable_ecc)</span></p> 
 <p align="left"><span style="color:#333333">               chip-&gt;ecc.mode   = NAND_ECC_NONE;</span></p> 
 <p align="left"><span style="color:#333333">      chip-&gt;ecc.mode   = NAND_ECC_NONE;//&lt;-</span><span style="color:#333333">在函数最后加上</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">启动信息：</span></p> 
 <p align="left"><span style="color:#333333">Copy linux kernel from 0x00050000 to0x30008000, size = 0x00200000 ... done</span></p> 
 <p align="left"><span style="color:#333333">zImage magic = 0x016f2818</span></p> 
 <p align="left"><span style="color:#333333">Setup linux parameters at 0x30000100</span></p> 
 <p align="left"><span style="color:#333333">linux command line is: "noinitrdroot=/dev/mtdblock2 init=/linuxrc console=ttySAC0"</span></p> 
 <p align="left"><span style="color:#333333">MACH_TYPE = 362</span></p> 
 <p align="left"><span style="color:#333333">NOW, Booting Linux......</span></p> 
 <p align="left"><span style="color:#333333">UncompressingLinux.................................................................................................................done, booting the kernel.</span></p> 
 <p align="left"><span style="color:#333333">Linux version 2.6.27-rc9(fqh@ubuntu-sniper) (gcc version 4.2.4 (Debian 4.2.4-3)) #8 Sat Oct 11 03:17:21CST 2008</span></p> 
 <p align="left"><span style="color:#333333">CPU: ARM920T [41129200] revision 0(ARMv4T), cr=c0007177</span></p> 
 <p align="left"><span style="color:#333333">Machine: SMDK2440</span></p> 
 <p align="left"><span style="color:#333333">ATAG_INITRD is deprecated; please updateyour bootloader.</span></p> 
 <p align="left"><span style="color:#333333">Memory policy: ECC disabled, Data cachewriteback</span></p> 
 <p align="left"><span style="color:#333333">CPU S3C2440A (id 0x32440001)</span></p> 
 <p align="left"><span style="color:#333333">S3C244X: core 405.000 MHz, memory101.250 MHz, peripheral 50.625 MHz</span></p> 
 <p align="left"><span style="color:#333333">S3C24XX Clocks, (c) 2004 SimtecElectronics</span></p> 
 <p align="left"><span style="color:#333333">CLOCK: Slow mode (1.500 MHz), fast, MPLLon, UPLL on</span></p> 
 <p align="left"><span style="color:#333333">CPU0: D VIVT write-back cache</span></p> 
 <p align="left"><span style="color:#333333">CPU0: I cache: 16384 bytes,associativity 64, 32 byte lines, 8 sets</span></p> 
 <p align="left"><span style="color:#333333">CPU0: D cache: 16384 bytes,associativity 64, 32 byte lines, 8 sets</span></p> 
 <p align="left"><span style="color:#333333">Built 1 zonelists in Zone order,mobility grouping on.  Total pages: 16256</span></p> 
 <p align="left"><span style="color:#333333">Kernel command line: noinitrd root=/dev/mtdblock2init=/linuxrc console=ttySAC0</span></p> 
 <p align="left"><span style="color:#333333">irq: clearing pending ext status00000200</span></p> 
 <p align="left"><span style="color:#333333">irq: clearing subpending status 00000002</span></p> 
 <p align="left"><span style="color:#333333">PID hash table entries: 256 (order: 8,1024 bytes)</span></p> 
 <p align="left"><span style="color:#333333">timer tcon=00000000, tcnt a4ca, tcfg00000200,00000000, usec 00001e57</span></p> 
 <p align="left"><span style="color:#333333">Console: colour dummy device 80x30</span></p> 
 <p align="left"><span style="color:#333333">console [ttySAC0] enabled</span></p> 
 <p align="left"><span style="color:#333333">Dentry cache hash table entries: 8192(order: 3, 32768 bytes)</span></p> 
 <p align="left"><span style="color:#333333">Inode-cache hash table entries: 4096(order: 2, 16384 bytes)</span></p> 
 <p align="left"><span style="color:#333333">Memory: 64MB = 64MB total</span></p> 
 <p align="left"><span style="color:#333333">Memory: 61140KB available (3224K code,335K data, 144K init)</span></p> 
 <p align="left"><span style="color:#333333">Calibrating delay loop... 201.93BogoMIPS (lpj=504832)</span></p> 
 <p align="left"><span style="color:#333333">Mount-cache hash table entries: 512</span></p> 
 <p align="left"><span style="color:#333333">CPU: Testing write buffer coherency: ok</span></p> 
 <p align="left"><span style="color:#333333">net_namespace: 440 bytes</span></p> 
 <p align="left"><span style="color:#333333">NET: Registered protocol family 16</span></p> 
 <p align="left"><span style="color:#333333">S3C2410 Power Management, (c) 2004Simtec Electronics</span></p> 
 <p align="left"><span style="color:#333333">S3C2440: Initialising architecture</span></p> 
 <p align="left"><span style="color:#333333">S3C2440: IRQ Support</span></p> 
 <p align="left"><span style="color:#333333">S3C24XX DMA Driver, (c) 2003-2004,2006Simtec Electronics</span></p> 
 <p align="left"><span style="color:#333333">DMA channel 0 at c4800000, irq 33</span></p> 
 <p align="left"><span style="color:#333333">DMA channel 1 at c4800040, irq 34</span></p> 
 <p align="left"><span style="color:#333333">DMA channel 2 at c4800080, irq 35</span></p> 
 <p align="left"><span style="color:#333333">DMA channel 3 at c48000c0, irq 36</span></p> 
 <p align="left"><span style="color:#333333">S3C244X: Clock Support, DVS off</span></p> 
 <p align="left"><span style="color:#333333">SCSI subsystem initialized</span></p> 
 <p align="left"><span style="color:#333333">usbcore: registered new interface driverusbfs</span></p> 
 <p align="left"><span style="color:#333333">usbcore: registered new interface driverhub</span></p> 
 <p align="left"><span style="color:#333333">usbcore: registered new device driverusb</span></p> 
 <p align="left"><span style="color:#333333">NET: Registered protocol family 2</span></p> 
 <p align="left"><span style="color:#333333">IP route cache hash table entries: 1024(order: 0, 4096 bytes)</span></p> 
 <p align="left"><span style="color:#333333">TCP established hash table entries: 2048(order: 2, 16384 bytes)</span></p> 
 <p align="left"><span style="color:#333333">TCP bind hash table entries: 2048(order: 1, 8192 bytes)</span></p> 
 <p align="left"><span style="color:#333333">TCP: Hash tables configured (established2048 bind 2048)</span></p> 
 <p align="left"><span style="color:#333333">TCP reno registered</span></p> 
 <p align="left"><span style="color:#333333">NET: Registered protocol family 1</span></p> 
 <p align="left"><span style="color:#333333">NetWinder Floating Point Emulator V0.97(extended precision)</span></p> 
 <p align="left"><span style="color:#333333">JFFS2 version 2.2. (NAND) (SUMMARY)  Â© 2001-2006 Red Hat, Inc.</span></p> 
 <p align="left"><span style="color:#333333">msgmni has been set to 119</span></p> 
 <p align="left"><span style="color:#333333">io scheduler noop registered</span></p> 
 <p align="left"><span style="color:#333333">io scheduler anticipatory registered(default)</span></p> 
 <p align="left"><span style="color:#333333">io scheduler deadline registered</span></p> 
 <p align="left"><span style="color:#333333">io scheduler cfq registered</span></p> 
 <p align="left"><span style="color:#333333">Console: switching to colour framebuffer device 30x40</span></p> 
 <p align="left"><span style="color:#333333">fb0: s3c2410fb frame buffer device</span></p> 
 <p align="left"><span style="color:#333333">lp: driver loaded but no devices found</span></p> 
 <p align="left"><span style="color:#333333">ppdev: user-space parallel port driver</span></p> 
 <p align="left"><span style="color:#333333">Serial: 8250/16550 driver4 ports, IRQsharing enabled</span></p> 
 <p align="left"><span style="color:#333333">s3c2440-uart.0: s3c2410_serial0 at MMIO0x50000000 (irq = 70) is a S3C2440</span></p> 
 <p align="left"><span style="color:#333333">s3c2440-uart.1: s3c2410_serial1 at MMIO0x50004000 (irq = 73) is a S3C2440</span></p> 
 <p align="left"><span style="color:#333333">s3c2440-uart.2: s3c2410_serial2 at MMIO0x50008000 (irq = 76) is a S3C2440</span></p> 
 <p align="left"><span style="color:#333333">brd: module loaded</span></p> 
 <p align="left"><span style="color:#333333">loop: module loaded</span></p> 
 <p align="left"><span style="color:#333333">dm9000 Ethernet Driver, V1.31</span></p> 
 <p align="left"><span style="color:#333333">Uniform Multi-Platform E-IDE driver</span></p> 
 <p align="left"><span style="color:#333333">Driver 'sd' needs updating - please usebus_type methods</span></p> 
 <p align="left"><span style="color:#333333">S3C24XX NAND Driver, (c) 2004 SimtecElectronics</span></p> 
 <p align="left"><span style="color:#333333">s3c2440-nand s3c2440-nand: Tacls=3, 29nsTwrph0=7 69ns, Twrph1=3 29ns</span></p> 
 <p align="left"><span style="color:#333333">NAND device: Manufacturer ID: 0xec, ChipID: 0x76 (Samsung NAND 64MiB 3,3V 8-bit)</span></p> 
 <p align="left"><span style="color:#333333">NAND_ECC_NONE selected by board driver.This is not recommended !!</span></p> 
 <p align="left"><span style="color:#333333">Scanning device for bad blocks</span></p> 
 <p align="left"><span style="color:#333333">Bad eraseblock 562 at 0x008c8000</span></p> 
 <p align="left"><span style="color:#333333">Bad eraseblock 566 at 0x008d8000</span></p> 
 <p align="left"><span style="color:#333333">Creating 3 MTD partitions on "NAND64MiB 3,3V 8-bit":</span></p> 
 <p align="left"><span style="color:#333333">0x00000000-0x00030000 : "vivi"</span></p> 
 <p align="left"><span style="color:#333333">0x00050000-0x00250000 :"kernel"</span></p> 
 <p align="left"><span style="color:#333333">0x00250000-0x03ffc000 : "root"</span></p> 
 <p align="left"><span style="color:#333333">usbmon: debugfs is not available</span></p> 
 <p align="left"><span style="color:#333333">s3c2410-ohci s3c2410-ohci: S3C24XX OHCI</span></p> 
 <p align="left"><span style="color:#333333">s3c2410-ohci s3c2410-ohci: new USB busregistered, assigned bus number 1</span></p> 
 <p align="left"><span style="color:#333333">s3c2410-ohci s3c2410-ohci: irq 42, iomem 0x49000000</span></p> 
 <p align="left"><span style="color:#333333">usb usb1: configuration #1 chosen from 1choice</span></p> 
 <p align="left"><span style="color:#333333">hub 1-0:1.0: USB hub found</span></p> 
 <p align="left"><span style="color:#333333">hub 1-0:1.0: 2 ports detected</span></p> 
 <p align="left"><span style="color:#333333">usbcore: registered new interface driverlibusual</span></p> 
 <p align="left"><span style="color:#333333">usbcore: registered new interface driverusbserial</span></p> 
 <p align="left"><span style="color:#333333">usbserial: USB Serial support registeredfor generic</span></p> 
 <p align="left"><span style="color:#333333">usbcore: registered new interface driverusbserial_generic</span></p> 
 <p align="left"><span style="color:#333333">usbserial: USB Serial Driver core</span></p> 
 <p align="left"><span style="color:#333333">usbserial: USB Serial support registeredfor FTDI USB Serial Device</span></p> 
 <p align="left"><span style="color:#333333">usbcore: registered new interface driverftdi_sio</span></p> 
 <p align="left"><span style="color:#333333">ftdi_sio: v1.4.3:USB FTDI SerialConverters Driver</span></p> 
 <p align="left"><span style="color:#333333">usbserial: USB Serial support registeredfor pl2303</span></p> 
 <p align="left"><span style="color:#333333">usbcore: registered new interface driverpl2303</span></p> 
 <p align="left"><span style="color:#333333">pl2303: Prolific PL2303 USB to serialadaptor driver</span></p> 
 <p align="left"><span style="color:#333333">mice: PS/2 mouse device common for allmice</span></p> 
 <p align="left"><span style="color:#333333">S3C24XX RTC, (c) 2004,2006 SimtecElectronics</span></p> 
 <p align="left"><span style="color:#333333">s3c2440-i2c s3c2440-i2c: slave address0x10</span></p> 
 <p align="left"><span style="color:#333333">s3c2440-i2c s3c2440-i2c: bus frequencyset to 98 KHz</span></p> 
 <p align="left"><span style="color:#333333">s3c2440-i2c s3c2440-i2c: i2c-0: S3C I2Cadapter</span></p> 
 <p align="left"><span style="color:#333333">S3C2410 Watchdog Timer, (c) 2004 SimtecElectronics</span></p> 
 <p align="left"><span style="color:#333333">s3c2410-wdt s3c2410-wdt: watchdoginactive, reset disabled, irq enabled</span></p> 
 <p align="left"><span style="color:#333333">TCP cubic registered</span></p> 
 <p align="left"><span style="color:#333333">NET: Registered protocol family 17</span></p> 
 <p align="left"><span style="color:#333333">RPC: Registered udp transport module.</span></p> 
 <p align="left"><span style="color:#333333">RPC: Registered tcp transport module.</span></p> 
 <p align="left"><span style="color:#333333">drivers/rtc/hctosys.c: unable to openrtc device (rtc0)</span></p> 
 <p align="left"><span style="color:#333333">VFS: Mounted root (cramfs filesystem)readonly.</span></p> 
 <p align="left"><span style="color:#333333">Freeing init memory: 144K</span></p> 
 <p align="left"><span style="color:#333333">hwclock: Could not access RTC: No suchfile or directory</span></p> 
 <p align="left"><span style="color:#333333">mknod: /dev/pts/0: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">ln: /dev/video0: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">ln: /dev/fb0: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">ln: /dev/tty1: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">ln: /dev/dsp: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">ln: /dev/mixer: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">ln: /dev/sda1: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 44:cannot create /dev/vc/0: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 45:cannot create /dev/vc/0: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">/etc/rc.d/init.d/httpd:/etc/rc.d/init.d/httpd: 16: /sbin/boa: not found</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 48:cannot create /dev/vc/0: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 49:cannot create /dev/vc/0: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">/etc/rc.d/init.d/leds:/etc/rc.d/init.d/leds: 16: /sbin/led-player: not found</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 52:cannot create /dev/vc/0: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 53:cannot create /dev/vc/0: Read-only file system</span></p> 
 <p align="left"><span style="color:#333333">                        </span></p> 
 <p align="left"><span style="color:#333333">SIOCSIFADDR: No such device</span></p> 
 <p align="left"><span style="color:#333333">SIOCGIFFLAGS: No such device</span></p> 
 <p align="left"><span style="color:#333333">/etc/init.d/rcS: /etc/init.d/rcS: 59:/sbin/madplay: not found</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Please press Enter to activate thisconsole. </span></p> 
 <p align="left"><span style="color:#333333">-sh: can't access tty; job controlturned off</span></p> 
 <p align="left"><span style="color:#333333">id: unknown uid 0</span></p> 
 <p align="left"><span style="color:#333333">[@FriendlyARM /]# uname -a</span></p> 
 <p align="left"><span style="color:#333333">Linux FriendlyARM 2.6.27-rc9 #8 Sat Oct11 03:17:21 CST 2008 armv4tl unknown</span></p> 
 <p align="left"><span style="color:#333333">[@FriendlyARM /]# </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">第四天：</span></p> 
 <p align="left"><span style="color:#333333">实现</span><span style="color:#333333">XP</span><span style="color:#333333">下虚拟机中的</span><span style="color:#333333">ubuntu</span><span style="color:#333333">利用</span><span style="color:#333333">gdb</span><span style="color:#333333">通过串口调试开发板上的</span><span style="color:#333333">2.6.27-rc9</span><span style="color:#333333">内核</span></p> 
 <p align="left"><span style="color:#333333">问题，开发板只有一个串口，给</span><span style="color:#333333">gdb</span><span style="color:#333333">占用了，怎么操作开发板？</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">第五天：</span></p> 
 <p align="left"><span style="color:#333333">实现硬盘安装的</span><span style="color:#333333">ubuntu</span><span style="color:#333333">系统利用</span><span style="color:#333333">gdb</span><span style="color:#333333">通过串口调试开发板上的内核。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">第六天：</span></p> 
 <p align="left"><span style="color:#333333">移植</span><span style="color:#333333">cs8900a</span><span style="color:#333333">网卡驱动。</span></p> 
 <p align="left"><span style="color:#333333">实现开发板从硬盘</span><span style="color:#333333">ubuntu</span><span style="color:#333333">的</span><span style="color:#333333">nfs</span><span style="color:#333333">启动。</span></p> 
 <p align="left"><span style="color:#333333">实现硬盘安装的</span><span style="color:#333333">ubuntu</span><span style="color:#333333">系统利用</span><span style="color:#333333">gdb</span><span style="color:#333333">通过网口调试开发板上的内核。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">参考：</span></p> 
 <p align="left"><span style="color:#333333"> ubuntu8.04+skyeye1.2.4</span><span style="color:#333333">搭建</span><span style="color:#333333">linux2.6.24+s3c2410</span><span style="color:#333333">的模拟</span><span style="color:#333333">arm-linux</span><span style="color:#333333">开发环境</span></p> 
 <p align="left"><span style="color:#333333">http://www.google.cn/search?complete=1&amp;hl=zh-CN&amp;newwindow=1&amp;client=firefox-a&amp;rls=org.mozilla:zh-CN:official&amp;hs=R4b&amp;q=cs8900+s3c2440+%E9%A9%B1%E5%8A%A8&amp;start=20&amp;sa=N</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">http://blog.chinaunix.net/u2/72751/showart_1130655.html</span></p> 
 <p align="left"><span style="color:#333333">http://www.akae.cn/bbs/redirect.php?tid=6929&amp;goto=lastpost</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">基于网口</span></strong></p> 
<p align="left"><strong><span style="color:#333333">gdb</span><span style="color:#333333">基础</span></strong></p> 
<p align="left"><strong><span style="color:#333333">基本命令</span></strong></p> 
<p align="left"><span style="color:#333333">推荐这篇，内容很全: gdb </span>使用手册 <a target="_blank" href="http://blog.chinaunix.net/u/11240/showart.php?id=340632" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u/11240/showart.php?id=340632</span></a></p> 
<p align="left"><span style="color:#333333">终极参考： Debugging withGDB <a target="_blank" href="http://sourceware.org/gdb/current/onlinedocs/gdb.html#SEC_Top" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceware.org/gdb/current/onlinedocs/gdb.html#SEC_Top</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">gdb</span><span style="color:#333333">之gui</span></strong></p> 
<p align="left"><span style="color:#333333">网址：</span></p> 
<p align="left"><span style="color:#333333">cgdb:<a target="_blank" href="http://cgdb.sourceforge.net/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://cgdb.sourceforge.net/</span></a></span></p> 
<p align="left"><span style="color:#333333">kgdb:<a target="_blank" href="http://www.kdbg.org/screenshot.php" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.kdbg.org/screenshot.php</span></a></span></p> 
<p align="left"><span style="color:#333333">ddd:<a target="_blank" href="http://www.gnu.org/software/ddd/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.gnu.org/software/ddd/</span></a></span></p> 
<p align="left"><span style="color:#333333">insight:<a target="_blank" href="http://sourceware.org/insight/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceware.org/insight/</span></a></span></p> 
<p align="left"><span style="color:#333333">这些工具在ubuntu</span>下都有编译好的.deb安装包，利用“立新得”就直接搜索然后在线安装。</p> 
<p align="left"><span style="color:#333333">这篇短文是我的浅陋之见，我接触这些gui</span>的时间也不久。错误难免。虚拟机：qemu</p> 
<p align="left"><span style="color:#333333">内核内置kgdb</span></p> 
<p align="left"><span style="color:#333333">developer machine: </span><span style="color:#333333">运行gdb</span></p> 
<p align="left"><span style="color:#333333">除了只用命令行gdb</span>外，还可以用gdb的gui,有</p> 
<p align="left"><span style="color:#333333">1.cgdb </span><span style="color:#333333">缺点：界面简陋，自动化程度低，只是把terminal</span>分为两部分，上面部分显示源码，下面打命令。由于没有显示反汇编的窗体，不适合要求使用到 stepi命令的场合。优点：运行快，锻炼手指头. 最大的优点是，它有完美的代码着色功能。其他几款调试器中都没有。</p> 
<p align="left"><span style="color:#333333">2.ddd: </span><span style="color:#333333">缺点：与kdbg</span>相比，界面凌乱。优点：代码显示效果比kdbg好，c和反汇编代码分开在两个窗口。 可以随时暂停程序的运行。data windows 这个功能非常强大灵活。提示 ddd –tty 2&gt;/dev/null ./vmlinux ; remotetarget localhost:1234</p> 
<p align="left"><span style="color:#333333">3. kdbg: </span><span style="color:#333333">缺点：功能比ddd</span>弱。字体太小，c和反汇编代码交错显示，反汇编代码折叠隐藏在C代码之间，要显示反汇编代码要手动展开，不可忍受。太过界面化，居然找 不到是在哪里手动打gdb命令。致命缺点是，内核跑起来后，如果没有断点拦截，就没法把内核的运行暂停下来，kdbg成了没事姥，源码窗口的显示不更新。 另一个致命缺点是，如果没有源码只有二进制文件，虽然可以下断点，但无法显示反汇编代码，没意义。据说kdbg是用来调试kde程序的，实际上也能调试内 核。优点：窗口可以整合到一块，稳定。有变化的寄存器会显示红色。提示 kdbg -r localhost:1234 ./vmlinux</p> 
<p align="left"><span style="color:#333333">4. insight: </span><span style="color:#333333">和ddd</span>都是基于TCL/TK，比较相似。优点：源码显示功能最强，可以选择C和反汇编代码分开和交叉显示。可以选择反汇编代码使用intel还是 at&amp;t格式。可以列出当前有哪些源文件，当前文件有哪些函数。变化的寄存器有改变颜色的功能，ddd则没有。缺点：和ddd一样，小窗口无法整 合到到窗口中，但比ddd差的是，主窗口最大化后小窗口无法保持置顶。相对ddd的大劣势是没有一个强大的data windows。感觉界面比ddd强大，但灵活性比ddd差点。对于调试内核来说，还有一个和kdbg相同的大缺点，内核只能通过断点暂停运行，而ddd 下还可以用ctrl+c暂停内核。另外它有个SB错误，显示backtrace的窗口,标题居然是stack. 提示: insight ./vmlinux</p> 
<p align="left"><span style="color:#333333">5. xxgdb: </span><span style="color:#333333">古董级别。没事干的时候可以玩玩</span></p> 
<p align="left"><span style="color:#333333">6. </span><span style="color:#333333">其实，gdb</span>自带了一个基于curses的gui。启动方式是gdbtuixxx; 或者在gdb启动之后用命令layout启动gui。很好用，可以至多同时显示三个分窗口。要是代码有着色功能就好了。</p> 
<p align="left"><span style="color:#333333">针对内核调试的总结：</span></p> 
<p align="left"><span style="color:#333333">1. kdbg</span><span style="color:#333333">不适合调试内核</span></p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">如果想复习gdb</span>强大的命令，选cgdb或纯gdb。</p> 
<p align="left"><span style="color:#333333">4. </span><span style="color:#333333">如果想学习汇编，insight</span>是不二选择。</p> 
<p align="left"><span style="color:#333333">5 </span><span style="color:#333333">如果倾向于把调试器当作浏览器使用，作为source insight</span>等工具的辅助工具，在内核运行中拦截函数，分析函数的调用关系，不需要反汇编的话，则cgdb是不错的选择 .(source insight等源码分析工具有个共同的缺点，因为体系和内核配置不同，一个函数有很多的定义，借助调试器可以在内核运行的时候找出实际调用的那个)</p> 
<p align="left"><span style="color:#333333">6.insight</span><span style="color:#333333">和ddd</span>很接近，各有千秋。但如果侧重于追溯数据结构体间的联系，ddd更好一点，因为它有data window，它的强项是数据和数据结构关系分析并用图像方式显示出来（What is DDD? Data Display Debugger)。如果侧重于分析汇编指令是怎么在cpu中跑的，推荐用insight，因为它汇编代码显示功能更细致。</p> 
<p align="left"><span style="color:#333333">7.</span><span style="color:#333333">可惜目前在ubuntu8.04</span>下,ddd+qemu组合用来调试驱动时有bug：驱动函数被拦截时如果正在qemu的系统下操作，鼠标就会冻结在qemu的屏幕中。其实调试单个驱动，用gdb就足够了。ddd等gui一般用来调试理解内核原理。</p> 
<p align="left"><strong><span style="color:#333333">gdb</span><span style="color:#333333">技巧</span></strong></p> 
<p align="left"><span style="color:#333333">另外有用的命令 ptype,whatis</span></p> 
<p align="left"><span style="color:#333333">－－－－</span></p> 
<p align="left"><span style="color:#333333">更多相关技巧：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">获取structpage</span>结构的大小</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) p mem_map</span></p> 
 <p align="left"><span style="color:#333333">$80 = (struct page *) 0xc1000000</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p mem_map+1</span></p> 
 <p align="left"><span style="color:#333333">$81 = (struct page *) 0xc1000020</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p/x 0xc1000020 - 0xc1000000</span></p> 
 <p align="left"><span style="color:#333333">$82 = 0×20</span></p> 
</div> 
<p align="left"><span style="color:#333333">2.</span></p> 
<p align="left"><span style="color:#333333">打印前从指针mem_map</span>所指起的5个page结构体</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) p *mem_map@5</span></p> 
 <p align="left"><span style="color:#333333">$83 = {<!-- -->{flags = 1024, _count = {counter= 1}, {_mapcount = {counter = -1}, {inuse = 65535, objects = 65535}}, {<!-- -->{private= 0, mapping = 0×0}, ptl =…</span></p> 
</div> 
<p align="left"><span style="color:#333333">用ddd</span>的图形显示命令是 (gdb) graph display *mem_map@5</p> 
<p align="left"><span style="color:#333333">参考 p *array@len</span></p> 
<p align="left"><span style="color:#333333">@</span><span style="color:#333333">的左边是数组的首地址的值，也就是变量array</span>所指向的内容，右边则是数据的长度，其保存在变量len中</p> 
<p align="left"><span style="color:#333333">3.</span></p> 
<p align="left"><span style="color:#333333">每运行一次stepi/next</span>等命令后显示下一步要将要运行的反汇编指令</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) display/i $pc</span></p> 
 <p align="left"><span style="color:#333333">6: x/i $pc</span></p> 
 <p align="left"><span style="color:#333333">0xc0144fb6&lt;init_cgroup_root+22&gt;:    mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333">(gdb) stepi</span></p> 
 <p align="left"><span style="color:#333333">6: x/i $pc</span></p> 
 <p align="left"><span style="color:#333333">0xc0144fb8 &lt;init_cgroup_root+24&gt;:    mov   %edx,0×44(%eax)</span></p> 
</div> 
<p align="left"><span style="color:#333333">提示：display</span>的管理：</p> 
<p align="left"><span style="color:#333333">undisplay deletedisplay disable display enable display info display</span></p> 
<p align="left"><span style="color:#333333">4.</span><span style="color:#333333">使结构体的显示更漂亮</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) show print pretty</span></p> 
 <p align="left"><span style="color:#333333">Prettyprinting of structures is on.</span></p> 
 <p align="left"><span style="color:#333333">(gdb) set print pretty off</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p *init_task-&gt;group_info</span></p> 
 <p align="left"><span style="color:#333333">$12 = {ngroups = 0, usage = {counter =14}, small_block = {0 &lt;repeats 32 times&gt;}, nblocks = 0, blocks =0xc0355530}</span></p> 
 <p align="left"><span style="color:#333333">(gdb) set print pretty on</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p *init_task-&gt;group_info</span></p> 
 <p align="left"><span style="color:#333333">$13 = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">ngroups = 0,</span></p> 
 <p align="left"><span style="color:#333333">usage = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">counter = 14</span></p> 
 <p align="left"><span style="color:#333333">},</span></p> 
 <p align="left"><span style="color:#333333">small_block = {0 &lt;repeats 32times&gt;},</span></p> 
 <p align="left"><span style="color:#333333">nblocks = 0,</span></p> 
 <p align="left"><span style="color:#333333">blocks = 0xc0355530</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
</div> 
<p align="left"><span style="color:#333333">(</span><span style="color:#333333">注：6.7.</span>条来自<a target="_blank" href="http://techcenter.dicder.com/2006/0906/content_173.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://techcenter.dicder.com/2006/0906/content_173.html</span></a>)</p> 
<p align="left"><span style="color:#333333">5. </span><span style="color:#333333">使用自定义命令。</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) define nid</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Type commands for definition of “nid”.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">End with a line saying just “end”.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">&gt;ni</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">&gt;disassemble $pc $pc+16</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">&gt;end</span></p> 
</div> 
<p align="left"><span style="color:#333333">6. </span><span style="color:#333333">纯gdb</span>的多窗口显示 GUI调试器可以同时打开多个小窗口，分别显示寄存器、汇编和源代码等。在gdb里也可以做到，但同时最多只能显示两个窗口，试了一下也很方便的。基本命令如下：</p> 
<p align="left"><span style="color:#333333">a) `layout src</span><span style="color:#333333">’ 仅显示源代码窗口。</span></p> 
<p align="left"><span style="color:#333333">b) `layout asm</span><span style="color:#333333">’ 仅显示汇编代码窗口。</span></p> 
<p align="left"><span style="color:#333333">c) `layout split</span><span style="color:#333333">’ 显示源代码和汇编代码窗口。</span></p> 
<p align="left"><span style="color:#333333">d) `layout regs</span><span style="color:#333333">’ 显示寄存器和源代码窗口，或者寄存器和汇编代码窗口。</span></p> 
<p align="left"><span style="color:#333333">e) `layout next` </span><span style="color:#333333">和`layout prev</span>’ 切换窗口。</p> 
<p align="left"><span style="color:#333333">f) ctrl + L </span><span style="color:#333333">刷新屏幕。</span></p> 
<p align="left"><span style="color:#333333">g) `C-x 1</span><span style="color:#333333">′ 单窗口模式。</span></p> 
<p align="left"><span style="color:#333333">h) `C-x 2</span><span style="color:#333333">′ 双窗口模式。</span></p> 
<p align="left"><span style="color:#333333">i) `C-x a</span><span style="color:#333333">’ 回到传统模式。</span></p> 
<p align="left"><span style="color:#333333">7. </span><span style="color:#333333">字符gdb</span>中，如何在每执行一次next命令后都自动显示backtrace的内容 这个问题实际是如何一次执行多条命令。用自定义命令解决</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) define nbt</span></p> 
 <p align="left"><span style="color:#333333">Type commands for definition of “nbt”.</span></p> 
 <p align="left"><span style="color:#333333">End with a line saying just “end”.</span></p> 
 <p align="left"><span style="color:#333333">&gt;next</span></p> 
 <p align="left"><span style="color:#333333">&gt;bt</span></p> 
 <p align="left"><span style="color:#333333">&gt;end</span></p> 
 <p align="left"><span style="color:#333333">(gdb) nbt</span></p> 
 <p align="left"><span style="color:#333333">#0 early_cpu_init () at arch/x86/kernel/cpu/common.c:626</span></p> 
 <p align="left"><span style="color:#333333">#1 0xc0384ca9 in setup_arch (cmdline_p=0xc0379fe8)</span></p> 
 <p align="left"><span style="color:#333333">at arch/x86/kernel/setup_32.c:765</span></p> 
 <p align="left"><span style="color:#333333">#2 0xc037f62e in start_kernel () at init/main.c:564</span></p> 
 <p align="left"><span style="color:#333333">#3 0xc037f008 in i386_start_kernel () at arch/x86/kernel/head32.c:13</span></p> 
 <p align="left"><span style="color:#333333">#4 0×00000000 in ?? ()</span></p> 
 <p align="left"><span style="color:#333333">(gdb)</span></p> 
</div> 
<p align="left"><span style="color:#333333">8. gdb</span><span style="color:#333333">在TUI</span>模式下如何把光标焦点炸转移到command窗口，以便能用上下箭头键能快速翻出历史指令？</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">实际是转换</span><span style="color:#333333">“active”</span><span style="color:#333333">窗口。</span></p> 
 <p align="left"><span style="color:#333333">C-x o</span><span style="color:#333333">：</span><span style="color:#333333"> ctrl+x,</span><span style="color:#333333">接着放开这两个键，然后在按</span><span style="color:#333333">o</span><span style="color:#333333">（不需要</span><span style="color:#333333">+ctrl</span><span style="color:#333333">）</span></p> 
 <p align="left"><span style="color:#333333">关于</span><span style="color:#333333">TUI</span><span style="color:#333333">更多信息：</span></p> 
 <p align="left"><span style="color:#333333">http://sourceware.org/gdb/current/onlinedocs/gdb_23.html#SEC236</span></p> 
 <p align="left"><span style="color:#333333">还有组合键</span></p> 
 <p align="left"><span style="color:#333333">C-x C-a</span></p> 
 <p align="left"><span style="color:#333333">C-x a</span></p> 
 <p align="left"><span style="color:#333333">C-x A </span><span style="color:#333333">退出</span><span style="color:#333333">TUI</span><span style="color:#333333">模式</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">C-x 1 </span><span style="color:#333333">只用一个窗口</span></p> 
 <p align="left"><span style="color:#333333">C-x 2 </span><span style="color:#333333">用两个窗口，按多次会有不同两个窗口的组合形式</span></p> 
 <p align="left"><span style="color:#333333">C-x o active </span><span style="color:#333333">窗口转移</span></p> 
 <p align="left"><span style="color:#333333">C-x s </span><span style="color:#333333">进入和退出</span><span style="color:#333333">TUI SingleKey </span><span style="color:#333333">模式</span></p> 
 <p align="left"><span style="color:#333333">注：</span><span style="color:#333333">C-x o</span><span style="color:#333333">多次使用相当于依次执行以下命令</span></p> 
 <p align="left"><span style="color:#333333">focus src </span><span style="color:#333333">转移焦点到源码窗口。</span></p> 
 <p align="left"><span style="color:#333333">focus asm</span></p> 
 <p align="left"><span style="color:#333333">focus regs</span></p> 
 <p align="left"><span style="color:#333333">focus cmd</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">TUI</span><span style="color:#333333">模式还有以下专用命令</span></p> 
 <p align="left"><span style="color:#333333">info win</span></p> 
 <p align="left"><span style="color:#333333">layout next</span></p> 
 <p align="left"><span style="color:#333333">layout prev</span></p> 
 <p align="left"><span style="color:#333333">layout src</span></p> 
 <p align="left"><span style="color:#333333">layout asm</span></p> 
 <p align="left"><span style="color:#333333">layout split</span></p> 
 <p align="left"><span style="color:#333333">layout regs</span></p> 
 <p align="left"><span style="color:#333333">focus next</span></p> 
 <p align="left"><span style="color:#333333">refresh</span></p> 
 <p align="left"><span style="color:#333333">tui reg float</span></p> 
 <p align="left"><span style="color:#333333">tui reg general</span></p> 
 <p align="left"><span style="color:#333333">tui reg next</span></p> 
 <p align="left"><span style="color:#333333">tui reg system</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">update</span></p> 
 <p align="left"><span style="color:#333333">winheight name +count</span></p> 
 <p align="left"><span style="color:#333333">winheight name -count</span></p> 
 <p align="left"><span style="color:#333333">tabset nchars</span></p> 
</div> 
<p align="left"><span style="color:#333333">9. </span><span style="color:#333333">如何在子函数调用和退出时都暂停运行 watch $ebp</span></p> 
<p align="left"><span style="color:#333333">10. </span><span style="color:#333333">如何获取结构体中特定域的相对偏移量，比如struct stak_struct </span>中lock_depth的相对偏移量？</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) p/x &amp;(*(struct task_struct*)0).lock_depth</span></p> 
 <p align="left"><span style="color:#333333">$7 = 0x14</span></p> 
</div> 
<p align="left"><span style="color:#333333">11. </span><span style="color:#333333">如何能够交换使用ddd</span>与gdb，也就是说使用ddd调试时，想换回使用纯gdb，同时保证启用gdb后保证“调试上下文”没任何变化？</p> 
<p align="left"><span style="color:#333333">只要.gdbinit </span>文件没包含 c, next..等等能驱动gdb继续调试的命令就可以。</p> 
<p align="left"><span style="color:#333333">12. </span><span style="color:#333333">如何通过函数名确定所在的源文件</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) info line vfs_mkdir</span></p> 
 <p align="left"><span style="color:#333333">Line 2131 of "fs/namei.c"starts at address 0xc017c048 &lt;vfs_mkdir&gt; and ends at 0xc017c052&lt;vfs_mkdir+10&gt;.</span></p> 
</div> 
<p align="left"><span style="color:#333333">13. </span><span style="color:#333333">由汇编指令地址确定该指令所对应源码的所在行(</span>注：一行c语言一般对应几行汇编指令)</p> 
<p align="left"><span style="color:#333333">info line *xxxxxxx(xxx</span><span style="color:#333333">是汇编指令地址)</span></p> 
<p align="left"><span style="color:#333333">14. </span><span style="color:#333333">如何快速定位函数中某句C</span>语句对应汇编指令的开始地址。比如以下 [内容太大，准备移到其他位置]</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">2130  intvfs_mkdir(struct inode *dir, struct dentry *dentry, int mode)</span></p> 
 <p align="left"><span style="color:#333333">2131  {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">.......</span></p> 
 <p align="left"><span style="color:#333333">2145           DQUOT_INIT(dir);</span></p> 
 <p align="left"><span style="color:#333333">2146           error= dir-&gt;i_op-&gt;mkdir(dir, dentry, mode);//&lt;-</span><span style="color:#333333">我们想确定这句语句的汇编指令开始地址，注意它在源文件中的行数</span></p> 
 <p align="left"><span style="color:#333333">2147           if(!error)</span></p> 
 <p align="left"><span style="color:#333333">2148                   fsnotify_mkdir(dir,dentry);</span></p> 
 <p align="left"><span style="color:#333333">2149           returnerror;</span></p> 
 <p align="left"><span style="color:#333333">2150  }</span></p> 
</div> 
<p align="left"><span style="color:#333333">首先，通过函数名查询对应的源文件</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) info line vfs_mkdir</span></p> 
 <p align="left"><span style="color:#333333">Line 2131 of "fs/namei.c"starts at address 0xc017c048 &lt;vfs_mkdir&gt; and ends at 0xc017c052&lt;vfs_mkdir+10&gt;.</span></p> 
</div> 
<p align="left"><span style="color:#333333">然后，利用info line </span>源文件:目标语句的行数 就能查询到</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) info line fs/namei.c:2146</span></p> 
 <p align="left"><span style="color:#333333">Line 2146 of "fs/namei.c"starts at address 0xc017c0ee &lt;vfs_mkdir+166&gt; and ends at 0xc017c0fe&lt;vfs_mkdir+182&gt;.</span></p> 
</div> 
<p align="left"><span style="color:#333333">验证一下</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) disass 0xc017c0ee</span></p> 
 <p align="left"><span style="color:#333333">Dump of assembler code for functionvfs_mkdir:</span></p> 
 <p align="left"><span style="color:#333333">0xc017c048 &lt;vfs_mkdir+0&gt;:       push  %ebp</span></p> 
 <p align="left"><span style="color:#333333">.....</span></p> 
 <p align="left"><span style="color:#333333">0xc017c0e4 &lt;vfs_mkdir+156&gt;:     mov   0x24(%eax),%ecx</span></p> 
 <p align="left"><span style="color:#333333">0xc017c0e7 &lt;vfs_mkdir+159&gt;:     or    $0xffffffff,%edx</span></p> 
 <p align="left"><span style="color:#333333">0xc017c0ea &lt;vfs_mkdir+162&gt;:     mov   %esi,%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc017c0ec &lt;vfs_mkdir+164&gt;:     call  *(%ecx)</span></p> 
 <p align="left"><span style="color:#333333">0xc017c0ee &lt;vfs_mkdir+166&gt;:     mov   0x98(%esi),%ebx  //</span></p> 
 <p align="left"><span style="color:#333333">0xc017c0f4 &lt;vfs_mkdir+172&gt;:     mov   %edi,%edx        //</span><span style="color:#333333">参数</span><span style="color:#333333"> dentry -&gt; %edx</span></p> 
 <p align="left"><span style="color:#333333">0xc017c0f6 &lt;vfs_mkdir+174&gt;:     mov   %esi,%eax        //</span><span style="color:#333333">参数</span><span style="color:#333333">dir -&gt; %eax</span></p> 
 <p align="left"><span style="color:#333333">0xc017c0f8 &lt;vfs_mkdir+176&gt;:     mov   -0x10(%ebp),%ecx //</span><span style="color:#333333">参数</span><span style="color:#333333">mode -&gt; %ecx </span></p> 
 <p align="left"><span style="color:#333333">0xc017c0fb &lt;vfs_mkdir+179&gt;:     call  *0x14(%ebx)      //dir-&gt;i_op-&gt;mkdir(dir, dentry, mode) </span></p> 
 <p align="left"><span style="color:#333333">0xc017c0fe &lt;vfs_mkdir+182&gt;:     test  %eax,%eax        //</span><span style="color:#333333">判断返回值</span><span style="color:#333333">(error = dir-&gt;i_op-&gt;mkdir(dir,dentry, mode);)</span></p> 
 <p align="left"><span style="color:#333333">0xc017c100 &lt;vfs_mkdir+184&gt;:     mov   %eax,%ebx        //</span><span style="color:#333333">保存返回值</span></p> 
 <p align="left"><span style="color:#333333">0xc017c102 &lt;vfs_mkdir+186&gt;:     jne   0xc017c15d &lt;vfs_mkdir+277&gt; //</span><span style="color:#333333">如果返回值</span><span style="color:#333333"> != 0</span><span style="color:#333333">，也就是</span><span style="color:#333333">mkdir</span><span style="color:#333333">失败，跳到最后返回。成功则继续</span></p> 
 <p align="left"><span style="color:#333333">0xc017c104 &lt;vfs_mkdir+188&gt;:     testb $0x4,0x11c(%esi)           //</span><span style="color:#333333">内联函数</span><span style="color:#333333">fsnotify_mkdir </span><span style="color:#333333">及子函数</span><span style="color:#333333">-&gt;inode_dir_notify</span><span style="color:#333333">在这里展开</span></p> 
 <p align="left"><span style="color:#333333">                           //static inline voidinode_dir_notify(struct inode *inode, unsigned long event)</span></p> 
 <p align="left"><span style="color:#333333">                           //{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                           //       if (inode-&gt;i_dnotify_mask &amp;(event)) &lt;-</span><span style="color:#333333">注意这里判断位，刚好对应</span><span style="color:#333333">testb $0x4,0x11c(%esi)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">0xc017c10b &lt;vfs_mkdir+195&gt;:     je    0xc017c119 &lt;vfs_mkdir+209&gt;</span></p> 
 <p align="left"><span style="color:#333333">.....</span></p> 
 <p align="left"><span style="color:#333333">0xc017c15d &lt;vfs_mkdir+277&gt;:     lea   -0xc(%ebp),%esp</span></p> 
 <p align="left"><span style="color:#333333">0xc017c160 &lt;vfs_mkdir+280&gt;:     mov   %ebx,%eax</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">我们通过mkdir</span>参数个数，及testb 指令基本判定我们的猜测没错。也就是说vfs_mkdir函数中dir→i_op→mkdir的实际调用是在0xc017c0fb &lt;vfs_mkdir+179&gt;: call *0×14(%ebx)</p> 
<p align="left"><span style="color:#333333">15. </span><span style="color:#333333">下断点的形式</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">1. b </span><span style="color:#333333">函数名</span></p> 
 <p align="left"><span style="color:#333333">2. b *</span><span style="color:#333333">指令地址</span></p> 
 <p align="left"><span style="color:#333333">3. b </span><span style="color:#333333">源码</span><span style="color:#333333">:</span><span style="color:#333333">行数</span></p> 
 <p align="left"><span style="color:#333333">(gdb) b fs/namei.c:2146</span></p> 
 <p align="left"><span style="color:#333333">Breakpoint 9 at 0xc017c0ee: filefs/namei.c, line 2146.</span></p> 
</div> 
<p align="left"><span style="color:#333333">16. </span><span style="color:#333333">陷入循环语句后，想自动运行到循环语句结束：</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">u</span></p> 
</div> 
<p align="left"><span style="color:#333333">17. </span><span style="color:#333333">重复当前的gdb</span>指令</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">按</span><span style="color:#333333">enter</span><span style="color:#333333">键即可</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">gdb</span><span style="color:#333333">宏</span></strong></p> 
<p align="left"><span style="color:#333333">本小节意义：为了方便把调试内容复制出来，而又需要一定的功能，本人经常使用的工具是gdb</span>的tui。所以gdb宏的使用更是成了不可缺少的辅助手段。比如extendinstr宏，能实时显示调用链的情况，相当于实现了ddd的backtrace分窗口。其他宏的作用就不说了。</p> 
<p align="left"><strong><span style="color:#333333">参考资料</span></strong></p> 
<p align="left"><span style="color:#333333">kgdb</span><span style="color:#333333">官方的gdb</span>宏 <a target="_blank" href="http://kgdb.linsyssoft.com/downloads.htm" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://kgdb.linsyssoft.com/downloads.htm</span></a></p> 
<p align="left"><span style="color:#333333">“Fun with strace andthe GDB Debugger</span>” <a target="_blank" href="http://www.ibm.com/developerworks/aix/library/au-unix-strace.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/aix/library/au-unix-strace.html</span></a></p> 
<p align="left"><span style="color:#333333">“GNU ProjectDebugger: More fun with GDB</span>” <a target="_blank" href="http://www.ibm.com/developerworks/aix/library/au-gdb.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/aix/library/au-gdb.html</span></a></p> 
<p align="left"><span style="color:#333333">“14.3.4. UsefulKernel gdb Macros</span>” from “EmbeddedLinux Primer” <a target="_blank" href="http://book.opensourceproject.org.cn/embedded/embeddedprime/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://book.opensourceproject.org.cn/embedded/embeddedprime/</span></a></p> 
<p align="left"><strong><span style="color:#333333">gdb</span><span style="color:#333333">宏的使用</span></strong></p> 
<p align="left"><span style="color:#333333">假设要使用下节的lsmod</span>，该gdb宏能列举内核中的模块。 在内核源码目录下建立一个新文件lsmod,内容见下节。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">装载宏</span></p> 
 <p align="left"><span style="color:#333333">(gdb) source lsmod </span></p> 
 <p align="left"><span style="color:#333333">查看说明</span></p> 
 <p align="left"><span style="color:#333333">(gdb) help lsmod</span></p> 
 <p align="left"><span style="color:#333333">list module struct's address, textaddress and their module name</span></p> 
 <p align="left"><span style="color:#333333">使用</span></p> 
 <p align="left"><span style="color:#333333">(gdb) lsmod</span></p> 
 <p align="left"><span style="color:#333333">(gdb) lsmod</span></p> 
 <p align="left"><span style="color:#333333">Address                text             Module</span></p> 
 <p align="left"><span style="color:#333333">0xE014DDA0     0xE014D000       nls_iso8859_1</span></p> 
 <p align="left"><span style="color:#333333">0xE0169AE0     0xE0164000       isofs</span></p> 
 <p align="left"><span style="color:#333333">0xE014BA20     0xE0148000       zlib_inflate</span></p> 
 <p align="left"><span style="color:#333333">0xE0161FE0     0xE0152000       udf</span></p> 
 <p align="left"><span style="color:#333333">.....</span></p> 
 <p align="left"><span style="color:#333333">0xE0012DE0     0xE000B000       processor</span></p> 
 <p align="left"><span style="color:#333333">0xE0008EA0     0xE0008000       fan</span></p> 
 <p align="left"><span style="color:#333333">0xE00223E0     0xE0020000       thermal_sys</span></p> 
 <p align="left"><span style="color:#333333">----end----</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">我们查看一下</span><span style="color:#333333">processor</span><span style="color:#333333">模块结构体的内容</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p *(struct module *)0xE0012DE0</span></p> 
 <p align="left"><span style="color:#333333">$10 = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333"> state = MODULE_STATE_LIVE, </span></p> 
 <p align="left"><span style="color:#333333"> list = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">   next = 0xe0008ea4, </span></p> 
 <p align="left"><span style="color:#333333">   prev = 0xe0018984</span></p> 
 <p align="left"><span style="color:#333333"> }, </span></p> 
 <p align="left"><span style="color:#333333"> name = "processor", '\0' &lt;repeats 50 times&gt;, </span></p> 
 <p align="left"><span style="color:#333333"> mkobj = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">   kobj = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">     name = 0xd5910ba0 "processor", </span> </p> 
 <p align="left"><span style="color:#333333">     kref = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       refcount = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">         counter = 3</span></p> 
 <p align="left"><span style="color:#333333">       }</span></p> 
 <p align="left"><span style="color:#333333">     }, </span></p> 
 <p align="left"><span style="color:#333333">     entry = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       next = 0xe00189d0, </span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">为了方便查看该结构中指针域所指向的结构体，可在</span><span style="color:#333333">ddd</span><span style="color:#333333">下用以下命令打开数据图形然后展开查看</span></p> 
 <p align="left"><span style="color:#333333">(gdb) graph display *(struct module*)0xE0012DE0</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">实例</span></strong></p> 
<p align="left"><span style="color:#333333">给出的例子都在2.6.26</span>内核上上测试通过。</p> 
<p align="left"><strong><span style="color:#333333">链表遍历类</span></strong></p> 
<p align="left"><span style="color:#333333">宏名: lsmod(</span>有小bug,饭后再看)</p> 
<p align="left"><span style="color:#333333">作用: </span>列举内核模块的名称及对应模块结构体的地址，以及text段的地址［todo，导出.bss,.data地址］</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">define lsmod</span></p> 
 <p align="left"><span style="color:#333333">       printf"Address\t\ttext\t\tModule\n"</span></p> 
 <p align="left"><span style="color:#333333">       set $m=(struct list_head *)&amp;modules</span></p> 
 <p align="left"><span style="color:#333333">       set $done=0</span></p> 
 <p align="left"><span style="color:#333333">       #</span><span style="color:#333333">获取结构体内特定域的相对偏移，见</span><span style="color:#333333">"gdb</span><span style="color:#333333">技巧</span><span style="color:#333333">"</span></p> 
 <p align="left"><span style="color:#333333">       set $offset=&amp;(*(struct module *)0).list</span></p> 
 <p align="left"><span style="color:#333333">       while ( !$done )</span></p> 
 <p align="left"><span style="color:#333333">                set $mp=(struct module *)((char*)$m-&gt;next - (char *)$offset)</span></p> 
 <p align="left"><span style="color:#333333">                printf"0x%X\t0x%X\t%s\n", $mp, $mp-&gt;module_core,$mp-&gt;name</span></p> 
 <p align="left"><span style="color:#333333">                if ( $mp-&gt;list-&gt;next ==&amp;modules)</span></p> 
 <p align="left"><span style="color:#333333">                        set $done=1</span></p> 
 <p align="left"><span style="color:#333333">                end</span></p> 
 <p align="left"><span style="color:#333333">                set $m=$m-&gt;next</span></p> 
 <p align="left"><span style="color:#333333">       end</span></p> 
 <p align="left"><span style="color:#333333">       printf "----end----\n"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">document lsmod</span></p> 
 <p align="left"><span style="color:#333333">list module struct's address, textaddress and their module name</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">效果如下</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) lsmod</span></p> 
 <p align="left"><span style="color:#333333">Address                text             Module</span></p> 
 <p align="left"><span style="color:#333333">0xE014DDA0     0xE014D000       nls_iso8859_1</span></p> 
 <p align="left"><span style="color:#333333">0xE0169AE0     0xE0164000       isofs</span></p> 
 <p align="left"><span style="color:#333333">0xE014BA20     0xE0148000       zlib_inflate</span></p> 
 <p align="left"><span style="color:#333333">0xE0161FE0     0xE0152000       udf</span></p> 
 <p align="left"><span style="color:#333333">.....</span></p> 
 <p align="left"><span style="color:#333333">0xE001BEA0     0xE001A000       8390</span></p> 
 <p align="left"><span style="color:#333333">0xE017EEC0     0xE016C000       ide_core</span></p> 
 <p align="left"><span style="color:#333333">0xE0018980     0xE0015000       thermal</span></p> 
 <p align="left"><span style="color:#333333">0xE0012DE0     0xE000B000       processor</span></p> 
 <p align="left"><span style="color:#333333">0xE0008EA0     0xE0008000       fan</span></p> 
 <p align="left"><span style="color:#333333">0xE00223E0     0xE0020000       thermal_sys</span></p> 
 <p align="left"><span style="color:#333333">----end----</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">宏名: psusr,pskern</span></p> 
<p align="left"><span style="color:#333333">作用: </span>列举所有task的结构地址，状态，PID，PPID，comm。</p> 
<p align="left"><span style="color:#333333">psusr,</span><span style="color:#333333">只列举用户层可见的进程；pskern</span>，列举内核层可见的所有进程。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">define __show_state</span></p> 
 <p align="left"><span style="color:#333333">       if ($arg0-&gt;state == 0)</span></p> 
 <p align="left"><span style="color:#333333">                printf "running\t\t"</span></p> 
 <p align="left"><span style="color:#333333">                else</span></p> 
 <p align="left"><span style="color:#333333">                if ($arg0-&gt;state == 1)</span></p> 
 <p align="left"><span style="color:#333333">                        printf "sleeping\t"</span></p> 
 <p align="left"><span style="color:#333333">                        else</span></p> 
 <p align="left"><span style="color:#333333">                        if ($arg0-&gt;state ==2)</span></p> 
 <p align="left"><span style="color:#333333">                                printf"disksleep\t"</span></p> 
 <p align="left"><span style="color:#333333">                                else</span></p> 
 <p align="left"><span style="color:#333333">                                if($arg0-&gt;state == 4)</span></p> 
 <p align="left"><span style="color:#333333">                                        printf"zombie\t"</span></p> 
 <p align="left"><span style="color:#333333">                                        else</span></p> 
 <p align="left"><span style="color:#333333">                                        if($arg0-&gt;state == 8)</span></p> 
 <p align="left"><span style="color:#333333">                                               printf "stopped\t"</span></p> 
 <p align="left"><span style="color:#333333">                                                else</span></p> 
 <p align="left"><span style="color:#333333">                                               if ($arg0-&gt;state == 16)</span></p> 
 <p align="left"><span style="color:#333333">                                                       printf "wpaging\t"</span></p> 
 <p align="left"><span style="color:#333333">                                                       else</span></p> 
 <p align="left"><span style="color:#333333">                                                                printf"%d\t\t", $arg0-&gt;state</span></p> 
 <p align="left"><span style="color:#333333">                                                       end</span></p> 
 <p align="left"><span style="color:#333333">                                               end</span></p> 
 <p align="left"><span style="color:#333333">                                        end</span></p> 
 <p align="left"><span style="color:#333333">                                end</span></p> 
 <p align="left"><span style="color:#333333">                        end</span></p> 
 <p align="left"><span style="color:#333333">                end</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document __show_state</span></p> 
 <p align="left"><span style="color:#333333">internel macro, don't call it by hand</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define psusr</span></p> 
 <p align="left"><span style="color:#333333">       printf "address\t\tstate\t\tuid\tpid\tppid\tcomm\n"</span></p> 
 <p align="left"><span style="color:#333333">       set $init_t = &amp;init_task</span></p> 
 <p align="left"><span style="color:#333333">       set $tasks_off=((size_t)&amp;((struct task_struct *)0)-&gt;tasks)</span></p> 
 <p align="left"><span style="color:#333333">       set $next_t=(((char *)($init_t-&gt;tasks).next) - $tasks_off)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       while ($next_t != $init_t)</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(struct task_struct *)$next_t</span></p> 
 <p align="left"><span style="color:#333333">               printf"0x%08X\t", $next_t</span></p> 
 <p align="left"><span style="color:#333333">               __show_state$next_t</span></p> 
 <p align="left"><span style="color:#333333">               printf"%d\t%d\t%d\t%s\n", \</span></p> 
 <p align="left"><span style="color:#333333">                       $next_t-&gt;uid,$next_t-&gt;pid, \</span></p> 
 <p align="left"><span style="color:#333333">                       $next_t-&gt;parent-&gt;pid,$next_t-&gt;comm</span></p> 
 <p align="left"><span style="color:#333333">               set  $next_t=(char *)($next_t-&gt;tasks.next) -$tasks_off </span></p> 
 <p align="left"><span style="color:#333333">       end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       printf "address\t\tstate\t\tuid\tpid\tppid\tcomm\n"</span></p> 
 <p align="left"><span style="color:#333333">       printf "----end----\n"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document psusr</span></p> 
 <p align="left"><span style="color:#333333">print information for all tasks, but notincluding thread members.</span></p> 
 <p align="left"><span style="color:#333333">This command looks like "ps-aux" in userspace.</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define pskern</span></p> 
 <p align="left"><span style="color:#333333">       printf "address\t\tstate\t\tuid\tpid\tppid\tcomm\n"</span></p> 
 <p align="left"><span style="color:#333333">       set $init_t = &amp;init_task</span></p> 
 <p align="left"><span style="color:#333333">       printf "0x%08X\t", $init_t</span></p> 
 <p align="left"><span style="color:#333333">       __show_state $init_t</span></p> 
 <p align="left"><span style="color:#333333">       printf "%d\t%d\t%d\t%s\n", \</span></p> 
 <p align="left"><span style="color:#333333">                $init_t-&gt;uid,$init_t-&gt;pid, \</span></p> 
 <p align="left"><span style="color:#333333">                $init_t-&gt;parent-&gt;pid,$init_t-&gt;comm</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">      set$tasks_off=((size_t)&amp;((struct task_struct *)0)-&gt;tasks)</span></p> 
 <p align="left"><span style="color:#333333">      set$thread_off=((size_t)&amp;((struct task_struct *)0)-&gt;thread_group.next)</span></p> 
 <p align="left"><span style="color:#333333">      set$next_t=(((char *)($init_t-&gt;tasks).next) - $tasks_off)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      while($next_t != $init_t)</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(struct task_struct *)$next_t</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               printf"0x%08X\t", $next_t</span></p> 
 <p align="left"><span style="color:#333333">               __show_state$next_t</span></p> 
 <p align="left"><span style="color:#333333">               printf"%d\t%d\t%d\t%s\n", \</span></p> 
 <p align="left"><span style="color:#333333">                       $next_t-&gt;uid,$next_t-&gt;pid, \</span></p> 
 <p align="left"><span style="color:#333333">                       $next_t-&gt;parent-&gt;pid,$next_t-&gt;comm</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               set$next_th=(((char *)$next_t-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               while($next_th != $next_t)</span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(struct task_struct *)$next_th</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">                       printf"0x%08X\t", $next_th</span></p> 
 <p align="left"><span style="color:#333333">                       __show_state$next_th</span></p> 
 <p align="left"><span style="color:#333333">                       printf"%d\t%d\t%d\t%s\n", \</span></p> 
 <p align="left"><span style="color:#333333">                                $next_th-&gt;uid,$next_th-&gt;pid, \</span></p> 
 <p align="left"><span style="color:#333333">                                $next_th-&gt;parent-&gt;pid,$next_th-&gt;comm</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(((char *)$next_th-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333">               end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               set  $next_t=(char *)($next_t-&gt;tasks.next) -$tasks_off</span></p> 
 <p align="left"><span style="color:#333333">       end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       printf "address\t\tstate\t\tuid\tpid\tppid\tcomm\n"</span></p> 
 <p align="left"><span style="color:#333333">       printf "----end----\n"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document pskern</span></p> 
 <p align="left"><span style="color:#333333">print infor for all tasks viewed inkernel, including all thread members</span></p> 
 <p align="left"><span style="color:#333333">and swapper(PID==0).</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
</div> 
<p align="left"><span style="color:#333333">效果如下</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) source ps</span></p> 
 <p align="left"><span style="color:#333333">(gdb) psusr</span></p> 
 <p align="left"><span style="color:#333333">address                state            uid      pid      ppid     comm</span></p> 
 <p align="left"><span style="color:#333333">0xDC43F8A0     sleeping 0        1        0        init</span></p> 
 <p align="left"><span style="color:#333333">0xDC43F490     sleeping 0        2        0        kthreadd</span></p> 
 <p align="left"><span style="color:#333333">0xDC43F080     sleeping 0        3        2        migration/0</span></p> 
 <p align="left"><span style="color:#333333">0xDC43EC70     sleeping 0        4        2        ksoftirqd/0</span></p> 
 <p align="left"><span style="color:#333333">0xDC43E860     sleeping 0        5        2        watchdog/0</span></p> 
 <p align="left"><span style="color:#333333">.....</span></p> 
 <p align="left"><span style="color:#333333">0xDC44E060     sleeping 0        1707     1        acpid</span></p> 
 <p align="left"><span style="color:#333333">0xD8AE6100     sleeping 104      1716     1        dbus-daemon</span></p> 
 <p align="left"><span style="color:#333333">0xDC46ECD0     sleeping 0        1739     1        cupsd</span></p> 
 <p align="left"><span style="color:#333333">0xDC45E080     sleeping 101      2009     1        exim4</span></p> 
 <p align="left"><span style="color:#333333">0xD5A6C0E0     sleeping 0        2026     1        inetd</span></p> 
 <p align="left"><span style="color:#333333">0xD5A6CD10     sleeping 0        2034     1        dhcdbd</span></p> 
 <p align="left"><span style="color:#333333">0xDBD45160     sleeping 105      2044     1        hald</span></p> 
 <p align="left"><span style="color:#333333">0xDBD45570     sleeping 0        2045     2044     hald-runner</span></p> 
 <p align="left"><span style="color:#333333">....</span></p> 
 <p align="left"><span style="color:#333333">address                state            uid      pid      ppid     comm</span></p> 
 <p align="left"><span style="color:#333333">----end----</span></p> 
</div> 
<p align="left"><span style="color:#333333">宏名： lssp</span></p> 
<p align="left"><span style="color:#333333">作用： 列举超级块地址及其s_id</span>域</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">define lssp</span></p> 
 <p align="left"><span style="color:#333333">       printf "address\t\ts_id\n"</span></p> 
 <p align="left"><span style="color:#333333">       set $sb_lh=(struct list_head *)&amp;super_blocks</span></p> 
 <p align="left"><span style="color:#333333">       #</span><span style="color:#333333">获取结构体内特定域的相对偏移，见</span><span style="color:#333333">"gdb</span><span style="color:#333333">技巧</span><span style="color:#333333">"</span></p> 
 <p align="left"><span style="color:#333333">       set $offset=&amp;(*(struct super_block *)0).s_list</span></p> 
 <p align="left"><span style="color:#333333">       set $sbp=(struct super_block *)((char *)$sb_lh-&gt;next - (char*)$offset)</span></p> 
 <p align="left"><span style="color:#333333">       while ( &amp;$sbp-&gt;s_list != $sb_lh )</span></p> 
 <p align="left"><span style="color:#333333">                printf"0x%08X\t%s\n", $sbp, $sbp-&gt;s_id</span></p> 
 <p align="left"><span style="color:#333333">                set $sbp=(struct super_block*)((char *)$sbp-&gt;s_list.next - (char *)$offset)</span></p> 
 <p align="left"><span style="color:#333333">       end</span></p> 
 <p align="left"><span style="color:#333333">       printf "----end----\n"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">document lssp</span></p> 
 <p align="left"><span style="color:#333333">List the super_block and their startaddresses</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">效果</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) lssp</span></p> 
 <p align="left"><span style="color:#333333">address                s_id</span></p> 
 <p align="left"><span style="color:#333333">0xDC40DC00     sysfs</span></p> 
 <p align="left"><span style="color:#333333">0xDC40DA00     rootfs</span></p> 
 <p align="left"><span style="color:#333333">0xDC40D800     bdev</span></p> 
 <p align="left"><span style="color:#333333">0xDC40D400     proc</span></p> 
 <p align="left"><span style="color:#333333">0xDC41B200     sockfs</span></p> 
 <p align="left"><span style="color:#333333">0xDC431C00     debugfs</span></p> 
 <p align="left"><span style="color:#333333">0xDC486600     pipefs</span></p> 
 <p align="left"><span style="color:#333333">0xDC486000     anon_inodefs</span></p> 
 <p align="left"><span style="color:#333333">0xD58C5A00     tmpfs</span></p> 
 <p align="left"><span style="color:#333333">0xD58C5200     inotifyfs</span></p> 
 <p align="left"><span style="color:#333333">0xD8C09800     devpts</span></p> 
 <p align="left"><span style="color:#333333">0xD8C09600     hugetlbfs</span></p> 
 <p align="left"><span style="color:#333333">0xD8C09400     mqueue</span></p> 
 <p align="left"><span style="color:#333333">0xD590E000     tmpfs</span></p> 
 <p align="left"><span style="color:#333333">0xD59E4C00     hda1</span></p> 
 <p align="left"><span style="color:#333333">0xD5908A00     tmpfs</span></p> 
 <p align="left"><span style="color:#333333">0xD7753200     tmpfs</span></p> 
 <p align="left"><span style="color:#333333">0xDBD66400     hdc</span></p> 
 <p align="left"><span style="color:#333333">----end----</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">功能增强类</span></strong></p> 
<p align="left"><span style="color:#333333">宏名： eih, lih, ooi</span></p> 
<p align="left"><span style="color:#333333">作用： 克服时钟中断干扰与中断无关的目标代码的调试(X86</span>下适用)，解释请看“工程方法”</p> 
<p align="left"><span style="color:#333333">说明： 使用gdb</span>或ddd时，进入中断后用finish命令的话常常是要么无法返回被中断的原指令处后停住，而是继续运行，要么是会进入到另一个时钟中断中；但是好像在insight下没这个问题。使用这个gdb宏可以解决该问题。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">define eih</span></p> 
 <p align="left"><span style="color:#333333">b common_interrupt</span></p> 
 <p align="left"><span style="color:#333333">b native_iret</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">document eih</span></p> 
 <p align="left"><span style="color:#333333">eih: early interrupt hacking, breakcommon_interrupt and native_iret</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define lih</span></p> 
 <p align="left"><span style="color:#333333">b apic_timer_interrupt</span></p> 
 <p align="left"><span style="color:#333333">b irq_return</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">document lih</span></p> 
 <p align="left"><span style="color:#333333">lih: late interrupt hacking, breakapic_timer_interrupt and irq_return</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define ooi</span></p> 
 <p align="left"><span style="color:#333333">c</span></p> 
 <p align="left"><span style="color:#333333">stepi</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">document ooi</span></p> 
 <p align="left"><span style="color:#333333">ooi: out of interrupt, return to theinstruction interrupted by interrupt handler</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
</div> 
<p align="left"><span style="color:#333333">宏名： extendinstr</span></p> 
<p align="left"><span style="color:#333333">作用： 扩展指令集。配合gdb</span>自带的tui使用，能代替ddd等界面工具的部分功能。</p> 
<p align="left"><span style="color:#333333">说明： 指令开头:s</span>→step,si→stepi,n→next,ni→nexti,中间bt→bt,末尾i→info args &amp;&amp; info local</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">define inar</span></p> 
 <p align="left"><span style="color:#333333">printf "-----args start----\n"</span></p> 
 <p align="left"><span style="color:#333333">info args</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define inlo</span></p> 
 <p align="left"><span style="color:#333333">printf "-----localstart----\n"</span></p> 
 <p align="left"><span style="color:#333333">info local</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define btl</span></p> 
 <p align="left"><span style="color:#333333">printf "-------------------\n"</span></p> 
 <p align="left"><span style="color:#333333">bt</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define sibt</span></p> 
 <p align="left"><span style="color:#333333">stepi</span></p> 
 <p align="left"><span style="color:#333333">btl</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define sbt</span></p> 
 <p align="left"><span style="color:#333333">step</span></p> 
 <p align="left"><span style="color:#333333">btl</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define nibt</span></p> 
 <p align="left"><span style="color:#333333">nexti</span></p> 
 <p align="left"><span style="color:#333333">btl</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define nbt</span></p> 
 <p align="left"><span style="color:#333333">next</span></p> 
 <p align="left"><span style="color:#333333">btl</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define sibti</span></p> 
 <p align="left"><span style="color:#333333">inar</span></p> 
 <p align="left"><span style="color:#333333">inlo</span></p> 
 <p align="left"><span style="color:#333333">stepi</span></p> 
 <p align="left"><span style="color:#333333">btl</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define sbti</span></p> 
 <p align="left"><span style="color:#333333">inar</span></p> 
 <p align="left"><span style="color:#333333">inlo</span></p> 
 <p align="left"><span style="color:#333333">step</span></p> 
 <p align="left"><span style="color:#333333">btl</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define nibti</span></p> 
 <p align="left"><span style="color:#333333">inar</span></p> 
 <p align="left"><span style="color:#333333">inlo</span></p> 
 <p align="left"><span style="color:#333333">nexti</span></p> 
 <p align="left"><span style="color:#333333">btl</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define nbti</span></p> 
 <p align="left"><span style="color:#333333">inar</span></p> 
 <p align="left"><span style="color:#333333">inlo</span></p> 
 <p align="left"><span style="color:#333333">next</span></p> 
 <p align="left"><span style="color:#333333">btl</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
</div> 
<p align="left"><span style="color:#333333">效果</span></p> 
<p align="left"><span style="color:#333333">宏名： quick</span></p> 
<p align="left"><span style="color:#333333">作用： 超级快捷键。gdb</span>的快捷键并没用用尽所有的按键。我们可以利用空余的按键定义自己的命令。方便起见，我只是利用自定义命令简单的实现该该功能，而不是自定义快捷键。可以根据自己偏好来定义。</p> 
<p align="left"><span style="color:#333333">说明： 这个宏是配合前面的宏ooi</span>和宏extendinstr使用的。这样，如果调试时进入了时钟中断，按a＋enter就可以瞬间返回；q＋enter–&gt;sibt; z＋enter–&gt;finish。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">define a</span></p> 
 <p align="left"><span style="color:#333333">ooi</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define q</span></p> 
 <p align="left"><span style="color:#333333">sibt</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define z</span></p> 
 <p align="left"><span style="color:#333333">finish</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">宏名：bttnobp,btt,psusr,pskern,trapinfo,btpid,dmesg</span></p> 
<p align="left"><span style="color:#333333">内核文档gdbmacros.txt </span>的gdb宏的升级版本,还修正了一个bug,已在2.6.26下测试。</p> 
<p align="left"><span style="color:#333333">如果你运行这个脚本有错误，那说明你的内核版本太低了，请运行内核源码中原文件的宏。</span></p> 
<p align="left"><span style="color:#333333">本人这个文件的补丁还在提交的过程中。</span></p> 
<p align="left"><span style="color:#333333">能提供non-running</span>进程的backtrace功能，还实现了dmesg。</p> 
<p align="left"><span style="color:#333333">说明bttnobp</span>没在!CONFIG_FRAME_POINTER的配置下测试过，但是估计结果很不可靠，</p> 
<p align="left"><span style="color:#333333">因为条件判断太宽大了。</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#</span></p> 
 <p align="left"><span style="color:#333333"># This file contains a few gdb macros(user defined commands) to extract</span></p> 
 <p align="left"><span style="color:#333333"># useful information from kernelcrashdump (kdump) like stack traces of</span></p> 
 <p align="left"><span style="color:#333333"># all the processes or a particularprocess and trapinfo.</span></p> 
 <p align="left"><span style="color:#333333">#</span></p> 
 <p align="left"><span style="color:#333333"># These macros can be used by copyingthis file in .gdbinit (put in home</span></p> 
 <p align="left"><span style="color:#333333"># directory or current directory) or byinvoking gdb command with</span></p> 
 <p align="left"><span style="color:#333333"># --command=&lt;command-file-name&gt;option</span></p> 
 <p align="left"><span style="color:#333333">#</span></p> 
 <p align="left"><span style="color:#333333"># Credits:</span></p> 
 <p align="left"><span style="color:#333333"># Alexander Nyberg&lt;alexn@telia.com&gt;</span></p> 
 <p align="left"><span style="color:#333333"># V Srivatsa &lt;vatsa@in.ibm.com&gt;</span></p> 
 <p align="left"><span style="color:#333333"># Maneesh Soni&lt;maneesh@in.ibm.com&gt;</span></p> 
 <p align="left"><span style="color:#333333">#</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define __show_state</span></p> 
 <p align="left"><span style="color:#333333">       if ($arg0-&gt;state == 0)</span></p> 
 <p align="left"><span style="color:#333333">                printf "running\t\t"</span></p> 
 <p align="left"><span style="color:#333333">                else</span></p> 
 <p align="left"><span style="color:#333333">                if ($arg0-&gt;state == 1)</span></p> 
 <p align="left"><span style="color:#333333">                        printf"sleeping\t"</span></p> 
 <p align="left"><span style="color:#333333">                       else</span></p> 
 <p align="left"><span style="color:#333333">                        if ($arg0-&gt;state ==2)</span></p> 
 <p align="left"><span style="color:#333333">                                printf"disksleep\t"</span></p> 
 <p align="left"><span style="color:#333333">                                else</span></p> 
 <p align="left"><span style="color:#333333">                                if($arg0-&gt;state == 4)</span></p> 
 <p align="left"><span style="color:#333333">                                        printf"zombie\t"</span></p> 
 <p align="left"><span style="color:#333333">                                        else</span></p> 
 <p align="left"><span style="color:#333333">                                        if($arg0-&gt;state == 8)</span></p> 
 <p align="left"><span style="color:#333333">                                               printf "stopped\t"</span></p> 
 <p align="left"><span style="color:#333333">                                               else</span></p> 
 <p align="left"><span style="color:#333333">                                                if($arg0-&gt;state == 16)</span></p> 
 <p align="left"><span style="color:#333333">                                                       printf "wpaging\t"</span></p> 
 <p align="left"><span style="color:#333333">                                                       else</span></p> 
 <p align="left"><span style="color:#333333">                                                               printf "%d\t\t",$arg0-&gt;state</span></p> 
 <p align="left"><span style="color:#333333">                                                       end</span></p> 
 <p align="left"><span style="color:#333333">                                               end</span></p> 
 <p align="left"><span style="color:#333333">                                        end</span></p> 
 <p align="left"><span style="color:#333333">                                end</span></p> 
 <p align="left"><span style="color:#333333">                        end</span></p> 
 <p align="left"><span style="color:#333333">                end</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document __show_state</span></p> 
 <p align="left"><span style="color:#333333">internel macro, don't call it by hand</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define psusr</span></p> 
 <p align="left"><span style="color:#333333">       printf "address\t\tstate\t\tuid\tpid\tppid\tcomm\n"</span></p> 
 <p align="left"><span style="color:#333333">       set $init_t = &amp;init_task</span></p> 
 <p align="left"><span style="color:#333333">       set $tasks_off=((size_t)&amp;((struct task_struct *)0)-&gt;tasks)</span></p> 
 <p align="left"><span style="color:#333333">       set $next_t=(((char *)($init_t-&gt;tasks).next) - $tasks_off)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       while ($next_t != $init_t)</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(struct task_struct *)$next_t</span></p> 
 <p align="left"><span style="color:#333333">               printf"0x%08X\t", $next_t</span></p> 
 <p align="left"><span style="color:#333333">               __show_state$next_t</span></p> 
 <p align="left"><span style="color:#333333">               printf"%d\t%d\t%d\t%s\n", \</span></p> 
 <p align="left"><span style="color:#333333">                       $next_t-&gt;uid,$next_t-&gt;pid, \</span></p> 
 <p align="left"><span style="color:#333333">                       $next_t-&gt;parent-&gt;pid,$next_t-&gt;comm</span></p> 
 <p align="left"><span style="color:#333333">               set  $next_t=(char *)($next_t-&gt;tasks.next) -$tasks_off </span></p> 
 <p align="left"><span style="color:#333333">       end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       printf "address\t\tstate\t\tuid\tpid\tppid\tcomm\n"</span></p> 
 <p align="left"><span style="color:#333333">       printf "----end----\n"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document psusr</span></p> 
 <p align="left"><span style="color:#333333">print information for all tasks, but notincluding thread members.</span></p> 
 <p align="left"><span style="color:#333333">This command looks like "ps-aux" in userspace.</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define pskern</span></p> 
 <p align="left"><span style="color:#333333">       printf "address\t\tstate\t\tuid\tpid\tppid\tcomm\n"</span></p> 
 <p align="left"><span style="color:#333333">       set $init_t = &amp;init_task</span></p> 
 <p align="left"><span style="color:#333333">       printf "0x%08X\t", $init_t</span></p> 
 <p align="left"><span style="color:#333333">       __show_state $init_t</span></p> 
 <p align="left"><span style="color:#333333">       printf "%d\t%d\t%d\t%s\n", \</span></p> 
 <p align="left"><span style="color:#333333">                $init_t-&gt;uid,$init_t-&gt;pid, \</span></p> 
 <p align="left"><span style="color:#333333">                $init_t-&gt;parent-&gt;pid,$init_t-&gt;comm</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">      set$tasks_off=((size_t)&amp;((struct task_struct *)0)-&gt;tasks)</span></p> 
 <p align="left"><span style="color:#333333">      set$thread_off=((size_t)&amp;((struct task_struct *)0)-&gt;thread_group.next)</span></p> 
 <p align="left"><span style="color:#333333">      set$next_t=(((char *)($init_t-&gt;tasks).next) - $tasks_off)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      while($next_t != $init_t)</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(struct task_struct *)$next_t</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               printf"0x%08X\t", $next_t</span></p> 
 <p align="left"><span style="color:#333333">               __show_state$next_t</span></p> 
 <p align="left"><span style="color:#333333">               printf"%d\t%d\t%d\t%s\n", \</span></p> 
 <p align="left"><span style="color:#333333">                       $next_t-&gt;uid,$next_t-&gt;pid, \</span></p> 
 <p align="left"><span style="color:#333333">                       $next_t-&gt;parent-&gt;pid,$next_t-&gt;comm</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               set$next_th=(((char *)$next_t-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               while($next_th != $next_t)</span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(struct task_struct *)$next_th</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">                       printf"0x%08X\t", $next_th</span></p> 
 <p align="left"><span style="color:#333333">                       __show_state$next_th</span></p> 
 <p align="left"><span style="color:#333333">                       printf"%d\t%d\t%d\t%s\n", \</span></p> 
 <p align="left"><span style="color:#333333">                                $next_th-&gt;uid,$next_th-&gt;pid, \</span></p> 
 <p align="left"><span style="color:#333333">                                $next_th-&gt;parent-&gt;pid,$next_th-&gt;comm</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(((char *)$next_th-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333">               end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               set  $next_t=(char *)($next_t-&gt;tasks.next) -$tasks_off</span></p> 
 <p align="left"><span style="color:#333333">       end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       printf "address\t\tstate\t\tuid\tpid\tppid\tcomm\n"</span></p> 
 <p align="left"><span style="color:#333333">       printf "----end----\n"</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document pskern</span></p> 
 <p align="left"><span style="color:#333333">print infor for all tasks viewed inkernel, including all thread members</span></p> 
 <p align="left"><span style="color:#333333">and swapper(PID==0).</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define __prinfo_nobp</span></p> 
 <p align="left"><span style="color:#333333">       printf "\npid %d; addr:0x%08x; comm %s:\n", \</span></p> 
 <p align="left"><span style="color:#333333">                $arg0.pid, $arg0, $arg0.comm</span></p> 
 <p align="left"><span style="color:#333333">       printf "=====================================\n"</span></p> 
 <p align="left"><span style="color:#333333">       set var $stackp = $arg0.thread.sp</span></p> 
 <p align="left"><span style="color:#333333">       set var $stack_top = ($stackp &amp; ~4095) + 4096</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       while ($stackp &lt; $stack_top)</span></p> 
 <p align="left"><span style="color:#333333">                if (*($stackp) &gt; _stext&amp;&amp; *($stackp) &lt; _sinittext)</span></p> 
 <p align="left"><span style="color:#333333">                        info symbol *($stackp)</span></p> 
 <p align="left"><span style="color:#333333">                end</span></p> 
 <p align="left"><span style="color:#333333">       set $stackp += 4</span></p> 
 <p align="left"><span style="color:#333333">       end</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document __prinfo_nobp</span></p> 
 <p align="left"><span style="color:#333333">internal macro, don't call it by hand.</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define bttnobp</span></p> 
 <p align="left"><span style="color:#333333">      set$tasks_off=((size_t)&amp;((struct task_struct *)0)-&gt;tasks)</span></p> 
 <p align="left"><span style="color:#333333">      set$thread_off=((size_t)&amp;((struct task_struct *)0)-&gt;thread_group.next)</span></p> 
 <p align="left"><span style="color:#333333">      set$init_t=&amp;init_task</span></p> 
 <p align="left"><span style="color:#333333">      set$next_t=(((char *)($init_t-&gt;tasks).next) - $tasks_off)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      while($next_t != $init_t)</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(struct task_struct *)$next_t</span></p> 
 <p align="left"><span style="color:#333333">               __prinfo_nobp$next_t</span></p> 
 <p align="left"><span style="color:#333333">               set$next_th=(((char *)$next_t-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333">               while($next_th != $next_t)</span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(struct task_struct *)$next_th</span></p> 
 <p align="left"><span style="color:#333333">                       __prinfo_nobp$next_th</span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(((char *)$next_th-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333">               end</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(char *)($next_t-&gt;tasks.next) - $tasks_off</span></p> 
 <p align="left"><span style="color:#333333">      end</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document bttnobp</span></p> 
 <p align="left"><span style="color:#333333">      dumpall thread stack traces on a kernel compiled with !CONFIG_FRAME_POINTER</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define __prinfo</span></p> 
 <p align="left"><span style="color:#333333">       printf "\npid %d; addr:0x%08x; comm %s:\n", \</span></p> 
 <p align="left"><span style="color:#333333">                $arg0.pid, $arg0, $arg0.comm</span></p> 
 <p align="left"><span style="color:#333333">       printf "=====================================\n"</span></p> 
 <p align="left"><span style="color:#333333">       set var $stackp = $arg0.thread.sp</span></p> 
 <p align="left"><span style="color:#333333">       set var $stack_top = ($stackp &amp; ~4095) + 4096</span></p> 
 <p align="left"><span style="color:#333333">       set var $stack_bot = ($stackp &amp; ~4095)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       set $stackp = *($stackp)</span></p> 
 <p align="left"><span style="color:#333333">       while (($stackp &lt; $stack_top) &amp;&amp; ($stackp &gt; $stack_bot))</span></p> 
 <p align="left"><span style="color:#333333">                set var $addr = *($stackp + 4)</span></p> 
 <p align="left"><span style="color:#333333">                info symbol $addr</span></p> 
 <p align="left"><span style="color:#333333">                set $stackp = *($stackp)</span></p> 
 <p align="left"><span style="color:#333333">       end</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document __prinfo</span></p> 
 <p align="left"><span style="color:#333333">internal macro, don't call it by hand.</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define btt</span></p> 
 <p align="left"><span style="color:#333333">      set$tasks_off=((size_t)&amp;((struct task_struct *)0)-&gt;tasks)</span></p> 
 <p align="left"><span style="color:#333333">      set$thread_off=((size_t)&amp;((struct task_struct *)0)-&gt;thread_group.next)</span></p> 
 <p align="left"><span style="color:#333333">      set$init_t=&amp;init_task</span></p> 
 <p align="left"><span style="color:#333333">      set$next_t=(((char *)($init_t-&gt;tasks).next) - $tasks_off)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      while($next_t != $init_t)</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(struct task_struct *)$next_t</span></p> 
 <p align="left"><span style="color:#333333">               __prinfo$next_t</span></p> 
 <p align="left"><span style="color:#333333">               set$next_th=(((char *)$next_t-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333">               while($next_th != $next_t)</span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(struct task_struct *)$next_th</span></p> 
 <p align="left"><span style="color:#333333">                       __prinfo$next_th </span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(((char *)$next_th-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333">               end</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(char *)($next_t-&gt;tasks.next) - $tasks_off</span></p> 
 <p align="left"><span style="color:#333333">      end</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document btt</span></p> 
 <p align="left"><span style="color:#333333">      dumpall thread stack traces on a kernel compiled with CONFIG_FRAME_POINTER</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define btpid</span></p> 
 <p align="left"><span style="color:#333333">      setvar $pid = $arg0</span></p> 
 <p align="left"><span style="color:#333333">      set$tasks_off=((size_t)&amp;((struct task_struct *)0)-&gt;tasks)</span></p> 
 <p align="left"><span style="color:#333333">      set$thread_off=((size_t)&amp;((struct task_struct *)0)-&gt;thread_group)</span></p> 
 <p align="left"><span style="color:#333333">      set$init_t=&amp;init_task</span></p> 
 <p align="left"><span style="color:#333333">      set$next_t=(((char *)($init_t-&gt;tasks).next) - $tasks_off)</span></p> 
 <p align="left"><span style="color:#333333">      setvar $pid_task = 0</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      while($next_t != $init_t)</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(struct task_struct *)$next_t</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               if($next_t.pid == $pid)</span></p> 
 <p align="left"><span style="color:#333333">                       set$pid_task = $next_t</span></p> 
 <p align="left"><span style="color:#333333">               end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               set$next_th=(((char *)$next_t-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333">               while($next_th != $next_t)</span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(struct task_struct *)$next_th</span></p> 
 <p align="left"><span style="color:#333333">                       if($next_th.pid == $pid)</span></p> 
 <p align="left"><span style="color:#333333">                                set$pid_task = $next_th</span></p> 
 <p align="left"><span style="color:#333333">                       end</span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(((char *)$next_th-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333">               end</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(char *)($next_t-&gt;tasks.next) - $tasks_off</span></p> 
 <p align="left"><span style="color:#333333">      end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      __prinfo$pid_task</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document btpid</span></p> 
 <p align="left"><span style="color:#333333">      backtraceof pid</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define trapinfo</span></p> 
 <p align="left"><span style="color:#333333">      setvar $pid = $arg0</span></p> 
 <p align="left"><span style="color:#333333">      set$tasks_off=((size_t)&amp;((struct task_struct *)0)-&gt;tasks)</span></p> 
 <p align="left"><span style="color:#333333">      set$thread_off=((size_t)&amp;((struct task_struct *)0)-&gt;thread_group.next)</span></p> 
 <p align="left"><span style="color:#333333">      set$init_t=&amp;init_task</span></p> 
 <p align="left"><span style="color:#333333">      set$next_t=(((char *)($init_t-&gt;tasks).next) - $tasks_off)</span></p> 
 <p align="left"><span style="color:#333333">      setvar $pid_task = 0</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      while($next_t != $init_t)</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(struct task_struct *)$next_t</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               if($next_t.pid == $pid)</span></p> 
 <p align="left"><span style="color:#333333">                       set$pid_task = $next_t</span></p> 
 <p align="left"><span style="color:#333333">               end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               set$next_th=(((char *)$next_t-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333">               while($next_th != $next_t)</span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(struct task_struct *)$next_th</span></p> 
 <p align="left"><span style="color:#333333">                       if($next_th.pid == $pid)</span></p> 
 <p align="left"><span style="color:#333333">                                set$pid_task = $next_th</span></p> 
 <p align="left"><span style="color:#333333">                       end</span></p> 
 <p align="left"><span style="color:#333333">                       set$next_th=(((char *)$next_th-&gt;thread_group.next) - $thread_off)</span></p> 
 <p align="left"><span style="color:#333333">               end</span></p> 
 <p align="left"><span style="color:#333333">               set$next_t=(char *)($next_t-&gt;tasks.next) - $tasks_off</span></p> 
 <p align="left"><span style="color:#333333">      end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      printf"Trapno %ld, cr2 0x%lx, error_code %ld\n", $pid_task.thread.trap_no,\</span></p> 
 <p align="left"><span style="color:#333333">                                $pid_task.thread.cr2,$pid_task.thread.error_code</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document trapinfo</span></p> 
 <p align="left"><span style="color:#333333">      Runinfo threads and lookup pid of thread #1</span></p> 
 <p align="left"><span style="color:#333333">      'trapinfo&lt;pid&gt;' will tell you by which trap &amp; possibly</span></p> 
 <p align="left"><span style="color:#333333">      addressthe kernel panicked.</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define dmesg</span></p> 
 <p align="left"><span style="color:#333333">      set$i = 0</span></p> 
 <p align="left"><span style="color:#333333">      set$end_idx = (log_end - 1) &amp; (log_buf_len - 1)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      while($i &lt; logged_chars)</span></p> 
 <p align="left"><span style="color:#333333">               set$idx = (log_end - 1 - logged_chars + $i) &amp; (log_buf_len - 1)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               if($idx + 100 &lt;= $end_idx) || \</span></p> 
 <p align="left"><span style="color:#333333">                  ($end_idx &lt;= $idx &amp;&amp; $idx + 100&lt; log_buf_len)</span></p> 
 <p align="left"><span style="color:#333333">                       printf"%.100s", &amp;log_buf[$idx]</span></p> 
 <p align="left"><span style="color:#333333">                       set$i = $i + 100</span></p> 
 <p align="left"><span style="color:#333333">               else</span></p> 
 <p align="left"><span style="color:#333333">                       printf"%c", log_buf[$idx]</span></p> 
 <p align="left"><span style="color:#333333">                       set$i = $i + 1</span></p> 
 <p align="left"><span style="color:#333333">               end</span></p> 
 <p align="left"><span style="color:#333333">      end</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333">document dmesg</span></p> 
 <p align="left"><span style="color:#333333">      printthe kernel ring buffer</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">宏名：vmap, lsvmaps,lsmod, lsmodsects, lsallmodsects</span></p> 
<p align="left"><span style="color:#333333">说明：没测试，待更新</span></p> 
<p align="left"><span style="color:#333333">来源 <a target="_blank" href="http://jeanmarc.saffroy.free.fr/kdump2gdb/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://jeanmarc.saffroy.free.fr/kdump2gdb/</span></a></span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333"># Copyright Jean-Marc Saffroy&lt;saffroy@gmail.com&gt; 2006</span></p> 
 <p align="left"><span style="color:#333333"># This program is free software,distributed under the terms of the</span></p> 
 <p align="left"><span style="color:#333333"># GNU General Public License version 2.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"># a few useful(?) macros for x86-64 VMMhacks</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"># useful constants</span></p> 
 <p align="left"><span style="color:#333333">set $PAGE_SIZE = (1&lt;&lt;12)</span></p> 
 <p align="left"><span style="color:#333333">set $__PHYSICAL_MASK = (1 &lt;&lt; 46)-1</span></p> 
 <p align="left"><span style="color:#333333">set $PTE_MASK = ~($PAGE_SIZE-1) &amp;$__PHYSICAL_MASK</span></p> 
 <p align="left"><span style="color:#333333">set $__PAGE_OFFSET = 0xffff810000000000</span></p> 
 <p align="left"><span style="color:#333333">set $_PAGE_PSE = 0x80</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define vmap</span></p> 
 <p align="left"><span style="color:#333333">      set$addr = (long)$arg0</span></p> 
 <p align="left"><span style="color:#333333">      #index in each of the 4 levels of page directories</span></p> 
 <p align="left"><span style="color:#333333">      set$pgd = $addr &gt;&gt; 39 &amp; (1&lt;&lt;9)-1</span></p> 
 <p align="left"><span style="color:#333333">      set$pud = $addr &gt;&gt; 30 &amp; (1&lt;&lt;9)-1</span></p> 
 <p align="left"><span style="color:#333333">      set$pmd = $addr &gt;&gt; 21 &amp; (1&lt;&lt;9)-1</span></p> 
 <p align="left"><span style="color:#333333">      set$pte = $addr &gt;&gt; 12 &amp; (1&lt;&lt;9)-1</span></p> 
 <p align="left"><span style="color:#333333">      #offset in page</span></p> 
 <p align="left"><span style="color:#333333">      set$off = $addr &amp; (1&lt;&lt;12)-1</span></p> 
 <p align="left"><span style="color:#333333">      #printf"%03x %03x %03x %03x %03x\n", $pgd, $pud, $pmd, $pte, $off</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      set$pgd_off = (pgd_t *) &amp;init_level4_pgt + $pgd</span></p> 
 <p align="left"><span style="color:#333333">      #printf"pgd_off: %lx pgd: %lx\n", $pgd_off, (long)$pgd_off-&gt;pgd</span></p> 
 <p align="left"><span style="color:#333333">      set$pgd_page = ((long)$pgd_off-&gt;pgd &amp; $PTE_MASK) + $__PAGE_OFFSET</span></p> 
 <p align="left"><span style="color:#333333">      #printf"pgd_page: %lx\n", $pgd_page</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      set$pud_off = ((pud_t *) $pgd_page) + $pud</span></p> 
 <p align="left"><span style="color:#333333">      #printf"pud_off: %lx pud: %lx\n", $pud_off, (long)$pud_off-&gt;pud</span></p> 
 <p align="left"><span style="color:#333333">      set$pud_page = ((long)$pud_off-&gt;pud &amp; $PTE_MASK) + $__PAGE_OFFSET</span></p> 
 <p align="left"><span style="color:#333333">      #printf"pud_page: %lx\n", $pud_page</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      set$pmd_off = ((pmd_t *) $pud_page) + $pmd</span></p> 
 <p align="left"><span style="color:#333333">      #printf"pmd_off: %lx pmd: %lx\n", $pmd_off, (long)$pmd_off-&gt;pmd</span></p> 
 <p align="left"><span style="color:#333333">      set$pmd_page = ((long)$pmd_off-&gt;pmd &amp; $PTE_MASK) + $__PAGE_OFFSET</span></p> 
 <p align="left"><span style="color:#333333">      #printf"pmd_page: %lx\n", $pmd_page</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      if((long)$pmd_off-&gt;pmd &amp; $_PAGE_PSE) != 0</span></p> 
 <p align="left"><span style="color:#333333">               #printf"PSE page! "</span></p> 
 <p align="left"><span style="color:#333333">               set$paddr = $pmd_page + ($addr &amp; (1&lt;&lt;21)-1)</span></p> 
 <p align="left"><span style="color:#333333">      else</span></p> 
 <p align="left"><span style="color:#333333">               set$pte_off = ((pte_t *) $pmd_page) + $pte</span></p> 
 <p align="left"><span style="color:#333333">               #printf"pte_off: %lx pte: %lx\n", $pte_off, (long)$pte_off-&gt;pte</span></p> 
 <p align="left"><span style="color:#333333">               set$pte_page = ((long)$pte_off-&gt;pte &amp; $PTE_MASK) + $__PAGE_OFFSET</span></p> 
 <p align="left"><span style="color:#333333">               #printf"pte_page: %lx\n", $pte_page</span></p> 
 <p align="left"><span style="color:#333333">               set$paddr = $pte_page + $off</span></p> 
 <p align="left"><span style="color:#333333">      end</span></p> 
 <p align="left"><span style="color:#333333">      #printf"remapped physical addr: %lx\n", $paddr</span></p> 
 <p align="left"><span style="color:#333333">      printf"%lx -&gt; %lx\n", $addr, $paddr</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">document vmap</span></p> 
 <p align="left"><span style="color:#333333">Usage: vmap &lt;address&gt;</span></p> 
 <p align="left"><span style="color:#333333">Convert a kernel remapped virtualaddress to an identity-mapped address.</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define lsvmaps</span></p> 
 <p align="left"><span style="color:#333333">      set$map = vmlist</span></p> 
 <p align="left"><span style="color:#333333">      set$gcount = 0</span></p> 
 <p align="left"><span style="color:#333333">      while$map != 0</span></p> 
 <p align="left"><span style="color:#333333">               if$map-&gt;pages != 0</span></p> 
 <p align="left"><span style="color:#333333">                       set$vaddr = (long)$map-&gt;addr</span></p> 
 <p align="left"><span style="color:#333333">                       set$count = (long)$map-&gt;size / $PAGE_SIZE</span></p> 
 <p align="left"><span style="color:#333333">                       set$gcount = $gcount + $count -1</span></p> 
 <p align="left"><span style="color:#333333">                       while$count &gt; 1</span></p> 
 <p align="left"><span style="color:#333333">                                vmap$vaddr</span></p> 
 <p align="left"><span style="color:#333333">                                set$vaddr = $vaddr + $PAGE_SIZE</span></p> 
 <p align="left"><span style="color:#333333">                                set$count = $count - 1</span></p> 
 <p align="left"><span style="color:#333333">                       end</span></p> 
 <p align="left"><span style="color:#333333">               end</span></p> 
 <p align="left"><span style="color:#333333">               set$map = $map-&gt;next</span></p> 
 <p align="left"><span style="color:#333333">      end</span></p> 
 <p align="left"><span style="color:#333333">      printf"page count: %d\n", $gcount</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">document lsvmaps</span></p> 
 <p align="left"><span style="color:#333333">List all kernel remapped pages (vmallocregions) and corresponding identity-mapped pages.</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define lsmod</span></p> 
 <p align="left"><span style="color:#333333">   set $mod = modules.next</span></p> 
 <p align="left"><span style="color:#333333">   printf "struct module       size   name\n"</span></p> 
 <p align="left"><span style="color:#333333">   while $mod != &amp;modules</span></p> 
 <p align="left"><span style="color:#333333">       set $m = (struct module *)((char*)$mod-(char*)(&amp;((structmodule*)0)-&gt;list))</span></p> 
 <p align="left"><span style="color:#333333">     printf "0x%lx % 8d%s\n", $m, $m-&gt;core_size, $m-&gt;name</span></p> 
 <p align="left"><span style="color:#333333">      set$mod = $mod-&gt;next</span></p> 
 <p align="left"><span style="color:#333333">   end</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">document lsmod</span></p> 
 <p align="left"><span style="color:#333333">List loaded kernel modules.</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define lsmodsects</span></p> 
 <p align="left"><span style="color:#333333">      set$mod = (struct module *)$arg0</span></p> 
 <p align="left"><span style="color:#333333">      printf"add-symbol-file %s.ko 0x%lx ", $mod-&gt;name,$mod-&gt;sect_attrs-&gt;attrs[0].address</span></p> 
 <p align="left"><span style="color:#333333">      set$i = 1</span></p> 
 <p align="left"><span style="color:#333333">      while$mod-&gt;sect_attrs-&gt;grp-&gt;attrs[$i] != 0</span></p> 
 <p align="left"><span style="color:#333333">               printf"-s %s ", (char*)$mod-&gt;sect_attrs-&gt;attrs[$i].name</span></p> 
 <p align="left"><span style="color:#333333">               printf"0x%lx ", $mod-&gt;sect_attrs-&gt;attrs[$i].address</span></p> 
 <p align="left"><span style="color:#333333">               set$i = $i + 1</span></p> 
 <p align="left"><span style="color:#333333">      end</span></p> 
 <p align="left"><span style="color:#333333">      printf"\n"</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">document lsmodsects</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Usage: lsmodsects &lt;address of structmodule&gt;</span></p> 
 <p align="left"><span style="color:#333333">Prints "add-symbol-file..."command to load sections of the given module.</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">define lsallmodsects</span></p> 
 <p align="left"><span style="color:#333333">   set $mdl = modules.next</span></p> 
 <p align="left"><span style="color:#333333">   while $mdl != &amp;modules</span></p> 
 <p align="left"><span style="color:#333333">       set $m = (struct module *)((char*)$mdl-(char*)(&amp;((structmodule*)0)-&gt;list))</span></p> 
 <p align="left"><span style="color:#333333">      lsmodsects$m</span></p> 
 <p align="left"><span style="color:#333333">      set$mdl = $mdl-&gt;next</span></p> 
 <p align="left"><span style="color:#333333">   end</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">document lsallmodsects</span></p> 
 <p align="left"><span style="color:#333333">Calls lsmodsects on all modules.</span></p> 
 <p align="left"><span style="color:#333333">end</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">汇编基础--X86</span>篇</strong></p> 
<p align="left"><span style="color:#333333">注意：某些内容不具备普遍性。比如给出的反汇编代码，在不同的优化等级下是不同的。但是在熟悉了典型的函数调用链反汇编代码，对于有变化的其他形式也就不难理解了。</span></p> 
<p align="left"><strong><span style="color:#333333">用户手册</span></strong></p> 
<p align="left"><span style="color:#333333">Intel® 64 and IA-32Architectures Software Developer</span><span style="color:#333333">’s Manuals</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.intel.com/products/processor/manuals/index.htm" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.intel.com/products/processor/manuals/index.htm</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">AT&amp;T</span><span style="color:#333333">汇编格式</span></strong></p> 
<p align="left"><span style="color:#333333">参考</span></p> 
<p align="left"><span style="color:#333333">“AT&amp;T</span>汇编语言与GCC内嵌汇编简介” <a target="_blank" href="http://blog.chinaunix.net/u2/73528/showart_1110874.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u2/73528/showart_1110874.html</span></a></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">杂类文章]</span></p> 
<p align="left"><span style="color:#333333">“Linux Assembly andDisassembly an Introduction</span>” <a target="_blank" href="http://www.milw0rm.com/papers/47" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.milw0rm.com/papers/47</span></a></p> 
<p align="left"><strong><span style="color:#333333">内联汇编</span></strong></p> 
<p align="left"><span style="color:#333333">GCC-Inline-Assembly-HOWTO <a target="_blank" href="http://www.ibiblio.org/gferg/ldp/GCC-Inline-Assembly-HOWTO.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibiblio.org/gferg/ldp/GCC-Inline-Assembly-HOWTO.html</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">汇编与C</span>函数的相互调用</strong></p> 
<p align="left"><strong><span style="color:#333333">调用链形成和参数传递</span></strong></p> 
<p align="left"><span style="color:#333333">参考文章 [</span>多如牛毛]</p> 
<p align="left"><span style="color:#333333">“Guide: FunctionCalling Conventions</span>” <a target="_blank" href="http://www.delorie.com/djgpp/doc/ug/asm/calling.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.delorie.com/djgpp/doc/ug/asm/calling.html</span></a></p> 
<p align="left"><span style="color:#333333">“Intel x86Function-call Conventions - Assembly View</span>” <a target="_blank" href="http://www.unixwiz.net/techtips/win32-callconv-asm.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.unixwiz.net/techtips/win32-callconv-asm.html</span></a></p> 
<p align="left"><span style="color:#333333">“C Function CallConventions and the Stack</span>” <a target="_blank" href="http://www.cs.umbc.edu/~chang/cs313.s02/stack.shtml" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.cs.umbc.edu/~chang/cs313.s02/stack.shtml</span></a></p> 
<p align="left"><span style="color:#333333">“The C CallingConvention and the 8086: Using the Stack Frame</span>” <a target="_blank" href="http://www.et.byu.edu/groups/ece425web/stable/labs/StackFrame.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.et.byu.edu/groups/ece425web/stable/labs/StackFrame.html</span></a></p> 
<p align="left"><span style="color:#333333">“C Function CallingConvention</span>” <a target="_blank" href="http://adamw-dev.blogspot.com/2007/05/c-function-calling-convention.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://adamw-dev.blogspot.com/2007/05/c-function-calling-convention.html</span></a></p> 
<p align="left"><span style="color:#333333">“C</span>函数调用在GNU汇编中的实现” <a target="_blank" href="http://www.unixresources.net/linux/clf/cpu/archive/00/00/59/75/597564.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.unixresources.net/linux/clf/cpu/archive/00/00/59/75/597564.html</span></a></p> 
<p align="left"><span style="color:#333333">“函数调用的几个概念：_stdcall,_cdecl....</span>” <a target="_blank" href="http://blog.chinaunix.net/u2/67530/showart_601750.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u2/67530/showart_601750.html</span></a></p> 
<p align="left"><span style="color:#333333">“Callingconventions(</span>调用规则)” <a target="_blank" href="http://www.bobd.cn/itschool/Program/delphi/200612/itschool_12084.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.bobd.cn/itschool/Program/delphi/200612/itschool_12084.html</span></a></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">扩展，简要说明原理。并用实例解析]</span></p> 
<p align="left"><span style="color:#333333">x86</span><span style="color:#333333">终极参考</span></p> 
<p align="left"><span style="color:#333333">CHAPTER 6 PROCEDURECALLS, INTERRUPTS, AND EXCEPTIONS of</span></p> 
<p align="left"><span style="color:#333333">IA-32 Intel_Architecture Software Developer</span><span style="color:#333333">’s Manual Volume 1_ BasicArchitecture.pdf <a target="_blank" href="http://download.intel.com/design/processor/manuals/253665.pdf" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://download.intel.com/design/processor/manuals/253665.pdf</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">寄存器的角色与保护</span></strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">寄存器的角色</span></p> 
<p align="left"><span style="color:#333333">1. %esp: </span><span style="color:#333333">栈指针</span></p> 
<p align="left"><span style="color:#333333">指向栈的顶端，也就是指向栈的最后一个正在使用的元素。%esp</span>的值隐式地受到几个机器指令的影响，比如push,pop,call,ret等。</p> 
<p align="left"><span style="color:#333333">2. %ebp: </span><span style="color:#333333">基址指针</span></p> 
<p align="left"><span style="color:#333333">指向当前栈的基地址，有时也称为“帧指针”。与%esp</span>不同的是，它必须显式地进行操作才能改变值。</p> 
<p align="left"><span style="color:#333333">3. %eip: </span><span style="color:#333333">指令指针</span></p> 
<p align="left"><span style="color:#333333">保存着下一个被执行机器指令的地址。当CPU</span>执行call指令时，%eip的值自动被保存到栈中。还有，任何一个“jump”跳转指令都会直接地改变%eip</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">两条规则</span></p> 
<p align="left"><span style="color:#333333">1. gcc</span><span style="color:#333333">要求在函数调用的前后，寄存器%ebx</span>，%esi，%edi，%ebp，%esp,%ds, %es，%ss的值保持不变。所以被调用函数如果需要修改这些寄存器的值，被调用函数必须负责对它们进行保护。［后三个??］</p> 
<p align="left"><span style="color:#333333">2. gcc</span><span style="color:#333333">规定在函数调用的前后，寄存器%eax,%edx,%ecx</span>的值可以改变。所以调用函数如果需要防止子函数破坏这三个寄存器的值，调用者必须在函数调用前自己负责保护它们。</p> 
<p align="left"><span style="color:#333333">我们注意到，是保护，不一定是保存。如果确认没用到某寄存器，那么该寄存器就不需要一定要有一个先保存到栈而后再恢复原值的过程。</span></p> 
<p align="left"><span style="color:#333333">这两条规则实际是定义了对系统资源使用的权限和义务。</span></p> 
<p align="left"><span style="color:#333333">第一条规则，是银行和借贷者的关系。有人向银行借了几千万，结果赌博全输光了。还钱的期限到了，银行的行长对借贷者说“没事，你回家吧。几千万而已，我拿我工资给你垫上”。我想这样的事决不会发生，行长一个电话110</span>过去，借贷者一天后就把钱还清了。所以，这里，调用函数是银行行长，子函数是借贷者。</p> 
<p align="left"><span style="color:#333333">第二条规则，则是老爸和儿子的关系了。儿子对老爸说“老爸，解我100</span>去买球鞋，我明天还你”。结果，第二天，老爸没钱吃饭了，问儿子“还钱”。儿 子说“昨晚逛街碰到一个美女，请了一顿，把钱化光了”。老爸没法子，总不能把儿子绳以正法吧。怪只能怪自己事前没防这招咯。所以，这里，调用函数是老爸，子函数是儿子你。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">返回值</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333"> 1. Integers (of any size up to 32 bits) and pointers are returned in the%eax register.</span></p> 
 <p align="left"><span style="color:#333333">  2.Floating point values are returned in the 387 top-of-stack register, st(0).</span></p> 
 <p align="left"><span style="color:#333333"> 3. Return values of type long long int are returned in %edx:%eax (themost significant word in %edx and the least significant in %eax).</span></p> 
 <p align="left"><span style="color:#333333"> 4. Returning a structure is complicated and rarely useful; try to avoidit. (Note that this is different from returning a pointer to a structure.) </span></p> 
 <p align="left"><span style="color:#333333"> 5. If your function returns void (e.g. no value), the contents of theseregisters are not used.</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">调用链的形成</span></strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">应用层实例解析</span></p> 
<p align="left"><span style="color:#333333">我们回头看看“寄存器的角色”这一小节，很快就能明白调用链的形成的本质。</span></p> 
<p align="left"><span style="color:#333333">调用链包含两方面的内容</span></p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">返回地址的保存与恢复</span></p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">旧栈帧的保存与恢复</span></p> 
<p align="left"><span style="color:#333333">因为在普通的调用形式中(call</span>调用)，返回地址的保存与恢复是由处理器机制本身保证的，不需人工维护。调用指令call的执行自动将call指令之下 的指令地址压入栈中，被调用函数返回时，ret指令的执行会重新将返回地址从栈弹出传送到pc中。要求下面分析旧栈帧的保存与恢复。</p> 
<p align="left"><span style="color:#333333">旧栈帧的保存与恢复，无非就是要解决两大问题：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">建立新栈帧 这一步很简单，栈帧无非有两个头，底端和顶端。%esp</span>指向栈的顶端，而%esp是不需要手工维护的，随着push,pop等指令，它自己就在改变自己。 那么又怎么建立栈帧的底端呢？我们知道，栈底(也就是基址)是由%ebp指定的，在一个栈帧的整个生命周期里，%ebp的值都不变，也就是说，赋个合适的 值给它就完事。怎么赋值就是问题所在了。我们知道，%esp指向栈中最后一个被使用的元素。所以，当我们正在使用(我们认为的)第一个元素时，把%esp 的值赋给%ebp,%ebp不就是指向栈的基址了吗？</p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">保护旧栈帧的信息 同样的问题，保护旧栈帧的信息，就是保存旧栈帧指向底端和顶端的指针值，也就是旧%ebp,%esbp</span>的值。当函数调用指令刚执行完，马上就要保护作案现 场了。首先，push%ebp,这句就把旧栈帧的基地址保存在栈的顶端。此时，%esp指向的内存地址中，就放着旧栈帧的基地址的值。但是还不够啊，%esp是个不可靠的东 西，它经常在变化，必须把这个地址放到一个不会隐式变化的寄存器中。于是选择了%ebp。mov %esp %ebp.这样，%ebp指向的内存地址中，就放着旧栈帧的基地址的值。这就解放了%esp，可以用%esp来动态指向新栈帧的顶端了。按照定 义，%ebp所指向的地址是新栈帧的底端，也就是新栈帧的第一个元素，也就是说新栈帧第一个元素的值是旧栈帧基址。</p> 
<p align="left"><span style="color:#333333">但是注意，%ebp</span>指向的地址再加4bytes的地址上，存放的是被调用函数的返回地址。在执行call指令时，call指令后面的那个指令的地址（也就是被调用函数的返回地址）被自动隐式地放到了栈中。</p> 
<p align="left"><span style="color:#333333">当子函数返回时，再按照上面文字进行逆操作，就能恢复旧栈帧的信息。</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void func()</span></p> 
 <p align="left"><span style="color:#333333">{}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void funb()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       func();</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void funa()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       funb();</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       funa();</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333">-------</span></p> 
 <p align="left"><span style="color:#333333">08048344 &lt;func&gt;:</span></p> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void func()</span></p> 
 <p align="left"><span style="color:#333333">{}</span></p> 
 <p align="left"><span style="color:#333333"> 8048344:      55                      push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048345:      89 e5                   mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048347:      5d                      pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048348:      c3                      ret</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">08048349 &lt;funb&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void funb()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333"> 8048349:      55                      push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804834a:      89 e5                   mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333">       func();</span></p> 
 <p align="left"><span style="color:#333333"> 804834c:      e8 f3 ff ff ff          call   8048344 &lt;func&gt;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> 8048351:      5d                      pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048352:      c3                      ret</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">08048353 &lt;funa&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void funa()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333"> 8048353:      55                      push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048354:      89 e5                   mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333">       funb();</span></p> 
 <p align="left"><span style="color:#333333"> 8048356:      e8 ee ff ff ff          call   8048349 &lt;funb&gt;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> 804835b:      5d                      pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804835c:      c3                      ret</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">0804835d &lt;main&gt;:</span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333"> 804835d:      8d 4c 24 04             lea    0x4(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333"> 8048361:      83 e4 f0                and    $0xfffffff0,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 8048364:      ff 71 fc                pushl  -0x4(%ecx)</span></p> 
 <p align="left"><span style="color:#333333"> 8048367:      55                      push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048368:      89 e5                   mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804836a:      51                      push   %ecx</span></p> 
 <p align="left"><span style="color:#333333">       funa();</span></p> 
 <p align="left"><span style="color:#333333"> 804836b:      e8 e3 ff ff ff          call   8048353 &lt;funa&gt;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> 8048370:      59                      pop    %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 8048371:      5d                      pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048372:      8d 61 fc                lea    -0x4(%ecx),%esp</span></p> 
 <p align="left"><span style="color:#333333"> 8048375:      c3                      ret</span></p> 
 <p align="left"><span style="color:#333333"> 8048376:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> 8048377:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> 8048378:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> 8048379:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> 804837a:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> 804837b:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> 804837c:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> 804837d:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> 804837e:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> 804837f:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">func</span><span style="color:#333333">被调用后内存如下</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">         |              |                        </span></p> 
 <p align="left"><span style="color:#333333">     |   |              |                       | hight</span></p> 
 <p align="left"><span style="color:#333333">     |   |              |                       |</span></p> 
 <p align="left"><span style="color:#333333">     |   +--------------\                       |</span></p> 
 <p align="left"><span style="color:#333333">     +---+ main's %ebp  |\                      |</span></p> 
 <p align="left"><span style="color:#333333">     +-&gt; +--------------+ --funa's frame        |</span></p> 
 <p align="left"><span style="color:#333333">     |   | ret to funa  | /                     |</span></p> 
 <p align="left"><span style="color:#333333">     |   +--------------+X                      |</span></p> 
 <p align="left"><span style="color:#333333">     +---+ funa's %ebp  | \                     |</span></p> 
 <p align="left"><span style="color:#333333">     +--&gt;+--------------+ ---funb's frame       |</span></p> 
 <p align="left"><span style="color:#333333">     |   | ret to funb  | /                     |</span></p> 
 <p align="left"><span style="color:#333333">     |   +--------------+                       |</span></p> 
 <p align="left"><span style="color:#333333">     +---+ funb's %ebp  |&lt;---func'sframe       | low</span></p> 
 <p align="left"><span style="color:#333333"> %esp--&gt; +--------------+&lt;---- %ebp             v </span></p> 
 <p align="left"><span style="color:#333333">         |              |                         </span></p> 
 <p align="left"><span style="color:#333333">         |              |                         </span></p> 
 <p align="left"><span style="color:#333333">         |              |  </span></p> 
 <p align="left"><span style="color:#333333">         |              | </span></p> 
 <p align="left"><span style="color:#333333">         |              | </span></p> 
 <p align="left"><span style="color:#333333">                          </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">内核层实例解析</span></p> 
<p align="left"><strong><span style="color:#333333">栈帧结构与参数传递</span></strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">栈元素引用的就近原则</span></p> 
<p align="left"><span style="color:#333333">为了说明就近原则，我们先看看典型和全面的栈帧是怎样的。函数caller</span>调用子函数callee所形成的栈帧。</p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">从被调用的子函数callee</span>来看，获取caller的传递的实参，以及建立自身本地变量时，因为内存地址都靠近栈帧的基址,所以这两种引用都是利用%ebp加上偏移量的形式。</p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">相反，主函数在调用子函数前，在为子函数准备实参时，因为实参位于栈帧末端，所以对实参的引用都是利用%esp</span>加上偏移量的形式(没画出来)</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333"> caller's frame pointer                           </span></p> 
 <p align="left"><span style="color:#333333">       |                                        </span></p> 
 <p align="left"><span style="color:#333333">       |     |                   |               </span></p> 
 <p align="left"><span style="color:#333333">       |     |                   |               </span></p> 
 <p align="left"><span style="color:#333333">       |     |                   |               </span></p> 
 <p align="left"><span style="color:#333333">       |     +-------------------+               </span></p> 
 <p align="left"><span style="color:#333333">       |     | caller saved      |               </span></p> 
 <p align="left"><span style="color:#333333">       |     |   registers       |               </span></p> 
 <p align="left"><span style="color:#333333">       |     | %eax,%ecx,%edx    |               </span></p> 
 <p align="left"><span style="color:#333333">       |     |  (as needed)      |               </span></p> 
 <p align="left"><span style="color:#333333">       |     +-------------------+               </span></p> 
 <p align="left"><span style="color:#333333">       |     | argument  #3     | [%ebp+16]     </span></p> 
 <p align="left"><span style="color:#333333">       |     +-------------------+               </span></p> 
 <p align="left"><span style="color:#333333">       |     | argument  #2     | [%ebp+12]     </span></p> 
 <p align="left"><span style="color:#333333">       |     +-------------------+               </span></p> 
 <p align="left"><span style="color:#333333">       |     | argument #1      | [%ebp+8]      </span></p> 
 <p align="left"><span style="color:#333333">       |     +-------------------+               </span></p> 
 <p align="left"><span style="color:#333333">       |     | return address    |               </span></p> 
 <p align="left"><span style="color:#333333">       |     +-------------------+      -----   </span></p> 
 <p align="left"><span style="color:#333333">       +-----+ caller's %ebp    |&lt;---%ebp   \   </span></p> 
 <p align="left"><span style="color:#333333">              +-------------------+            \  </span></p> 
 <p align="left"><span style="color:#333333">              | local var #1      | [%ebp-4]    \  </span></p> 
 <p align="left"><span style="color:#333333">              +-------------------+             | </span></p> 
 <p align="left"><span style="color:#333333">              | local var #2      | [%ebp-8]    | </span></p> 
 <p align="left"><span style="color:#333333">              +-------------------+             | </span></p> 
 <p align="left"><span style="color:#333333">              | temporary        |             | </span></p> 
 <p align="left"><span style="color:#333333">              |   storage         |             | </span></p> 
 <p align="left"><span style="color:#333333">              +-------------------+               </span></p> 
 <p align="left"><span style="color:#333333">              | callee saved     |           callee stack frame</span></p> 
 <p align="left"><span style="color:#333333">              |    registers      |             | </span></p> 
 <p align="left"><span style="color:#333333">              | %ebx,%esi,%edi    |             | </span></p> 
 <p align="left"><span style="color:#333333">              |   (as needed)     |             | </span></p> 
 <p align="left"><span style="color:#333333">              +-------------------+             | </span></p> 
 <p align="left"><span style="color:#333333">              |                   |             | </span></p> 
 <p align="left"><span style="color:#333333">              |                   |             | </span></p> 
 <p align="left"><span style="color:#333333">              |                   |            / </span></p> 
 <p align="left"><span style="color:#333333">              |                   |&lt;----%esp  /   </span></p> 
 <p align="left"><span style="color:#333333">              |                                          </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">caller:</span><span style="color:#333333">调用者</span><span style="color:#333333"> callee:</span><span style="color:#333333">被调用者</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">完整的调用过程</span></strong></p> 
<p align="left"><span style="color:#333333">函数caller</span>调用子函数callee，这是应用层的普通函数调用过程。如果是远调用，跨态调用要考虑的东西更多。但这个例子已经充分展示了调用过程的繁复部分。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">函数调用前调用者的动作</span></p> 
<p align="left"><span style="color:#333333">1.%eax,%edx,%ecx</span><span style="color:#333333">入栈（可选）</span></p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">子函数的参数入栈</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">函数调用 call callee</span></p> 
<p align="left"><span style="color:#333333">call</span><span style="color:#333333">机器指令，原子性自动地完成了两种任务.</span></p> 
<p align="left"><span style="color:#333333">1.%eip</span><span style="color:#333333">入栈,</span>保存了callee函数的返回地址</p> 
<p align="left"><span style="color:#333333">2.callee</span><span style="color:#333333">的函数地址传递到%eip.</span></p> 
<p align="left"><span style="color:#333333">所以下一指令就从callee</span>函数的第一指令开始运行。控制权转移给callee</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">函数调用后被调用者的动作</span></p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">保存caller</span>栈帧基址 push %ebp</p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">建立callee</span>栈帧基址 mov %esp，%ebp</p> 
<p align="left"><span style="color:#333333">3.</span><span style="color:#333333">分配本地变量和临时存储的空间 sub $XXX, %esp</span></p> 
<p align="left"><span style="color:#333333">4.</span><span style="color:#333333">本地变量赋值</span></p> 
<p align="left"><span style="color:#333333">5.%ebx,%esi,%edi</span><span style="color:#333333">入栈(</span>可选)</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">调用返回前被调用者的动作</span></p> 
<p align="left"><span style="color:#333333">1.%ebx,%esi,%edi</span><span style="color:#333333">还原(</span>出栈,可选)</p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">释放本地变量和临时存储的栈空间mov %ebp</span>，%esp</p> 
<p align="left"><span style="color:#333333">3.</span><span style="color:#333333">还原caller</span>栈帧的基址 pop %ebp</p> 
<p align="left"><span style="color:#333333">或者2.3.</span>步用一条元语指令完成 leave</p> 
<p align="left"><span style="color:#333333">4.</span><span style="color:#333333">调用返回 ret</span></p> 
<p align="left"><span style="color:#333333">该指令把存放于栈的返回地址取出(</span>出栈)，存放到%eip中。下一指令就从callcallee指令的下一指令开始运行。控制权返回给caller</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">调用返回后调用者的动作</span></p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">释放存放callee</span>参数的栈空间 add $XXX, %esp</p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">转移%eax</span>的值（子函数的返回值，可选）</p> 
<p align="left"><span style="color:#333333">3.</span><span style="color:#333333">还原%eax,%edx,%ecx</span>（出栈，可选）</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">应用层实例解析</span></p> 
<p align="left"><span style="color:#333333">应用层参数的传入: </span>用户层参数的传递是利用栈来完成的。函数右边的参数先入栈，位于栈的高地址。反之，函数左边的参数后入栈，位于栈的低地址。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">例子请看</span><span style="color:#333333"> “C</span><span style="color:#333333">难点的汇编解释</span><span style="color:#333333">”</span></p> 
</div> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">内核层实例解析</span></p> 
<p align="left"><span style="color:#333333">内核层参数的传入： 混合使用寄存器和栈来传递参数。当参数个数不多于3</span>个时，参数从左到右依次传递到%eax, %edx, %ecx.当参数个数多于3时，从第4个起的其余参数通过栈传递。同样，函数右边的参数先入栈，位于栈的高地址。反之，函数左边的参数后入栈，位于栈的低地址。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">系统调用实例解析</span></p> 
<p align="left"><span style="color:#333333">系统调用的参数传递：[</span>以后再看]</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">C</span><span style="color:#333333">库函数</span></p> 
 <p align="left"><span style="color:#333333">      ssize_t read(int fd, void *buf, size_t count);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">000b6a30 &lt;__read&gt;:</span></p> 
 <p align="left"><span style="color:#333333">   b6a30:      65 83 3d 0c 00 00 00    cmpl   $0x0,%gs:0xc</span></p> 
 <p align="left"><span style="color:#333333">  b6a37:       00</span></p> 
 <p align="left"><span style="color:#333333">  b6a38:       75 1d                   jne    b6a57 &lt;__read+0x27&gt;</span></p> 
 <p align="left"><span style="color:#333333">  b6a3a:       53                      push   %ebx</span></p> 
 <p align="left"><span style="color:#333333">  b6a3b:       8b 54 24 10             mov    0x10(%esp),%edx      //count</span></p> 
 <p align="left"><span style="color:#333333">  b6a3f:       8b 4c 24 0c             mov    0xc(%esp),%ecx       //buf</span></p> 
 <p align="left"><span style="color:#333333">  b6a43:       8b 5c 24 08             mov    0x8(%esp),%ebx       //fd</span></p> 
 <p align="left"><span style="color:#333333">  b6a47:       b8 03 00 00 00          mov   $0x3,%eax            //</span><span style="color:#333333">系统调用号</span></p> 
 <p align="left"><span style="color:#333333">  b6a4c:       cd 80                   int    $0x80</span></p> 
 <p align="left"><span style="color:#333333">  b6a4e:       5b                      pop    %ebx</span></p> 
 <p align="left"><span style="color:#333333">  b6a4f:       3d 01 f0 ff ff          cmp   $0xfffff001,%eax</span></p> 
 <p align="left"><span style="color:#333333">  b6a54:       73 2d                   jae    b6a83 &lt;__read+0x53&gt;</span></p> 
 <p align="left"><span style="color:#333333">  b6a56:       c3                      ret</span></p> 
 <p align="left"><span style="color:#333333">  b6a57:       e8 14 ae 01 00          call  d1870 &lt;pthread_exit+0x110&gt;</span></p> 
 <p align="left"><span style="color:#333333">  b6a5c:       50                      push   %eax</span></p> 
 <p align="left"><span style="color:#333333">  b6a5d:       53                      push   %ebx</span></p> 
 <p align="left"><span style="color:#333333">  b6a5e:       8b 54 24 14             mov    0x14(%esp),%edx</span></p> 
 <p align="left"><span style="color:#333333">  b6a62:       8b 4c 24 10             mov    0x10(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333">  b6a66:       8b 5c 24 0c             mov    0xc(%esp),%ebx</span></p> 
 <p align="left"><span style="color:#333333">  b6a6a:       b8 03 00 00 00          mov   $0x3,%eax</span></p> 
 <p align="left"><span style="color:#333333">  b6a6f:       cd 80                   int    $0x80</span></p> 
 <p align="left"><span style="color:#333333">  b6a71:       5b                      pop    %ebx</span></p> 
 <p align="left"><span style="color:#333333">  b6a72:       87 04 24                xchg   %eax,(%esp)</span></p> 
 <p align="left"><span style="color:#333333">  b6a75:       e8 c6 ad 01 00          call  d1840 &lt;pthread_exit+0xe0&gt;</span></p> 
 <p align="left"><span style="color:#333333">  b6a7a:       58                      pop    %eax</span></p> 
 <p align="left"><span style="color:#333333">  b6a7b:       3d 01 f0 ff ff          cmp    $0xfffff001,%eax</span></p> 
 <p align="left"><span style="color:#333333">  b6a80:       73 01                   jae    b6a83 &lt;__read+0x53&gt;</span></p> 
 <p align="left"><span style="color:#333333">  b6a82:       c3                      ret</span></p> 
 <p align="left"><span style="color:#333333">  b6a83:       e8 8e 5a 04 00          call  fc516 &lt;__frame_state_for+0xb96&gt;</span></p> 
 <p align="left"><span style="color:#333333">  b6a88:       81 c1 6c e5 0700       add    $0x7e56c,%ecx</span></p> 
 <p align="left"><span style="color:#333333">  b6a8e:       8b 89 e0 ff ffff       mov    -0x20(%ecx),%ecx</span></p> 
 <p align="left"><span style="color:#333333">  b6a94:       31 d2                   xor    %edx,%edx</span></p> 
 <p align="left"><span style="color:#333333">  b6a96:       29 c2                   sub    %eax,%edx</span></p> 
 <p align="left"><span style="color:#333333">  b6a98:       65 03 0d 00 00 0000    add    %gs:0x0,%ecx</span></p> 
 <p align="left"><span style="color:#333333">  b6a9f:       89 11                   mov    %edx,(%ecx)</span></p> 
 <p align="left"><span style="color:#333333">  b6aa1:       83 c8 ff                or     $0xffffffff,%eax</span></p> 
 <p align="left"><span style="color:#333333">  b6aa4:       eb dc                   jmp    b6a82 &lt;__read+0x52&gt;</span></p> 
 <p align="left"><span style="color:#333333">  b6aa6:       90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">调用号</span><span style="color:#333333">#define __NR_read            3</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(gdb) disass sys_read</span></p> 
 <p align="left"><span style="color:#333333">Dump of assembler code for functionsys_read:</span></p> 
 <p align="left"><span style="color:#333333">0xc017585a &lt;sys_read+0&gt;:        push  %ebp</span></p> 
 <p align="left"><span style="color:#333333">0xc017585b &lt;sys_read+1&gt;:        mov   %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333">0xc017585d &lt;sys_read+3&gt;:        push  %esi</span></p> 
 <p align="left"><span style="color:#333333">0xc017585e &lt;sys_read+4&gt;:        mov   $0xfffffff7,%esi</span></p> 
 <p align="left"><span style="color:#333333">0xc0175863 &lt;sys_read+9&gt;:        push  %ebx</span></p> 
 <p align="left"><span style="color:#333333">0xc0175864 &lt;sys_read+10&gt;:       sub   $0xc,%esp</span></p> 
 <p align="left"><span style="color:#333333">0xc0175867 &lt;sys_read+13&gt;:       mov   0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc017586a &lt;sys_read+16&gt;:       lea   -0xc(%ebp),%edx</span></p> 
 <p align="left"><span style="color:#333333">0xc017586d &lt;sys_read+19&gt;:       call  0xc0175f65 &lt;fget_light&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc0175872 &lt;sys_read+24&gt;:       test  %eax,%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc0175874 &lt;sys_read+26&gt;:       mov   %eax,%ebx</span></p> 
 <p align="left"><span style="color:#333333">0xc0175876 &lt;sys_read+28&gt;:       je    0xc01758b1 &lt;sys_read+87&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc0175878 &lt;sys_read+30&gt;:       mov   0x24(%ebx),%edx</span></p> 
 <p align="left"><span style="color:#333333">0xc017587b &lt;sys_read+33&gt;:       mov   0x20(%eax),%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc017587e &lt;sys_read+36&gt;:       mov   0x10(%ebp),%ecx</span></p> 
 <p align="left"><span style="color:#333333">0xc0175881 &lt;sys_read+39&gt;:       mov   %edx,-0x10(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">0xc0175884 &lt;sys_read+42&gt;:       mov   0xc(%ebp),%edx</span></p> 
 <p align="left"><span style="color:#333333">0xc0175887 &lt;sys_read+45&gt;:       mov   %eax,-0x14(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">0xc017588a &lt;sys_read+48&gt;:       lea   -0x14(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc017588d &lt;sys_read+51&gt;:       push  %eax</span></p> 
 <p align="left"><span style="color:#333333">0xc017588e &lt;sys_read+52&gt;:       mov   %ebx,%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc0175890 &lt;sys_read+54&gt;:       call  0xc01753c1 &lt;vfs_read&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc0175895 &lt;sys_read+59&gt;:       mov   -0x10(%ebp),%edx</span></p> 
 <p align="left"><span style="color:#333333">0xc0175898 &lt;sys_read+62&gt;:       mov   %eax,%esi</span></p> 
 <p align="left"><span style="color:#333333">0xc017589a &lt;sys_read+64&gt;:       mov   -0x14(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc017589d &lt;sys_read+67&gt;:       mov   %edx,0x24(%ebx)</span></p> 
 <p align="left"><span style="color:#333333">0xc01758a0 &lt;sys_read+70&gt;:       mov   %eax,0x20(%ebx)</span></p> 
 <p align="left"><span style="color:#333333">0xc01758a3 &lt;sys_read+73&gt;:       cmpl  $0x0,-0xc(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">0xc01758a7 &lt;sys_read+77&gt;:       pop   %eax</span></p> 
 <p align="left"><span style="color:#333333">0xc01758a8 &lt;sys_read+78&gt;:       je    0xc01758b1 &lt;sys_read+87&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc01758aa &lt;sys_read+80&gt;:       mov   %ebx,%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc01758ac &lt;sys_read+82&gt;:       call  0xc0175eae &lt;fput&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc01758b1 &lt;sys_read+87&gt;:       lea   -0x8(%ebp),%esp</span></p> 
 <p align="left"><span style="color:#333333">0xc01758b4 &lt;sys_read+90&gt;:       mov   %esi,%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc01758b6 &lt;sys_read+92&gt;:       pop   %ebx</span></p> 
 <p align="left"><span style="color:#333333">0xc01758b7 &lt;sys_read+93&gt;:       pop   %esi</span></p> 
 <p align="left"><span style="color:#333333">0xc01758b8 &lt;sys_read+94&gt;:       pop   %ebp</span></p> 
 <p align="left"><span style="color:#333333">0xc01758b9 &lt;sys_read+95&gt;:       ret   </span></p> 
 <p align="left"><span style="color:#333333">End of assembler dump.</span></p> 
 <p align="left"><span style="color:#333333">(gdb) list fget_light</span></p> 
 <p align="left"><span style="color:#333333">313   * holds a refcnt to that file. That check has to be done at fget() only</span></p> 
 <p align="left"><span style="color:#333333">314   * and a flag is returned to be passed to the corresponding fput_light().</span></p> 
 <p align="left"><span style="color:#333333">315   * There must not be a cloning between an fget_light/fput_light pair.</span></p> 
 <p align="left"><span style="color:#333333">316   */</span></p> 
 <p align="left"><span style="color:#333333">317   structfile *fget_light(unsigned int fd, int *fput_needed)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">来自</span><span style="color:#333333">2.6.11</span></p> 
 <p align="left"><span style="color:#333333">378 #define_syscall6(type,name,type1,arg1,type2,arg2,type3,arg3,type4,arg4, \</span></p> 
 <p align="left"><span style="color:#333333">379           type5,arg5,type6,arg6) \</span></p> 
 <p align="left"><span style="color:#333333">380 type name (type1 arg1,type2arg2,type3 arg3,type4 arg4,type5 arg5,type6 arg6) \</span></p> 
 <p align="left"><span style="color:#333333">381 { \</span></p> 
 <p align="left"><span style="color:#333333">382 long __res; \</span></p> 
 <p align="left"><span style="color:#333333">383 __asm__ volatile ("push %%ebp ;movl %%eax,%%ebp ; movl %1,%%eax ; int $0x80 ; pop %%ebp" \</span></p> 
 <p align="left"><span style="color:#333333">384         : "=a" (__res) \</span></p> 
 <p align="left"><span style="color:#333333">385        : "i"(__NR_##name),"b" ((long)(arg1)),"c" ((long)(arg2)), \</span></p> 
 <p align="left"><span style="color:#333333">386           "d"((long)(arg3)),"S" ((long)(arg4)),"D" ((long)(arg5)), \</span></p> 
 <p align="left"><span style="color:#333333">387           "0" ((long)(arg6))); \</span></p> 
 <p align="left"><span style="color:#333333">388 __syscall_return(type,__res); \</span></p> 
 <p align="left"><span style="color:#333333">389 }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">调用链回溯的代码实现</span></strong></p> 
<p align="left"><span style="color:#333333">内核中(x86)</span>对调用链的回溯的代码实现在文件dumpstack_32.c文件中。主要函数是dump_trace和print_context_stack.</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">待解释</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">C</span><span style="color:#333333">难点的汇编解释</span></strong></p> 
<p align="left"><strong><span style="color:#333333">例1</span></strong></p> 
<p align="left"><span style="color:#333333">if ... else if</span></p> 
<p align="left"><span style="color:#333333">这个例子有人看来也许是非常非常地简单，但就这个例子，有的人还真给我考”倒”了。他的回话是“还真没见过这样子的代码”。但是，这样的代码在内核中比比皆是,</span>比如后面附上的函数代码 do_path_lookup。如果对if ... else if 理解有偏差，对内核代码的逻辑理解根本就是差以千里。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       int i = 1;</span></p> 
 <p align="left"><span style="color:#333333">       int j = 2;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       if (i == 1)</span></p> 
 <p align="left"><span style="color:#333333">                printf("i,ok\n");</span></p> 
 <p align="left"><span style="color:#333333">       else if (j == 2)</span></p> 
 <p align="left"><span style="color:#333333">                printf("j,ok\n");</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       return 0;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
</div> 
<p align="left"><span style="color:#333333">这个例子，有人会疑问为什么”j,ok</span>”没打印出来。现在我们分析下它的汇编代码</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">08048374 &lt;main&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 8048374:      8d 4c 24 04             lea    0x4(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333"> 8048378:      83 e4 f0                and    $0xfffffff0,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 804837b:      ff 71 fc                pushl  -0x4(%ecx)</span></p> 
 <p align="left"><span style="color:#333333"> 804837e:      55                      push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804837f:      89 e5                   mov    %esp,%ebp           //</span><span style="color:#333333">以上汇编码保存旧栈帧信息，建立新栈帧</span></p> 
 <p align="left"><span style="color:#333333"> 8048381:      51                      push   %ecx                //%ecx</span><span style="color:#333333">入栈保护</span></p> 
 <p align="left"><span style="color:#333333"> 8048382:      83 ec 14                sub    $0x14,%esp          //</span><span style="color:#333333">建立本地变量栈空间，以及子函数实参栈空间</span></p> 
 <p align="left"><span style="color:#333333"> 8048385:      c7 45 f8 01 00 00 00    movl  $0x1,-0x8(%ebp)     //</span><span style="color:#333333">变量</span><span style="color:#333333">i</span><span style="color:#333333">赋值，记得本地变量的地址靠近栈帧的基地址，所以用</span><span style="color:#333333">%ebp</span><span style="color:#333333">引用</span></p> 
 <p align="left"><span style="color:#333333"> 804838c:      c7 45 f4 02 00 00 00    movl   $0x2,-0xc(%ebp)     //</span><span style="color:#333333">变量</span><span style="color:#333333">j</span><span style="color:#333333">赋值</span></p> 
 <p align="left"><span style="color:#333333"> 8048393:      83 7d f8 01             cmpl   $0x1,-0x8(%ebp)     //i</span><span style="color:#333333">和</span><span style="color:#333333">1</span><span style="color:#333333">比较</span></p> 
 <p align="left"><span style="color:#333333"> 8048397:      75 0e                   jne    80483a7 &lt;main+0x33&gt; //</span><span style="color:#333333">如果</span><span style="color:#333333">i-1</span><span style="color:#333333">不等</span><span style="color:#333333">0</span><span style="color:#333333">，跳到地址</span><span style="color:#333333">80483a7</span><span style="color:#333333">执行。否则继续执行下面指令</span></p> 
 <p align="left"><span style="color:#333333"> 8048399:      c7 04 24 90 84 04 08    movl   $0x8048490,(%esp)   //printf</span><span style="color:#333333">函数第一个参数入栈，它的栈空间之前已经建好。</span></p> 
 <p align="left"><span style="color:#333333">                                                                  //</span><span style="color:#333333">记得子函数的实参空间靠近栈顶，所以引用实参用</span><span style="color:#333333">%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483a0:      e8 2f ff ff ff          call   80482d4 &lt;puts@plt&gt;  //</span><span style="color:#333333">调用</span><span style="color:#333333">printf</span></p> 
 <p align="left"><span style="color:#333333"> 80483a5:      eb 12                   jmp    80483b9 &lt;main+0x45&gt; //printf</span><span style="color:#333333">返回后，接着执行这个指令，将跳到地址</span><span style="color:#333333">80483b9</span><span style="color:#333333">继续运行</span></p> 
 <p align="left"><span style="color:#333333"> 80483a7:      83 7d f4 02             cmpl   $0x2,-0xc(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483ab:      75 0c                   jne    80483b9 &lt;main+0x45&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483ad:      c7 04 24 95 84 04 08    movl   $0x8048495,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483b4:      e8 1b ff ff ff          call   80482d4 &lt;puts@plt&gt;   </span></p> 
 <p align="left"><span style="color:#333333"> 80483b9:      b8 00 00 00 00          mov   $0x0,%eax           //%eax</span><span style="color:#333333">赋值</span><span style="color:#333333">0,%eax</span><span style="color:#333333">放的也就是</span><span style="color:#333333">main</span><span style="color:#333333">函数返回结果</span></p> 
 <p align="left"><span style="color:#333333"> 80483be:      83 c4 14                add    $0x14,%esp          //</span><span style="color:#333333">撤销新栈帧的本地变量栈空间，以及子函数实参栈空间</span></p> 
 <p align="left"><span style="color:#333333"> 80483c1:      59                      pop    %ecx                //</span><span style="color:#333333">恢复保存的旧</span><span style="color:#333333">%ecx</span><span style="color:#333333">的值</span></p> 
 <p align="left"><span style="color:#333333"> 80483c2:      5d                      pop    %ebp                //</span><span style="color:#333333">以下汇编码都是恢复旧栈帧的信息</span><span style="color:#333333">,main</span><span style="color:#333333">函数返回等</span></p> 
 <p align="left"><span style="color:#333333"> 80483c3:      8d 61 fc                lea    -0x4(%ecx),%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483c6:      c3                      ret</span></p> 
</div> 
<p align="left"><span style="color:#333333">经过上面的汇编代码分析，可见c</span>代码块</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">       else if (j == 2)</span></p> 
 <p align="left"><span style="color:#333333">                printf("j,ok\n");</span></p> 
</div> 
<p align="left"><span style="color:#333333">对应的汇编代码是：</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333"> 80483a7:      83 7d f4 02             cmpl   $0x2,-0xc(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483ab:      75 0c                   jne    80483b9 &lt;main+0x45&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483ad:      c7 04 24 95 84 04 08    movl   $0x8048495,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483b4:      e8 1b ff ff ff          call   80482d4 &lt;puts@plt&gt;   </span></p> 
</div> 
<p align="left"><span style="color:#333333">上面的代码指令根本就没有机会运行。</span></p> 
<p align="left"><span style="color:#333333">结论，一个if ... else if..else..</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">if (</span><span style="color:#333333">判断语句</span><span style="color:#333333">1)</span></p> 
 <p align="left"><span style="color:#333333">       </span><span style="color:#333333">代码块</span><span style="color:#333333">1</span></p> 
 <p align="left"><span style="color:#333333">else if (</span><span style="color:#333333">判断语句</span><span style="color:#333333">2)</span></p> 
 <p align="left"><span style="color:#333333">       </span><span style="color:#333333">代码块</span><span style="color:#333333">2;</span></p> 
 <p align="left"><span style="color:#333333">else if ....</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">..</span></p> 
 <p align="left"><span style="color:#333333">else </span><span style="color:#333333">代码块</span><span style="color:#333333">N</span><span style="color:#333333">；</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">语句块1,2..N</span>的运行机会是一种互斥的关系。当然它们的“机会优先级”是不一样的。语句块1,2..N只有一个有被运行的机会，如果没有else甚至可能没有一个语句块能被运行。</p> 
<p align="left"><span style="color:#333333">内核代码实例</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">static int do_path_lookup(int dfd, constchar *name,</span></p> 
 <p align="left"><span style="color:#333333">                                unsignedint flags, struct nameidata *nd)</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      intretval = 0;</span></p> 
 <p align="left"><span style="color:#333333">      intfput_needed;</span></p> 
 <p align="left"><span style="color:#333333">      structfile *file;</span></p> 
 <p align="left"><span style="color:#333333">      structfs_struct *fs = current-&gt;fs;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      nd-&gt;last_type= LAST_ROOT; /* if there are only slashes... */</span></p> 
 <p align="left"><span style="color:#333333">      nd-&gt;flags= flags;</span></p> 
 <p align="left"><span style="color:#333333">      nd-&gt;depth= 0;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      if(*name=='/') {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               read_lock(&amp;fs-&gt;lock);</span></p> 
 <p align="left"><span style="color:#333333">               if(fs-&gt;altroot.dentry &amp;&amp; !(nd-&gt;flags &amp; LOOKUP_NOALT)) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       nd-&gt;path= fs-&gt;altroot;</span></p> 
 <p align="left"><span style="color:#333333">                       path_get(&amp;fs-&gt;altroot);</span></p> 
 <p align="left"><span style="color:#333333">                       read_unlock(&amp;fs-&gt;lock);</span></p> 
 <p align="left"><span style="color:#333333">                       if(__emul_lookup_dentry(name,nd))</span></p> 
 <p align="left"><span style="color:#333333">                                gotoout; /* found in altroot */</span></p> 
 <p align="left"><span style="color:#333333">                       read_lock(&amp;fs-&gt;lock);</span></p> 
 <p align="left"><span style="color:#333333">               }</span></p> 
 <p align="left"><span style="color:#333333">               nd-&gt;path= fs-&gt;root;</span></p> 
 <p align="left"><span style="color:#333333">               path_get(&amp;fs-&gt;root);</span></p> 
 <p align="left"><span style="color:#333333">               read_unlock(&amp;fs-&gt;lock);</span></p> 
 <p align="left"><span style="color:#333333">      }else if (dfd == AT_FDCWD) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               read_lock(&amp;fs-&gt;lock);</span></p> 
 <p align="left"><span style="color:#333333">               nd-&gt;path= fs-&gt;pwd;</span></p> 
 <p align="left"><span style="color:#333333">               path_get(&amp;fs-&gt;pwd);</span></p> 
 <p align="left"><span style="color:#333333">               read_unlock(&amp;fs-&gt;lock);</span></p> 
 <p align="left"><span style="color:#333333">      }else {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               structdentry *dentry;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               file= fget_light(dfd, &amp;fput_needed);</span></p> 
 <p align="left"><span style="color:#333333">               retval= -EBADF;</span></p> 
 <p align="left"><span style="color:#333333">               if(!file)</span></p> 
 <p align="left"><span style="color:#333333">                       gotoout_fail;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               dentry= file-&gt;f_path.dentry;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               retval= -ENOTDIR;</span></p> 
 <p align="left"><span style="color:#333333">               if(!S_ISDIR(dentry-&gt;d_inode-&gt;i_mode))</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">                       gotofput_fail;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               retval= file_permission(file, MAY_EXEC);</span></p> 
 <p align="left"><span style="color:#333333">               if(retval)</span></p> 
 <p align="left"><span style="color:#333333">                       gotofput_fail;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               nd-&gt;path= file-&gt;f_path;</span></p> 
 <p align="left"><span style="color:#333333">               path_get(&amp;file-&gt;f_path);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               fput_light(file,fput_needed);</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      retval= path_walk(name, nd);</span></p> 
 <p align="left"><span style="color:#333333">out:</span></p> 
 <p align="left"><span style="color:#333333">      if(unlikely(!retval &amp;&amp; !audit_dummy_context() &amp;&amp;nd-&gt;path.dentry &amp;&amp;</span></p> 
 <p align="left"><span style="color:#333333">                                nd-&gt;path.dentry-&gt;d_inode))</span></p> 
 <p align="left"><span style="color:#333333">               audit_inode(name,nd-&gt;path.dentry);</span></p> 
 <p align="left"><span style="color:#333333">out_fail:</span></p> 
 <p align="left"><span style="color:#333333">      returnretval;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">fput_fail:</span></p> 
 <p align="left"><span style="color:#333333">      fput_light(file,fput_needed);</span></p> 
 <p align="left"><span style="color:#333333">      gotoout_fail;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">例2</span></strong></p> 
<p align="left"><span style="color:#333333">短路逻辑算法。</span></p> 
<p align="left"><span style="color:#333333">这样的例子在内核代码中也是非常地多，一般用在短的函数或宏中。</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       int a = 1;</span></p> 
 <p align="left"><span style="color:#333333">       int b = 2;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       if (a || ++b)</span></p> 
 <p align="left"><span style="color:#333333">                printf("%d\n", b);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       return 0;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">这个例子，有人会疑问为什么b</span>的值没有变化，还是为2。现在我们分析下它的汇编代码</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">08048374 &lt;main&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 8048374:      8d 4c 24 04             lea    0x4(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333"> 8048378:      83 e4 f0                and    $0xfffffff0,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 804837b:      ff 71 fc                pushl  -0x4(%ecx)</span></p> 
 <p align="left"><span style="color:#333333"> 804837e:      55                      push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804837f:      89 e5                   mov    %esp,%ebp            //</span><span style="color:#333333">以上汇编码保存旧栈帧信息，建立新栈帧</span></p> 
 <p align="left"><span style="color:#333333"> 8048381:      51                      push   %ecx                 //%ecx</span><span style="color:#333333">入栈保护</span></p> 
 <p align="left"><span style="color:#333333"> 8048382:      83 ec 24                sub    $0x24,%esp           //</span><span style="color:#333333">创建本地变量和子函数实参的栈空间</span><span style="color:#333333">(</span><span style="color:#333333">实际上没全部使用到</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333"> 8048385:      c7 45 f8 01 00 00 00    movl   $0x1,-0x8(%ebp)      //</span><span style="color:#333333">变量</span><span style="color:#333333">a</span><span style="color:#333333">赋值，记得本地变量的地址靠近栈帧的基地址，所以用</span><span style="color:#333333">%ebp</span><span style="color:#333333">引用</span><span style="color:#333333">  </span></p> 
 <p align="left"><span style="color:#333333"> 804838c:      c7 45 f4 02 00 00 00    movl   $0x2,-0xc(%ebp)      //</span><span style="color:#333333">变量</span><span style="color:#333333">b</span><span style="color:#333333">赋值</span></p> 
 <p align="left"><span style="color:#333333"> 8048393:      83 7d f8 00             cmpl   $0x0,-0x8(%ebp)      //</span><span style="color:#333333">变量</span><span style="color:#333333">a</span><span style="color:#333333">和</span><span style="color:#333333">0</span><span style="color:#333333">比较，其实就是判断</span><span style="color:#333333">“</span><span style="color:#333333">表达式</span><span style="color:#333333"> a”</span><span style="color:#333333">是不是为假</span></p> 
 <p align="left"><span style="color:#333333"> 8048397:      75 0a                   jne    80483a3 &lt;main+0x2f&gt;  //a-0</span><span style="color:#333333">如果不等</span><span style="color:#333333">0</span><span style="color:#333333">，也就是</span><span style="color:#333333">a</span><span style="color:#333333">为真时就跳到地址</span><span style="color:#333333">80483a3</span><span style="color:#333333">执行。</span></p> 
 <p align="left"><span style="color:#333333">                                                                   //</span><span style="color:#333333">已经知道</span><span style="color:#333333">a==1,</span><span style="color:#333333">表达式</span><span style="color:#333333">a</span><span style="color:#333333">为真，所以将跳到地址</span><span style="color:#333333">80483a3</span><span style="color:#333333">执行</span></p> 
 <p align="left"><span style="color:#333333"> 8048399:      83 45 f4 01             addl   $0x1,-0xc(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 804839d:      83 7d f4 00             cmpl   $0x0,-0xc(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483a1:      74 13                   je     80483b6 &lt;main+0x42&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483a3:      8b 45 f4                mov    -0xc(%ebp),%eax      //</span><span style="color:#333333">把变量</span><span style="color:#333333">b</span><span style="color:#333333">的值放到临时寄存器</span><span style="color:#333333">%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483a6:      89 44 24 04             mov    %eax,0x4(%esp)       //</span><span style="color:#333333">接着把它作为</span><span style="color:#333333">printf</span><span style="color:#333333">函数第二个实参入栈</span><span style="color:#333333">,</span></p> 
 <p align="left"><span style="color:#333333">                                                                    //</span><span style="color:#333333">记得子函数的实参空间靠近栈顶，所以引用实参用</span><span style="color:#333333">%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483aa:      c7 04 24 90 84 04 08    movl   $0x8048490,(%esp)    //printf</span><span style="color:#333333">函数第一个实参入栈。记得</span><span style="color:#333333">X86</span><span style="color:#333333">下用户层的子函数参数</span></p> 
 <p align="left"><span style="color:#333333">                                                                   //</span><span style="color:#333333">是保存到栈的，而且是从右到左依次入栈</span><span style="color:#333333">   </span></p> 
 <p align="left"><span style="color:#333333"> 80483b1:      e8 22 ff ff ff          call   80482d8 &lt;printf@plt&gt; //</span><span style="color:#333333">调用</span><span style="color:#333333">printf</span><span style="color:#333333">函数</span></p> 
 <p align="left"><span style="color:#333333"> 80483b6:      b8 00 00 00 00          mov    $0x0,%eax            //%eax</span><span style="color:#333333">赋值</span><span style="color:#333333">0,%eax</span><span style="color:#333333">放的也就是</span><span style="color:#333333">main</span><span style="color:#333333">函数返回结果</span></p> 
 <p align="left"><span style="color:#333333"> 80483bb:      83 c4 24                add    $0x24,%esp           //</span><span style="color:#333333">撤销新栈帧的本地变量栈空间，以及子函数实参栈空间</span></p> 
 <p align="left"><span style="color:#333333"> 80483be:      59                      pop    %ecx                 //</span><span style="color:#333333">恢复保存的旧</span><span style="color:#333333">%ecx</span><span style="color:#333333">的值</span></p> 
 <p align="left"><span style="color:#333333"> 80483bf:      5d                      pop    %ebp                 //</span><span style="color:#333333">以下汇编码都是恢复旧栈帧的信息，</span><span style="color:#333333">main</span><span style="color:#333333">函数返回等</span></p> 
 <p align="left"><span style="color:#333333"> 80483c0:      8d 61 fc                lea    -0x4(%ecx),%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483c3:      c3                      ret</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">分析可见C</span>语句 if (a || ++b)中的++b对应的汇编码是</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333"> 8048399:      83 45 f4 01             addl   $0x1,-0xc(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 804839d:      83 7d f4 00             cmpl   $0x0,-0xc(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483a1:      74 13                   je     80483b6 &lt;main+0x42&gt;</span></p> 
</div> 
<p align="left"><span style="color:#333333">可是因为a==1,</span>表达式a已经为真，++b这个语句，也就是上面的汇编码，根本就没运行。所以变量b的值没有自增，还是保持为2。</p> 
<p align="left"><span style="color:#333333">结论</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">表达式</span><span style="color:#333333"> a, b</span></p> 
 <p align="left"><span style="color:#333333">a || b: </span><span style="color:#333333">如果</span><span style="color:#333333">a</span><span style="color:#333333">为真</span><span style="color:#333333">,b</span><span style="color:#333333">就不管</span><span style="color:#333333">;</span><span style="color:#333333">如果运行到</span><span style="color:#333333">b,a</span><span style="color:#333333">必已是假</span></p> 
 <p align="left"><span style="color:#333333">a &amp;&amp; b: </span><span style="color:#333333">如果</span><span style="color:#333333">a</span><span style="color:#333333">为假</span><span style="color:#333333">,b</span><span style="color:#333333">就不管</span><span style="color:#333333">;</span><span style="color:#333333">如果运行到</span><span style="color:#333333">b,a</span><span style="color:#333333">必已是真</span></p> 
</div> 
<p align="left"><span style="color:#333333">内核代码实例</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">static struct char_device_struct *</span></p> 
 <p align="left"><span style="color:#333333">__register_chrdev_region(unsigned intmajor, unsigned int baseminor,</span></p> 
 <p align="left"><span style="color:#333333">                          int minorct, const char *name)</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">......</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      i= major_to_index(major);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      for(cp = &amp;chrdevs[i]; *cp; cp = &amp;(*cp)-&gt;next)</span></p> 
 <p align="left"><span style="color:#333333">               if((*cp)-&gt;major &gt; major ||</span></p> 
 <p align="left"><span style="color:#333333">                   ((*cp)-&gt;major == major &amp;&amp;</span></p> 
 <p align="left"><span style="color:#333333">                    (((*cp)-&gt;baseminor &gt;= baseminor) ||</span></p> 
 <p align="left"><span style="color:#333333">                     ((*cp)-&gt;baseminor + (*cp)-&gt;minorct&gt; baseminor))))</span></p> 
 <p align="left"><span style="color:#333333">                       break;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">.....</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">例3</span></strong></p> 
<p align="left"><span style="color:#333333">自增自减</span></p> 
<p align="left"><span style="color:#333333">自增自减，以及增减的前后问题。这类代码在内核数不胜数。理解稍有偏差，就会产生“边界问题”，或者在条件判断时理解出错。</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       int i = -1;</span></p> 
 <p align="left"><span style="color:#333333">       if (!i++) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                printf("inner: %d\n", i);</span></p> 
 <p align="left"><span style="color:#333333">       }</span></p> 
 <p align="left"><span style="color:#333333">       printf("outer: %d\n", i);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       return 0;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">汇编代码</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">08048374 &lt;main&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> 8048374:      8d 4c 24 04             lea    0x4(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333"> 8048378:      83 e4 f0                and    $0xfffffff0,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 804837b:      ff 71 fc                pushl  -0x4(%ecx)</span></p> 
 <p align="left"><span style="color:#333333"> 804837e:      55                      push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804837f:      89 e5                   mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048381:      51                      push   %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 8048382:      83 ec 24                sub    $0x24,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 8048385:      c7 45 f8 ff ff ff ff    movl   $0xffffffff,-0x8(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 804838c:      83 45 f8 01             addl   $0x1,-0x8(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 8048390:      83 7d f8 01             cmpl   $0x1,-0x8(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 8048394:      75 13                   jne    80483a9 &lt;main+0x35&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 8048396:      8b 45 f8                mov    -0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 8048399:      89 44 24 04             mov    %eax,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 804839d:      c7 04 24 90 84 04 08    movl   $0x8048490,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483a4:      e8 2f ff ff ff          call   80482d8 &lt;printf@plt&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483a9:      8b 45 f8                mov    -0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483ac:      89 44 24 04             mov    %eax,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483b0:      c7 04 24 9b 84 04 08    movl   $0x804849b,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483b7:      e8 1c ff ff ff          call   80482d8 &lt;printf@plt&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483bc:      b8 00 00 00 00          mov    $0x0,%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483c1:      83 c4 24                add    $0x24,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483c4:      59                      pop    %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483c5:      5d                      pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483c6:      8d 61 fc                lea    -0x4(%ecx),%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483c9:      c3                      ret</span></p> 
 <p align="left"><span style="color:#333333"> 80483ca:      90                      nop</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">内核代码实例</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">int platform_add_devices(structplatform_device **devs, int num)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      inti, ret = 0;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      for(i = 0; i &lt; num; i++) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               ret= platform_device_register(devs[i]);</span></p> 
 <p align="left"><span style="color:#333333">               if(ret) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       while(--i &gt;= 0)  /*</span><span style="color:#333333">没错，</span><span style="color:#333333">devs[i]</span><span style="color:#333333">没注册成功的话，从</span><span style="color:#333333">devs[i-1]</span><span style="color:#333333">起反注册</span><span style="color:#333333">*/</span></p> 
 <p align="left"><span style="color:#333333">                                platform_device_unregister(devs[i]);</span></p> 
 <p align="left"><span style="color:#333333">                       break;</span></p> 
 <p align="left"><span style="color:#333333">               }</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      returnret;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">例4</span></strong></p> 
<p align="left"><span style="color:#333333">函数指针</span></p> 
<p align="left"><span style="color:#333333">解释在“穿越交叉索引工具的盲区”→函数指针</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       int myfunc(int a, int b)</span></p> 
 <p align="left"><span style="color:#333333">       {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                int c = a + b;</span></p> 
 <p align="left"><span style="color:#333333">                printf("%d\n", c);</span></p> 
 <p align="left"><span style="color:#333333">                return 0;</span></p> 
 <p align="left"><span style="color:#333333">       }</span></p> 
 <p align="left"><span style="color:#333333">       int (*funa)(int, int) = myfunc;</span></p> 
 <p align="left"><span style="color:#333333">       int (*funb)(int, int) = &amp;myfunc;</span></p> 
 <p align="left"><span style="color:#333333">       int (*func)(int, int) = (int (*)(int, int))myfunc;</span></p> 
 <p align="left"><span style="color:#333333">       int (*fund)(int, int) = (int (*)(int, int))(&amp;myfunc);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       myfunc(1, 2);</span></p> 
 <p align="left"><span style="color:#333333">       funa(3, 4);</span></p> 
 <p align="left"><span style="color:#333333">       funb(5, 6);</span></p> 
 <p align="left"><span style="color:#333333">       func(7, 8);</span></p> 
 <p align="left"><span style="color:#333333">       fund(9, 10);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       return 0;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">编译：</span></p> 
 <p align="left"><span style="color:#333333">$ gcc -g -Wall fuk.c //</span><span style="color:#333333">注意，没任何警告</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333"> 8048374:      8d 4c 24 04             lea    0x4(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333">....</span><span style="color:#333333">省略</span></p> 
 <p align="left"><span style="color:#333333">       int (*funa)(int, int) = myfunc;</span></p> 
 <p align="left"><span style="color:#333333"> 8048385:      c7 45 f8 13 84 04 08    movl   $0x8048413,-0x8(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">       int (*funb)(int, int) = &amp;myfunc;</span></p> 
 <p align="left"><span style="color:#333333"> 804838c:      c7 45 f4 13 84 04 08    movl   $0x8048413,-0xc(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">       int (*func)(int, int) = (int (*)(int, int))myfunc;</span></p> 
 <p align="left"><span style="color:#333333"> 8048393:      c7 45 f0 13 84 04 08    movl   $0x8048413,-0x10(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">       int (*fund)(int, int) = (int (*)(int, int))(&amp;myfunc);</span></p> 
 <p align="left"><span style="color:#333333"> 804839a:      c7 45 ec 13 84 04 08    movl   $0x8048413,-0x14(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       myfunc(1, 2);</span></p> 
 <p align="left"><span style="color:#333333">...</span><span style="color:#333333">省略</span></p> 
 <p align="left"><span style="color:#333333">       funa(3, 4);</span></p> 
 <p align="left"><span style="color:#333333"> 80483b5:      c7 44 24 04 04 00 00    movl   $0x4,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483bc:      00</span></p> 
 <p align="left"><span style="color:#333333"> 80483bd:      c7 04 24 03 00 00 00    movl   $0x3,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483c4:      8b 45 f8                mov    -0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483c7:      ff d0                   call   *%eax</span></p> 
 <p align="left"><span style="color:#333333">       funb(5, 6);</span></p> 
 <p align="left"><span style="color:#333333">....</span><span style="color:#333333">省略，</span><span style="color:#333333">funb, func,fund</span><span style="color:#333333">汇编码和</span><span style="color:#333333">funa</span><span style="color:#333333">完全相同</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       return 0;</span></p> 
 <p align="left"><span style="color:#333333"> 8048405:      b8 00 00 00 00          mov    $0x0,%eax</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> 804840a:      83 c4 24                add    $0x24,%esp</span></p> 
 <p align="left"><span style="color:#333333">...</span><span style="color:#333333">省略</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">08048413 &lt;myfunc.1933&gt;:</span></p> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       int myfunc(int a, int b)</span></p> 
 <p align="left"><span style="color:#333333">       {<!-- --></span></p> 
 <p align="left"><span style="color:#333333"> 8048413:      55                      push   %ebp</span></p> 
 <p align="left"><span style="color:#333333">.....</span><span style="color:#333333">省略</span></p> 
 <p align="left"><span style="color:#333333">       }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">xxx@ubuntu:~/dt/test$ gdb a.out</span></p> 
 <p align="left"><span style="color:#333333">GNU gdb 6.8-debian</span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">(gdb) list</span></p> 
 <p align="left"><span style="color:#333333">1     #include&lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">......</span></p> 
 <p align="left"><span style="color:#333333">17             funa(3,4);</span></p> 
 <p align="left"><span style="color:#333333">....</span></p> 
 <p align="left"><span style="color:#333333">20             </span></p> 
 <p align="left"><span style="color:#333333">(gdb) b 17</span></p> 
 <p align="left"><span style="color:#333333">(gdb) r</span></p> 
 <p align="left"><span style="color:#333333">Starting program: /home/xxx/</span><span style="color:#333333">桌面</span><span style="color:#333333">/test/a.out</span></p> 
 <p align="left"><span style="color:#333333">Breakpoint 1, main () at fuck.c:17</span></p> 
 <p align="left"><span style="color:#333333">17             funa(3,4);</span></p> 
 <p align="left"><span style="color:#333333">(gdb) display/i $pc</span></p> 
 <p align="left"><span style="color:#333333">1: x/i $pc</span></p> 
 <p align="left"><span style="color:#333333">0x80483b5 &lt;main+65&gt;:   movl  $0x4,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333">(gdb) stepi</span></p> 
 <p align="left"><span style="color:#333333">0x080483bd     17               funa(3,4);</span></p> 
 <p align="left"><span style="color:#333333">1: x/i $pc</span></p> 
 <p align="left"><span style="color:#333333">0x80483bd &lt;main+73&gt;:   movl  $0x3,(%esp)</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333">0x080483c4     17               funa(3,4);</span></p> 
 <p align="left"><span style="color:#333333">1: x/i $pc</span></p> 
 <p align="left"><span style="color:#333333">0x80483c4 &lt;main+80&gt;:   mov   -0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333">0x080483c7     17               funa(3,4);</span></p> 
 <p align="left"><span style="color:#333333">1: x/i $pc</span></p> 
 <p align="left"><span style="color:#333333">0x80483c7 &lt;main+83&gt;:   call  *%eax</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p/x $eax</span></p> 
 <p align="left"><span style="color:#333333">$4 = 0x8048413</span></p> 
 <p align="left"><span style="color:#333333">(gdb) info line  *0x8048413</span></p> 
 <p align="left"><span style="color:#333333">Line 6 of "fuck.c" starts ataddress 0x8048413 &lt;myfunc&gt; and ends at 0x8048419 &lt;myfunc+6&gt;.</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">其他例子</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      staticconst char *operstates[] = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      "unknown",</span></p> 
 <p align="left"><span style="color:#333333">      "notpresent",/* currently unused */</span></p> 
 <p align="left"><span style="color:#333333">      "down",</span></p> 
 <p align="left"><span style="color:#333333">      "lowerlayerdown",</span></p> 
 <p align="left"><span style="color:#333333">      "testing",/* currently unused */</span></p> 
 <p align="left"><span style="color:#333333">      "dormant",</span></p> 
 <p align="left"><span style="color:#333333">      "up"</span></p> 
 <p align="left"><span style="color:#333333">      };</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      enum{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      IF_OPER_UNKNOWN,</span></p> 
 <p align="left"><span style="color:#333333">      IF_OPER_NOTPRESENT,</span></p> 
 <p align="left"><span style="color:#333333">      IF_OPER_DOWN,</span></p> 
 <p align="left"><span style="color:#333333">      IF_OPER_LOWERLAYERDOWN,</span></p> 
 <p align="left"><span style="color:#333333">      IF_OPER_TESTING,</span></p> 
 <p align="left"><span style="color:#333333">      IF_OPER_DORMANT,</span></p> 
 <p align="left"><span style="color:#333333">      IF_OPER_UP,</span></p> 
 <p align="left"><span style="color:#333333">      };</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       enum {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       OPER_UNKNOWN = 1,</span></p> 
 <p align="left"><span style="color:#333333">       OPER_NOTPRESENT,</span></p> 
 <p align="left"><span style="color:#333333">       OPER_DOWN,</span></p> 
 <p align="left"><span style="color:#333333">       OPER_LOWERLAYERDOWN,</span></p> 
 <p align="left"><span style="color:#333333">       OPER_TESTING,</span></p> 
 <p align="left"><span style="color:#333333">       OPER_DORMANT,</span></p> 
 <p align="left"><span style="color:#333333">       OPER_UP,</span></p> 
 <p align="left"><span style="color:#333333">       };</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       enum {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">        UNKNOWN,</span></p> 
 <p align="left"><span style="color:#333333">       NOTPRESENT = 6,</span></p> 
 <p align="left"><span style="color:#333333">       DOWN,</span></p> 
 <p align="left"><span style="color:#333333">       LOWERLAYERDOWN,</span></p> 
 <p align="left"><span style="color:#333333">       TESTING,</span></p> 
 <p align="left"><span style="color:#333333">       DORMANT,</span></p> 
 <p align="left"><span style="color:#333333">       UP,</span></p> 
 <p align="left"><span style="color:#333333">       };</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      printf("%d\n",sizeof(operstates));</span></p> 
 <p align="left"><span style="color:#333333">      printf("%d\n",sizeof(operstates[0]));</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      printf("%d\n",IF_OPER_DOWN);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      printf("%d\n",OPER_DOWN);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      printf("%d\n",UNKNOWN);</span></p> 
 <p align="left"><span style="color:#333333">      printf("%d\n",DOWN);</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">优化级别的影响</span></strong></p> 
<p align="left"><span style="color:#333333">这部分内容有点偏题，没必要这么钻牛角尖。但是为了说明“调试用的代码和实际运行的代码是不一样”的这个事实以及因为代码优化导致的“非理想状态”的调用链问题(</span>见“内核初窥”)，有必要用观察一个实例，以便有个直观的印象。</p> 
<p align="left"><span style="color:#333333">首先应该知道，有没有指定调试选项-g(</span>–debug)，在相同优先级下生成的代码都是一样的。差别只是，指定-g后，多生成了一个调试表。</p> 
<p align="left"><strong><span style="color:#333333">优化选项</span></strong></p> 
<p align="left"><span style="color:#333333">下面文字来自“ARM </span>系列应用技术完全手册”</p> 
<p align="left"><span style="color:#333333">使用-Onum</span>选择编译器的优化级别。优化级别分别有</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">-O0: </span><span style="color:#333333">除一些简单的代码编号外，关闭所有优化，该选项可提供最直接的优化信息。</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">-O1: </span><span style="color:#333333">关闭严重影响调试效果的优化功能。使用该编译选项，编译器会移除程序中未使用到的内联函数和静态函数。如果于–debug(</span>也就是-g)一起使用，该选项可以在较好的代码密度下，给出最佳调试视图。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">-O2: </span><span style="color:#333333">生成充分优化代码。如果与–debug</span>一起使用，调试效果可能不令人满意，因为对目标代码到源代码的映射可能因为代码优化而发生变化。如果不生成调试表，这是默认优化级别。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">-O3: </span><span style="color:#333333">最高优化级别。使用该优化级别，使生成的代码在时间和空间上寻求平衡。</span></p> 
<p align="left"><strong><span style="color:#333333">例子</span></strong></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int add(int a, int b)</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      return(a + b);</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void funa()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      inta = 3 + 4;</span></p> 
 <p align="left"><span style="color:#333333">      intb;</span></p> 
 <p align="left"><span style="color:#333333">      printf("%d\n",a);</span></p> 
 <p align="left"><span style="color:#333333">       b = add(5,6);</span></p> 
 <p align="left"><span style="color:#333333">      printf("%d\n",b);</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      intm = 1 + 2;</span></p> 
 <p align="left"><span style="color:#333333">      printf("%d\n",m);</span></p> 
 <p align="left"><span style="color:#333333">       funa();</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$ gcc -g -O0 src.c (</span><span style="color:#333333">或者不指定优化选项：</span><span style="color:#333333"> gcc -g src.c</span><span style="color:#333333">，编译出的机器码一样</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333">$ objdump -d a.out</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">得到一个结论：如果指定了</span><span style="color:#333333">-g</span><span style="color:#333333">而没指定优化等级，那么默认优化等级是最低的</span><span style="color:#333333">-O0</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">08048374 &lt;add&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 8048374:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048375:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048377:      8b45 0c                    mov    0xc(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 804837a:      0345 08                    add    0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 804837d:      5d                           pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804837e:      c3                           ret    </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">0804837f &lt;funa&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 804837f:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048380:      89e5                       mov    %esp,%ebp           //</span><span style="color:#333333">保存旧栈帧，建立新栈帧</span></p> 
 <p align="left"><span style="color:#333333"> 8048382:      83ec 18                    sub    $0x18,%esp           //</span><span style="color:#333333">分配栈帧空间，注意分配了</span><span style="color:#333333">$0x18</span></p> 
 <p align="left"><span style="color:#333333"> 8048385:      c745 fc 07 00 00 00      movl   $0x7,-0x4(%ebp)             //-0x4(%ebp)</span><span style="color:#333333">是本地变量</span><span style="color:#333333">a</span><span style="color:#333333">的地址，</span><span style="color:#333333">int a = 3 + 4;</span></p> 
 <p align="left"><span style="color:#333333">                                                                       //</span><span style="color:#333333">注意编译器已经完成了计算</span></p> 
 <p align="left"><span style="color:#333333"> 804838c:      8b45 fc                    mov    -0x4(%ebp),%eax              //a</span><span style="color:#333333">放到临时寄存器</span><span style="color:#333333">%eax</span></p> 
 <p align="left"><span style="color:#333333"> 804838f:      8944 24 04                 mov    %eax,0x4(%esp)               //</span><span style="color:#333333">接着作为</span><span style="color:#333333">printf</span><span style="color:#333333">第二个参数入栈</span></p> 
 <p align="left"><span style="color:#333333"> 8048393:      c704 24 d0 84 04 08      movl   $0x80484d0,(%esp)   //printf</span><span style="color:#333333">第一个参数入栈</span></p> 
 <p align="left"><span style="color:#333333"> 804839a:      e839 ff ff ff             call   80482d8&lt;printf@plt&gt;        //printf("%d\n",a);</span></p> 
 <p align="left"><span style="color:#333333"> 804839f:      c744 24 04 06 00 00      movl   $0x6,0x4(%esp)              //add(5,6);</span><span style="color:#333333">第二个参数入栈</span></p> 
 <p align="left"><span style="color:#333333"> 80483a6:      00</span></p> 
 <p align="left"><span style="color:#333333"> 80483a7:      c704 24 05 00 00 00      movl   $0x5,(%esp)                 //add(5,6);</span><span style="color:#333333">第一个参数入栈</span></p> 
 <p align="left"><span style="color:#333333"> 80483ae:      e8c1 ff ff ff             call   8048374&lt;add&gt;               //</span><span style="color:#333333">调用</span><span style="color:#333333">add</span></p> 
 <p align="left"><span style="color:#333333"> 80483b3:      8945 f8                    mov    %eax,-0x8(%ebp)              //-0x8(%ebp)</span><span style="color:#333333">是本地变量</span><span style="color:#333333">b</span><span style="color:#333333">的地址，</span><span style="color:#333333">b = add(5,6);</span></p> 
 <p align="left"><span style="color:#333333"> 80483b6:      8b45 f8                    mov    -0x8(%ebp),%eax              //b</span><span style="color:#333333">放到临时寄存器</span><span style="color:#333333">%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483b9:      8944 24 04                 mov    %eax,0x4(%esp)               //</span><span style="color:#333333">接着作为</span><span style="color:#333333">printf</span><span style="color:#333333">第二个参数入栈</span></p> 
 <p align="left"><span style="color:#333333"> 80483bd:      c704 24 d0 84 04 08      movl   $0x80484d0,(%esp)   //printf</span><span style="color:#333333">第一个参数入栈</span></p> 
 <p align="left"><span style="color:#333333"> 80483c4:      e80f ff ff ff             call   80482d8 &lt;printf@plt&gt;        //printf("%d\n", b);</span></p> 
 <p align="left"><span style="color:#333333"> 80483c9:      c9                           leave                              //</span><span style="color:#333333">撤销新栈帧空间</span></p> 
 <p align="left"><span style="color:#333333"> 80483ca:      c3                           ret                                 //funa</span><span style="color:#333333">返回</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">080483cb &lt;main&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 80483cb:      8d4c 24 04                 lea    0x4(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483cf:      83e4 f0                    and    $0xfffffff0,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483d2:      ff71 fc                    pushl  -0x4(%ecx)</span></p> 
 <p align="left"><span style="color:#333333"> 80483d5:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483d6:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483d8:      51                           push   %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483d9:      83ec 24                    sub    $0x24,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483dc:      c7 45 f8 03 00 00 00      movl  $0x3,-0x8(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483e3:      8b45 f8                    mov    -0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483e6:      8944 24 04                 mov    %eax,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483ea:      c704 24 d0 84 04 08      movl   $0x80484d0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483f1:      e8e2 fe ff ff             call   80482d8&lt;printf@plt&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483f6:      e884 ff ff ff             call   804837f&lt;funa&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483fb:      83c4 24                    add    $0x24,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483fe:      59                           pop    %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483ff:      5d                           pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048400:      8d61 fc                    lea    -0x4(%ecx),%esp</span></p> 
 <p align="left"><span style="color:#333333"> 8048403:      c3                           ret    </span></p> 
 <p align="left"><span style="color:#333333">$ gcc -g -O1 src.c</span></p> 
 <p align="left"><span style="color:#333333">$ objdump -d a.out</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">08048374 &lt;add&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 8048374:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048375:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048377:      8b45 0c                    mov    0xc(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 804837a:      0345 08                    add    0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 804837d:      5d                           pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804837e:      c3                           ret    </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">0804837f &lt;funa&gt;:                                                            //funa</span><span style="color:#333333">与</span><span style="color:#333333">-O0</span><span style="color:#333333">相比，没有了向本地变量</span><span style="color:#333333">a,b</span><span style="color:#333333">赋值的过程。</span></p> 
 <p align="left"><span style="color:#333333">                                                                       //</span><span style="color:#333333">代码量少了，分配的栈帧空间也小了。</span></p> 
 <p align="left"><span style="color:#333333"> 804837f:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048380:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048382:      83ec 08                    sub    $0x8,%esp            //</span><span style="color:#333333">分配栈帧空间，注意分配了</span><span style="color:#333333">$0x8</span><span style="color:#333333">，比－</span><span style="color:#333333">O0</span><span style="color:#333333">下小了</span></p> 
 <p align="left"><span style="color:#333333"> 8048385:      c744 24 04 07 00 00      movl   $0x7,0x4(%esp)              //printf("%d\n", a);</span><span style="color:#333333">的第二个参数入栈。</span></p> 
 <p align="left"><span style="color:#333333">                                                                       //</span><span style="color:#333333">注意，与</span><span style="color:#333333">-O0</span><span style="color:#333333">相比，没有向本地变量</span><span style="color:#333333">a</span><span style="color:#333333">赋值的过程。</span></p> 
 <p align="left"><span style="color:#333333"> 804838c:      00</span></p> 
 <p align="left"><span style="color:#333333"> 804838d:      c704 24 c0 84 04 08      movl   $0x80484c0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 8048394:      e83f ff ff ff             call   80482d8 &lt;printf@plt&gt;        //printf("%d\n", a);</span></p> 
 <p align="left"><span style="color:#333333"> 8048399:      c744 24 04 06 00 00      movl   $0x6,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483a0:      00</span></p> 
 <p align="left"><span style="color:#333333"> 80483a1:      c704 24 05 00 00 00      movl   $0x5,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483a8:      e8c7 ff ff ff             call   8048374&lt;add&gt;               //add(5,6);</span></p> 
 <p align="left"><span style="color:#333333"> 80483ad:      8944 24 04                 mov    %eax,0x4(%esp)               //add</span><span style="color:#333333">的返回结果作为</span><span style="color:#333333">printf("%d\n", b);</span><span style="color:#333333">的第二个参数入栈。</span></p> 
 <p align="left"><span style="color:#333333">                                                                       //</span><span style="color:#333333">注意，与</span><span style="color:#333333">-O0</span><span style="color:#333333">相比，没有向本地变量</span><span style="color:#333333">b</span><span style="color:#333333">赋值的过程。</span></p> 
 <p align="left"><span style="color:#333333"> 80483b1:      c704 24 c0 84 04 08      movl   $0x80484c0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483b8:      e81b ff ff ff             call   80482d8&lt;printf@plt&gt;        //printf("%d\n",b);</span></p> 
 <p align="left"><span style="color:#333333"> 80483bd:      c9                           leave  </span></p> 
 <p align="left"><span style="color:#333333"> 80483be:      c3                           ret    </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">080483bf &lt;main&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 80483bf:      8d4c 24 04                 lea    0x4(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483c3:      83e4 f0                    and    $0xfffffff0,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483c6:      ff71 fc                    pushl  -0x4(%ecx)</span></p> 
 <p align="left"><span style="color:#333333"> 80483c9:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483ca:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483cc:      51                           push   %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483cd:      83ec 14                    sub    $0x14,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483d0:      c744 24 04 03 00 00      movl   $0x3,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483d7:      00</span></p> 
 <p align="left"><span style="color:#333333"> 80483d8:      c704 24 c0 84 04 08      movl   $0x80484c0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483df:      e8f4 fe ff ff             call   80482d8&lt;printf@plt&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483e4:      e896 ff ff ff             call   804837f&lt;funa&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483e9:      83c4 14                    add    $0x14,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483ec:      59                           pop    %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483ed:      5d                           pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483ee:      8d61 fc                    lea    -0x4(%ecx),%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483f1:      c3                           ret    </span></p> 
 <p align="left"><span style="color:#333333">$ gcc -g -O2 src.c</span></p> 
 <p align="left"><span style="color:#333333">$ objdump -d a.out</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">我们应该知道，如果没有指定</span><span style="color:#333333">-g</span><span style="color:#333333">和优化选项，那么默认的优化等级就是</span><span style="color:#333333">-O2</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">08048380 &lt;add&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 8048380:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048381:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048383:      8b45 0c                    mov    0xc(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 8048386:      0345 08                    add    0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 8048389:      5d                           pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804838a:      c3                           ret    </span></p> 
 <p align="left"><span style="color:#333333"> 804838b:      90                           nop    </span></p> 
 <p align="left"><span style="color:#333333"> 804838c:      8d74 26 00                 lea    0x0(%esi),%esi</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">08048390 &lt;funa&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 8048390:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048391:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048393:      83ec 08                    sub    $0x8,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 8048396:      c744 24 04 07 00 00      movl   $0x7,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 804839d:      00</span></p> 
 <p align="left"><span style="color:#333333"> 804839e:      c704 24 d0 84 04 08      movl   $0x80484d0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483a5:      e82e ff ff ff             call   80482d8 &lt;printf@plt&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483aa:      c744 24 04 06 00 00      movl   $0x6,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483b1:      00</span></p> 
 <p align="left"><span style="color:#333333"> 80483b2:      c704 24 05 00 00 00      movl   $0x5,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483b9:      e8c2 ff ff ff             call   8048380&lt;add&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483be:      c704 24 d0 84 04 08      movl   $0x80484d0,(%esp)   //</span><span style="color:#333333">第二个参数入栈</span></p> 
 <p align="left"><span style="color:#333333"> 80483c5:      8944 24 04                 mov    %eax,0x4(%esp)               //</span><span style="color:#333333">第一个参数入栈。注意和</span><span style="color:#333333">-O1</span><span style="color:#333333">相比，参数在栈帧空间的位置没变，</span></p> 
 <p align="left"><span style="color:#333333">                                                                       //</span><span style="color:#333333">但是入栈指令的执行顺序有变。</span></p> 
 <p align="left"><span style="color:#333333"> 80483c9:      e80a ff ff ff             call   80482d8&lt;printf@plt&gt;        //printf("%d\n",b);</span></p> 
 <p align="left"><span style="color:#333333"> 80483ce:      c9                           leave  </span></p> 
 <p align="left"><span style="color:#333333"> 80483cf:      c3                           ret    </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">080483d0 &lt;main&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 80483d0:      8d4c 24 04                 lea    0x4(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483d4:      83e4 f0                    and    $0xfffffff0,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483d7:      ff71 fc                    pushl  -0x4(%ecx)</span></p> 
 <p align="left"><span style="color:#333333"> 80483da:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483db:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483dd:      51                           push   %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483de:      83ec 14                    sub    $0x14,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483e1:      c744 24 04 03 00 00      movl   $0x3,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483e8:      00</span></p> 
 <p align="left"><span style="color:#333333"> 80483e9:      c7 04 24 d0 84 04 08      movl  $0x80484d0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483f0:      e8e3 fe ff ff             call   80482d8&lt;printf@plt&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483f5:      e896 ff ff ff             call   8048390&lt;funa&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483fa:      83c4 14                    add    $0x14,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483fd:      59                           pop    %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483fe:      5d                           pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483ff:      8d61 fc                    lea    -0x4(%ecx),%esp</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> 8048402:      c3                           ret   </span></p> 
 <p align="left"><span style="color:#333333">$ gcc -g -O3 src.c</span></p> 
 <p align="left"><span style="color:#333333">$ objdump -d a.out</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">048380 &lt;add&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 8048380:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048381:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048383:      8b45 0c                    mov    0xc(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 8048386:      0345 08                    add    0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 8048389:      5d                           pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804838a:      c3                           ret    </span></p> 
 <p align="left"><span style="color:#333333"> 804838b:      90                           nop    </span></p> 
 <p align="left"><span style="color:#333333"> 804838c:      8d74 26 00                 lea    0x0(%esi),%esi</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">08048390 &lt;funa&gt;:                                                            //</span><span style="color:#333333">与</span><span style="color:#333333">-O2</span><span style="color:#333333">相比，对函数</span><span style="color:#333333">add()</span><span style="color:#333333">的调用被编译器优化消失</span></p> 
 <p align="left"><span style="color:#333333"> 8048390:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048391:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048393:      83ec 08                    sub    $0x8,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 8048396:      c744 24 04 07 00 00      movl   $0x7,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 804839d:      00</span></p> 
 <p align="left"><span style="color:#333333"> 804839e:      c704 24 e0 84 04 08      movl   $0x80484e0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483a5:      e82e ff ff ff             call   80482d8&lt;printf@plt&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483aa:      c744 24 04 0b 00 00      movl   $0xb,0x4(%esp)              //</span><span style="color:#333333">注意，与</span><span style="color:#333333">-O2</span><span style="color:#333333">相比，</span><span style="color:#333333">b = add(5,6);</span><span style="color:#333333">被优化掉了。</span></p> 
 <p align="left"><span style="color:#333333">                                                                       //</span><span style="color:#333333">之前应该有个优化为内联函数的过程，但因为</span><span style="color:#333333">add</span><span style="color:#333333">函数</span></p> 
 <p align="left"><span style="color:#333333">                                                                       //</span><span style="color:#333333">太简单，被直接计算了结果。</span><span style="color:#333333">(</span><span style="color:#333333">猜想</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333">                                                                        //</span><span style="color:#333333">编译器直接计算出它的结果</span><span style="color:#333333">$0xb,</span><span style="color:#333333">也就是</span><span style="color:#333333">11</span></p> 
 <p align="left"><span style="color:#333333"> 80483b1:      00</span></p> 
 <p align="left"><span style="color:#333333"> 80483b2:      c704 24 e0 84 04 08      movl   $0x80484e0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483b9:      e81a ff ff ff             call   80482d8&lt;printf@plt&gt;        //printf("%d\n",b);</span></p> 
 <p align="left"><span style="color:#333333"> 80483be:      c9                           leave  </span></p> 
 <p align="left"><span style="color:#333333"> 80483bf:      c3                           ret    </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">080483c0 &lt;main&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 80483c0:      8d4c 24 04                 lea    0x4(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483c4:      83e4 f0                    and    $0xfffffff0,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483c7:      ff71 fc                    pushl  -0x4(%ecx)</span></p> 
 <p align="left"><span style="color:#333333"> 80483ca:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483cb:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 80483cd:      51                           push   %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 80483ce:      83ec 14                    sub    $0x14,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 80483d1:      c744 24 04 03 00 00      movl   $0x3,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483d8:      00</span></p> 
 <p align="left"><span style="color:#333333"> 80483d9:      c704 24 e0 84 04 08      movl   $0x80484e0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483e0:      e8f3 fe ff ff             call   80482d8&lt;printf@plt&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483e5:      c744 24 04 07 00 00      movl   $0x7,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483ec:      00</span></p> 
 <p align="left"><span style="color:#333333"> 80483ed:      c704 24 e0 84 04 08      movl   $0x80484e0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483f4:      e8df fe ff ff             call   80482d8&lt;printf@plt&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483f9:      c744 24 04 0b 00 00      movl   $0xb,0x4(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 8048400:      00</span></p> 
 <p align="left"><span style="color:#333333"> 8048401:      c704 24 e0 84 04 08      movl   $0x80484e0,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 8048408:      e8cb fe ff ff             call   80482d8&lt;printf@plt&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 804840d:      83c4 14                    add    $0x14,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 8048410:      59                           pop    %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 8048411:      5d                           pop    %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048412:      8d61 fc                    lea    -0x4(%ecx),%esp</span></p> 
 <p align="left"><span style="color:#333333"> 8048415:      c3                           ret    </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">汇编基础--ARM</span>篇</strong></p> 
<p align="left"><span style="color:#333333">说明：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">部分内容和X86</span>的重复，重复部分请参考X86的内容。</p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">某些内容不具备普遍性。比如给出的反汇编代码，在不同的优化等级下是不同的。但是在熟悉了典型的函数调用链反汇编代码，对于有变化的其他形式也就不难理解了。</span></p> 
<p align="left"><strong><span style="color:#333333">用户手册</span></strong></p> 
<p align="left"><span style="color:#333333">ARM7TDMI TechnicalReference Manual</span></p> 
<p align="left"><span style="color:#333333">ARM920T TechnicalReference Manual</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.home/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.home/index.html</span></a></span></p> 
<p align="left"><span style="color:#333333">指令速查 <a target="_blank" href="http://www.arm.com/pdfs/QRC0001H_rvct_v2.1_arm.pdf" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.arm.com/pdfs/QRC0001H_rvct_v2.1_arm.pdf</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">调用链形成和参数传递</span></strong></p> 
<p align="left"><span style="color:#333333">注意：arm</span>体系过程调用的文字说明部分，都是依据AAPCS标准。</p> 
<p align="left"><strong><span style="color:#333333">壮观的标准</span></strong></p> 
<p align="left"><span style="color:#333333">参考：</span></p> 
<p align="left"><span style="color:#333333">AAPCS</span></p> 
<p align="left"><span style="color:#333333">Procedure CallStandard for the ARM Architecture</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://infocenter.arm.com/help/topic/com.arm.doc.ihi0042b/IHI0042B_aapcs.pdf" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://infocenter.arm.com/help/topic/com.arm.doc.ihi0042b/IHI0042B_aapcs.pdf</span></a></span></p> 
<p align="left"><span style="color:#333333">终于在“ARM ProcedureCall Standard</span>”中找到了答案</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">PCS     Procedure Call Standard.</span></p> 
 <p align="left"><span style="color:#333333">AAPCS   Procedure Call Standard for the ARM Architecture (this standard).</span></p> 
 <p align="left"><span style="color:#333333">APCS    ARM Procedure Call Standard (obsolete).</span></p> 
 <p align="left"><span style="color:#333333">TPCS    Thumb Procedure Call Standard (obsolete).</span></p> 
 <p align="left"><span style="color:#333333">ATPCS   ARM-Thumb Procedure Call Standard (precursor to this standard).</span></p> 
 <p align="left"><span style="color:#333333">PIC, PID Position-independent code,position-independent data.</span></p> 
</div> 
<p align="left"><span style="color:#333333">下面的标准已过时</span></p> 
<p align="left"><span style="color:#333333">APCS</span></p> 
<p align="left"><span style="color:#333333">ARM Procedure CallStandard <a target="_blank" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0041c/BGBGFIDA.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0041c/BGBGFIDA.html</span></a></span></p> 
<p align="left"><span style="color:#333333">Using the ARMProcedure Call Standard <a target="_blank" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0040d/Chdbceig.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0040d/Chdbceig.html</span></a></span></p> 
<p align="left"><span style="color:#333333">APCS </span><span style="color:#333333">简介<a target="_blank" href="http://www.bsdmap.com/UNIX_html/ARM/apcsintro.html#01" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.bsdmap.com/UNIX_html/ARM/apcsintro.html#01</span></a></span></p> 
<p align="left"><span style="color:#333333">TPCS</span></p> 
<p align="left"><span style="color:#333333">Thumb Procedure CallStandard <a target="_blank" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0041c/BCEEAHAF.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0041c/BCEEAHAF.html</span></a></span></p> 
<p align="left"><span style="color:#333333">Using the ThumbProcedure Call Standard <a target="_blank" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0040d/Cihdbchi.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0040d/Cihdbchi.html</span></a></span></p> 
<p align="left"><span style="color:#333333">ATPCS</span></p> 
<p align="left"><span style="color:#333333">About the ARM-ThumbProcedure Call Standard <a target="_blank" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0056d/Bcffcieh.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0056d/Bcffcieh.html</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">别名的烦恼</span></strong></p> 
<p align="left"><span style="color:#333333">arm</span><span style="color:#333333">体系的函数调用标准换了好几个版本，对寄存器的别名也是不一样。不同的调试器，或者它在不同的选项下，对同一个寄存器可能就有多种称呼。又或者你在调试器下看到的名称和书籍上的不一样。所以，又必要知道这些寄存器各自都有哪些别名。</span></p> 
<p align="left"><span style="color:#333333">我们运行下命令</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ arm-linux-gnueabi-objdump --help</span></p> 
 <p align="left"><span style="color:#333333">....</span><span style="color:#333333">省略</span></p> 
 <p align="left"><span style="color:#333333">The following ARM specific disassembleroptions are supported for use with</span></p> 
 <p align="left"><span style="color:#333333">the -M switch:</span></p> 
 <p align="left"><span style="color:#333333"> reg-names-special-atpcs  Selectspecial register names used in the ATPCS</span></p> 
 <p align="left"><span style="color:#333333"> reg-names-atpcs          Selectregister names used in the ATPCS</span></p> 
 <p align="left"><span style="color:#333333"> reg-names-apcs           Selectregister names used in the APCS</span></p> 
 <p align="left"><span style="color:#333333"> reg-names-std            Selectregister names used in ARM's ISA documentation</span></p> 
 <p align="left"><span style="color:#333333"> reg-names-gcc            Selectregister names used by GCC</span></p> 
 <p align="left"><span style="color:#333333"> reg-names-raw            Selectraw register names</span></p> 
 <p align="left"><span style="color:#333333"> force-thumb              Assumeall insns are Thumb insns</span></p> 
 <p align="left"><span style="color:#333333"> no-force-thumb           Examinepreceeding label to determine an insn's type</span></p> 
</div> 
<p align="left"><span style="color:#333333">我们下载它的源码打开看看</span></p> 
<p align="left"><span style="color:#333333">$ sudo apt-getsource binutils-arm-linux-gnueabi</span></p> 
<p align="left"><span style="color:#333333">完成后，在下载目录下多了几个东东，其中有一个文件夹binutils-2.18.1~cvs20080103</span>，这是debian对官方binutils进行过修改的源码。在里面搜索文件arm-dis.c，该文件中有以下这个数组。</p> 
<p align="left"><span style="color:#333333">就是不同标准下各个寄存器的不同别名。</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">static const arm_regname regnames[] =</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333"> { "raw" , "Select raw register names",</span></p> 
 <p align="left"><span style="color:#333333">   { "r0", "r1", "r2", "r3","r4", "r5", "r6", "r7", "r8","r9", "r10", "r11", "r12","r13", "r14", "r15"}},</span></p> 
 <p align="left"><span style="color:#333333"> { "gcc",  "Selectregister names used by GCC",</span></p> 
 <p align="left"><span style="color:#333333">   { "r0", "r1", "r2", "r3","r4", "r5", "r6", "r7", "r8","r9", "sl", "fp", "ip", "sp", "lr",  "pc"}},</span></p> 
 <p align="left"><span style="color:#333333"> { "std",  "Selectregister names used in ARM's ISA documentation",</span></p> 
 <p align="left"><span style="color:#333333">   { "r0", "r1", "r2", "r3","r4", "r5", "r6", "r7", "r8","r9", "r10", "r11", "r12","sp",  "lr",  "pc" }},</span></p> 
 <p align="left"><span style="color:#333333"> { "apcs", "Select register names used in the APCS",</span></p> 
 <p align="left"><span style="color:#333333">   { "a1", "a2", "a3", "a4","v1", "v2", "v3", "v4", "v5","v6", "sl", "fp",  "ip",  "sp",  "lr",  "pc" }},</span></p> 
 <p align="left"><span style="color:#333333"> { "atpcs", "Select register names used in theATPCS",</span></p> 
 <p align="left"><span style="color:#333333">   { "a1", "a2", "a3", "a4","v1", "v2", "v3", "v4", "v5","v6", "v7", "v8", "IP", "SP", "LR",  "PC"}},</span></p> 
 <p align="left"><span style="color:#333333"> { "special-atpcs", "Select special register names used inthe ATPCS",</span></p> 
 <p align="left"><span style="color:#333333">   { "a1", "a2", "a3", "a4","v1", "v2", "v3", "WR", "v5","SB", "SL", "FP", "IP", "SP", "LR",  "PC"}},</span></p> 
 <p align="left"><span style="color:#333333">};</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">但是可以看到，该列表并没有包含</span><span style="color:#333333">AAPCS</span><span style="color:#333333">标准，</span><span style="color:#333333">AAPCS</span><span style="color:#333333">标准对</span><span style="color:#333333"> r9 </span><span style="color:#333333">又引入了一个别名</span><span style="color:#333333"> TR</span><span style="color:#333333">，这样</span><span style="color:#333333">AAPCS</span><span style="color:#333333">下，</span><span style="color:#333333">r9</span><span style="color:#333333">使用了三个别名</span><span style="color:#333333">v6</span><span style="color:#333333">，</span><span style="color:#333333"> SB</span><span style="color:#333333">，</span><span style="color:#333333"> TR</span><span style="color:#333333">。选用哪个</span></p> 
 <p align="left"><span style="color:#333333">别名，是依赖于不同平台的选择。</span></p> 
</div> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">扩展，简要说明原理。并用实例解析]</span></p> 
<p align="left"><strong><span style="color:#333333">寄存器的角色与保护</span></strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">寄存器的角色(AAPCS</span>标准)</p> 
<table border="0" cellpadding="0"><tbody><tr><td style="background:#FFFFDD"> <p align="center"><strong>寄存器</strong></p> </td><td style="background:#FFFFDD"> <p align="center"><strong>可选寄存器名</strong></p> </td><td style="background:#FFFFDD"> <p align="center"><strong>特殊寄存器名</strong></p> </td><td style="background:#FFFFDD"> <p align="center"><strong>在函数调用中的角色</strong></p> </td></tr><tr><td> <p align="left">r15</p> </td><td> <p align="left">PC</p> </td><td> <p align="left">The Program Counter.</p> </td></tr><tr><td> <p align="left">r14</p> </td><td> <p align="left">LR</p> </td><td> <p align="left">The Link Register.</p> </td></tr><tr><td> <p align="left">r13</p> </td><td> <p align="left">SP</p> </td><td> <p align="left">The Stack Pointer.</p> </td></tr><tr><td> <p align="left">r12</p> </td><td> <p align="left">IP</p> </td><td> <p align="left">The Intra-Procedure-call scratch register.</p> </td></tr><tr><td> <p align="left">r11</p> </td><td> <p align="left">v8</p> </td><td> <p align="left">Variable-register 8.</p> </td></tr><tr><td> <p align="left">r10</p> </td><td> <p align="left">v7</p> </td><td> <p align="left">Variable-register 7.</p> </td></tr><tr><td> <p align="left">r9</p> </td><td> <p align="left">v6/SB/TR</p> </td><td> <p align="left">Platform register. The meaning of this register is defined by the platform standard</p> </td></tr><tr><td> <p align="left">r8</p> </td><td> <p align="left">v5</p> </td><td> <p align="left">Variable-register 5.</p> </td></tr><tr><td> <p align="left">r7</p> </td><td> <p align="left">v4</p> </td><td> <p align="left">Variable register 4.</p> </td></tr><tr><td> <p align="left">r6</p> </td><td> <p align="left">v3</p> </td><td> <p align="left">Variable register 3.</p> </td></tr><tr><td> <p align="left">r5</p> </td><td> <p align="left">v2</p> </td><td> <p align="left">Variable register 2.</p> </td></tr><tr><td> <p align="left">r4</p> </td><td> <p align="left">v1</p> </td><td> <p align="left">Variable register 1.</p> </td></tr><tr><td> <p align="left">r3</p> </td><td> <p align="left">a4</p> </td><td> <p align="left">Argument / scratch register 4.</p> </td></tr><tr><td> <p align="left">r2</p> </td><td> <p align="left">a3</p> </td><td> <p align="left">Argument / scratch register 3.</p> </td></tr><tr><td> <p align="left">r1</p> </td><td> <p align="left">a2</p> </td><td> <p align="left">Argument / result / scratch register 2.</p> </td></tr><tr><td> <p align="left">r0</p> </td><td> <p align="left">a1</p> </td><td> <p align="left">Argument / result / scratch register 1.</p> </td></tr></tbody></table> 
<p align="left"><span style="color:#333333">前四个寄存器r0-r3 (a1-a4)</span>用于传递参数给子函数或从函数中返回结果值。他们也可用于在一个函数中保存寄存器的值（但是，一般只用在子函数调用中）。</p> 
<p align="left"><span style="color:#333333">寄存器r12 (IP) </span>可在函数以及该函数调用的任何子函数中被链接器用作临时寄存器。它也可以在函数调用中用于保存寄存器的值。</p> 
<p align="left"><span style="color:#333333">寄存器r9</span>的角色是平台相关的。虚拟系统可能赋予该寄存器任何角色，因此必须说明它的用法。比如，在位置无关数据模型中它可以指定为static base(SB)，或者在带有本地线程存储的环境中指定它为threadregister(TR)。该寄存器的使用可能要求在所有调用过程前后，它保存的值必须不变。在一个不需要这样特殊寄存器的虚拟平台上，r9可以指定为新 增的callee-saved variableregister,v6.</p> 
<p align="left"><span style="color:#333333">通常，寄存器r4-r8, r10 </span>和 r11 (v1-v5, v7 和 v8)用于保存函数的本地变量。这些寄存器中，只有v1-v4能被整个thumb指令集一致地使用，但是AAPCS并没有规定Thumb代码只能使用这些寄存器。</p> 
<p align="left"><span style="color:#333333">子函数必须保护寄存器r4-r8,r10, r11 </span>和 SP(还有r9,如果在函数调用过程中r6被指定为v6的话)的值。</p> 
<p align="left"><span style="color:#333333">在所有的函数调用标准中，寄存器r12-r15</span>都扮演特殊的角色。依据这些角色，它们被标注为IP, SP, LR 和 PC。</p> 
<p align="left"><span style="color:#333333">寄存器CPSR</span>的属性（省）</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">寄存器保护规则</span></p> 
<p align="left"><span style="color:#333333">子函数必须保护寄存器r4-r8,r10, r11 </span>和 SP(还有r9,如果在函数调用过程中r6被指定为v6的话)的值。子函数调用</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">子函数调用</span></p> 
<p align="left"><span style="color:#333333">ARM </span><span style="color:#333333">和Thumb </span>指令集都有一个函数调用指令元语，BL,它执行branch-with-link操作。BL的执行效果是把紧跟程序计数器的下一个值－－也就是返回地址－－传送到链接寄存器(LR)，然后把目标地址传送到程序寄存器(PC)中。如果 BL指令是在Thumb状态下执行的，链接寄存器的Bit 0就设置为1;如果是在ARM状态下执行的，则设置为0。执行的结果是，把控制权转给目标地址，并把存放在LR中的返回地址作为附加的参数传递给了被调用的函数。</p> 
<p align="left"><span style="color:#333333">当返回地址装载到PC</span>时，控制就返回给跟随BL后面的指令。</p> 
<p align="left"><span style="color:#333333">子函数调用可以由具有下面效果的任何指令序列完成：</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">               LR[31:1] ← </span><span style="color:#333333">返回地址</span></p> 
 <p align="left"><span style="color:#333333">               LR[0] ← </span><span style="color:#333333">返回地址的代码类型</span><span style="color:#333333"> (0 ARM, 1 Thumb)</span></p> 
 <p align="left"><span style="color:#333333">               PC ← </span><span style="color:#333333">子函数地址</span></p> 
 <p align="left"><span style="color:#333333">      ...</span></p> 
 <p align="left"><span style="color:#333333">返回地址</span><span style="color:#333333">:</span></p> 
</div> 
<p align="left"><span style="color:#333333">例如，在ARM</span>状态中，调用由r4指定了地址的子函数</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">do:</span></p> 
 <p align="left"><span style="color:#333333">      MOVLR, PC</span></p> 
 <p align="left"><span style="color:#333333">      BX  r4</span></p> 
 <p align="left"><span style="color:#333333">      ...</span></p> 
</div> 
<p align="left"><span style="color:#333333">注意，相同的指令序列在Thumb</span>状态中将不能工作，因为设置LR的指令并没有拷贝Thumb 状态标志位到LR[0]中。</p> 
<p align="left"><span style="color:#333333">在ARM V5</span>架构中，ARM 和 Thumb指令集都提供了BLX指令，它将调用由一个寄存器指定了地址的子函数，并正确地设置返回地址为程序计数器的下一个值。</p> 
<p align="left"><strong><span style="color:#333333">条件执行</span></strong></p> 
<table border="0" cellpadding="0"><tbody><tr><td style="background:#FFFFDD"> <p align="center"><strong>操作码［31:28］</strong></p> </td><td style="background:#FFFFDD"> <p align="center"><strong>助记符扩展</strong></p> </td><td style="background:#FFFFDD"> <p align="center"><strong>解释</strong></p> </td><td style="background:#FFFFDD"> <p align="center"><strong>用于执行的标志位状态</strong></p> </td></tr><tr><td> <p align="left">0000</p> </td><td> <p align="center">EQ</p> </td><td> <p align="left">相等/等于0</p> </td><td> <p align="left">Z置位</p> </td></tr><tr><td> <p align="left">0001</p> </td><td> <p align="center">NE</p> </td><td> <p align="left">不等</p> </td><td> <p align="left">Z清0</p> </td></tr><tr><td> <p align="left">0010</p> </td><td> <p align="center">CS/HS</p> </td><td> <p align="left">进位/无符号数高于或等于</p> </td><td> <p align="left">C置位</p> </td></tr><tr><td> <p align="left">0011</p> </td><td> <p align="center">CC/LO</p> </td><td> <p align="left">无进位/无符号数小于</p> </td><td> <p align="left">C清0</p> </td></tr><tr><td> <p align="left">0100</p> </td><td> <p align="center">MI</p> </td><td> <p align="left">负数</p> </td><td> <p align="left">N置位</p> </td></tr><tr><td> <p align="left">0101</p> </td><td> <p align="center">PL</p> </td><td> <p align="left">正数或0</p> </td><td> <p align="left">N清0</p> </td></tr><tr><td> <p align="left">0110</p> </td><td> <p align="center">VS</p> </td><td> <p align="left">溢出</p> </td><td> <p align="left">V置位</p> </td></tr><tr><td> <p align="left">0111</p> </td><td> <p align="center">VC</p> </td><td> <p align="left">未溢出</p> </td><td> <p align="left">V清0</p> </td></tr><tr><td> <p align="left">1000</p> </td><td> <p align="center">HI</p> </td><td> <p align="left">无符号数高于</p> </td><td> <p align="left">C置位，Z清0</p> </td></tr><tr><td> <p align="left">1001</p> </td><td> <p align="center">LS</p> </td><td> <p align="left">无符号数小于或等于</p> </td><td> <p align="left">C清0,Z置位</p> </td></tr><tr><td> <p align="left">1010</p> </td><td> <p align="center">GE</p> </td><td> <p align="left">有符号数大于或等于</p> </td><td> <p align="left">N等于V</p> </td></tr><tr><td> <p align="left">1011</p> </td><td> <p align="center">LT</p> </td><td> <p align="left">有符号数小于</p> </td><td> <p align="left">N不等于V</p> </td></tr><tr><td> <p align="left">1100</p> </td><td> <p align="center">GT</p> </td><td> <p align="left">有符号数大于</p> </td><td> <p align="left">Z清0且N等于V</p> </td></tr><tr><td> <p align="left">1101</p> </td><td> <p align="center">LE</p> </td><td> <p align="left">有符号数小于或等于</p> </td><td> <p align="left">Z置位且N不等于V</p> </td></tr><tr><td> <p align="left">1110</p> </td><td> <p align="center">AL</p> </td><td> <p align="left">总是</p> </td><td> <p align="left">任何状态</p> </td></tr><tr><td> <p align="left">1111</p> </td><td> <p align="center">NV</p> </td><td> <p align="left">从不(未使用）</p> </td><td> <p align="left">无</p> </td></tr></tbody></table> 
<p align="left"><strong><span style="color:#333333">调用链的形成</span></strong></p> 
<p align="left"><span style="color:#333333">注意对比ARM</span>和X86在调用链形成的类似和区别之处。</p> 
<p align="left"><span style="color:#333333">区别，首先在寄存器的名称和角色的差异。</span></p> 
<p align="left"><span style="color:#333333">1. X86</span><span style="color:#333333">中寄存器%eip</span>指向的是下一个将要执行的指令。在ARM中也有个类似别名的寄存器ip。但这个寄存器ip的作用并不是指向的是下一个将要执行的指 令。在ARM中，寄存器pc才是起着X86中寄存器%eip的角色，也就是包含下一个将要执行指令的地址。而ARM中的ip寄存器，作用比较自由，类似干 杂工的人，一般用于临时寄存器。[扩展，引用权威手册的话]</p> 
<p align="left"><span style="color:#333333">2. X86</span><span style="color:#333333">中，返回地址是直接保存在栈中的。但是ARM</span>不一样了，它寄存器比X86多得多，财大气粗，所以，返回地址保存在了专用的寄存器lr(link register)中。但是，不要以为把返回地址放到专用的寄存器中会省事，其实反而多事了。因为，在调用函数刚执行完调用语句之时，lr保存的是子函数 的返回地址，而指令控制权转移到了子函数后，子函数照样可能调用自己的子函数，依次需要使用lr。所以自然也就有了lr的值的保存与恢复的问题，解决方法 还是要靠压栈解决。（参考下面的内容）</p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">我们知道，描述栈帧就是描述栈帧的基地址和顶端地址。在X86</span>中，用专用的寄存器%ebp保存栈基址，也就是base pointer；%esp保存栈顶端地址，也就是stack pointer。在ARM中，也有专用的寄存器保存栈顶端地址，就是SP(stack pointer的简称)。但是，在保存栈基址这方面，依据最新的AAPCS标准，ARM就很吝啬了，没有一个保存栈基址的专用寄存器。又不过呢，在 APCS和ATPCS标准中，有fp寄存器用于保存帧指针(frame pointer，也就是X86的base pointer)。在现在的编译器，可以看到，还是依照惯例把fp用于保存帧指针。既然如此，当然也有个入栈保存恢复的问题。</p> 
<p align="left"><span style="color:#333333">调用链包含两方面的内容，和X86</span>类似</p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">返回地址的保存与恢复</span></p> 
<p align="left"><span style="color:#333333">由调用函数在执行调用指令时把子函数的返回地址传送进连接寄存器lr</span>中，指令控制权转交给子函数后，再由子函数负责把上层函数的lr(也就是子函数的返回地址)保存到栈中。然后子函数在返回前的最后时刻，再负责把lr的保存值从栈弹回到lr中，从而恢复了上层函数的lr。这时还没完事，子函数在执行 返回指令时，由返回指令把lr的值传送到寄存器pc(Program Counter)，从而导致接下来的指令是从子函数的返回地址开始运行。这样，指令控制权就返回给了调用函数。</p> 
<p align="left"><span style="color:#333333">我们应当注意到，ARM</span>中调用指令也是多种多样的。有b,bl,bx,bxl。如果调用指令是不带连接的指令，比如b,bx,这时就要人工给lr赋 值。不过为了简便，我不再区分这两类指令，而把实现跳转和连接以及可能的换态这些功能的整个指令序列为“调用指令”，相关区别参考指令手册。在ARM中， 返回指令和调用指令都是同一套的。而X86，调用用call,返回用ret。</p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">旧栈帧的保存与恢复</span></p> 
<p align="left"><span style="color:#333333">对比X86</span>栈帧的保存与恢复的方式，ARM的更加简单直接。就是直接把上一栈帧的帧指针（frame pointer，也就是栈帧基地址）以及栈顶端指针sp(stack pointer)压入栈中。子函数返回时，在执行返回指令之前的最后关头才从栈弹出fp和sp的值，从而恢复旧栈帧。这个过程真的没有遗漏了吗？我们看 下，上面的步骤保证了调用函数的栈帧不被破坏，但是子函数自己的栈帧却没有建立起来呢。首先是帧指针需要人赋值。这个情形和X86非常相似。子函数在使用 栈帧之前，把上层函数的栈顶端指针sp赋给一个临时寄存器ip，然后在旧fp的值被压栈保存之后，把ip的值减去4，再赋给帧指针寄存器fp，此时，fp 就指向了新栈帧的基址。这是因为，新栈帧基地址刚好位于旧栈帧栈顶之下，地址低了4字节。其次，子函数栈帧的栈顶指针sp也是要考虑的，根据压栈指令的不 同，sp可能不需要人工维护，也可能需要人工维护［有疑问...????］。</p> 
<p align="left"><span style="color:#333333">我们还注意到，在X86</span>中，子函数的栈帧的底端（也就是%ebp所指的内存位置)存放着上一层栈帧的基址指针(旧%ebp)的值，一层层下去，这样 就形成回溯的链条。那么，在ARM之下，也是靠子函数的栈帧的底端提供回溯的能力的吗？当然不是。实际上子函数的栈帧的基址位置存放的是什么，这无所谓 的。</p> 
<p align="left"><span style="color:#333333">［疑问？？？如果旧fp</span>保存在新栈帧中的位置不是固定的，那么调试器是如何做到栈帧回溯的呢？］</p> 
<p align="left"><span style="color:#333333">根据AAPCS</span>标准的规定，子函数必须保护寄存器r4-r8, r10, r11 和 SP(还有r9,如果在函数调用过程中r6被指定为v6的话)的值。注意，它用的字眼是“保护”，而不是“保存”。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">应用层实例解析</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void func()</span></p> 
 <p align="left"><span style="color:#333333">{}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void funb()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       func();</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void funa()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       funb();</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       funa();</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333">-----------</span></p> 
 <p align="left"><span style="color:#333333">000083b0 &lt;func&gt;:</span></p> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void func()</span></p> 
 <p align="left"><span style="color:#333333">{}</span></p> 
 <p align="left"><span style="color:#333333">   83b0:       e1a0c00d        mov    ip, sp</span></p> 
 <p align="left"><span style="color:#333333">   83b4:       e92dd800        push   {fp, ip, lr, pc}</span></p> 
 <p align="left"><span style="color:#333333">   83b8:       e24cb004        sub    fp, ip, #4      ; 0x4</span></p> 
 <p align="left"><span style="color:#333333">   83bc:       e24bd00c        sub    sp, fp, #12     ; 0xc</span></p> 
 <p align="left"><span style="color:#333333">   83c0:       e89d6800        ldm    sp, {fp, sp, lr}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   83c4:       e12fff1e        bx     lr</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">000083c8 &lt;funb&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void funb()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">   83c8:       e1a0c00d        mov    ip, sp</span></p> 
 <p align="left"><span style="color:#333333">   83cc:       e92dd800        push   {fp, ip, lr, pc}</span></p> 
 <p align="left"><span style="color:#333333">   83d0:       e24cb004        sub    fp, ip, #4      ; 0x4</span></p> 
 <p align="left"><span style="color:#333333">       func();</span></p> 
 <p align="left"><span style="color:#333333">   83d4:       ebfffff5        bl     83b0 &lt;func&gt;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333">   83d8:       e24bd00c        sub    sp, fp, #12     ; 0xc</span></p> 
 <p align="left"><span style="color:#333333">   83dc:       e89d6800        ldm    sp, {fp, sp, lr}</span></p> 
 <p align="left"><span style="color:#333333">   83e0:       e12fff1e        bx     lr</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">000083e4 &lt;funa&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">void funa()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   83e4:       e1a0c00d        mov    ip, sp</span></p> 
 <p align="left"><span style="color:#333333">   83e8:       e92dd800        push   {fp, ip, lr, pc}</span></p> 
 <p align="left"><span style="color:#333333">   83ec:       e24cb004        sub    fp, ip, #4      ; 0x4</span></p> 
 <p align="left"><span style="color:#333333">       funb();</span></p> 
 <p align="left"><span style="color:#333333">   83f0:       ebfffff4        bl     83c8 &lt;funb&gt;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333">   83f4:       e24bd00c        sub    sp, fp, #12     ; 0xc</span></p> 
 <p align="left"><span style="color:#333333">   83f8:       e89d6800        ldm    sp, {fp, sp, lr}</span></p> 
 <p align="left"><span style="color:#333333">   83fc:       e12fff1e        bx     lr</span></p> 
 <p align="left"><span style="color:#333333">00008400 &lt;main&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">   8400:       e1a0c00d        mov    ip, sp</span></p> 
 <p align="left"><span style="color:#333333">   8404:       e92dd800        push   {fp, ip, lr, pc}</span></p> 
 <p align="left"><span style="color:#333333">   8408:       e24cb004        sub    fp, ip, #4      ; 0x4</span></p> 
 <p align="left"><span style="color:#333333">       funa();</span></p> 
 <p align="left"><span style="color:#333333">   840c:       ebfffff4        bl     83e4 &lt;funa&gt;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333">   8410:       e24bd00c        sub     sp, fp, #12     ; 0xc</span></p> 
 <p align="left"><span style="color:#333333">   8414:       e89d6800        ldm    sp, {fp, sp, lr}</span></p> 
 <p align="left"><span style="color:#333333">   8418:       e12fff1e        bx     lr</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">内核层实例解析</span></p> 
<p align="left"><strong><span style="color:#333333">栈帧结构与参数传递</span></strong></p> 
<p align="left"><span style="color:#333333">[1.</span><span style="color:#333333">栈:</span>栈对齐，栈限制。2.参数传递：variadic函数，nonvariadic函数。3.结果的返回 4.互交代码(ARM-Thumbinterworking)]</p> 
<p align="left"><span style="color:#333333">栈帧示意图</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">                        +------------------------------ + ---------</span></p> 
 <p align="left"><span style="color:#333333">                        |  Register Save Area           |        | </span></p> 
 <p align="left"><span style="color:#333333">                       +------------------------------ +       | </span></p> 
 <p align="left"><span style="color:#333333">                        | Locals andTemporaries        |        | </span></p> 
 <p align="left"><span style="color:#333333">                       +------------------------------+          </span></p> 
 <p align="left"><span style="color:#333333">                        |     alloca() Locals           |    Caller's Frame</span></p> 
 <p align="left"><span style="color:#333333">                       +------------------------------ +          </span></p> 
 <p align="left"><span style="color:#333333">                        | Incoming Args Past FourWords |        | </span></p> 
 <p align="left"><span style="color:#333333">                       +------------------------------ + ---------</span></p> 
 <p align="left"><span style="color:#333333">                        | First Four Words OfArgs      |        | </span></p> 
 <p align="left"><span style="color:#333333">      Frame Pointer--&gt; +------------------------------ +        |</span></p> 
 <p align="left"><span style="color:#333333">                        |  Register Save Area           |        | </span></p> 
 <p align="left"><span style="color:#333333">                       +------------------------------ +     Current Frame</span></p> 
 <p align="left"><span style="color:#333333">                        | Locals andTemporaries        |         </span></p> 
 <p align="left"><span style="color:#333333">                       +------------------------------ +       |   </span></p> 
 <p align="left"><span style="color:#333333">                       |   alloca() Locals             |        | </span></p> 
 <p align="left"><span style="color:#333333">                       +------------------------------ +       | </span></p> 
 <p align="left"><span style="color:#333333">                        | Outgoing Args PastFour Words |        | </span></p> 
 <p align="left"><span style="color:#333333">     Stack Pointer---&gt; +------------------------------ + ---------</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">完整的调用过程</span></strong></p> 
<p align="left"><span style="color:#333333">函数caller</span>调用子函数callee，这是应用层的普通函数调用过程。如果是远调用，跨态调用要考虑的东西更多。但这个例子已经充分展示了调用过程的繁复部分。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">函数调用前调用者的动作</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">函数调用 call callee</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">函数调用后被调用者的动作</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">调用返回前被调用者的动作</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">调用返回后调用者的动作</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">应用层实例解析</span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">内核层实例解析</span></p> 
<p align="left"><strong><span style="color:#333333">调用链回溯的实现</span></strong></p> 
<p align="left"><span style="color:#333333">arm</span><span style="color:#333333">体系对调用链的回溯的代码实现主要在</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">arch/arm/kernel/traps.c </span><span style="color:#333333">和</span><span style="color:#333333">arch/arm/lib/backtrace.S.</span><span style="color:#333333">其中核心函数是</span><span style="color:#333333">backtrace.S</span><span style="color:#333333">中的</span><span style="color:#333333">__backtrace</span><span style="color:#333333">函数。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">待解释</span></p> 
 <p align="left"><span style="color:#333333">---/*</span></p> 
 <p align="left"><span style="color:#333333"> * linux/arch/arm/lib/backtrace.S</span></p> 
 <p align="left"><span style="color:#333333"> *</span></p> 
 <p align="left"><span style="color:#333333"> * Copyright (C) 1995, 1996 Russell King</span></p> 
 <p align="left"><span style="color:#333333"> *</span></p> 
 <p align="left"><span style="color:#333333"> *This program is free software; you can redistribute it and/or modify</span></p> 
 <p align="left"><span style="color:#333333"> *it under the terms of the GNU General Public License version 2 as</span></p> 
 <p align="left"><span style="color:#333333"> *published by the Free Software Foundation.</span></p> 
 <p align="left"><span style="color:#333333"> *</span></p> 
 <p align="left"><span style="color:#333333"> *27/03/03 Ian Molton Clean up CONFIG_CPU</span></p> 
 <p align="left"><span style="color:#333333"> *</span></p> 
 <p align="left"><span style="color:#333333"> */</span></p> 
 <p align="left"><span style="color:#333333">#include &lt;linux/linkage.h&gt;</span></p> 
 <p align="left"><span style="color:#333333">#include &lt;asm/assembler.h&gt;</span></p> 
 <p align="left"><span style="color:#333333">               .text</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">@ fp is 0 or stack frame</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">#define frame  r4</span></p> 
 <p align="left"><span style="color:#333333">#define sv_fp  r5</span></p> 
 <p align="left"><span style="color:#333333">#define sv_pc  r6</span></p> 
 <p align="left"><span style="color:#333333">#define mask   r7</span></p> 
 <p align="left"><span style="color:#333333">#define offset r8</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">ENTRY(__backtrace)</span></p> 
 <p align="left"><span style="color:#333333">               mov      r1, #0x10</span></p> 
 <p align="left"><span style="color:#333333">               mov      r0, fp</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">ENTRY(c_backtrace)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">#if !defined(CONFIG_FRAME_POINTER) ||!defined(CONFIG_PRINTK)</span></p> 
 <p align="left"><span style="color:#333333">               mov      pc, lr</span></p> 
 <p align="left"><span style="color:#333333">ENDPROC(__backtrace)</span></p> 
 <p align="left"><span style="color:#333333">ENDPROC(c_backtrace)</span></p> 
 <p align="left"><span style="color:#333333">#else</span></p> 
 <p align="left"><span style="color:#333333">               stmfd    sp!, {r4 - r8, lr}        @ Save an extra register so we have a location...</span></p> 
 <p align="left"><span style="color:#333333">               movs     frame, r0                 @if frame pointer is zero</span></p> 
 <p align="left"><span style="color:#333333">               beq      no_frame         @we have no stack frames</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               tst      r1, #0x10                 @26 or 32-bit mode?</span></p> 
 <p align="left"><span style="color:#333333">               moveq    mask, #0xfc000003 @ mask for 26-bit</span></p> 
 <p align="left"><span style="color:#333333">               movne    mask, #0         @mask for 32-bit</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">1:             stmfd    sp!, {pc}                 @calculate offset of PC stored</span></p> 
 <p align="left"><span style="color:#333333">               ldr      r0, [sp], #4              @ by stmfd for this CPU</span></p> 
 <p align="left"><span style="color:#333333">               adr      r1, 1b</span></p> 
 <p align="left"><span style="color:#333333">               sub      offset, r0, r1</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">/*</span></p> 
 <p align="left"><span style="color:#333333"> *Stack frame layout:</span></p> 
 <p align="left"><span style="color:#333333"> *            optionally saved caller registers (r4 - r10)</span></p> 
 <p align="left"><span style="color:#333333"> *            saved fp</span></p> 
 <p align="left"><span style="color:#333333"> *            saved sp</span></p> 
 <p align="left"><span style="color:#333333"> *            saved lr</span></p> 
 <p align="left"><span style="color:#333333"> *   frame =&gt; saved pc</span></p> 
 <p align="left"><span style="color:#333333"> *            optionally saved arguments (r0 - r3)</span></p> 
 <p align="left"><span style="color:#333333"> *saved sp =&gt; &lt;next word&gt;</span></p> 
 <p align="left"><span style="color:#333333"> *</span></p> 
 <p align="left"><span style="color:#333333"> *Functions start with the following code sequence:</span></p> 
 <p align="left"><span style="color:#333333"> *                  mov   ip, sp</span></p> 
 <p align="left"><span style="color:#333333"> *                  stmfd sp!, {r0 - r3}(optional)</span></p> 
 <p align="left"><span style="color:#333333"> *corrected pc =&gt;  stmfd sp!, {..., fp,ip, lr, pc}</span></p> 
 <p align="left"><span style="color:#333333"> */</span></p> 
 <p align="left"><span style="color:#333333">for_each_frame:        tst      frame, mask               @ Check for address exceptions</span></p> 
 <p align="left"><span style="color:#333333">               bne      no_frame</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">1001:          ldr      sv_pc, [frame, #0]        @ get saved pc</span></p> 
 <p align="left"><span style="color:#333333">1002:          ldr      sv_fp, [frame, #-12]      @ get saved fp</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               sub      sv_pc, sv_pc, offset      @ Correct PC for prefetching</span></p> 
 <p align="left"><span style="color:#333333">               bic      sv_pc, sv_pc, mask        @ mask PC/LR for the mode</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">1003:          ldr      r2, [sv_pc, #-4] @ if stmfd sp!, {args} exists,</span></p> 
 <p align="left"><span style="color:#333333">               ldr      r3, .Ldsi+4               @ adjust saved 'pc' back one</span></p> 
 <p align="left"><span style="color:#333333">               teq      r3, r2, lsr #10           @ instruction</span></p> 
 <p align="left"><span style="color:#333333">               subne    r0, sv_pc, #4             @ allow for mov</span></p> 
 <p align="left"><span style="color:#333333">               subeq    r0, sv_pc, #8             @ allow for mov + stmia</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               ldr      r1, [frame, #-4] @ get saved lr</span></p> 
 <p align="left"><span style="color:#333333">               mov      r2, frame</span></p> 
 <p align="left"><span style="color:#333333">               bic      r1, r1, mask              @ mask PC/LR for the mode</span></p> 
 <p align="left"><span style="color:#333333">               bl       dump_backtrace_entry</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               ldr      r1, [sv_pc, #-4] @ if stmfd sp!, {args} exists,</span></p> 
 <p align="left"><span style="color:#333333">               ldr      r3, .Ldsi+4</span></p> 
 <p align="left"><span style="color:#333333">               teq      r3, r1, lsr #10</span></p> 
 <p align="left"><span style="color:#333333">               ldreq    r0, [frame, #-8] @ get sp</span></p> 
 <p align="left"><span style="color:#333333">               subeq    r0, r0, #4                @point at the last arg</span></p> 
 <p align="left"><span style="color:#333333">               bleq     .Ldumpstm                 @dump saved registers</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">1004:          ldr      r1, [sv_pc, #0]           @ if stmfd sp!, {..., fp, ip, lr, pc}</span></p> 
 <p align="left"><span style="color:#333333">               ldr      r3, .Ldsi                 @instruction exists,</span></p> 
 <p align="left"><span style="color:#333333">               teq      r3, r1, lsr #10</span></p> 
 <p align="left"><span style="color:#333333">               subeq    r0, frame, #16</span></p> 
 <p align="left"><span style="color:#333333">               bleq     .Ldumpstm                 @dump saved registers</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               teq      sv_fp, #0                 @zero saved fp means</span></p> 
 <p align="left"><span style="color:#333333">               beq      no_frame         @no further frames</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               cmp      sv_fp, frame              @ next frame must be</span></p> 
 <p align="left"><span style="color:#333333">               mov      frame, sv_fp              @ above the current frame</span></p> 
 <p align="left"><span style="color:#333333">               bhi      for_each_frame</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">1006:          adr      r0, .Lbad</span></p> 
 <p align="left"><span style="color:#333333">               mov      r1, frame</span></p> 
 <p align="left"><span style="color:#333333">               bl       printk</span></p> 
 <p align="left"><span style="color:#333333">no_frame:      ldmfd    sp!, {r4 - r8,pc}</span></p> 
 <p align="left"><span style="color:#333333">ENDPROC(__backtrace)</span></p> 
 <p align="left"><span style="color:#333333">ENDPROC(c_backtrace)</span></p> 
 <p align="left"><span style="color:#333333">               </span></p> 
 <p align="left"><span style="color:#333333">               .section__ex_table,"a"</span></p> 
 <p align="left"><span style="color:#333333">               .align   3</span></p> 
 <p align="left"><span style="color:#333333">               .long    1001b, 1006b</span></p> 
 <p align="left"><span style="color:#333333">               .long    1002b, 1006b</span></p> 
 <p align="left"><span style="color:#333333">               .long    1003b, 1006b</span></p> 
 <p align="left"><span style="color:#333333">               .long    1004b, 1006b</span></p> 
 <p align="left"><span style="color:#333333">               .previous</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">#define instr r4</span></p> 
 <p align="left"><span style="color:#333333">#define reg   r5</span></p> 
 <p align="left"><span style="color:#333333">#define stack r6</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">.Ldumpstm:     stmfd    sp!, {instr, reg,stack, r7, lr}</span></p> 
 <p align="left"><span style="color:#333333">               mov      stack, r0</span></p> 
 <p align="left"><span style="color:#333333">               mov      instr, r1</span></p> 
 <p align="left"><span style="color:#333333">               mov      reg, #10</span></p> 
 <p align="left"><span style="color:#333333">               mov      r7, #0</span></p> 
 <p align="left"><span style="color:#333333">1:             mov      r3, #1</span></p> 
 <p align="left"><span style="color:#333333">               tst      instr, r3, lsl reg</span></p> 
 <p align="left"><span style="color:#333333">               beq      2f</span></p> 
 <p align="left"><span style="color:#333333">               add      r7, r7, #1</span></p> 
 <p align="left"><span style="color:#333333">               teq      r7, #6</span></p> 
 <p align="left"><span style="color:#333333">               moveq    r7, #1</span></p> 
 <p align="left"><span style="color:#333333">               moveq    r1, #'\n'</span></p> 
 <p align="left"><span style="color:#333333">               movne    r1, #' '</span></p> 
 <p align="left"><span style="color:#333333">               ldr      r3, [stack], #-4</span></p> 
 <p align="left"><span style="color:#333333">               mov      r2, reg</span></p> 
 <p align="left"><span style="color:#333333">               adr      r0, .Lfp</span></p> 
 <p align="left"><span style="color:#333333">               bl       printk</span></p> 
 <p align="left"><span style="color:#333333">2:             subs     reg, reg, #1</span></p> 
 <p align="left"><span style="color:#333333">               bpl      1b</span></p> 
 <p align="left"><span style="color:#333333">               teq      r7, #0</span></p> 
 <p align="left"><span style="color:#333333">               adrne    r0, .Lcr</span></p> 
 <p align="left"><span style="color:#333333">               blne     printk</span></p> 
 <p align="left"><span style="color:#333333">               ldmfd    sp!, {instr, reg, stack, r7, pc}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">.Lfp:          .asciz   "%cr%d:%08x"</span></p> 
 <p align="left"><span style="color:#333333">.Lcr:          .asciz   "\n"</span></p> 
 <p align="left"><span style="color:#333333">.Lbad:                 .asciz   "Backtrace aborted due to bad framepointer &lt;%p&gt;\n"</span></p> 
 <p align="left"><span style="color:#333333">               .align</span></p> 
 <p align="left"><span style="color:#333333">.Ldsi:                 .word    0xe92dd800 &gt;&gt; 10 @ stmfd sp!, {... fp, ip, lr, pc}</span></p> 
 <p align="left"><span style="color:#333333">               .word    0xe92d0000 &gt;&gt; 10 @ stmfd sp!, {}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">#endif</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">源码浏览工具</span></strong></p> 
<p align="left"><span style="color:#333333">本节意义： 内核源码的代码量越来越大，不借助源码交叉索引工具根本是无法阅读了。一定要熟练灵活掌握此类工具的使用</span></p> 
<p align="left"><strong><span style="color:#333333">调用图生成工具</span></strong></p> 
<p align="left"><span style="color:#333333">1.CodeViz</span></p> 
<p align="left"><span style="color:#333333">官网：</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.csn.ul.ie/~mel/projects/codeviz/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.csn.ul.ie/~mel/projects/codeviz/</span></a></span></p> 
<p align="left"><span style="color:#333333">安装使用：</span></p> 
<p align="left"><span style="color:#333333">CodeViz </span><span style="color:#333333">—— 一款分析C_C++</span>源代码中函数调用关系的调用图生成工具.pdf</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://linux.chinaunix.net/bbs/thread-1031921-1-1.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://linux.chinaunix.net/bbs/thread-1031921-1-1.html</span></a></span></p> 
<p align="left"><span style="color:#333333">用CodeViz</span>产生函数调用图</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://barry-popy.blog.sohu.com/31629163.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://barry-popy.blog.sohu.com/31629163.html</span></a></span></p> 
<p align="left"><span style="color:#333333">分析函数调用关系图(callgraph)</span>的几种方法</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://blog.csdn.net/Solstice/archive/2005/09/24/488865.aspx" rel="noopener noreferrer"><span style="color:#FF8373">http://blog.csdn.net/Solstice/archive/2005/09/24/488865.aspx</span></a></span></p> 
<p align="left"><span style="color:#333333">用CodeViz</span>绘制函数调用关系图(call graph)</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://blog.csdn.net/Solstice/archive/2005/09/22/486788.aspx" rel="noopener noreferrer"><span style="color:#FF8373">http://blog.csdn.net/Solstice/archive/2005/09/22/486788.aspx</span></a></span></p> 
<p align="left"><span style="color:#333333">2.ncc</span></p> 
<p align="left"><strong><span style="color:#333333">find + grep</span></strong></p> 
<p align="left"><span style="color:#333333">对于源码的阅读工具，一般是选取后面提到的某种源码索引工具，再和find</span>以及grep“高低搭配”一起来使用。</p> 
<p align="left"><span style="color:#333333">1.</span><span style="color:#333333">命令选项</span></p> 
<p align="left"><span style="color:#333333">2.</span><span style="color:#333333">正则表达式</span></p> 
<p align="left"><span style="color:#333333">Regular ExpressionHOWTO</span><span style="color:#333333">： <a target="_blank" href="http://www.amk.ca/python/howto/regex/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.amk.ca/python/howto/regex/</span></a></span></p> 
<p align="left"><span style="color:#333333">正则表达式之道： <a target="_blank" href="http://net.pku.edu.cn/~yhf/tao_regexps_zh.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://net.pku.edu.cn/~yhf/tao_regexps_zh.html</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">wine + SI</span></strong></p> 
<p align="left"><span style="color:#333333">wine + sourceinsight</span></p> 
<p align="left"><strong><span style="color:#333333">优缺点</span></strong></p> 
<p align="left"><span style="color:#333333">优点： SI</span>的特点是有图形界面，操作和浏览特别方便快捷。特别是它的“函数调用树”的图形显示功能，以及分窗口自动显示函数，变量等定义的功能。</p> 
<p align="left"><span style="color:#333333">缺点： 不能解析汇编源文件。</span></p> 
<p align="left"><strong><span style="color:#333333">安装wine</span></strong></p> 
<p align="left"><span style="color:#333333">在ubuntu/debian</span>下用以下命令就能在线安装wine</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ sudo apt-get install wine</span></p> 
</div> 
<p align="left"><span style="color:#333333">安装好后，就能看到wine</span>的快捷菜单被添加到了任务栏的“应用程序”中。</p> 
<p align="left"><strong><span style="color:#333333">安装SI</span></strong></p> 
<p align="left"><span style="color:#333333">wine</span><span style="color:#333333">安装好后，就可以像在windows</span>一样去安装使用SI了。安装完成后，SI的快捷菜单被添加到“应用程序”→“wine”→“programs”→“source insight3”中。以后用快捷菜单就能启动SI</p> 
<p align="left"><strong><span style="color:#333333">SI</span><span style="color:#333333">的设置</span></strong></p> 
<p align="left"><span style="color:#333333">字体，颜色就不说了。现在加入 无名小卒 大侠发现的一个有用设置。</span></p> 
<p align="left"><span style="color:#333333">preferences</span><span style="color:#333333">→display</span>→ trim long path names with ellipses. 去掉该选项的选择。这样就能直接在上下两个分窗口的标题栏上看到一个源文件的全路径。如果不去掉的话，对于长路径它会用...的形式来表示路径的一部分。</p> 
<p align="left"><strong><span style="color:#333333">SI</span><span style="color:#333333">的使用</span></strong></p> 
<p align="left"><span style="color:#333333">可以乱点乱试一下，它能提供很多的功能。其中一些经常要到的功能有 查找符号；函数调用的函数，被调用的函数；以及调用关系的多层展开显示；字符串搜索等。</span></p> 
<p align="left"><strong><span style="color:#333333">global</span></strong></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">待玩] <a target="_blank" href="http://www.gnu.org/software/global/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.gnu.org/software/global/</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">Source-Navigator</span></strong></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">待玩] <a target="_blank" href="http://sourcenav.sourceforge.net/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourcenav.sourceforge.net/</span></a></span></p> 
<p align="left"><span style="color:#333333">安装：</span></p> 
<p align="left"><span style="color:#333333">在ubuntu</span>下可以在线安装</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ sudo apt-get install sourcenav</span></p> 
</div> 
<p align="left"><span style="color:#333333">运行：</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ snavigator</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">vim + cscope/ctags</span></strong></p> 
<p align="left"><span style="color:#333333">参考：</span></p> 
<p align="left"><span style="color:#333333">cscope</span><span style="color:#333333">的官方教程 “The Vim/Cscope tutorial</span>”：</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://cscope.sourceforge.net/cscope_vim_tutorial.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://cscope.sourceforge.net/cscope_vim_tutorial.html</span></a></span></p> 
<p align="left"><span style="color:#333333">对应的中文翻译： <a target="_blank" href="http://www.gracecode.com/Archive/Display/316" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.gracecode.com/Archive/Display/316</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.lupaworld.com/?uid-151392-action-viewspace-itemid-106656" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.lupaworld.com/?uid-151392-action-viewspace-itemid-106656</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://dev.21tx.com/2007/02/21/10252.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://dev.21tx.com/2007/02/21/10252.html</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">优缺点</span></strong></p> 
<p align="left"><span style="color:#333333">优点： 本人感觉在终端下看源码比较舒服。</span></p> 
<p align="left"><span style="color:#333333">缺点： 没有一个实时显示函数/</span>变量定义的分窗口。也不能直接显示“调用树”，但有其他小工具可以实现该功能。也许vim高手能解决这些问题。</p> 
<p align="left"><strong><span style="color:#333333">安装cscope/ctags</span></strong></p> 
<p align="left"><span style="color:#333333">ubuntu/debian</span><span style="color:#333333">下用以下命令就能在线安装</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$ sudo apt-get install cscope ctags</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">命令选项</span></strong></p> 
<p align="left"><span style="color:#333333">在终端下可以用 man info </span>–help等形式查看cscope/ctags的手册</p> 
<p align="left"><span style="color:#333333">在vim</span>下查看手册的方式是</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">:help cscope</span></p> 
 <p align="left"><span style="color:#333333">和</span></p> 
 <p align="left"><span style="color:#333333">:help ctags</span></p> 
</div> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">以下是cscope</span>建立索引文件用到的一些选项</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">-R: </span><span style="color:#333333">在生成索引文件时，搜索子目录树中的代码</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">-b: </span><span style="color:#333333">只生成索引文件，不进入</span><span style="color:#333333">cscope</span><span style="color:#333333">的界面</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">-q: </span><span style="color:#333333">生成</span><span style="color:#333333">cscope.in.out</span><span style="color:#333333">和</span><span style="color:#333333">cscope.po.out</span><span style="color:#333333">文件，加快</span><span style="color:#333333">cscope</span><span style="color:#333333">的索引速度</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">-k: </span><span style="color:#333333">在生成索引文件时，不搜索</span><span style="color:#333333">/usr/include</span><span style="color:#333333">目录</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">-i: </span><span style="color:#333333">如果保存文件列表的文件名不是</span><span style="color:#333333">cscope.files</span><span style="color:#333333">时，需要加此选项告诉</span><span style="color:#333333">cscope</span><span style="color:#333333">到哪儿去找源文件列表。可以使用</span><span style="color:#333333">“-”</span><span style="color:#333333">，表示由标准输入获得文件列表。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">-I dir: </span><span style="color:#333333">在</span><span style="color:#333333">-I</span><span style="color:#333333">选项指出的目录中查找头文件</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">-u: </span><span style="color:#333333">扫描所有文件，重新生成交叉索引文件</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">-C: </span><span style="color:#333333">在搜索时忽略大小写</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">-P path: </span><span style="color:#333333">在以相对路径表示的文件前加上的</span><span style="color:#333333">path</span><span style="color:#333333">，这样，你不用切换到你数据库文件所在的目录也可以使用它了。</span></p> 
</div> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">在vim</span>下利用:cscope find &lt;关键字&gt; 命令的选项有</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">s: </span><span style="color:#333333">查找</span><span style="color:#333333">C</span><span style="color:#333333">语言符号，即查找函数名、宏、枚举值等出现的地方</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">g: </span><span style="color:#333333">查找函数、宏、枚举等定义的位置，类似</span><span style="color:#333333">ctags</span><span style="color:#333333">所提供的功能</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">d: </span><span style="color:#333333">查找本函数调用的函数</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">c: </span><span style="color:#333333">查找调用本函数的函数</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">t: </span><span style="color:#333333">查找指定的字符串</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">e: </span><span style="color:#333333">查找</span><span style="color:#333333">egrep</span><span style="color:#333333">模式，相当于</span><span style="color:#333333">egrep</span><span style="color:#333333">功能，但查找速度快多了</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">f: </span><span style="color:#333333">查找并打开文件，类似</span><span style="color:#333333">vim</span><span style="color:#333333">的</span><span style="color:#333333">find</span><span style="color:#333333">功能</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">i: </span><span style="color:#333333">查找包含本文件的文</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">使用</span></strong></p> 
<p align="left"><strong><span style="color:#333333">建立索引</span></strong></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">可能要修改]</span></p> 
<p align="left"><span style="color:#333333">用以下命令先产生一个文件列表，然后让cscope</span>为这个列表中的每个文件都生成索引。在这里，我们只关注.h, .c, .S文件，所以只对他们进行索引。可以根据自己需求进行更改。接着我们用-bq选项利用cscope生成索引。选项意义见上节。同时也生成ctags索 引。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#!/bin/sh</span></p> 
 <p align="left"><span style="color:#333333">find . -name "*.h" -o -name"*.c" -o -name "*.S" &gt; cscope.files</span></p> 
 <p align="left"><span style="color:#333333">cscope -bkq -i cscope.files</span></p> 
 <p align="left"><span style="color:#333333">ctags -R</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">利用vim</span>浏览源码</strong></p> 
<p align="left"><span style="color:#333333">切换到内核源码的目录上，运行vim</span>，然后在vim下导入索引</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$vim</span></p> 
 <p align="left"><span style="color:#333333">:cscope add cscope.out</span></p> 
</div> 
<p align="left"><span style="color:#333333">然后就可以在vim</span>下调用“:cscope find &lt;关键字&gt;”来查找函数的定义，函数调用的函数以及被调用函数等</p> 
<p align="left"><span style="color:#333333">“:cscope find &lt;</span>关键字&gt;” 可以缩写为 “:cs f &lt;关键字&gt;”</p> 
<p align="left"><span style="color:#333333">比如以下命令用来查找sys_read</span>的定义</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">:cs f g sys_read</span></p> 
</div> 
<p align="left"><span style="color:#333333">“cs f</span>”的其他命令选项请看上节</p> 
<p align="left"><strong><span style="color:#333333">快捷键的使用</span></strong></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">ctrl + t : </span><span style="color:#333333">退回</span></p> 
 <p align="left"><span style="color:#333333">ctrl + ] : </span><span style="color:#333333">进入光标处的变量</span><span style="color:#333333">/</span><span style="color:#333333">函数的定义处</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">kscope</span></strong></p> 
<p align="left"><span style="color:#333333">kscope</span><span style="color:#333333">是cscope</span>的图形前端工具。在ubuntu下可以在线安装。它的界面上和操作上与source insight都比较类似。但是目前它对cpu的占用很大，不是很好。但是它和cscope相比，有一个很大的优点是：可以图形显示“函数调用树”，甚至这个功能比SI还强大。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">$sudo apt-get install kscope</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">lxr</span></strong></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">优缺点</span></p> 
<p align="left"><span style="color:#333333">优点：本身好像没什么特别的优点。但是有专门提供这种服务的网站，上面有很多不同系统的不同版本源码</span></p> 
<p align="left"><span style="color:#333333">缺点：在本机上配置运行的话，配置麻烦。如果是浏览lxr</span>站点的方式，速度比较慢。</p> 
<p align="left"><span style="color:#333333">2. lxr</span><span style="color:#333333">官方： <a target="_blank" href="http://lxr.linux.no/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://lxr.linux.no/</span></a></span></p> 
<p align="left"><span style="color:#333333">特点是可以浏览历史上linux</span>所有版本的源码，可以看到它的演化过程。</p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">其他系统的源码 <a target="_blank" href="http://fxr.watson.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://fxr.watson.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">估计超一流的内核开发人员，可能会经常访问此类站点。因为他需要借鉴其他系统的设计思想。</span></p> 
<p align="left"><strong><span style="color:#333333">SI</span><span style="color:#333333">等与gdb</span>的特点</strong></p> 
<p align="left"><span style="color:#333333">在源码阅读的功能上：</span></p> 
<p align="left"><span style="color:#333333">1. SI</span><span style="color:#333333">等适合“面读”，也就是读一个代码段，并且提供更舒适的阅读辅助手段。SI</span>适合分析函数全面的逻辑。</p> 
<p align="left"><span style="color:#333333">2. gdb</span><span style="color:#333333">适合“线读”，也就是以追踪调用链的方式深入阅读，并且提供了数据分析的调试功能。适合分析特定情况下的函数逻辑表现。</span></p> 
<p align="left"><strong><span style="color:#333333">调用链、调用树和调用图</span></strong></p> 
<p align="left"><span style="color:#333333">为了能使用调试器，必须理解函数调用链在调试器级别的表现形式。但是，因为存在内嵌函数和代码优化等原因，调试器的表现形式和源码浏览器下的表现形式是不一样的。它们两者的信息显示可能存在“错位”的现象。本节的目的就是为了磨合调试器和交叉索引工具之间的代沟。</span></p> 
<p align="left"><span style="color:#333333">为了简化问题的描述，在实际分析前，先将知识点分解介绍一下。</span></p> 
<p align="left"><strong><span style="color:#333333">理想调用链</span></strong></p> 
<p align="left"><span style="color:#333333">下面我给出一个处于“理想状态”的经典backtrace(backtrace</span>的意思是“回溯”，依照它的作用来说，也就是本人说的调用链)。所谓“理想 状态的”的backtrace是指，可以利用内核源码交叉索引工具，依据gdb给出的这个backtrace，从frame0开始一级级往后最追溯，能够一直追溯到最前面的frame N，而且追溯的过程中，没有出现多出来的连接frameN和frame(N-1)的“过渡”frame.</p> 
<p align="left"><span style="color:#333333">注意其中的两个条件：1.</span>能够 2.不多出。但是，在现实的世界里，往往没这么美好。源码浏览工具往往要么“不能”，要么“多出”。造成前者的原因在于源码浏览工具的局限性，造成后者的是内嵌函数以及代码优化。详细情况可看下节的分析。</p> 
<p align="left"><span style="color:#333333">追溯的方法对于sourceinsight</span>来说就是：打开”relation window”→选中要被追溯的函数→右键→选“view relation”→选“referenced by functions”,这样就能显示出调用了被选函数的函数来。</p> 
<p align="left"><span style="color:#333333">我们拿下面这个“理想状态”的backtrace</span>分析一下</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) bt</span></p> 
 <p align="left"><span style="color:#333333">#0 kref_init (kref=0xdc40abe4) at lib/kref.c:33</span></p> 
 <p align="left"><span style="color:#333333">#1 0xc01de8be in kobject_init_internal (kobj=0xdc40abe0) atlib/kobject.c:149</span></p> 
 <p align="left"><span style="color:#333333">#2 0xc01de928 in kobject_init (kobj=0xdc40abe0, ktype=0xc035b9dc) atlib/kobject.c:282</span></p> 
 <p align="left"><span style="color:#333333">#3 0xc01de972 in kobject_create () at lib/kobject.c:619</span></p> 
 <p align="left"><span style="color:#333333">#4 0xc01def53 in kobject_create_and_add (name=0xdc40abe4 "",parent=0xc035b9dc) at lib/kobject.c:641</span></p> 
 <p align="left"><span style="color:#333333">#5 0xc0393b04 in mnt_init () at fs/namespace.c:2333</span></p> 
 <p align="left"><span style="color:#333333">#6 0xc039382b in vfs_caches_init (mempages=108676) at fs/dcache.c:2212</span></p> 
 <p align="left"><span style="color:#333333">#7 0xc037f868 in start_kernel () at init/main.c:666</span></p> 
 <p align="left"><span style="color:#333333">#8 0xc037f008 in i386_start_kernel () at arch/x86/kernel/head32.c:13</span></p> 
 <p align="left"><span style="color:#333333">#9 0x00000000 in ?? ()</span></p> 
</div> 
<p align="left"><span style="color:#333333">理想状态下的backtrace</span>各个域的含义是(注意，在非理想状态的backtrace中，这些含义往往对不上号)</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#frameN</span><span style="color:#333333">的编号</span><span style="color:#333333"> frame(N-1)</span><span style="color:#333333">的返回地址</span><span style="color:#333333">(</span><span style="color:#333333">注：</span><span style="color:#333333">fram0</span><span style="color:#333333">没有这项</span><span style="color:#333333">) in frameN</span><span style="color:#333333">所处的函数</span><span style="color:#333333">(</span><span style="color:#333333">该函数的参数</span><span style="color:#333333">...) at </span><span style="color:#333333">该函数所处的源文件</span><span style="color:#333333"> : frameN</span><span style="color:#333333">函数内对</span><span style="color:#333333">frame(N-1)</span><span style="color:#333333">函数的调用语句在源文件中所处的行数</span></p> 
</div> 
<p align="left"><span style="color:#333333">我们看下</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#0 kref_init (kref=0xdc40abe4) at lib/kref.c:33</span></p> 
</div> 
<p align="left"><span style="color:#333333">它说明frame0</span>时，kref_init正要运行。传入的参数是0xdc40abe4。函数kref_init从源文件lib/kref.c第33行开始。 在gdb下调用shell来查看源文件</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) shell vi lib/kref.c</span></p> 
</div> 
<p align="left"><span style="color:#333333">vi </span><span style="color:#333333">出来后打命令:set nu</span>可看到</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333"> 31  */</span></p> 
 <p align="left"><span style="color:#333333"> 32 void kref_init(struct kref *kref)</span></p> 
 <p align="left"><span style="color:#333333"> 33 {<!-- --></span></p> 
 <p align="left"><span style="color:#333333"> 34         kref_set(kref, 1);</span></p> 
 <p align="left"><span style="color:#333333"> 35 }</span></p> 
 <p align="left"><span style="color:#333333"> 36 </span></p> 
</div> 
<p align="left"><span style="color:#333333">我们再看看frame0</span>这一瞬间是不是“kref_init正要运行”。应该知道，“正要运行”和“正要被调用”是两个不同的概念。前者来说，到了下一个指令，代码的控制权就会交给了被调用的函数；而后者，到了下一个指令，代码的控制权还在调用者手里，</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) f 0</span></p> 
 <p align="left"><span style="color:#333333">#0 kref_init (kref=0xdc40abe4) at lib/kref.c:33</span></p> 
 <p align="left"><span style="color:#333333">33    {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">(gdb) info registers </span></p> 
 <p align="left"><span style="color:#333333">....</span></p> 
 <p align="left"><span style="color:#333333">edi            0x0       0</span></p> 
 <p align="left"><span style="color:#333333">eip            0xc01df520         0xc01df520 &lt;kref_init&gt; //&lt;-</span><span style="color:#333333">注意</span><span style="color:#333333">eip</span><span style="color:#333333">是下一个将要运行的指令地址</span></p> 
 <p align="left"><span style="color:#333333">eflags         0x282     [SF IF ]</span></p> 
 <p align="left"><span style="color:#333333">....</span></p> 
 <p align="left"><span style="color:#333333">(gdb) disass kref_init</span></p> 
 <p align="left"><span style="color:#333333">Dump of assembler code for functionkref_init:</span></p> 
 <p align="left"><span style="color:#333333">0xc01df520 &lt;kref_init+0&gt;:       push  %ebp  //</span><span style="color:#333333">对比上面，</span><span style="color:#333333">eip</span><span style="color:#333333">指向这里</span></p> 
 <p align="left"><span style="color:#333333">0xc01df521 &lt;kref_init+1&gt;:       mov   %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">0xc01df52f &lt;kref_init+15&gt;:      ret   </span></p> 
 <p align="left"><span style="color:#333333">End of assembler dump.</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
</div> 
<p align="left"><span style="color:#333333">可见，kobject_init_internal</span>的调用指令call已经执行完毕，到了frame0时，下一个指令“将要运行”函数kref_init。</p> 
<p align="left"><span style="color:#333333">再看看</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#1 0xc01de8be in kobject_init_internal (kobj=0xdc40abe0) atlib/kobject.c:149</span></p> 
</div> 
<p align="left"><span style="color:#333333">frameN</span><span style="color:#333333">与frame(N-1)</span>之间是调用的关系，前者调用了后者。也就是说，frame1的kobject_init_internal调用 frame0的kref_init，并且kref_init函数返回后，将返回到地址0xc01de8be继续执行。0xc01de8be就在 kobject_init_internal的体内，函数kobject_init_internal中调用kref_init的C语句位于lib/kobject.c的149行。</p> 
<p align="left"><span style="color:#333333">查看一下kobject_init_internal</span>的反汇编码</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) disass kobject_init_internal</span></p> 
 <p align="left"><span style="color:#333333">Dump of assembler code for functionkobject_init_internal:</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8ac&lt;kobject_init_internal+0&gt;:    push   %ebp</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8ad&lt;kobject_init_internal+1&gt;:    test   %eax,%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8af&lt;kobject_init_internal+3&gt;:    mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8b1&lt;kobject_init_internal+5&gt;:    push   %ebx</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8b2&lt;kobject_init_internal+6&gt;:    mov    %eax,%ebx</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8b4&lt;kobject_init_internal+8&gt;:    je     0xc01de8d3&lt;kobject_init_internal+39&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8b6&lt;kobject_init_internal+10&gt;:   lea    0x4(%eax),%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8b9&lt;kobject_init_internal+13&gt;:   call   0xc01df520 &lt;kref_init&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8be&lt;kobject_init_internal+18&gt;:   lea    0x8(%ebx),%eax  //</span><span style="color:#333333">注意这个地址</span><span style="color:#333333">0xc01de8be</span><span style="color:#333333">是</span><span style="color:#333333">kref_init</span><span style="color:#333333">的返回地址</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8c1&lt;kobject_init_internal+21&gt;:   mov    %eax,0x8(%ebx)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">再看看lib/kobject.c</span>，看看最后的那个行数的意义</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">145 static voidkobject_init_internal(struct kobject *kobj)</span></p> 
 <p align="left"><span style="color:#333333">146 {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">147         if (!kobj)</span></p> 
 <p align="left"><span style="color:#333333">148                 return;</span></p> 
 <p align="left"><span style="color:#333333">149         kref_init(&amp;kobj-&gt;kref);   //</span><span style="color:#333333">注意</span><span style="color:#333333">kobject_init_internal</span><span style="color:#333333">调用子函数</span><span style="color:#333333">kref_init</span><span style="color:#333333">的</span><span style="color:#333333">C</span><span style="color:#333333">语句位于行数</span><span style="color:#333333">149</span></p> 
 <p align="left"><span style="color:#333333">150         INIT_LIST_HEAD(&amp;kobj-&gt;entry);</span></p> 
 <p align="left"><span style="color:#333333">151        kobj-&gt;state_in_sysfs = 0;</span></p> 
 <p align="left"><span style="color:#333333">152         kobj-&gt;state_add_uevent_sent = 0;</span></p> 
 <p align="left"><span style="color:#333333">153         kobj-&gt;state_remove_uevent_sent = 0;</span></p> 
 <p align="left"><span style="color:#333333">154         kobj-&gt;state_initialized = 1;</span></p> 
 <p align="left"><span style="color:#333333">155 }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">在验证一下</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#2 0xc01de928 in kobject_init (kobj=0xdc40abe0, ktype=0xc035b9dc) atlib/kobject.c:282</span></p> 
</div> 
<p align="left"><span style="color:#333333">看看kobject_init</span>的反汇编码</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) disass kobject_init</span></p> 
 <p align="left"><span style="color:#333333">Dump of assembler code for functionkobject_init:</span></p> 
 <p align="left"><span style="color:#333333">0xc01de8f3 &lt;kobject_init+0&gt;:    push  %ebp</span></p> 
 <p align="left"><span style="color:#333333">........</span></p> 
 <p align="left"><span style="color:#333333">0xc01de923 &lt;kobject_init+48&gt;:   call  0xc01de8ac &lt;kobject_init_internal&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc01de928 &lt;kobject_init+53&gt;:   mov   %esi,0x18(%ebx)     //</span><span style="color:#333333">注意这个地址</span><span style="color:#333333">0xc01de928</span><span style="color:#333333">是</span><span style="color:#333333">kobject_init_internal</span><span style="color:#333333">的返回地址</span></p> 
 <p align="left"><span style="color:#333333">......</span></p> 
 <p align="left"><span style="color:#333333">0xc01de94b &lt;kobject_init+88&gt;:   pop   %ebp</span></p> 
 <p align="left"><span style="color:#333333">0xc01de94c &lt;kobject_init+89&gt;:   ret    </span></p> 
 <p align="left"><span style="color:#333333">End of assembler dump.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">看看看看lib/kobject.c</span>，看看最后的那个行数的意义</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">263 void kobject_init(struct kobject *kobj,struct kobj_type *ktype)</span></p> 
 <p align="left"><span style="color:#333333">264 {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">265         char *err_str;</span></p> 
 <p align="left"><span style="color:#333333">.......</span></p> 
 <p align="left"><span style="color:#333333">282         kobject_init_internal(kobj);    </span><span style="color:#333333">注意</span><span style="color:#333333">kobject_init</span><span style="color:#333333">调用子函数</span><span style="color:#333333">kobject_init_internal</span><span style="color:#333333">的</span><span style="color:#333333">C</span><span style="color:#333333">语句位于行数</span><span style="color:#333333">282</span></p> 
 <p align="left"><span style="color:#333333">283         kobj-&gt;ktype = ktype;</span></p> 
 <p align="left"><span style="color:#333333">......</span></p> 
 <p align="left"><span style="color:#333333">287         printk(KERN_ERR "kobject (%p):%s\n", kobj, err_str);</span></p> 
 <p align="left"><span style="color:#333333">288         dump_stack</span></p> 
</div> 
<p align="left"><span style="color:#333333">通过这两个例子，可见最初的猜想是正确的。</span></p> 
<p align="left"><strong><span style="color:#333333">函数指针调用</span></strong></p> 
<p align="left"><span style="color:#333333">本小节意义： 在利用SI</span>等工具查看函数调用链时，遇到的一个最多的问题是函数指针的调用。所以把该小节内容移到这里来，为下小节的叙述作铺垫。SI等交叉索引工具不能在父函数内部解析出这种调用关系。</p> 
<p align="left"><span style="color:#333333">我们经常碰到这种情况：如果内核中函数A</span>是通过函数指针调用函数B，那么源码交叉索引工具(如sourceinsight, kscope等)就无法通过函数B的名称回溯到上层函数A。这是因为在函数A内部对函数B的调用并不是通过函数B的名称，而是利用指向函数B代码块的指针(函数指针)。</p> 
<p align="left"><span style="color:#333333">要想解决这个问题，方法有两种：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">利用字符串搜索功能：</span></p> 
<p align="left"><span style="color:#333333">搜索函数指针的变量名。如果已经知道的是子函数，想找出通过指针调用它的所有上层父函数：利用子函数的函数名进行搜索，就能找到所有相应的函数指针变量赋值的语句。然后搜索该函数指针变量就能得到所有可能调用该函数的上层父函数。相反，如果是已经知道父函数，想知道该父函数体内的一个函数指针可能会 调用哪些子函数，可以搜索该函数指针变量(</span>一般在该变量名前加个点号“.”)，这样可以搜索出所有给该函数指针变量赋值的语句，从而找出所有可能的子函数。</p> 
<p align="left"><span style="color:#333333">当然，既然是字符串搜索，搜索结果中会夹带其他没用的信息，这需要进一步的筛选。这个方法能搜索出依赖某函数指针变量的所有调用关系。</span></p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">利用调试工具：</span></p> 
<p align="left"><span style="color:#333333">在目标函数处下断点。调试器器会实时拦截该函数的调用，然后用bt</span>命令就能看到整个调用链。</p> 
<p align="left"><span style="color:#333333">这个方法得到的只是一个特定的具体调用关系。可能还有其他很多的潜在调用路径。</span></p> 
<p align="left"><span style="color:#333333">然而，我们研究的目标并不满足于知道调用链。下面我们观察函数究竟是怎样利用函数指针调用子函数的。[</span>待整理]</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">2130 int vfs_mkdir(struct inode *dir,struct dentry *dentry, int mode)</span></p> 
 <p align="left"><span style="color:#333333">2131 {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">2132         int error = may_create(dir, dentry,NULL);</span></p> 
 <p align="left"><span style="color:#333333">2133 </span></p> 
 <p align="left"><span style="color:#333333">2134         if (error)</span></p> 
 <p align="left"><span style="color:#333333">2135                 return error;</span></p> 
 <p align="left"><span style="color:#333333">2136 </span></p> 
 <p align="left"><span style="color:#333333">2137         if (!dir-&gt;i_op ||!dir-&gt;i_op-&gt;mkdir)</span></p> 
 <p align="left"><span style="color:#333333">2138                 return -EPERM;</span></p> 
 <p align="left"><span style="color:#333333">2139 </span></p> 
 <p align="left"><span style="color:#333333">2140         mode &amp;= (S_IRWXUGO|S_ISVTX);</span></p> 
 <p align="left"><span style="color:#333333">2141         error = security_inode_mkdir(dir,dentry, mode);</span></p> 
 <p align="left"><span style="color:#333333">2142         if (error)</span></p> 
 <p align="left"><span style="color:#333333">2143                 return error;</span></p> 
 <p align="left"><span style="color:#333333">2144 </span></p> 
 <p align="left"><span style="color:#333333">2145         DQUOT_INIT(dir);</span></p> 
 <p align="left"><span style="color:#333333">2146         error = dir-&gt;i_op-&gt;mkdir(dir,dentry, mode);</span></p> 
 <p align="left"><span style="color:#333333">2147         if (!error)</span></p> 
 <p align="left"><span style="color:#333333">2148                 fsnotify_mkdir(dir, dentry);</span></p> 
 <p align="left"><span style="color:#333333">2149         return error;</span></p> 
 <p align="left"><span style="color:#333333">2150 }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">对源码文件下断点</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(gdb) b fs/namei.c:2146</span></p> 
 <p align="left"><span style="color:#333333">Breakpoint 9 at 0xc017c0ee: filefs/namei.c, line 2146.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">问题一：</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">动态分析</span><span style="color:#333333">call  *0x14(%ebx)</span><span style="color:#333333">是怎么回事，函数指针</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">-------------------------</span></p> 
 <p align="left"><span style="color:#333333">┌──Register group:general───────────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">│eax            0xdc20b0a8       -601837400                    ecx            0x1ed    493                                   │</span></p> 
 <p align="left"><span style="color:#333333">│edx            0xdb9526c0       -610982208                    ebx            0xe01c87d4       -535001132                    │</span></p> 
 <p align="left"><span style="color:#333333">│esp            0xd8c5bf1c       0xd8c5bf1c                    ebp            0xd8c5bf34       0xd8c5bf34                    │</span></p> 
 <p align="left"><span style="color:#333333">│esi            0xdc20b0a8       -601837400                    edi            0xdb9526c0       -610982208                    │</span></p> 
 <p align="left"><span style="color:#333333">│eip            0xc017c0fb       0xc017c0fb &lt;vfs_mkdir+179&gt;    eflags         0x200246 [ PF ZF IF ID ]                       │</span></p> 
 <p align="left"><span style="color:#333333">│cs            0x60     96                                    ss             0x68     104                                   │</span></p> 
 <p align="left"><span style="color:#333333">│ds             0x7b     123                                   es             0x7b     123                                   │</span></p> 
 <p align="left"><span style="color:#333333">│fs            0xd8     216                                   gs             0x33     51                                    │</span></p> 
 <p align="left"><span style="color:#333333">│                                                                                                                           │</span></p> 
 <p align="left"><span style="color:#333333">│                                                                                                                           │</span></p> 
 <p align="left"><span style="color:#333333">│                                                                                                                           │</span></p> 
 <p align="left"><span style="color:#333333">│                                                                                                                            │</span></p> 
 <p align="left"><span style="color:#333333">│                                                                                                                           │</span></p> 
 <p align="left"><span style="color:#333333">│                                                                                                                            │</span></p> 
 <p align="left"><span style="color:#333333">  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c0ea &lt;vfs_mkdir+162&gt;     mov    %esi,%eax                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c0ec &lt;vfs_mkdir+164&gt;     call   *(%ecx)                                                                          │</span></p> 
 <p align="left"><span style="color:#333333">B+ │0xc017c0ee &lt;vfs_mkdir+166&gt;      mov   0x98(%esi),%ebx                                                                  │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c0f4 &lt;vfs_mkdir+172&gt;     mov    %edi,%edx                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c0f6 &lt;vfs_mkdir+174&gt;     mov    %esi,%eax                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c0f8 &lt;vfs_mkdir+176&gt;     mov    -0x10(%ebp),%ecx                                                                 │</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│0xc017c0fb &lt;vfs_mkdir+179&gt;      call  *0x14(%ebx)                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c0fe &lt;vfs_mkdir+182&gt;     test   %eax,%eax                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c100 &lt;vfs_mkdir+184&gt;     mov    %eax,%ebx                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c102 &lt;vfs_mkdir+186&gt;     jne    0xc017c15d&lt;vfs_mkdir+277&gt;                                                       │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c104 &lt;vfs_mkdir+188&gt;     testb  $0x4,0x11c(%esi)                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c10b &lt;vfs_mkdir+195&gt;     je     0xc017c119&lt;vfs_mkdir+209&gt;                                                       │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c10d &lt;vfs_mkdir+197&gt;     mov    $0x4,%edx                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017c112 &lt;vfs_mkdir+202&gt;     mov    %esi,%eax                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333">remote Thread 42000 In: vfs_mkdir                                                                  Line: 2146 PC: 0xc017c0fb </span></p> 
 <p align="left"><span style="color:#333333"> i_state = 1, </span></p> 
 <p align="left"><span style="color:#333333"> dirtied_when = 0, </span></p> 
 <p align="left"><span style="color:#333333"> i_flags = 0, </span></p> 
 <p align="left"><span style="color:#333333"> i_writecount = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">   counter = 0</span></p> 
 <p align="left"><span style="color:#333333"> }, </span></p> 
 <p align="left"><span style="color:#333333"> i_security = 0x0, </span></p> 
 <p align="left"><span style="color:#333333"> i_private = 0x0</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p/x $ebx</span></p> 
 <p align="left"><span style="color:#333333">$20 = 0xe01c87d4</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p/x $ebx+0x14</span></p> 
 <p align="left"><span style="color:#333333">$21 = 0xe01c87e8</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(gdb) p &amp;sfs_dir_inode_ops</span></p> 
 <p align="left"><span style="color:#333333">$13 = (struct inode_operations *)0xe01c87d4</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(gdb) p/x *(int * )0xe01c87d4@10</span></p> 
 <p align="left"><span style="color:#333333">$18 = {0xe01c75b1, 0xe01c7677,0xc018d3f0, 0xc018cc91, 0xe01c75dd, 0xe01c75c0, 0xc018d441, 0xe01c7510,0xc018d474, 0x0}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(gdb) disass sfs_mkdir</span></p> 
 <p align="left"><span style="color:#333333">Dump of assembler code for functionsfs_mkdir:</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75c0 &lt;sfs_mkdir+0&gt;:       push   %ebp         //&lt;-</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75c1 &lt;sfs_mkdir+1&gt;:       or    $0x40,%ch</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75c4 &lt;sfs_mkdir+4&gt;:       mov   %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75c6 &lt;sfs_mkdir+6&gt;:       push  %ebx</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75c7 &lt;sfs_mkdir+7&gt;:       mov   %eax,%ebx</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75c9 &lt;sfs_mkdir+9&gt;:       push  $0x0</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75cb &lt;sfs_mkdir+11&gt;:      call  0xe01c7510 &lt;sfs_mknod&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75d0 &lt;sfs_mkdir+16&gt;:      pop   %edx</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75d1 &lt;sfs_mkdir+17&gt;:      test  %eax,%eax</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75d3 &lt;sfs_mkdir+19&gt;:      jne   0xe01c75d8 &lt;sfs_mkdir+24&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75d5 &lt;sfs_mkdir+21&gt;:      incl  0x28(%ebx)</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75d8 &lt;sfs_mkdir+24&gt;:      mov   -0x4(%ebp),%ebx</span></p> 
 <p align="left"><span style="color:#333333">0xe01c75db &lt;sfs_mkdir+27&gt;:      leave </span></p> 
 <p align="left"><span style="color:#333333">0xe01c75dc &lt;sfs_mkdir+28&gt;:      ret   </span></p> 
 <p align="left"><span style="color:#333333">End of assembler dump.</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p/x *0xe01c87e8</span></p> 
 <p align="left"><span style="color:#333333">$9 = 0xe01c75c0   // &lt;-sfs_mkdir</span><span style="color:#333333">的地址</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">struct inode_operations {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      int(*create) (struct inode *,struct dentry *,int, struct nameidata *);</span></p> 
 <p align="left"><span style="color:#333333">      structdentry * (*lookup) (struct inode *,struct dentry *, struct nameidata *);</span></p> 
 <p align="left"><span style="color:#333333">      int(*link) (struct dentry *,struct inode *,struct dentry *);</span></p> 
 <p align="left"><span style="color:#333333">      int(*unlink) (struct inode *,struct dentry *);</span></p> 
 <p align="left"><span style="color:#333333">      int(*symlink) (struct inode *,struct dentry *,const char *);</span></p> 
 <p align="left"><span style="color:#333333">      int(*mkdir) (struct inode *,struct dentry *,int);</span></p> 
 <p align="left"><span style="color:#333333">......</span></p> 
 <p align="left"><span style="color:#333333">};</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">struct inode_operationssfs_dir_inode_ops = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">      .mkdir          = sfs_mkdir,</span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">};</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－</span></p> 
 <p align="left"><span style="color:#333333">0xc017c0fb &lt;vfs_mkdir+179&gt;      call  *0x14(%ebx)  </span><span style="color:#333333">为什么要加</span><span style="color:#333333"> * ?</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">call *0x14(%ebx) ==</span></p> 
 <p align="left"><span style="color:#333333">push %eip</span></p> 
 <p align="left"><span style="color:#333333">mov 0x14(%ebx) %eip   </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">注意</span><span style="color:#333333">call</span><span style="color:#333333">与</span><span style="color:#333333">mov</span><span style="color:#333333">指令语义的区别</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">mov 0x14(%ebx) %eax; </span><span style="color:#333333">把存放在地址</span><span style="color:#333333">0x14(%ebx)</span><span style="color:#333333">中的</span><span style="color:#333333">32</span><span style="color:#333333">位数据拷贝到</span><span style="color:#333333">%eax</span></p> 
 <p align="left"><span style="color:#333333">mov %eax 0x14(%ebx); </span><span style="color:#333333">把</span><span style="color:#333333">%eax</span><span style="color:#333333">的值拷贝到地址</span><span style="color:#333333">0x14(%ebx)</span><span style="color:#333333">指向的内存中</span></p> 
 <p align="left"><span style="color:#333333">call 0x14(%ebx)    : </span><span style="color:#333333">结果是跳到地址</span><span style="color:#333333">0x14(%ebx)</span><span style="color:#333333">继续执行</span><span style="color:#333333">(</span><span style="color:#333333">当然对于本例来说，该地址指向的并不是目标代码段</span><span style="color:#333333">)</span></p> 
 <p align="left"><span style="color:#333333">call *0x14(%ebx)   : </span><span style="color:#333333">取出存放在地址</span><span style="color:#333333">0x14(%ebx)</span><span style="color:#333333">中的</span><span style="color:#333333">32</span><span style="color:#333333">位数据，把该数据作为目标地址，跳到该地址继续执行。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">mov $0xe01c75c9 %eax ; 0xe01c75c9</span><span style="color:#333333">被认为是立即数，前面有</span><span style="color:#333333">$</span><span style="color:#333333">。没有</span><span style="color:#333333">mov 0xe01c75c9 %eax</span><span style="color:#333333">这种形式</span></p> 
 <p align="left"><span style="color:#333333">call 0xe01c75c9 ;0xe01c75c9</span><span style="color:#333333">被认为是地址。没有</span><span style="color:#333333">call $0xe01c75c9</span><span style="color:#333333">这种形式。</span></p> 
 <p align="left"><span style="color:#333333">注意，也没有</span><span style="color:#333333">call %eax</span><span style="color:#333333">等形式</span><span style="color:#333333">(</span><span style="color:#333333">假设</span><span style="color:#333333">%eax</span><span style="color:#333333">放着目标地址</span><span style="color:#333333">)</span><span style="color:#333333">。需用</span><span style="color:#333333"> call *%eax</span><span style="color:#333333">，同样，</span><span style="color:#333333">*%eax</span><span style="color:#333333">表示从</span><span style="color:#333333">%eax</span><span style="color:#333333">获取地址值</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">                                                                                                          </span></p> 
 <p align="left"><span style="color:#333333">                           |      -             |                  |    --        |            </span></p> 
 <p align="left"><span style="color:#333333">                           |      -             |                  |    --        |                   4. callsfs_mkdir == call 0xe01c75c0</span></p> 
 <p align="left"><span style="color:#333333">                           |      -            |                  |    --        |                     </span></p> 
 <p align="left"><span style="color:#333333">                          +--------------------+   &lt;-------&gt;     |    --        |                   3. 0xe01c75c0== fetch from 0xe01c87e8 </span></p> 
 <p align="left"><span style="color:#333333">                           |      ---           |                  |    --        |                                       *0x14(%ebx)</span></p> 
 <p align="left"><span style="color:#333333">                          +--------------------+                 +---------------+                     </span></p> 
 <p align="left"><span style="color:#333333">                           |  init (*mkdir)(..) +--+               |  0xe01c75c0  |   2. 0xe01c87e8  == calculate 0x14(%ebx)</span></p> 
 <p align="left"><span style="color:#333333">            0x14(%ebx)---&gt;+--------------------+  |               +---------------+                        </span></p> 
 <p align="left"><span style="color:#333333">                           |      ...           | |               |  0xe01c75dd  |                                            </span></p> 
 <p align="left"><span style="color:#333333">                          +--------------------+  |               +---------------+                                            </span></p> 
 <p align="left"><span style="color:#333333">                           |      ...           | |               |  0xc018cc91  |                        </span></p> 
 <p align="left"><span style="color:#333333">                          +--------------------+  |               +---------------+                        </span></p> 
 <p align="left"><span style="color:#333333">                           |      ...           | |               |  0xc018d3f0  |                        </span></p> 
 <p align="left"><span style="color:#333333">                          +--------------------+  |               +---------------+                     1. 0xe01c87d4 == fetchfrom %ebx</span></p> 
 <p align="left"><span style="color:#333333">                           |      ...           | |               |  0xe01c7677  |                        </span></p> 
 <p align="left"><span style="color:#333333">                          +--------------------+  |               +---------------+                        +------------+</span></p> 
 <p align="left"><span style="color:#333333">                           |  int (*create)(..) |  |               |  0xe01c75b1  |       0xe01c87d4       | 0xe01c87d4 |</span></p> 
 <p align="left"><span style="color:#333333">              %ebx-------&gt;+--------------------+  |               +---------------+                        +------------+</span></p> 
 <p align="left"><span style="color:#333333">                          structinode_operations  |                  contents              address         register %ebx </span></p> 
 <p align="left"><span style="color:#333333">                             sfs_dir_inode_ops     |                                                     </span></p> 
 <p align="left"><span style="color:#333333">                                                  |                                                  call   *0x14(%ebx) </span><span style="color:#333333">的过程</span></p> 
 <p align="left"><span style="color:#333333">                                                  | </span></p> 
 <p align="left"><span style="color:#333333">                                                  +-----------------------------+   </span></p> 
 <p align="left"><span style="color:#333333">                                                                                |   </span></p> 
 <p align="left"><span style="color:#333333">                                                     static int sfs_mkdir(..)   |   </span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75c0 &lt;sfs_mkdir+0&gt;: +-&gt;  push   %ebp         </span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75c1 &lt;sfs_mkdir+1&gt;:      or     $0x40,%ch</span></p> 
 <p align="left"><span style="color:#333333">                                                      0xe01c75c4&lt;sfs_mkdir+4&gt;:       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75c6 &lt;sfs_mkdir+6&gt;:      push   %ebx</span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75c7 &lt;sfs_mkdir+7&gt;:      mov    %eax,%ebx</span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75c9 &lt;sfs_mkdir+9&gt;:      push   $0x0</span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75cb &lt;sfs_mkdir+11&gt;:     call   0xe01c7510&lt;sfs_mknod&gt;</span></p> 
 <p align="left"><span style="color:#333333">                                                      0xe01c75d0&lt;sfs_mkdir+16&gt;:      pop    %edx</span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75d1 &lt;sfs_mkdir+17&gt;:     test   %eax,%eax</span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75d3 &lt;sfs_mkdir+19&gt;:     jne    0xe01c75d8&lt;sfs_mkdir+24&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75d5 &lt;sfs_mkdir+21&gt;:     incl   0x28(%ebx)</span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75d8 &lt;sfs_mkdir+24&gt;:     mov    -0x4(%ebp),%ebx</span></p> 
 <p align="left"><span style="color:#333333">                                                       0xe01c75db &lt;sfs_mkdir+27&gt;:      leave </span></p> 
 <p align="left"><span style="color:#333333">                                                     0xe01c75dc &lt;sfs_mkdir+28&gt;:     ret    </span></p> 
 <p align="left"><span style="color:#333333">                                                                                                                                                </span></p> 
 <p align="left"><span style="color:#333333">                                                           address                       contents</span></p> 
 <p align="left"><span style="color:#333333">－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－</span></p> 
 <p align="left"><span style="color:#333333">问题二：</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">下面的</span><span style="color:#333333">dir-&gt;i_op-&gt;mkdir()</span><span style="color:#333333">，为什么不是</span><span style="color:#333333">dir.i_op.mkidr. . </span><span style="color:#333333">和</span><span style="color:#333333"> -&gt; </span> <span style="color:#333333">有什么区别</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">一般得，有一个结构体变量</span><span style="color:#333333">a, </span><span style="color:#333333">其中</span><span style="color:#333333">a</span><span style="color:#333333">有一个域</span><span style="color:#333333">b</span><span style="color:#333333">，</span><span style="color:#333333">想取得</span><span style="color:#333333">b</span><span style="color:#333333">的值，一般用</span><span style="color:#333333">a.b</span><span style="color:#333333">；</span></p> 
 <p align="left"><span style="color:#333333">而如果</span><span style="color:#333333">a</span><span style="color:#333333">是一个指向结构体的指针变量，取域</span><span style="color:#333333">b</span><span style="color:#333333">的值一般用</span><span style="color:#333333">a-&gt;b.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">static int sfs_mkdir(struct inode * dir,struct dentry * dentry, int mode)</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">....</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">2130 int vfs_mkdir(struct inode *dir,struct dentry *dentry, int mode)</span></p> 
 <p align="left"><span style="color:#333333">2131 {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">....</span></p> 
 <p align="left"><span style="color:#333333">2146        error =dir-&gt;i_op-&gt;mkdir(dir, dentry, mode);</span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">2150 }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">struct inode {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">const struct inode_operations   *i_op;</span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">};</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">struct inode_operations {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">      int(*mkdir) (struct inode *,struct dentry *,int);</span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">};</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">dir: </span><span style="color:#333333">取得</span><span style="color:#333333">(struct inode *)dir</span></p> 
 <p align="left"><span style="color:#333333">dir-&gt;i_op: </span><span style="color:#333333">取得</span><span style="color:#333333">(const struct inode_operations     *)i_op</span></p> 
 <p align="left"><span style="color:#333333">dir-&gt;i_op-&gt;mkdir: </span><span style="color:#333333">取得</span><span style="color:#333333">(int (*) (struct inode *,struct dentry *,int))mkdir</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">dir-&gt;i_op-&gt;mkdir(dir, dentry,mode)</span><span style="color:#333333">也就是</span><span style="color:#333333">  </span><span style="color:#333333">函数指针变量名</span><span style="color:#333333">(</span><span style="color:#333333">参数</span><span style="color:#333333">...)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">函数指针是一个指针，它向目标函数的代码块的第一个指令。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">函数名的值等于该函数第一条指令的地址。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(gdb) p sfs_mkdir</span></p> 
 <p align="left"><span style="color:#333333">$20 = {int (struct inode *, structdentry *, int)} 0xe01c75c0 &lt;sfs_mkdir&gt;</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p &amp;sfs_mkdir</span></p> 
 <p align="left"><span style="color:#333333">$21 = (int (*)(struct inode *, structdentry *, int)) 0xe01c75c0 &lt;sfs_mkdir&gt;</span></p> 
 <p align="left"><span style="color:#333333">(gdb) p dir-&gt;i_op-&gt;mkdir</span></p> 
 <p align="left"><span style="color:#333333">$18 = (int (*)(struct inode *, structdentry *, int)) 0xe01c75c0 &lt;sfs_mkdir&gt;</span></p> 
 <p align="left"><span style="color:#333333">前者指明变量名</span><span style="color:#333333">/</span><span style="color:#333333">函数名的类型，后者是它的值</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">struct inode_operationssfs_dir_inode_ops = {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">      .mkdir          = sfs_mkdir,</span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">};</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">函数的两种调用形式：</span><span style="color:#333333">函数指针变量名</span><span style="color:#333333">(</span><span style="color:#333333">参数</span><span style="color:#333333">...) </span><span style="color:#333333">函数名</span><span style="color:#333333">(</span><span style="color:#333333">参数</span><span style="color:#333333">...)</span></p> 
 <p align="left"><span style="color:#333333">严格地说，从</span><span style="color:#333333">C</span><span style="color:#333333">语言的形式看来，前者通过函数指针变量名调用函数，后者通过函数名调用，是不同的。</span></p> 
 <p align="left"><span style="color:#333333">但从汇编级代码看来，都是转化为指令</span><span style="color:#333333">call </span><span style="color:#333333">函数地址。是一样的。</span></p> 
 <p align="left"><span style="color:#333333">引入了函数指针变量后，这个变量就可以动态地赋值，从而指向不同的函数体，实现某些特殊的功能。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">我们再看下函数指针的赋值</span><span style="color:#333333">.mkdir          = sfs_mkdir,</span></p> 
 <p align="left"><span style="color:#333333">严格地说，</span><span style="color:#333333">mkdir</span><span style="color:#333333">和</span><span style="color:#333333">sfs_mkdir</span><span style="color:#333333">是类型不同的东西，但在编译时自动经过了类型转换。所以下面这些写法效果都一样</span></p> 
 <p align="left"><span style="color:#333333">.mkdir          = sfs_mkdir,</span></p> 
 <p align="left"><span style="color:#333333">.mkdir          = &amp;sfs_mkdir,</span></p> 
 <p align="left"><span style="color:#333333">.mkdir          = (int (*)(struct inode *, struct dentry*, int))sfs_mkdir,</span></p> 
 <p align="left"><span style="color:#333333">.mkdir          = (int (*)(struct inode *, structdentry *, int))(&amp;sfs_mkdir),</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">函数指针的运用：</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">假设有函数指针</span><span style="color:#333333"> a</span><span style="color:#333333">，</span><span style="color:#333333">要调用该指针指向的函数，有意思地是，又有两形式：</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">a(</span><span style="color:#333333">参数</span><span style="color:#333333">)</span><span style="color:#333333">；</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">或者</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(*a)(</span><span style="color:#333333">参数</span><span style="color:#333333">)</span><span style="color:#333333">；</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">硬要理解的话，可以这样想：</span><span style="color:#333333">a</span><span style="color:#333333">之指向一个函数体的指针</span><span style="color:#333333">, </span><span style="color:#333333">按么</span><span style="color:#333333">(*a)</span><span style="color:#333333">自然就是得到了那个函数本身了。</span></p> 
 <p align="left"><span style="color:#333333">(*a)(</span><span style="color:#333333">参数</span><span style="color:#333333">) </span><span style="color:#333333">这个形式就变成了普通的函数调用，这比直接利用函数指针的变量名进行调用更直观，</span></p> 
 <p align="left"><span style="color:#333333">或者有人错误地认为本来就应该这样调用才正确。其实，这些形式上的东西是给人看的，</span></p> 
 <p align="left"><span style="color:#333333">到了汇编级别的指令都是一样的。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">linux</span><span style="color:#333333">使用第一种形式，而</span><span style="color:#333333">openbsd</span><span style="color:#333333">使用下面的第二种。</span><span style="color:#333333">linux</span><span style="color:#333333">不管在函数指针的赋值还是函数的调用，</span></p> 
 <p align="left"><span style="color:#333333">都是采取最简洁的形式。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">举个</span><span style="color:#333333">openbsd</span><span style="color:#333333">下的例子，可见它的形式不是很美观。</span></p> 
 <p align="left"><span style="color:#333333">int</span></p> 
 <p align="left"><span style="color:#333333">sobind(struct socket *so, struct mbuf*nam, struct proc *p)</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      ints = splsoftnet();</span></p> 
 <p align="left"><span style="color:#333333">      interror;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      error= (*so-&gt;so_proto-&gt;pr_usrreq)(so, PRU_BIND, NULL, nam, NULL, p);</span></p> 
 <p align="left"><span style="color:#333333">      splx(s);</span></p> 
 <p align="left"><span style="color:#333333">      return(error);</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">其中结构体：</span></p> 
 <p align="left"><span style="color:#333333">struct socket {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">      struct   protosw *so_proto;        /* protocol handle */</span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">struct protosw {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">      int      (*pr_usrreq)(struct socket *, int, structmbuf *,</span></p> 
 <p align="left"><span style="color:#333333">                   struct mbuf *, struct mbuf *, struct proc*);</span></p> 
 <p align="left"><span style="color:#333333">...}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">可见，下面这句</span></p> 
 <p align="left"><span style="color:#333333">(*so-&gt;so_proto-&gt;pr_usrreq)(so,PRU_BIND, NULL, nam, NULL, p);</span></p> 
 <p align="left"><span style="color:#333333">最后变成</span></p> 
 <p align="left"><span style="color:#333333">(*pr_usrreq)(so, PRU_BIND, NULL, nam,NULL, p);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">---</span></p> 
 <p align="left"><span style="color:#333333">例子</span></p> 
 <p align="left"><span style="color:#333333">#include &lt;stdio.h&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">int main()</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">       int myfunc(int a)</span></p> 
 <p align="left"><span style="color:#333333">       {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                printf("%d\n", a);</span></p> 
 <p align="left"><span style="color:#333333">                return 0;</span></p> 
 <p align="left"><span style="color:#333333">       }</span></p> 
 <p align="left"><span style="color:#333333">       int (*funa)(int) = myfunc;</span></p> 
 <p align="left"><span style="color:#333333">       int (*funb)(int) = &amp;myfunc;</span></p> 
 <p align="left"><span style="color:#333333">       int (*func)(int) = (int (*)(int))myfunc;</span></p> 
 <p align="left"><span style="color:#333333">       int (*fund)(int) = (int (*)(int))(&amp;myfunc);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       myfunc(1);</span></p> 
 <p align="left"><span style="color:#333333">       funa(2);</span></p> 
 <p align="left"><span style="color:#333333">       funb(3);</span></p> 
 <p align="left"><span style="color:#333333">       func(4);</span></p> 
 <p align="left"><span style="color:#333333">       fund(5);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       (*funa)(2);</span></p> 
 <p align="left"><span style="color:#333333">       (*funb)(3);</span></p> 
 <p align="left"><span style="color:#333333">       (*func)(4);</span></p> 
 <p align="left"><span style="color:#333333">       (*fund)(5);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">       return 0;</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">那几个函数调用的代码部分的反汇编码如下，可见在汇编级别，是一样的指令。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">08048374 &lt;main&gt;:</span></p> 
 <p align="left"><span style="color:#333333"> 8048374:      8d4c 24 04                 lea    0x4(%esp),%ecx</span></p> 
 <p align="left"><span style="color:#333333"> 8048378:      83e4 f0                    and    $0xfffffff0,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 804837b:      ff71 fc                    pushl  -0x4(%ecx)</span></p> 
 <p align="left"><span style="color:#333333"> 804837e:      55                           push   %ebp</span></p> 
 <p align="left"><span style="color:#333333"> 804837f:      89e5                       mov    %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333"> 8048381:      51                           push   %ecx</span></p> 
 <p align="left"><span style="color:#333333"> 8048382:      83ec 14                    sub    $0x14,%esp</span></p> 
 <p align="left"><span style="color:#333333"> 8048385:      c745 f8 1b 84 04 08      movl   $0x804841b,-0x8(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 804838c:      c745 f4 1b 84 04 08      movl   $0x804841b,-0xc(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 8048393:      c745 f0 1b 84 04 08      movl   $0x804841b,-0x10(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 804839a:      c745 ec 1b 84 04 08      movl   $0x804841b,-0x14(%ebp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483a1:      c704 24 01 00 00 00      movl   $0x1,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483a8:      e86e 00 00 00             call   804841b&lt;myfunc.1932&gt;</span></p> 
 <p align="left"><span style="color:#333333"> 80483ad:      c704 24 02 00 00 00      movl   $0x2,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483b4:      8b45 f8                    mov    -0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483b7:      ffd0                       call   *%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483b9:      c704 24 03 00 00 00      movl   $0x3,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483c0:      8b45 f4                    mov    -0xc(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483c3:      ff d0                       call   *%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483c5:      c704 24 04 00 00 00      movl   $0x4,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483cc:      8b45 f0                    mov    -0x10(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483cf:      ffd0                       call   *%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483d1:      c704 24 05 00 00 00      movl   $0x5,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483d8:      8b45 ec                    mov    -0x14(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483db:      ffd0                       call   *%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483dd:      c704 24 02 00 00 00      movl   $0x2,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483e4:      8b45 f8                    mov    -0x8(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483e7:      ffd0                       call   *%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483e9:      c704 24 03 00 00 00      movl   $0x3,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483f0:      8b45 f4                    mov    -0xc(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483f3:      ffd0                       call   *%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483f5:      c704 24 04 00 00 00      movl   $0x4,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 80483fc:      8b45 f0                    mov    -0x10(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 80483ff:      ffd0                       call   *%eax</span></p> 
 <p align="left"><span style="color:#333333"> 8048401:      c704 24 05 00 00 00      movl   $0x5,(%esp)</span></p> 
 <p align="left"><span style="color:#333333"> 8048408:      8b45 ec                    mov    -0x14(%ebp),%eax</span></p> 
 <p align="left"><span style="color:#333333"> 804840b:      ffd0                       call   *%eax</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">调用链的层次</span></strong></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">人观念层次</span></p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">交叉解析器层次</span></p> 
<p align="left"><span style="color:#333333">2. c</span><span style="color:#333333">调用层次</span></p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">编译器(</span>机器码静态)层次</p> 
<p align="left"><span style="color:#333333">4. </span><span style="color:#333333">运行时(</span>机器码动态)层次，也叫调试器层次</p> 
<p align="left"><span style="color:#333333">很明显，前面所讲的“理想状态”的backtrace</span>就是指在交叉解析器层次下和在调试器层次下的表现相同的调用链。</p> 
<p align="left"><strong><span style="color:#333333">非理想调用链</span></strong></p> 
<p align="left"><span style="color:#333333">任务：</span></p> 
<p align="left"><span style="color:#333333">从一个断点开始，从后向前推导，分析出ramfs</span>注册函数的调用过程。同时，观察调试器的优点和局限性。</p> 
<p align="left"><span style="color:#333333">ramfs</span><span style="color:#333333">文件系统的注册函数是register_filesystem(&amp;ramfs_fs_type)</span>。为了更快定位，在上层函数init_ramfs_fs下断点。而后在gdb下得到的调用链是</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) bt</span></p> 
 <p align="left"><span style="color:#333333">#0 register_filesystem (fs=0xc03595cc) at fs/filesystems.c:68</span></p> 
 <p align="left"><span style="color:#333333">#1 0xc0394594 in init_ramfs_fs () at fs/ramfs/inode.c:213</span></p> 
 <p align="left"><span style="color:#333333">#2 0xc037f473 in kernel_init (unused=&lt;value optimized out&gt;) atinit/main.c:708</span></p> 
 <p align="left"><span style="color:#333333">#3 0xc010463f in kernel_thread_helper () at arch/x86/kernel/entry_32.S:1013</span></p> 
</div> 
<p align="left"><span style="color:#333333">我们注意到：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">这个backtrace</span>包含的函数只有4个，实际上并非如此。经过分析，它实际上（用C的观点看）调用链如下所示，这是为什么呢？</p> 
<p align="left"><span style="color:#333333">start_kernel</span><span style="color:#333333">→rest_init</span>→kernel_thread→kernel_thread_helper→call %ebx (即call kernel_init)→do_basic_setup→do_initcalls→do_one_initcall→result = fn() (即call init_ramfs_fs)→register_filesystem</p> 
<p align="left"><span style="color:#333333">2. backtrace</span><span style="color:#333333">推溯到kernel_thread_helper</span>后就再没下文了。又是什么使得调试器变成了瞎子，无法看得再远了呢？</p> 
<p align="left"><span style="color:#333333">欲见其详，且听下回分解</span></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">下面准备材料]</span></p> 
<p align="left"><span style="color:#333333">kernel_init</span><span style="color:#333333">对do_basic_setup</span>的调用被优化成内联函数</p> 
<p align="left"><span style="color:#333333">do_basic_setup</span><span style="color:#333333">对do_initcalls</span>的调用被优化成内联函数</p> 
<p align="left"><span style="color:#333333">do_initcalls</span><span style="color:#333333">对do_one_initcall</span>的调用被优化成内联函数</p> 
<p align="left"><span style="color:#333333">有三层的非内联函数都被被优化成内联函数，整个代码被优化的乱七八糟。</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">838 static int __init kernel_init(void *unused)</span></p> 
 <p align="left"><span style="color:#333333">839 {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">.....</span></p> 
 <p align="left"><span style="color:#333333">864         cpuset_init_smp();</span></p> 
 <p align="left"><span style="color:#333333">865 </span></p> 
 <p align="left"><span style="color:#333333">866         do_basic_setup();</span></p> 
 <p align="left"><span style="color:#333333">867 </span></p> 
 <p align="left"><span style="color:#333333">.......</span></p> 
 <p align="left"><span style="color:#333333">887         return 0;</span></p> 
 <p align="left"><span style="color:#333333">888 }</span></p> 
 <p align="left"><span style="color:#333333">                                               </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">static void __init do_basic_setup(void)</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      /*drivers will send hotplug events */</span></p> 
 <p align="left"><span style="color:#333333">      init_workqueues();</span></p> 
 <p align="left"><span style="color:#333333">      usermodehelper_init();</span></p> 
 <p align="left"><span style="color:#333333">      driver_init();</span></p> 
 <p align="left"><span style="color:#333333">      init_irq_proc();</span></p> 
 <p align="left"><span style="color:#333333">      do_initcalls();</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">741 static void __initdo_initcalls(void)</span></p> 
 <p align="left"><span style="color:#333333">742 {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">743         initcall_t *call;</span></p> 
 <p align="left"><span style="color:#333333">744 </span></p> 
 <p align="left"><span style="color:#333333">745         for (call = __initcall_start; call&lt; __initcall_end; call++)</span></p> 
 <p align="left"><span style="color:#333333">746                 do_one_initcall(*call);</span></p> 
 <p align="left"><span style="color:#333333">747 </span></p> 
 <p align="left"><span style="color:#333333">748         /* Make sure there is no pending stufffrom the initcall sequence */</span></p> 
 <p align="left"><span style="color:#333333">749         flush_scheduled_work();</span></p> 
 <p align="left"><span style="color:#333333">750 }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">static void __init do_one_initcall(initcall_tfn)</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      intcount = preempt_count();</span></p> 
 <p align="left"><span style="color:#333333">      ktime_tt0, t1, delta;</span></p> 
 <p align="left"><span style="color:#333333">      charmsgbuf[64];</span></p> 
 <p align="left"><span style="color:#333333">      intresult;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      if(initcall_debug) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               print_fn_descriptor_symbol("calling  %s\n", fn);</span></p> 
 <p align="left"><span style="color:#333333">               t0= ktime_get();</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      result= fn();</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      if(initcall_debug) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">....</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">static inline voidprint_fn_descriptor_symbol(const char *fmt, void *addr)</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">#if defined(CONFIG_IA64) ||defined(CONFIG_PPC64)</span></p> 
 <p align="left"><span style="color:#333333">      addr= *(void **)addr;</span></p> 
 <p align="left"><span style="color:#333333">#endif</span></p> 
 <p align="left"><span style="color:#333333">      print_symbol(fmt,(unsigned long)addr);</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(gdb) disass kernel_init</span></p> 
 <p align="left"><span style="color:#333333">Dump of assembler code for functionkernel_init:</span></p> 
 <p align="left"><span style="color:#333333">0xc037f349 &lt;kernel_init+0&gt;:     push  %ebp</span></p> 
 <p align="left"><span style="color:#333333">0xc037f34a &lt;kernel_init+1&gt;:     mov   %esp,%ebp</span></p> 
 <p align="left"><span style="color:#333333">0xc037f34c &lt;kernel_init+3&gt;:     push  %edi</span></p> 
 <p align="left"><span style="color:#333333">0xc037f34d &lt;kernel_init+4&gt;:     push  %esi</span></p> 
 <p align="left"><span style="color:#333333">......</span></p> 
 <p align="left"><span style="color:#333333">0xc037f413 &lt;kernel_init+202&gt;:   call   0xc0391454 &lt;cpuset_init_smp&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc037f418 &lt;kernel_init+207&gt;:   call  0xc0390081 &lt;init_workqueues&gt; //&lt;-do_basic_setup</span><span style="color:#333333">被优化成内联函数，在这里开始展开</span></p> 
 <p align="left"><span style="color:#333333">0xc037f41d &lt;kernel_init+212&gt;:   call  0xc039004e &lt;usermodehelper_init&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc037f422 &lt;kernel_init+217&gt;:   call  0xc039b7d1 &lt;driver_init&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc037f427 &lt;kernel_init+222&gt;:   call  0xc0153e18 &lt;init_irq_proc&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc037f42c &lt;kernel_init+227&gt;:   movl  $0xc03aa470,-0x5c(%ebp) //do_initcalls</span><span style="color:#333333">被优化成内联函数，在这里开始展开</span></p> 
 <p align="left"><span style="color:#333333">0xc037f433 &lt;kernel_init+234&gt;:   pop   %eax</span></p> 
 <p align="left"><span style="color:#333333">0xc037f434 &lt;kernel_init+235&gt;:   pop   %edx</span></p> 
 <p align="left"><span style="color:#333333">0xc037f435 &lt;kernel_init+236&gt;:   jmp   0xc037f559 &lt;kernel_init+528&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc037f43a &lt;kernel_init+241&gt;:   mov   -0x5c(%ebp),%eax //do_one_initcall</span><span style="color:#333333">被优化成内联函数，在这里开始展开</span></p> 
 <p align="left"><span style="color:#333333">0xc037f43d &lt;kernel_init+244&gt;:   mov   (%eax),%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc037f43f &lt;kernel_init+246&gt;:   mov   %eax,-0x58(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">0xc037f442 &lt;kernel_init+249&gt;:   mov   %esp,%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc037f444 &lt;kernel_init+251&gt;:   and   $0xffffe000,%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc037f449 &lt;kernel_init+256&gt;:   mov   0x14(%eax),%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc037f44c &lt;kernel_init+259&gt;:   cmpl  $0x0,0xc03a1820</span></p> 
 <p align="left"><span style="color:#333333">0xc037f453 &lt;kernel_init+266&gt;:   mov   %eax,-0x54(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">0xc037f456 &lt;kernel_init+269&gt;:   je    0xc037f470 &lt;kernel_init+295&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc037f458 &lt;kernel_init+271&gt;:   mov   -0x58(%ebp),%edx  //</span><span style="color:#333333">内联函数</span><span style="color:#333333">print_fn_descriptor_symbol</span><span style="color:#333333">在这里开始展开</span></p> 
 <p align="left"><span style="color:#333333">0xc037f45b &lt;kernel_init+274&gt;:   mov   $0xc030d1be,%eax</span></p> 
 <p align="left"><span style="color:#333333">0xc037f460 &lt;kernel_init+279&gt;:   call  0xc013f598 &lt;__print_symbol&gt;//</span><span style="color:#333333">内联函数</span><span style="color:#333333">print_fn_descriptor_symbo</span><span style="color:#333333">的展开结束</span></p> 
 <p align="left"><span style="color:#333333">0xc037f465 &lt;kernel_init+284&gt;:   call  0xc013352f &lt;ktime_get&gt;</span></p> 
 <p align="left"><span style="color:#333333">0xc037f46a &lt;kernel_init+289&gt;:   mov   %eax,-0x64(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">0xc037f46d &lt;kernel_init+292&gt;:   mov   %edx,-0x60(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">0xc037f470 &lt;kernel_init+295&gt;:   call  *-0x58(%ebp)  //do_one_initcall</span><span style="color:#333333">中的调用语句</span><span style="color:#333333">result = fn();</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">.....</span></p> 
 <p align="left"><span style="color:#333333">0xc037f553 &lt;kernel_init+522&gt;:   pop   %edi</span></p> 
 <p align="left"><span style="color:#333333">0xc037f554 &lt;kernel_init+523&gt;:   pop   %eax</span></p> 
 <p align="left"><span style="color:#333333">0xc037f555 &lt;kernel_init+524&gt;:   addl  $0x4,-0x5c(%ebp)</span></p> 
 <p align="left"><span style="color:#333333">0xc037f559 &lt;kernel_init+528&gt;:   cmpl  $0xc03aa804,-0x5c(%ebp) //</span></p> 
 <p align="left"><span style="color:#333333">0xc037f560 &lt;kernel_init+535&gt;:   jb    0xc037f43a &lt;kernel_init+241&gt; //</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">如何在汇编码中定位内联（或被优化掉的非内联）函数</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">1.</span><span style="color:#333333">利用前后相关函数的提示</span></p> 
 <p align="left"><span style="color:#333333">2.</span><span style="color:#333333">函数的前戏码定位函数的开始</span></p> 
 <p align="left"><span style="color:#333333">3.</span><span style="color:#333333">注意跳转语句</span></p> 
 <p align="left"><span style="color:#333333">4.</span><span style="color:#333333">利用调试器辅助定位</span><span style="color:#333333">(</span><span style="color:#333333">见</span><span style="color:#333333">gdb</span><span style="color:#333333">技巧</span><span style="color:#333333">)</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">调用树与调用图</span></strong></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">待充实]</span></p> 
<p align="left"><strong><span style="color:#333333">调用树的定义</span></strong></p> 
<p align="left"><span style="color:#333333">一个复杂的函数调用一定是调用了多个子函数，同时这些子函数又会调用若干“孙”函数，这样依次调用并依次返回到最初的父函数后，就形成了树状的调用关系，我们称之为“调用树”。</span></p> 
<p align="left"><strong><span style="color:#333333">调用树的作用</span></strong></p> 
<p align="left"><span style="color:#333333">函数调用树是比函数调用链更为复杂的观察对象。如果能够显示调用树，就可以对调用的整个过程有个直观的了解。</span></p> 
<p align="left"><strong><span style="color:#333333">调用树的分类</span></strong></p> 
<p align="left"><span style="color:#333333">函数调用树有两类：</span></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">抽象调用树</span></p> 
<p align="left"><span style="color:#333333">也叫虚拟调用树。比如在源码中，父函数调用了子函数a, b, c</span>。那么对这三个函数的调用逻辑都考虑进去，这就是“抽象调用”。抽象调用树能全面的描述了父函数的逻辑和代码开发员的意图。但是，在实际的环境中，这三个函数未必就全部会调用到。把在实际的具体情况下未调用的“潜在”调用关系去掉后，剩下的调用树就称为“具体调用树”。明显，具体调用树不能全面显示代码 开发员的意图，只是放映具体环境下函数的调用关系。</p> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">具体调用树</span></p> 
<p align="left"><span style="color:#333333">也叫实时调用树。解释见上。</span></p> 
<p align="left"><strong><span style="color:#333333">调用树的显示</span></strong></p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">抽象调用树的显示</span></p> 
<p align="left"><span style="color:#333333">借助source insight</span>等工具可以图形显示抽象调用树。</p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">具体调用树的显示</span></p> 
<p align="left"><span style="color:#333333">据本人的了解，目前gdb</span>没有一个类似”bt”那样的能显示函数调用树的命令，但是借助gdb宏也许能够实现显示调用树的功能，这有待研究。不过，目前已经有个现成的调试工具可以显示调用树，它就是 systemtap.</p> 
<p align="left"><span style="color:#333333">效果如下：</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">[...]</span></p> 
 <p align="left"><span style="color:#333333">    0 klogd(1391):-&gt;sys_read</span></p> 
 <p align="left"><span style="color:#333333">   14 klogd(1391): -&gt;fget_light</span></p> 
 <p align="left"><span style="color:#333333">   22 klogd(1391): &lt;-fget_light</span></p> 
 <p align="left"><span style="color:#333333">   27 klogd(1391): -&gt;vfs_read</span></p> 
 <p align="left"><span style="color:#333333">   35 klogd(1391): -&gt;rw_verify_area</span></p> 
 <p align="left"><span style="color:#333333">   43 klogd(1391): &lt;-rw_verify_area</span></p> 
 <p align="left"><span style="color:#333333">   49 klogd(1391):  -&gt;kmsg_read</span></p> 
 <p align="left"><span style="color:#333333">    0 sendmail(1696):-&gt;sys_read</span></p> 
 <p align="left"><span style="color:#333333">   17 sendmail(1696): -&gt;fget_light</span></p> 
 <p align="left"><span style="color:#333333">   26 sendmail(1696): &lt;-fget_light</span></p> 
 <p align="left"><span style="color:#333333">   34 sendmail(1696): -&gt;vfs_read</span></p> 
 <p align="left"><span style="color:#333333">   44 sendmail(1696): -&gt;rw_verify_area</span></p> 
 <p align="left"><span style="color:#333333">   52 sendmail(1696): &lt;-rw_verify_area</span></p> 
 <p align="left"><span style="color:#333333">   58 sendmail(1696): -&gt;proc_file_read</span></p> 
 <p align="left"><span style="color:#333333">   70 sendmail(1696):  -&gt;loadavg_read_proc</span></p> 
 <p align="left"><span style="color:#333333">   84 sendmail(1696):   -&gt;proc_calc_metrics</span></p> 
 <p align="left"><span style="color:#333333">   92 sendmail(1696):   &lt;-proc_calc_metrics</span></p> 
 <p align="left"><span style="color:#333333">   95 sendmail(1696):  &lt;-loadavg_read_proc</span></p> 
 <p align="left"><span style="color:#333333">  101 sendmail(1696): &lt;-proc_file_read</span></p> 
 <p align="left"><span style="color:#333333">  106 sendmail(1696): -&gt;dnotify_parent</span></p> 
 <p align="left"><span style="color:#333333">  115 sendmail(1696): &lt;-dnotify_parent</span></p> 
 <p align="left"><span style="color:#333333">  119 sendmail(1696): -&gt;inotify_dentry_parent_queue_event</span></p> 
 <p align="left"><span style="color:#333333">  127 sendmail(1696):  &lt;-inotify_dentry_parent_queue_event</span></p> 
 <p align="left"><span style="color:#333333">  133 sendmail(1696): -&gt;inotify_inode_queue_event</span></p> 
 <p align="left"><span style="color:#333333">  141 sendmail(1696): &lt;-inotify_inode_queue_event</span></p> 
 <p align="left"><span style="color:#333333">  146 sendmail(1696): &lt;-vfs_read</span></p> 
 <p align="left"><span style="color:#333333">  151 sendmail(1696):&lt;-sys_read</span></p> 
 <p align="left"><span style="color:#333333">[...]</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">见于</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://sourceware.org/systemtap/wiki/WSCallGraph?highlight=" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceware.org/systemtap/wiki/WSCallGraph?highlight=</span></a><a target="_blank" href="http://my.oschina.net/fgq611/admin/#fn__1" rel="nofollow noopener noreferrer"><span style="color:#FF8373">1)</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">调用树的拼接</span></strong></p> 
<p align="left"><span style="color:#333333">对于一个更刁的函数调用来说，利用工具显示的抽象调用树和具体调用调用树可能是不完整的。比如，对于抽象调用树来说，它的显示工具是source insight</span>。但是如果这个函数对某个子函数或在更下层的函数对下下层的函数调用是通过函数指针来调用的，那么source insight显示的调用树中就会漏掉通过函数指针调用的子函数，以及以子函数为根的子调用树。这是因为函数指针变量的赋值是发生在代码动态运行时的。 source insight无法利用静态的源码就捕捉到未来才出现东西，甚至它也无法在形式上解析出“那里存在一个利用函数指针的调用”。这就要通过阅读源码来找出这种调用关系。同时，可以利用调试器实时找出具体情况下是通过那个函数指针调用了哪个特定的下层函数。这样就能把漏掉的子调用树拼接到父调用树中。</p> 
<p align="left"><span style="color:#333333">可见，这些内容又回归到了调用链的内容。具体看前面。</span></p> 
<p align="left"><strong><span style="color:#333333">调用图</span></strong></p> 
<p align="left"><span style="color:#333333">各函数间的像蜘蛛网一样的调用关系的图形表示就是调用图了，显然它比调用树更复杂。</span></p> 
<p align="left"><strong><span style="color:#333333">穿越盲区</span></strong></p> 
<p align="left"><span style="color:#333333">本节意义：经过上面章节的叙述，利用源码交叉索引工具＋调试器已经能解决大部分问题，但是因为调试器和交叉索引工具的各自局限性，依然会存在一些问题。本节尝试如何联合交叉索引工具以及调试器再加上人脑来解决各自的缺点。</span></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">观察积累中，待扩展]</span></p> 
<p align="left"><strong><span style="color:#333333">穿越gdb</span>的盲区</strong></p> 
<p align="left"><strong><span style="color:#333333">进程切换</span></strong></p> 
<p align="left"><strong><span style="color:#333333">中断异常</span></strong></p> 
<p align="left"><strong><span style="color:#333333">系统调用</span></strong></p> 
<p align="left"><strong><span style="color:#333333">穿越交叉索引工具的盲区</span></strong></p> 
<p align="left"><strong><span style="color:#333333">函数指针</span></strong></p> 
<p align="left"><span style="color:#333333">该小节内容移到了： 调用链的状态→函数指针调用</span></p> 
<p align="left"><strong><span style="color:#333333">查看函数的参数</span></strong></p> 
<p align="left"><span style="color:#333333">我们知道，一个函数的计算结果并不都是通过它的返回值返回的，有时会通过函数的参数返回真正感兴趣的数据。看内核源码的时候，如果调用链过长，涉及内容和数据结构过多的话，往往是看到最后都记不住函数的参数哪些是已经“初始化的”。</span></p> 
<p align="left"><span style="color:#333333">这也是交叉索引工具无法克服的先天弱点。它能动态索引源码，却无法动态查看数据。此时，可以利用gdb</span>给目标函数下断点，而后可以用命令info args查看参数，另外命令info local可查看本地变量。当然在ddd下查看效果会更好。</p> 
<p align="left"><span style="color:#333333">内容简单，不展开了。</span></p> 
<p align="left"><strong><span style="color:#333333">工程方法</span></strong></p> 
<p align="left"><strong><span style="color:#333333">二叉断点</span></strong></p> 
<p align="left"><span style="color:#333333">实例 “什么/proc</span>下无法创建目录？”</p> 
<p align="left"><strong><span style="color:#333333">给调用指令下断点</span></strong></p> 
<p align="left"><span style="color:#333333">如果对目标函数下断点后，受到很多骚扰，那么就转为在上层函数内对目标函数的调用指令处下断点。如果你已经进入了上层函数，对调用指令下断点，是更为精确的断点方法。</span></p> 
<p align="left"><strong><span style="color:#333333">绕过时钟中断的干扰</span></strong></p> 
<p align="left"><span style="color:#333333">有时我们调试的程序与中断无关的，但是由于时钟中断的异步到来，在调试过程中经常会自动进入时钟中断处理例程中，这严重干扰了我们的工作。用下面的方法可绕过时钟中断的干扰。</span></p> 
<p align="left"><span style="color:#333333">注：</span></p> 
<p align="left"><span style="color:#333333">使用GDB</span>与QEMU调试内核时的问题分析： <a target="_blank" href="http://www.chinaitlab.com/linux/kernel/356774.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.chinaitlab.com/linux/kernel/356774.html</span></a></p> 
<p align="left"><span style="color:#333333">关于qemu</span>在单步指令时进入时钟中断的问题，上面给出链接给出了比较“深入”地探讨。这个问题涉及虚拟机本身，有人说是虚拟机相对于真机的固有缺陷，似乎很深奥，我没那个能力也没那个时间研究。但是我们应该知道，如果问题足够的复杂，以至于解决它要花费太高的代价，那么绕过这个问题是个更明智的解 决方法。</p> 
<p align="left"><span style="color:#333333">解决方法(</span>手工)</p> 
<p align="left"><span style="color:#333333">1. </span><span style="color:#333333">内核启动早期</span></p> 
<p align="left"><span style="color:#333333">事先下两个断点</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">b common_interrupt</span></p> 
 <p align="left"><span style="color:#333333">b native_iret</span></p> 
</div> 
<p align="left"><span style="color:#333333">自定义返回命令</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) define ooi</span></p> 
 <p align="left"><span style="color:#333333">Type commands for definition of"ooi".</span></p> 
 <p align="left"><span style="color:#333333">End with a line saying just"end".</span></p> 
 <p align="left"><span style="color:#333333">&gt;c</span></p> 
 <p align="left"><span style="color:#333333">&gt;stepi</span></p> 
 <p align="left"><span style="color:#333333">&gt;end</span></p> 
</div> 
<p align="left"><span style="color:#333333">一旦时钟中断产生，就会拦截在中断处理的通用入口common_interrupt</span>，然后运行返回指令，就会“回到”被时钟中断打断的原指令处</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">ooi</span></p> 
</div> 
<p align="left"><span style="color:#333333">2. </span><span style="color:#333333">内核启动完毕</span></p> 
<p align="left"><span style="color:#333333">事先下两个断点</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">b apic_timer_interrupt</span></p> 
 <p align="left"><span style="color:#333333">b irq_return</span></p> 
</div> 
<p align="left"><span style="color:#333333">一旦时钟中断产生，就会拦截在中断处理例程apic_timer_interrupt</span>，然后运行返回指令，就会“回到”被时钟中断打断的原指令处</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">ooi</span></p> 
 <p align="left"><span style="color:#333333">分析记录，待整理</span></p> 
 <p align="left"><span style="color:#333333">提示，分析异常和中断的处理过程比分析</span><span style="color:#333333">C</span><span style="color:#333333">代码更直观，因为源码本身是汇编码。</span></p> 
 <p align="left"><span style="color:#333333">  ┌──arch/x86/kernel/entry_32.S─────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">  │614             SAVE_ALL                                                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │615            TRACE_IRQS_OFF                                                                                          │</span></p> 
 <p align="left"><span style="color:#333333">  │616             movl%esp,%eax                                                                                           │</span></p> 
 <p align="left"><span style="color:#333333">  │617             call do_IRQ                                                                                             │</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│618             jmpret_from_intr                                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │619    ENDPROC(common_interrupt)                                                                                       │</span></p> 
 <p align="left"><span style="color:#333333">  │620             CFI_ENDPROC                                                                                              │</span></p> 
 <p align="left"><span style="color:#333333">  │621                                                                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │622     #defineBUILD_INTERRUPT(name, nr)       \                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │623     ENTRY(name)                             \                                                                       │</span></p> 
 <p align="left"><span style="color:#333333">  │624            RING0_INT_FRAME;               \                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │625             pushl$~(nr);                   \                                                                       │</span></p> 
 <p align="left"><span style="color:#333333">  │626            CFI_ADJUST_CFA_OFFSET 4;       \                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │627             SAVE_ALL;                       \                                                                       │</span></p> 
 <p align="left"><span style="color:#333333">  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01043e1 &lt;common_interrupt+17&gt;        mov   %edx,%ds                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01043e3 &lt;common_interrupt+19&gt;        mov   %edx,%es                                                                  │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01043e5 &lt;common_interrupt+21&gt;        mov   $0xd8,%edx                                                               │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01043ea &lt;common_interrupt+26&gt;        mov   %edx,%fs                                                                  │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01043ec &lt;common_interrupt+28&gt;        mov   %esp,%eax                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01043ee &lt;common_interrupt+30&gt;        call  0xc0106151 &lt;do_IRQ&gt;                                                       │</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│0xc01043f3 &lt;common_interrupt+35&gt;        jmp   0xc01038dc &lt;ret_from_exception&gt;                                           │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01043f8 &lt;reschedule_interrupt&gt;       push  $0xffffff03                                                               │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01043fd &lt;reschedule_interrupt+5&gt;     cld                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01043fe &lt;reschedule_interrupt+6&gt;     push  %fs                                                                       │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0104400 &lt;reschedule_interrupt+8&gt;     push  %es                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0104401 &lt;reschedule_interrupt+9&gt;     push  %ds                                                                       │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0104402 &lt;reschedule_interrupt+10&gt;    push  %eax                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0104403 &lt;reschedule_interrupt+11&gt;    push  %ebp                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333">remote Thread 42000 In:common_interrupt                                                            Line: 618  PC: 0xc01043f3 </span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333">(gdb)  </span></p> 
 <p align="left"><span style="color:#333333">(gdb) bt</span></p> 
 <p align="left"><span style="color:#333333">#0 common_interrupt () at arch/x86/kernel/entry_32.S:618</span></p> 
 <p align="left"><span style="color:#333333">#1 0x00000292 in ?? ()</span></p> 
 <p align="left"><span style="color:#333333">#2 0xc01880db in alloc_vfsmnt (name=0xc031dcf3 "rootfs") atinclude/linux/slab.h:266</span></p> 
 <p align="left"><span style="color:#333333">#3 0xc0176919 in vfs_kern_mount (type=0xc0359678, flags=0, name=0xc031dcf3"rootfs", data=0x0) at fs/super.c:896</span></p> 
 <p align="left"><span style="color:#333333">#4 0xc0176a2f in do_kern_mount (fstype=0xc031dcf3 "rootfs",flags=0, name=0xc031dcf3 "rootfs", data=0x0) at fs/super.c:968</span></p> 
 <p align="left"><span style="color:#333333">#5 0xc0393b33 in mnt_init () at fs/namespace.c:2285</span></p> 
 <p align="left"><span style="color:#333333">#6 0xc039382b in vfs_caches_init (mempages=108676) at fs/dcache.c:2212</span></p> 
 <p align="left"><span style="color:#333333">#7 0xc037f868 in start_kernel () at init/main.c:666</span></p> 
 <p align="left"><span style="color:#333333">#8 0xc037f008 in i386_start_kernel () at arch/x86/kernel/head32.c:13</span></p> 
 <p align="left"><span style="color:#333333">#9 0x00000000 in ?? ()</span></p> 
 <p align="left"><span style="color:#333333">(gdb) disass</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333">----</span></p> 
 <p align="left"><span style="color:#333333">  ┌──arch/x86/kernel/entry_32.S─────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">  │401             cmpl$((SEGMENT_LDT &lt;&lt; 8) | USER_RPL), %eax                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │402            CFI_REMEMBER_STATE                                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │403             je ldt_ss                       # returning touser-space with LDT SS                                   │</span></p> 
 <p align="left"><span style="color:#333333">  │404     restore_nocheck:                                                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │405            TRACE_IRQS_IRET                                                                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │406    restore_nocheck_notrace:                                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │407             RESTORE_REGS                                                                                            │</span></p> 
 <p align="left"><span style="color:#333333">   │408             addl $4, %esp                   # skiporig_eax/error_code                                              │</span></p> 
 <p align="left"><span style="color:#333333">  │409            CFI_ADJUST_CFA_OFFSET -4                                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │410     irq_return:                                                                                                     │</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│411            INTERRUPT_RETURN                                                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │412     .section.fixup,"ax"                                                                                            │</span></p> 
 <p align="left"><span style="color:#333333">  │413     ENTRY(iret_exc)                                                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │414             pushl $0                        # no error code                                                         │</span></p> 
 <p align="left"><span style="color:#333333">  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a61 &lt;restore_nocheck_notrace&gt;    pop   %ebx                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a62 &lt;restore_nocheck_notrace+1&gt;  pop   %ecx                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a63 &lt;restore_nocheck_notrace+2&gt;  pop   %edx                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a64 &lt;restore_nocheck_notrace+3&gt;  pop   %esi                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a65 &lt;restore_nocheck_notrace+4&gt;  pop   %edi                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a66 &lt;restore_nocheck_notrace+5&gt;  pop   %ebp                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a67 &lt;restore_nocheck_notrace+6&gt;  pop   %eax                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a68 &lt;restore_nocheck_notrace+7&gt;  pop   %ds                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a69 &lt;restore_nocheck_notrace+8&gt;  pop   %es                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a6a &lt;restore_nocheck_notrace+9&gt;  pop   %fs                                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a6c &lt;restore_nocheck_notrace+11&gt; add    $0x4,%esp                                                                │</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│0xc0103a6f &lt;irq_return&gt;                 jmp    *%cs:0xc0353b54                                                          │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a76 &lt;ldt_ss&gt;                     lar    0x3c(%esp),%eax                                                          │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0103a7b &lt;ldt_ss+5&gt;                   jne    0xc0103a61&lt;restore_nocheck_notrace&gt;                                     │</span></p> 
 <p align="left"><span style="color:#333333">  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333">remote Thread 42000 In: irq_return                                                                 Line: 411  PC: 0xc0103a6f </span></p> 
 <p align="left"><span style="color:#333333">(gdb) stepi</span></p> 
 <p align="left"><span style="color:#333333">0xc0103a64 in restore_nocheck_notrace ()at arch/x86/kernel/entry_32.S:407</span></p> 
 <p align="left"><span style="color:#333333">0xc0103a65 in restore_nocheck_notrace ()at arch/x86/kernel/entry_32.S:407</span></p> 
 <p align="left"><span style="color:#333333">0xc0103a66 in restore_nocheck_notrace ()at arch/x86/kernel/entry_32.S:407</span></p> 
 <p align="left"><span style="color:#333333">Watchpoint 3: $ebp</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Old value = (void *) 0xc0378000</span></p> 
 <p align="left"><span style="color:#333333">New value = (void *) 0xc0379f4c</span></p> 
 <p align="left"><span style="color:#333333">0xc0103a67 in restore_nocheck_notrace ()at arch/x86/kernel/entry_32.S:407</span></p> 
 <p align="left"><span style="color:#333333">0xc0103a68 in restore_nocheck_notrace ()at arch/x86/kernel/entry_32.S:407</span></p> 
 <p align="left"><span style="color:#333333">0xc0103a69 in restore_nocheck_notrace ()at arch/x86/kernel/entry_32.S:407</span></p> 
 <p align="left"><span style="color:#333333">0xc0103a6a in restore_nocheck_notrace ()at arch/x86/kernel/entry_32.S:407</span></p> 
 <p align="left"><span style="color:#333333">restore_nocheck_notrace () atarch/x86/kernel/entry_32.S:408</span></p> 
 <p align="left"><span style="color:#333333">irq_return () atarch/x86/kernel/entry_32.S:411</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333">------------</span></p> 
 <p align="left"><span style="color:#333333">  ┌──arch/x86/kernel/entry_32.S─────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">  │864             jmpirq_return                                                                                          │</span></p> 
 <p align="left"><span style="color:#333333">  │865             CFI_ENDPROC                                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │866     KPROBE_END(nmi)                                                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │867                                                                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │868     #ifdefCONFIG_PARAVIRT                                                                                          │</span></p> 
 <p align="left"><span style="color:#333333">  │869     ENTRY(native_iret)                                                                                              │</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│870             iret                                                                                                    │</span></p> 
 <p align="left"><span style="color:#333333">  │871     .section __ex_table,"a"                                                                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │872             .align 4                                                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │873             .long native_iret, iret_exc                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │874     .previous                                                                                                       │</span></p> 
 <p align="left"><span style="color:#333333">  │875     END(native_iret)                                                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │876                                                                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │877     ENTRY(native_irq_enable_syscall_ret)                                                                            │</span></p> 
 <p align="left"><span style="color:#333333">  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│0xc01045a8 &lt;native_iret&gt;                        iret                                                                    │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045a9                                      lea    0x0(%esi),%esi                                                   │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045ac &lt;native_irq_enable_syscall_ret&gt;      sti                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045ad &lt;native_irq_enable_syscall_ret+1&gt;    sysexit                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045af                                      nop                                                                     │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045b0 &lt;overflow&gt;                           push   $0x0                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045b2 &lt;overflow+2&gt;                         push   $0xc0105030                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045b7 &lt;overflow+7&gt;                         jmp    0xc02bfb80 &lt;page_fault+8&gt;                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045bc &lt;bounds&gt;                             push   $0x0                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045be &lt;bounds+2&gt;                           push   $0xc0104fe3                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045c3 &lt;bounds+7&gt;                           jmp    0xc02bfb80 &lt;page_fault+8&gt;                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045c8 &lt;invalid_op&gt;                         push   $0x0                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045ca &lt;invalid_op+2&gt;                       push   $0xc0104f6d                                                      │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01045cf &lt;invalid_op+7&gt;                       jmp    0xc02bfb80 &lt;page_fault+8&gt;                                         │</span></p> 
 <p align="left"><span style="color:#333333">  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333">remote Thread 42000 In: native_iret                                                                Line: 870  PC: 0xc01045a8 </span></p> 
 <p align="left"><span style="color:#333333">#9 0x00000000 in ?? ()</span></p> 
 <p align="left"><span style="color:#333333">(gdb) stepi</span></p> 
 <p align="left"><span style="color:#333333">native_iret () atarch/x86/kernel/entry_32.S:870</span></p> 
 <p align="left"><span style="color:#333333">(gdb) bt</span></p> 
 <p align="left"><span style="color:#333333">#0 native_iret () at arch/x86/kernel/entry_32.S:870</span></p> 
 <p align="left"><span style="color:#333333">#1 0xc0172198 in kmem_cache_alloc (cachep=0xdc404ec0, flags=&lt;valueoptimized out&gt;) at include/asm/string_32.h:183</span></p> 
 <p align="left"><span style="color:#333333">#2 0xc01880db in alloc_vfsmnt (name=0xc031dcf3 "rootfs") atinclude/linux/slab.h:266</span></p> 
 <p align="left"><span style="color:#333333">#3 0xc0176919 in vfs_kern_mount (type=0xc0359678, flags=0, name=0xc031dcf3"rootfs", data=0x0) at fs/super.c:896</span></p> 
 <p align="left"><span style="color:#333333">#4 0xc0176a2f in do_kern_mount (fstype=0xc031dcf3 "rootfs",flags=0, name=0xc031dcf3 "rootfs", data=0x0) at fs/super.c:968</span></p> 
 <p align="left"><span style="color:#333333">#5 0xc0393b33 in mnt_init () at fs/namespace.c:2285</span></p> 
 <p align="left"><span style="color:#333333">#6 0xc039382b in vfs_caches_init (mempages=108676) at fs/dcache.c:2212</span></p> 
 <p align="left"><span style="color:#333333">#7 0xc037f868 in start_kernel () at init/main.c:666</span></p> 
 <p align="left"><span style="color:#333333">#8 0xc037f008 in i386_start_kernel () at arch/x86/kernel/head32.c:13</span></p> 
 <p align="left"><span style="color:#333333">#9 0x00000000 in ?? ()</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333">－－－－－－－－－－－－－－－－－－－－－－－－－－－－－</span></p> 
 <p align="left"><span style="color:#333333">  ┌──mm/slab.c──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">   │3478            if (unlikely((flags &amp;__GFP_ZERO) &amp;&amp; objp))                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │3479                   memset(objp, 0, obj_size(cachep));                                                              │</span></p> 
 <p align="left"><span style="color:#333333">  │3480                                                                                                                    │</span></p> 
 <p align="left"><span style="color:#333333">  │3481            return objp;                                                                                            │</span></p> 
 <p align="left"><span style="color:#333333">  │3482    }                                                                                                               │</span></p> 
 <p align="left"><span style="color:#333333">  │3483                                                                                                                    │</span></p> 
 <p align="left"><span style="color:#333333">  │3484    /*                                                                                                              │</span></p> 
 <p align="left"><span style="color:#333333">  │3485     * Caller needs toacquire correct kmem_list's list_lock                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │3486     */                                                                                                             │</span></p> 
 <p align="left"><span style="color:#333333">  │3487    static voidfree_block(struct kmem_cache *cachep, void **objpp, int nr_objects,                                  │</span></p> 
 <p align="left"><span style="color:#333333">  │3488                           int node)                                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │3489    {                                                                                                               │</span></p> 
 <p align="left"><span style="color:#333333">  │3490            int i;                                                                                                  │</span></p> 
 <p align="left"><span style="color:#333333">  │3491            struct kmem_list3*l3;                                                                                  │</span></p> 
 <p align="left"><span style="color:#333333">  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0172183 &lt;kmem_cache_alloc+100&gt;       cmpw  $0x0,-0x14(%ebp)                                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0172188 &lt;kmem_cache_alloc+105&gt;       jns   0xc01721a7 &lt;kmem_cache_alloc+136&gt;                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017218a &lt;kmem_cache_alloc+107&gt;       test  %edi,%edi                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017218c &lt;kmem_cache_alloc+109&gt;       je    0xc01721a7 &lt;kmem_cache_alloc+136&gt;                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017218e &lt;kmem_cache_alloc+111&gt;       mov   0x2c(%esi),%edx                                                          │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0172191 &lt;kmem_cache_alloc+114&gt;       xor   %eax,%eax                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0172193 &lt;kmem_cache_alloc+116&gt;       mov   %edx,%ecx                                                                │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc0172195 &lt;kmem_cache_alloc+118&gt;       shr   $0x2,%ecx                                                                │</span></p> 
 <p align="left"><span style="color:#333333"> &gt;│0xc0172198 &lt;kmem_cache_alloc+121&gt;       rep stos %eax,%es:(%edi)                                                        │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017219a &lt;kmem_cache_alloc+123&gt;       test  $0x2,%dl                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017219d &lt;kmem_cache_alloc+126&gt;       je    0xc01721a1 &lt;kmem_cache_alloc+130&gt;                                         │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc017219f &lt;kmem_cache_alloc+128&gt;       stos  %ax,%es:(%edi)                                                           │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01721a1 &lt;kmem_cache_alloc+130&gt;       test  $0x1,%dl                                                                 │</span></p> 
 <p align="left"><span style="color:#333333">  │0xc01721a4 &lt;kmem_cache_alloc+133&gt;       je    0xc01721a7 &lt;kmem_cache_alloc+136&gt;                                         │</span></p> 
 <p align="left"><span style="color:#333333">  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></p> 
 <p align="left"><span style="color:#333333">remote Thread 42000 In: kmem_cache_alloc                                                           Line: 183  PC: 0xc0172198 </span></p> 
 <p align="left"><span style="color:#333333">#7 0xc037f008 in i386_start_kernel () at arch/x86/kernel/head32.c:13</span></p> 
 <p align="left"><span style="color:#333333">#8 0x00000000 in ?? ()</span></p> 
 <p align="left"><span style="color:#333333">(gdb) bt</span></p> 
 <p align="left"><span style="color:#333333">#0 0xc0172198 in kmem_cache_alloc (cachep=0xdc404ec0, flags=&lt;valueoptimized out&gt;) at include/asm/string_32.h:183</span></p> 
 <p align="left"><span style="color:#333333">#1 0xc01880db in alloc_vfsmnt (name=0xc031dcf3 "rootfs") atinclude/linux/slab.h:266</span></p> 
 <p align="left"><span style="color:#333333">#2 0xc0176919 in vfs_kern_mount (type=0xc0359678, flags=0, name=0xc031dcf3"rootfs", data=0x0) at fs/super.c:896</span></p> 
 <p align="left"><span style="color:#333333">#3 0xc0176a2f in do_kern_mount (fstype=0xc031dcf3 "rootfs",flags=0, name=0xc031dcf3 "rootfs", data=0x0) at fs/super.c:968</span></p> 
 <p align="left"><span style="color:#333333">#4 0xc0393b33 in mnt_init () at fs/namespace.c:2285</span></p> 
 <p align="left"><span style="color:#333333">#5 0xc039382b in vfs_caches_init (mempages=108676) at fs/dcache.c:2212</span></p> 
 <p align="left"><span style="color:#333333">#6 0xc037f868 in start_kernel () at init/main.c:666</span></p> 
 <p align="left"><span style="color:#333333">#7 0xc037f008 in i386_start_kernel () at arch/x86/kernel/head32.c:13</span></p> 
 <p align="left"><span style="color:#333333">#8 0x00000000 in ?? ()</span></p> 
 <p align="left"><span style="color:#333333">(gdb) list</span></p> 
 <p align="left"><span style="color:#333333">(gdb) disass</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">bug </span><span style="color:#333333">与 OOPS</span></strong></p> 
<p align="left"><span style="color:#333333">［主要研究定位bug</span>的技巧，找出是哪条指令引发了panic似乎很容易。但要找出错误产生的源头似乎是门艺术了］</p> 
<p align="left"><span style="color:#333333">经过上面章节的叙述，本小节问题的解决已不成问题了。不再展开叙述。可以参考下面链接。</span></p> 
<p align="left"><span style="color:#333333">参考手册</span></p> 
<p align="left"><span style="color:#333333">“Using kgdb and thekgdb Internals</span>” <a target="_blank" href="http://www.kernel.org/pub/linux/kernel/people/jwessel/kgdb/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.kernel.org/pub/linux/kernel/people/jwessel/kgdb/index.html</span></a></p> 
<p align="left"><span style="color:#333333">kgdb</span><span style="color:#333333">官网 <a target="_blank" href="http://kgdb.linsyssoft.com/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://kgdb.linsyssoft.com/</span></a></span></p> 
<p align="left"><span style="color:#333333">参考书籍（freeebsd</span>）</p> 
<p align="left"><span style="color:#333333">“Debugging KernelProblems</span>” <a target="_blank" href="http://www.google.cn/search?q=Debugging+Kernel+Problems&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=com.ubuntu:zh-CN:unofficial&amp;client=firefox-a" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.google.cn/search?q=Debugging+Kernel+Problems&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=com.ubuntu:zh-CN:unofficial&amp;client=firefox-a</span></a></p> 
<p align="left"><span style="color:#333333">“Chapter 10 KernelDebugging</span>” <a target="_blank" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/developers-handbook/kerneldebug.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.freebsd.org/doc/en_US.ISO8859-1/books/developers-handbook/kerneldebug.html</span></a></p> 
<p align="left"><span style="color:#333333">参考书籍(linux)</span></p> 
<p align="left"><span style="color:#333333">Chapter 14. KernelDebugging Techniques of </span><span style="color:#333333">“Embedded Linux Primer: A Practical, Real-World Approach</span>”</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://book.opensourceproject.org.cn/embedded/embeddedprime/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://book.opensourceproject.org.cn/embedded/embeddedprime/</span></a></span></p> 
<p align="left"><span style="color:#333333">参考文章</span></p> 
<p align="left"><span style="color:#333333">“掌握 Linux </span>调试技术” <a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/sdk/l-debug/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/sdk/l-debug/index.html</span></a></p> 
<p align="left"><span style="color:#333333">“定位Oops</span>的具体代码行” <a target="_blank" href="http://blog.chinaunix.net/u/12592/showart_1092733.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u/12592/showart_1092733.html</span></a></p> 
<p align="left"><span style="color:#333333">“跟踪内核 oops</span>” <a target="_blank" href="http://wiki.zh-kernel.org/doc/oops-tracing.txt" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.zh-kernel.org/doc/oops-tracing.txt</span></a></p> 
<p align="left"><span style="color:#333333">“例解Linux KernelDebug</span>” <a target="_blank" href="http://blog.chinaunix.net/u/2108/showart_164703.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u/2108/showart_164703.html</span></a></p> 
<p align="left"><span style="color:#333333">“kernel debug</span>的一些小手段” <a target="_blank" href="http://blog.chinaunix.net/u/12592/showart_499502.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u/12592/showart_499502.html</span></a></p> 
<p align="left"><span style="color:#333333">“Kernel DebuggingTechniques</span>” <a target="_blank" href="http://www.linuxjournal.com/article/9252" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxjournal.com/article/9252</span></a></p> 
<p align="left"><span style="color:#333333">［参考文章］有的已过时，而且深度不够。</span></p> 
<p align="left"><strong><span style="color:#333333">网站</span></strong></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://bugzilla.kernel.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://bugzilla.kernel.org/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.kerneloops.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.kerneloops.org/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.lkml.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.lkml.org/</span></a> </span><span style="color:#333333">搜索bug</span></p> 
<p align="left"><strong><span style="color:#333333">***</span><span style="color:#333333">第二部分：内核分析***</span></strong></p> 
<p align="left"><span style="color:#333333">这部分的内容侧重于内核原理分析，其中涉及gdb</span>调试器的内容不是很多，但它起的作用很关键，主要用于观察内核数据的生成及变化，在对源码理解有困惑时用于验证自己的猜想。另外，gdb一个很重要的功能是，拦截通过函数指针调用的函数，从而追溯整个调用链，交叉索引工具无法做到这点。</p> 
<p align="left"><span style="color:#333333">另外，调试内核时，利用gdb</span>的“list 函数名”命令看到的C代码都是当前处理器当前配置下内核实际运行的函数版本:”disass 函数名”看到的都是处理器实际运行时的机器代码，也就是说define语句和inline函数已经被编译器处理了，而且编译器也完成了优化。所以，gdb 本身就是一种不可替代的源码浏览工具，它能筛选掉出实际运行的函数版本，又能呈现出实际运行的机器码。</p> 
<p align="left"><strong><span style="color:#333333">调试相关子系统</span></strong></p> 
<p align="left"><strong><span style="color:#333333">kgdb</span><span style="color:#333333">源码分析</span></strong></p> 
<p align="left"><span style="color:#333333">gdb</span><span style="color:#333333">远程串口协议</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://sourceware.org/gdb/current/onlinedocs/gdb_34.html#SEC706" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceware.org/gdb/current/onlinedocs/gdb_34.html#SEC706</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.huihoo.org/mirrors/pub/embed/document/debugger/ew_GDB_RSP.pdf" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.huihoo.org/mirrors/pub/embed/document/debugger/ew_GDB_RSP.pdf</span></a></span></p> 
<p align="left"><span style="color:#333333">Jason Wessel</span><span style="color:#333333">的linux-2.6-kgdb.git</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://git.kernel.org/?p=linux/kernel/git/jwessel/linux-2.6-kgdb.git;a=summary" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://git.kernel.org/?p=linux/kernel/git/jwessel/linux-2.6-kgdb.git;a=summary</span></a></span></p> 
<p align="left"><span style="color:#333333">gdb</span><span style="color:#333333">调试模式</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) set debug serial 1</span></p> 
 <p align="left"><span style="color:#333333">(gdb) set debug remote 1</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">sysrq</span></strong></p> 
<p align="left"><strong><span style="color:#333333">oprofile</span></strong></p> 
<p align="left"><strong><span style="color:#333333">kprobes</span></strong></p> 
<p align="left"><strong><span style="color:#333333">驱动分析</span></strong></p> 
<p align="left"><span style="color:#333333">［分析一个简单的驱动，观察函数调用流程。重点观察驱动与驱动模型，以及和系统内核的交互过程。比如，中断的整个生命周期。］</span></p> 
<p align="left"><span style="color:#333333">参考：</span></p> 
<p align="left"><span style="color:#333333">“Debugging kernelmodules</span>” <a target="_blank" href="http://lwn.net/Articles/90913/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://lwn.net/Articles/90913/</span></a></p> 
<p align="left"><span style="color:#333333">“Linux </span>系统内核的调试” <a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-kdb/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-kdb/</span></a></p> 
<p align="left"><span style="color:#333333">“Linux </span>可加载内核模块剖析” <a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-lkm/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-lkm/</span></a></p> 
<p align="left"><span style="color:#333333">“使用 KGDB </span>调试 Linux 内核” <a target="_blank" href="http://blog.chinaunix.net/u/8057/showart_1087126.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u/8057/showart_1087126.html</span></a></p> 
<p align="left"><span style="color:#333333">“使用 /proc </span>文件系统来访问 Linux 内核的内容” <a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-proc.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-proc.html</span></a></p> 
<p align="left"><span style="color:#333333">如何查找出当前系统所安装模块驱动对应的源码，从而对其做些修改等实验？</span></p> 
<p align="left"><span style="color:#333333">提示：</span></p> 
<p align="left"><span style="color:#333333">1. lsmod </span><span style="color:#333333">列出模块名</span></p> 
<p align="left"><span style="color:#333333">2. modinfo </span><span style="color:#333333">模块名， 查看模块信息</span></p> 
<p align="left"><span style="color:#333333">3. </span><span style="color:#333333">模块名，模块信息中的别名，模块的参数说明文字都可结合source insight</span>查找该模块的源码文件；模块信息中的模块路径也可用来定位对应源码的路径以及相关的kconfig文件，从而获取更多相关信息。一般源码文 件的名称就是模块名或在模块名的基础上加上某些后缀，用模块名的方法查找不出时再利用其他信息查找。</p> 
<p align="left"><span style="color:#333333">4. </span><span style="color:#333333">如果利用以上方法还找不到源文件，或者一个模块对应着几个源文件，可使用最后的必杀绝招。比如lsmod</span>后得到一个sr_mod。我们用modinfosr_mod的得到它的已编译文件的路径是/lib/modules/2.6.24-19-generic/kernel/drivers/scsi/sr_mod.ko ；把它拷贝出来，并用命令objdump -d sr_mod.ko 查看它的机器码，就可以知道它使用了哪些函数，利用这些函数名就可以结合source insight搜索出源码了。</p> 
<p align="left"><strong><span style="color:#333333">载入模块符号</span></strong></p> 
<p align="left"><span style="color:#333333">首先，在虚拟系统上装入目标模块foo</span>，然后到/sys/module/foo/sections/下查看目标模块的section偏移地址信息.</p> 
<p align="left"><span style="color:#333333">实例</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">debian:/sys/module/smplefs/sections# cat.text .data .bss</span></p> 
 <p align="left"><span style="color:#333333">0xe01c7000</span></p> 
 <p align="left"><span style="color:#333333">0xe01c864c</span></p> 
 <p align="left"><span style="color:#333333">0xe01c8b20</span></p> 
</div> 
<p align="left"><span style="color:#333333">然后，到真机的gdb</span>下用add-symbol-file命令装载目标模块的符号信息 格式如下</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">   add-symbol-file /path/to/module 0xe01c7000 \  # .text</span></p> 
 <p align="left"><span style="color:#333333">               -s .data 0xe01c864c \</span></p> 
 <p align="left"><span style="color:#333333">               -s.bss  0xe01c8b20</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">实例</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">(gdb) add-symbol-file  test/day11/samplefs.ko 0xe01c7000 -s .data0xe01c864c -s .bss 0xe01c8b20</span></p> 
 <p align="left"><span style="color:#333333">add symbol table from file"test/day11/samplefs.ko" at</span></p> 
 <p align="left"><span style="color:#333333">      .text_addr= 0xe01c7000</span></p> 
 <p align="left"><span style="color:#333333">      .data_addr= 0xe01c864c</span></p> 
 <p align="left"><span style="color:#333333">      .bss_addr= 0xe01c8b20</span></p> 
 <p align="left"><span style="color:#333333">(y or n) y</span></p> 
 <p align="left"><span style="color:#333333">Reading symbols from/storage/myqemu/new/linux-2.6.26/test/day11/samplefs.ko...done.</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">然后，余下的对模块的调试就类似对内核的调试了。</span></p> 
<p align="left"><strong><span style="color:#333333">seq_file.c</span><span style="color:#333333">的分析</span></strong></p> 
<p align="left"><strong><span style="color:#333333">module.c</span><span style="color:#333333">的分析</span></strong></p> 
<p align="left"><strong><span style="color:#333333">中断处理过程</span></strong></p> 
<p align="left"><strong><span style="color:#333333">s3c24xx</span><span style="color:#333333">内存初始化分析</span></strong></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">从这节开始，侧重于利用kgdb</span>和source insight理解内核原理] ［网上好像没这个内容。只看源码的话，因为source insight不能解析汇编源文件，在汇编源码中定位到初始化的源头好像很难，利用调试器很容易做到这点］</p> 
<p align="left"><strong><span style="color:#333333">虚拟地址空间</span></strong></p> 
<p align="left"><strong><span style="color:#333333">用户层的观察窗</span></strong></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">待充实]</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">3G~4G</span><span style="color:#333333">虚拟地址空间的用途。（来自于</span><span style="color:#333333">qemu</span><span style="color:#333333">虚拟机的</span><span style="color:#333333">dmesg</span><span style="color:#333333">启动信息</span><span style="color:#333333">,500m</span><span style="color:#333333">物理内存）</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;Zone PFN ranges:</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;  DMA             0 -&gt;     4096</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;  Normal      4096 -&gt;   127984</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;  HighMem   127984 -&gt;   127984</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">&lt;6&gt;virtual kernel memory layout:</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;    fixmap : 0xfff4c000 - 0xfffff000   ( 716kB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;    pkmap  : 0xff800000 - 0xffc00000   (4096kB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;    vmalloc : 0xe0000000 - 0xff7fe000   ( 503 MB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;    lowmem : 0xc0000000 - 0xdf3f0000   ( 499MB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;      .init : 0xc037f000 - 0xc03bb000   ( 240 kB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;      .data : 0xc02c0875 - 0xc03773ac   ( 730 kB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;      .text : 0xc0100000 - 0xc02c0875   (1794 kB)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">3G~4G</span><span style="color:#333333">虚拟地址空间的用途。（来自于</span><span style="color:#333333">qemu</span><span style="color:#333333">虚拟机的</span><span style="color:#333333">dmesg</span><span style="color:#333333">启动信息</span><span style="color:#333333">,897m</span><span style="color:#333333">物理内存）</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;Zone PFN ranges:</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;  DMA             0 -&gt;     4096</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;  Normal      4096 -&gt;   229376</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;  HighMem   229376 -&gt;   229616</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">&lt;6&gt;virtual kernel memory layout:</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;    fixmap : 0xfff4c000 - 0xfffff000   ( 716kB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;    pkmap  : 0xff800000 - 0xffc00000   (4096kB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;    vmalloc : 0xf8800000 - 0xff7fe000   ( 111 MB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;    lowmem : 0xc0000000 - 0xf8000000   ( 896MB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;      .init : 0xc037f000 - 0xc03bb000   ( 240 kB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;      .data : 0xc02c0875 - 0xc03773ac   ( 730 kB)</span></p> 
 <p align="left"><span style="color:#333333">&lt;4&gt;      .text : 0xc0100000 - 0xc02c0875   (1794 kB)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">3G~4G</span><span style="color:#333333">虚拟地址空间的用途。（来自真机的</span><span style="color:#333333">dmesg</span><span style="color:#333333">启动信息</span><span style="color:#333333">,3G</span><span style="color:#333333">物理内存）</span></p> 
 <p align="left"><span style="color:#333333">[   0.000000] Zone PFN ranges:</span></p> 
 <p align="left"><span style="color:#333333">[   0.000000]   DMA             0 -&gt;     4096</span></p> 
 <p align="left"><span style="color:#333333">[   0.000000]   Normal       4096 -&gt;   229376</span></p> 
 <p align="left"><span style="color:#333333">[   0.000000]   HighMem    229376 -&gt;   786416</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">[  33.262853] virtual kernel memory layout:</span></p> 
 <p align="left"><span style="color:#333333">[  33.262854]     fixmap  : 0xfff4b000 - 0xfffff000   ( 720 kB)</span></p> 
 <p align="left"><span style="color:#333333">[  33.262855]     pkmap   : 0xff800000 - 0xffc00000   (4096 kB)</span></p> 
 <p align="left"><span style="color:#333333">[  33.262856]     vmalloc :0xf8800000 - 0xff7fe000   ( 111 MB)</span></p> 
 <p align="left"><span style="color:#333333">[  33.262857]     lowmem  : 0xc0000000 - 0xf8000000   ( 896 MB)</span></p> 
 <p align="left"><span style="color:#333333">[  33.262858]       .init :0xc0421000 - 0xc047d000   ( 368 kB)</span></p> 
 <p align="left"><span style="color:#333333">[  33.262859]       .data :0xc03204c4 - 0xc041bdc4   (1006 kB)</span></p> 
 <p align="left"><span style="color:#333333">[  33.262861]       .text :0xc0100000 - 0xc03204c4   (2177 kB)</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   top, 4G ---&gt;+-------------------+</span></p> 
 <p align="left"><span style="color:#333333">                |                   |</span></p> 
 <p align="left"><span style="color:#333333">                | malloc()'ed memory|</span></p> 
 <p align="left"><span style="color:#333333">                |   interrupt stack | kernel</span></p> 
 <p align="left"><span style="color:#333333">                |       data        |</span></p> 
 <p align="left"><span style="color:#333333">                |       text        |</span></p> 
 <p align="left"><span style="color:#333333"> kernel, 3G---&gt;+-------------------+</span></p> 
 <p align="left"><span style="color:#333333">                |                   |</span></p> 
 <p align="left"><span style="color:#333333">                |     argv,envp     |</span></p> 
 <p align="left"><span style="color:#333333">                |     user stack    |</span></p> 
 <p align="left"><span style="color:#333333">                |         |         |</span></p> 
 <p align="left"><span style="color:#333333">                |         |         |</span></p> 
 <p align="left"><span style="color:#333333">                |         v         |</span></p> 
 <p align="left"><span style="color:#333333">                |                   | user process</span></p> 
 <p align="left"><span style="color:#333333">                |         ^         |</span></p> 
 <p align="left"><span style="color:#333333">                |         |         |</span></p> 
 <p align="left"><span style="color:#333333">                |         |         |</span></p> 
 <p align="left"><span style="color:#333333">                |        heap       |</span></p> 
 <p align="left"><span style="color:#333333">                |        data       |</span></p> 
 <p align="left"><span style="color:#333333">                |        text       |</span></p> 
 <p align="left"><span style="color:#333333">   user, 0G---&gt; +-------------------+</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">         Layout of virtual address space</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">我们验证一下用户空间的内容(</span>上图的下部分)［未完，待续］ 引用于<a target="_blank" href="http://linux.chinaunix.net/bbs/viewthread.php?tid=978491" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://linux.chinaunix.net/bbs/viewthread.php?tid=978491</span></a></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">查看进程的虚拟地址空间是如何使用的。</span></p> 
 <p align="left"><span style="color:#333333">该文件有</span><span style="color:#333333">6</span><span style="color:#333333">列，分别为：</span></p> 
 <p align="left"><span style="color:#333333">地址：库在进程里地址范围</span></p> 
 <p align="left"><span style="color:#333333">权限：虚拟内存的权限，</span><span style="color:#333333">r=</span><span style="color:#333333">读，</span><span style="color:#333333">w=</span><span style="color:#333333">写</span><span style="color:#333333">,x=,s=</span><span style="color:#333333">共享</span><span style="color:#333333">,p=</span><span style="color:#333333">私有；</span></p> 
 <p align="left"><span style="color:#333333">偏移量：库在进程里地址范围</span></p> 
 <p align="left"><span style="color:#333333">设备：映像文件的主设备号和次设备号；</span></p> 
 <p align="left"><span style="color:#333333">节点：映像文件的节点号；</span></p> 
 <p align="left"><span style="color:#333333">路径</span><span style="color:#333333">: </span><span style="color:#333333">映像文件的路径</span></p> 
 <p align="left"><span style="color:#333333">每项都与一个</span><span style="color:#333333">vm_area_struct</span><span style="color:#333333">结构成员对应，</span></p> 
 <p align="left"><span style="color:#333333">－－－－</span></p> 
 <p align="left"><span style="color:#333333">struct vm_area_struct {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      structmm_struct * vm_mm; /* The address space webelong to. */</span></p> 
 <p align="left"><span style="color:#333333">      unsignedlong vm_start;            /* Our startaddress within vm_mm. */</span></p> 
 <p align="left"><span style="color:#333333">      unsignedlong vm_end;              /* The firstbyte after our end address</span></p> 
 <p align="left"><span style="color:#333333">                                            within vm_mm. */</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      /*linked list of VM areas per task, sorted by address */</span></p> 
 <p align="left"><span style="color:#333333">      structvm_area_struct *vm_next;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      pgprot_tvm_page_prot;             /* Accesspermissions of this VMA. */</span></p> 
 <p align="left"><span style="color:#333333">      unsignedlong vm_flags;            /* Flags, listedbelow. */</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      structrb_node vm_rb;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      /*</span></p> 
 <p align="left"><span style="color:#333333">       * For areas with an address space and backingstore,</span></p> 
 <p align="left"><span style="color:#333333">       * linkage into the address_space-&gt;i_mmapprio tree, or</span></p> 
 <p align="left"><span style="color:#333333">       * linkage to the list of like vmas hanging offits node, or</span></p> 
 <p align="left"><span style="color:#333333">       * linkage of vma in theaddress_space-&gt;i_mmap_nonlinear list.</span></p> 
 <p align="left"><span style="color:#333333">       */</span></p> 
 <p align="left"><span style="color:#333333">      union{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               struct{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       structlist_head list;</span></p> 
 <p align="left"><span style="color:#333333">                       void*parent;    /* aligns with prio_tree_nodeparent */</span></p> 
 <p align="left"><span style="color:#333333">                       structvm_area_struct *head;</span></p> 
 <p align="left"><span style="color:#333333">               }vm_set;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               structraw_prio_tree_node prio_tree_node;</span></p> 
 <p align="left"><span style="color:#333333">      }shared;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      /*</span></p> 
 <p align="left"><span style="color:#333333">       * A file's MAP_PRIVATE vma can be in bothi_mmap tree and anon_vma</span></p> 
 <p align="left"><span style="color:#333333">       * list, after a COW of one of the file pages.      A MAP_SHARED vma</span></p> 
 <p align="left"><span style="color:#333333">       * can only be in the i_mmap tree.  An anonymous MAP_PRIVATE, stack</span></p> 
 <p align="left"><span style="color:#333333">       * or brk vma (with NULL file) can only be inan anon_vma list.</span></p> 
 <p align="left"><span style="color:#333333">       */</span></p> 
 <p align="left"><span style="color:#333333">      structlist_head anon_vma_node;    /* Serializedby anon_vma-&gt;lock */</span></p> 
 <p align="left"><span style="color:#333333">      structanon_vma *anon_vma;         /* Serializedby page_table_lock */</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      /*Function pointers to deal with this struct. */</span></p> 
 <p align="left"><span style="color:#333333">      structvm_operations_struct * vm_ops;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      /*Information about our backing store: */</span></p> 
 <p align="left"><span style="color:#333333">      unsignedlong vm_pgoff;            /* Offset(within vm_file) in PAGE_SIZE</span></p> 
 <p align="left"><span style="color:#333333">                                            units, *not* PAGE_CACHE_SIZE */</span></p> 
 <p align="left"><span style="color:#333333">      structfile * vm_file;             /* File we mapto (can be NULL). */</span></p> 
 <p align="left"><span style="color:#333333">      void* vm_private_data;            /* wasvm_pte (shared mem) */</span></p> 
 <p align="left"><span style="color:#333333">      unsignedlong vm_truncate_count;/* truncate_count or restart_addr */</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">#ifndef CONFIG_MMU</span></p> 
 <p align="left"><span style="color:#333333">      atomic_tvm_usage;                 /* refcount(VMAs shared if !MMU) */</span></p> 
 <p align="left"><span style="color:#333333">#endif</span></p> 
 <p align="left"><span style="color:#333333">#ifdef CONFIG_NUMA</span></p> 
 <p align="left"><span style="color:#333333">      structmempolicy *vm_policy;       /* NUMA policyfor the VMA */</span></p> 
 <p align="left"><span style="color:#333333">#endif</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">[todo </span><span style="color:#333333">换个简单的程序</span><span style="color:#333333">]</span></p> 
 <p align="left"><span style="color:#333333">$ ps -aux | grep firefox</span></p> 
 <p align="left"><span style="color:#333333">Warning: bad ps syntax, perhaps a bogus'-'? See http://procps.sf.net/faq.html</span></p> 
 <p align="left"><span style="color:#333333">fqh      8230  4.7  2.5 205872 80024 ?        Tl   14:54  0:19 /usr/lib/firefox-3.0.1/firefox</span></p> 
 <p align="left"><span style="color:#333333">fqh      8313  0.0  0.0  3220   764 pts/1    R+  15:01   0:00 grep firefox</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(gdb) attach 8230</span></p> 
 <p align="left"><span style="color:#333333">...</span></p> 
 <p align="left"><span style="color:#333333">.....</span></p> 
 <p align="left"><span style="color:#333333">Loaded symbols for/usr/lib/libflashsupport.so</span></p> 
 <p align="left"><span style="color:#333333">Reading symbols from/usr/lib/libpulse.so.0...(no debugging symbols found)...done.</span></p> 
 <p align="left"><span style="color:#333333">Loaded symbols for/usr/lib/libpulse.so.0</span></p> 
 <p align="left"><span style="color:#333333">Reading symbols from/lib/libcap.so.1...(no debugging symbols found)...done.</span></p> 
 <p align="left"><span style="color:#333333">Loaded symbols for /lib/libcap.so.1</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">(no debugging symbols found)</span></p> 
 <p align="left"><span style="color:#333333">0xb7f24410 in __kernel_vsyscall ()</span></p> 
 <p align="left"><span style="color:#333333">(gdb) bt</span></p> 
 <p align="left"><span style="color:#333333">#0 0xb7f24410 in __kernel_vsyscall ()</span></p> 
 <p align="left"><span style="color:#333333">#1 0xb7d46c07 in poll () from /lib/tls/i686/cmov/libc.so.6</span></p> 
 <p align="left"><span style="color:#333333">#2 0xb6b4e1c6 in ?? () from /usr/lib/libglib-2.0.so.0</span></p> 
 <p align="left"><span style="color:#333333">#3 0xb6b4e74e in g_main_context_iteration () from /usr/lib/libglib-2.0.so.0</span></p> 
 <p align="left"><span style="color:#333333">#4 0xb77ba87c in ?? () from /usr/lib/xulrunner-1.9.0.1/libxul.so</span></p> 
 <p align="left"><span style="color:#333333">#5 0xb77cf624 in ?? () from /usr/lib/xulrunner-1.9.0.1/libxul.so</span></p> 
 <p align="left"><span style="color:#333333">#6 0xb77cfa6f in ?? () from /usr/lib/xulrunner-1.9.0.1/libxul.so</span></p> 
 <p align="left"><span style="color:#333333">#7 0xb787ecd6 in ?? () from /usr/lib/xulrunner-1.9.0.1/libxul.so</span></p> 
 <p align="left"><span style="color:#333333">#8 0xb784e31f in ?? () from /usr/lib/xulrunner-1.9.0.1/libxul.so</span></p> 
 <p align="left"><span style="color:#333333">#9 0xb77cf75e in ?? () from /usr/lib/xulrunner-1.9.0.1/libxul.so</span></p> 
 <p align="left"><span style="color:#333333">#10 0xb765f122 in ?? () from/usr/lib/xulrunner-1.9.0.1/libxul.so</span></p> 
 <p align="left"><span style="color:#333333">#11 0xb70b3a88 in XRE_main () from/usr/lib/xulrunner-1.9.0.1/libxul.so</span></p> 
 <p align="left"><span style="color:#333333">#12 0x08049033 in ?? ()</span></p> 
 <p align="left"><span style="color:#333333">#13 0xb7c90450 in __libc_start_main ()from /lib/tls/i686/cmov/libc.so.6</span></p> 
 <p align="left"><span style="color:#333333">#14 0x08048cc1 in ?? ()</span></p> 
 <p align="left"><span style="color:#333333">(gdb) </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$ cat /proc/8230/maps</span></p> 
 <p align="left"><span style="color:#333333">08048000-0804f000 r-xp 00000000 08:017022914   /usr/lib/firefox-3.0.1/firefox &lt;-text,</span><span style="color:#333333">注意标志</span><span style="color:#333333">可读可执行不可写私有</span></p> 
 <p align="left"><span style="color:#333333">0804f000-08050000 rw-p 00006000 08:017022914   /usr/lib/firefox-3.0.1/firefox &lt;-data,</span><span style="color:#333333">注意标志</span><span style="color:#333333">可读可写不可执行</span></p> 
 <p align="left"><span style="color:#333333">08050000-0abd4000 rw-p 08050000 00:000          [heap]                          &lt;-heap</span><span style="color:#333333">，一共</span><span style="color:#333333">45.5</span><span style="color:#333333">多</span><span style="color:#333333">MB</span><span style="color:#333333">［</span><span style="color:#333333">todo:</span><span style="color:#333333">验证向上增长］可读可写不可执行</span></p> 
 <p align="left"><span style="color:#333333">ae060000-ae063000 r-xp 00000000 08:016941098   /usr/lib/libflashsupport.so    &lt;-libflashsupport.so </span><span style="color:#333333">共享库的代码段，</span><span style="color:#333333">可读可执行不可写</span></p> 
 <p align="left"><span style="color:#333333">ae063000-ae064000 rw-p 00002000 08:016941098   /usr/lib/libflashsupport.so    &lt;-libflashsupport.so </span><span style="color:#333333">共享库的数据段，</span><span style="color:#333333">可读可写不可执行</span></p> 
 <p align="left"><span style="color:#333333">.....</span></p> 
 <p align="left"><span style="color:#333333">..</span></p> 
 <p align="left"><span style="color:#333333">b7f20000-b7f21000 rw-p 00001000 08:016942869    /usr/lib/libplds4.so.0d</span></p> 
 <p align="left"><span style="color:#333333">b7f21000-b7f22000 r--p 00000000 08:016966184   /usr/lib/locale/zh_CN.utf8/LC_IDENTIFICATION</span></p> 
 <p align="left"><span style="color:#333333">b7f22000-b7f24000 rw-p b7f22000 00:00 0 </span></p> 
 <p align="left"><span style="color:#333333">b7f24000-b7f25000 r-xp b7f24000 00:000          [vdso]</span></p> 
 <p align="left"><span style="color:#333333">b7f25000-b7f3f000 r-xp 00000000 08:012326545    /lib/ld-2.7.so</span></p> 
 <p align="left"><span style="color:#333333">b7f3f000-b7f41000 rw-p 00019000 08:012326545    /lib/ld-2.7.so</span></p> 
 <p align="left"><span style="color:#333333">bfbcd000-bfc0a000 rw-p bffc3000 00:000          [stack]                         &lt;-stack</span><span style="color:#333333">，不到</span><span style="color:#333333">0.24MB</span><span style="color:#333333">，可读可执行不可写［</span><span style="color:#333333">todo:</span><span style="color:#333333">验证向下增长］</span></p> 
 <p align="left"><span style="color:#333333">                                                                                </span><span style="color:#333333">［</span><span style="color:#333333">todo:</span><span style="color:#333333">验证</span><span style="color:#333333">argv,envp</span><span style="color:#333333">］</span></p> 
 <p align="left"><span style="color:#333333">$</span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">交互，从内核层分析</span></strong></p> 
<p align="left"><span style="color:#333333">[</span><span style="color:#333333">扩展]</span></p> 
<p align="left"><strong><span style="color:#333333">理解设备模型</span></strong></p> 
<p align="left"><span style="color:#333333">［结合source insight</span>分析一个内核子系统的原理。源码分析工具虽好，但却是个死的东西，不能实时观察数据的生成和变化。如果在内核运行的时候，搭配调试器来分析，这个过程一定很形象和有趣］</p> 
<p align="left"><strong><span style="color:#333333">面向对象的实现</span></strong></p> 
<p align="left"><strong><span style="color:#333333">设备模型的分层</span></strong></p> 
<p align="left"><strong><span style="color:#333333">外围支持机制</span></strong></p> 
<p align="left"><strong><span style="color:#333333">sysfs</span></strong></p> 
<p align="left"><strong><span style="color:#333333">hotplug</span></strong></p> 
<p align="left"><strong><span style="color:#333333">文件系统</span></strong></p> 
<p align="left"><span style="color:#333333">参考书籍：</span></p> 
<p align="left"><span style="color:#333333">UNIX FilesystemsEvolution, Design, and Implementation.pdf :</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.google.cn/search?q=UNIX+Filesystems+Evolution%2C+Design%2C+and+Implementation&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=com.ubuntu:zh-CN:unofficial&amp;client=firefox-a" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.google.cn/search?q=UNIX+Filesystems+Evolution%2C+Design%2C+and+Implementation&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=com.ubuntu:zh-CN:unofficial&amp;client=firefox-a</span></a></span></p> 
<p align="left"><span style="color:#333333">站点：</span></p> 
<p align="left"><span style="color:#333333">Ext4 (and Ext2/Ext3)Wiki: <a target="_blank" href="http://ext4.wiki.kernel.org/index.php/Main_Page" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://ext4.wiki.kernel.org/index.php/Main_Page</span></a></span></p> 
<p align="left"><span style="color:#333333">Ext4 Developmentproject: <a target="_blank" href="http://www.bullopensource.org/ext4/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.bullopensource.org/ext4/</span></a></span></p> 
<p align="left"><span style="color:#333333">ext2-devel maillistarchive: <a target="_blank" href="http://sourceforge.net/mailarchive/forum.php?forum=ext2-devel" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceforge.net/mailarchive/forum.php?forum=ext2-devel</span></a></span></p> 
<p align="left"><span style="color:#333333">参考文章：</span></p> 
<p align="left"><span style="color:#333333">“Linux Filesystemsin 21 days 45 minutes</span>” <a target="_blank" href="http://us1.samba.org/samba/ftp/cifs-cvs/ols2006-fs-tutorial-smf.pdf" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://us1.samba.org/samba/ftp/cifs-cvs/ols2006-fs-tutorial-smf.pdf</span></a></p> 
<p align="left"><strong><span style="color:#333333">***</span><span style="color:#333333">第三部分：其他工具***</span></strong></p> 
<p align="left"><strong><span style="color:#333333">strace</span></strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">作用:strace</span>能拦截和记录应用程序发起的系统调用和它收到的信号。主要用于观察应用层和内核层的交互。</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">命令选项: </span>查看，$strace –help 或$man strace 或 $info strace</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">实例</span></p> 
<p align="left"><strong><span style="color:#333333">ltrace</span></strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">作用:ltrace</span>用于监控程序发起的库函数调用以及程序收到的信号。</p> 
<p align="left"><strong><span style="color:#333333">SystemTap</span></strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">动态收集Linux</span>内核信息和性能数据</p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">官方  <a target="_blank" href="http://sourceware.org/systemtap/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceware.org/systemtap/</span></a></span></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">参考文章</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-cn-systemtap3/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-cn-systemtap3/index.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-systemtap/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-systemtap/index.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://sourceware.org/systemtap/tutorial/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceware.org/systemtap/tutorial/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://sourceware.org/systemtap/wiki" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceware.org/systemtap/wiki</span></a></span></p> 
<p align="left"><span style="color:#333333">ubuntu</span><span style="color:#333333">下的配置安装： <a target="_blank" href="http://sourceware.org/systemtap/wiki/SystemtapOnUbuntu" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceware.org/systemtap/wiki/SystemtapOnUbuntu</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">MEMWATCH</span></strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">作用:</span>跟踪程序中的内存泄漏和错误</p> 
<p align="left"><strong><span style="color:#333333">YAMD</span></strong></p> 
<p align="left"><span style="color:#333333">·        </span><span style="color:#333333">作用:</span>查找 C 和 C++ 中动态的、与内存分配有关的问题</p> 
<p align="left"><strong><span style="color:#333333">Magic SysRq</span></strong></p> 
<p align="left"><span style="color:#333333">内核文档 sysrq.txt</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/sysrq.txt;h=10a0263ebb3f01e832c7827cc75d7fe54b341a6f;hb=f8d56f1771e4867acc461146764b4feeb5245669" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/sysrq.txt;h=10a0263ebb3f01e832c7827cc75d7fe54b341a6f;hb=f8d56f1771e4867acc461146764b4feeb5245669</span></a></span></p> 
<p align="left"><span style="color:#333333">linux</span><span style="color:#333333">内核测试指南 相关章节</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wiki.zh-kernel.org/#%E6%96%87%E7%AB%A0" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.zh-kernel.org/#%E6%96%87%E7%AB%A0</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">附录：社区交流相关</span></strong></p> 
<p align="left"><strong><span style="color:#333333">补丁提交相关文档</span></strong></p> 
<p align="left"><span style="color:#333333">如何参与 Linux </span>内核开发</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wiki.zh-kernel.org/doc/howto" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.zh-kernel.org/doc/howto</span></a></span></p> 
<p align="left"><span style="color:#333333">Linux</span><span style="color:#333333">内核代码风格</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wiki.zh-kernel.org/doc/codingstyle" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.zh-kernel.org/doc/codingstyle</span></a></span></p> 
<p align="left"><span style="color:#333333">Linux</span><span style="color:#333333">内核开发邮件客户端资料</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wiki.zh-kernel.org/doc/email-clients.txt" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.zh-kernel.org/doc/email-clients.txt</span></a></span></p> 
<p align="left"><span style="color:#333333">Linux</span><span style="color:#333333">内核补丁提交注意事项</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wiki.zh-kernel.org/doc/linux%E5%86%85%E6%A0%B8%E8%A1%A5%E4%B8%81%E6%8F%90%E4%BA%A4%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.zh-kernel.org/doc/linux%E5%86%85%E6%A0%B8%E8%A1%A5%E4%B8%81%E6%8F%90%E4%BA%A4%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9</span></a></span></p> 
<p align="left"><span style="color:#333333">基于git</span>的Gentoo中文文档开发流程</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.gentoo-cn.org/doc/zh_cn/git-howto.xml" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.gentoo-cn.org/doc/zh_cn/git-howto.xml</span></a></span></p> 
<p align="left"><span style="color:#333333">mutt</span><span style="color:#333333">配置使用</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://hi.baidu.com/springtty/blog/item/e6b25ddbb52f51ddb7fd4805.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://hi.baidu.com/springtty/blog/item/e6b25ddbb52f51ddb7fd4805.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.kongove.cn/blog/?p=149" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.kongove.cn/blog/?p=149</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.kongove.cn/blog/?p=229" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.kongove.cn/blog/?p=229</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.kongove.cn/blog/?p=225" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.kongove.cn/blog/?p=225</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">补丁制作与提交示范</span></strong></p> 
<p align="left"><span style="color:#333333">说明：对于初学者，又是发单个补丁的话，本人推荐使用邮件客户端claws</span>。它的优点是有线索成组的功能和草稿上有字数的标尺。本人感觉claws比 Sylpheed要快上几十倍。claws本来是Sylpheed的实验版，后来独立出来了。内核社区中使用的邮件客户端大多数是mutt（并不是专指发补丁）。发补丁的所用工具也多种多样，有用各种邮件客户端的(mutt,claws,kmail...)，有使用git-send-email的，还有使 用quilt的，真是打开眼界。</p> 
<p align="left"><span style="color:#333333">对于本人，发补丁用的工具目前在内核社区中是独一无二的，因为该工具是我自己写的：）凡是用它发出的邮件，在邮件头会有个标志，比如：User- Agent: sniper-patch-carrier/1.06</span>。无论单个还是多个补丁，都用它来发送，它的特点是够用简单又强大。源码在下小节中。</p> 
<p align="left"><span style="color:#333333">但下面的例子，还是使用claws</span>发补丁的举例。</p> 
<p align="left"><span style="color:#333333">补丁的任务</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">mm/oom_kill.c:badness</span><span style="color:#333333">（）函数</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">/**</span></p> 
 <p align="left"><span style="color:#333333"> *badness - calculate a numeric value for how bad this task has been</span></p> 
 <p align="left"><span style="color:#333333"> *@p: task struct of which task we should calculate</span></p> 
 <p align="left"><span style="color:#333333"> *@uptime: current uptime in seconds</span></p> 
 <p align="left"><span style="color:#333333"> *@mem: target memory controller//&lt;-Li Zefan</span><span style="color:#333333">大侠上次提交了一个补丁，去掉了</span><span style="color:#333333">badness()</span><span style="color:#333333">的这个参数，</span></p> 
 <p align="left"><span style="color:#333333">                                   </span> <span style="color:#333333">但是忘了删除该参数的说明了。现在的任务是提交补丁把它删除掉</span></p> 
 <p align="left"><span style="color:#333333"> *</span></p> 
 <p align="left"><span style="color:#333333">...</span><span style="color:#333333">省略</span></p> 
 <p align="left"><span style="color:#333333"> */</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">unsigned long badness(struct task_struct*p, unsigned long uptime)</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
</div> 
<p align="left"><span style="color:#333333">过程</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">1. </span><span style="color:#333333">进入</span><span style="color:#333333">git</span><span style="color:#333333">树</span></p> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:~$ cd/storage/linus-git/linux-2.6/</span></p> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:/storage/linus-git/linux-2.6$</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">2. </span><span style="color:#333333">更新</span><span style="color:#333333">git</span><span style="color:#333333">树</span></p> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:/storage/linus-git/linux-2.6$git-pull</span></p> 
 <p align="left"><span style="color:#333333">Already up-to-date.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">3. </span><span style="color:#333333">修改目标源码</span></p> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:/storage/linus-git/linux-2.6$vi mm/oom_kill.c </span></p> 
 <p align="left"><span style="color:#333333">删除掉那个参数说明后结束</span><span style="color:#333333">vi,</span><span style="color:#333333">返回到</span><span style="color:#333333">shell</span><span style="color:#333333">下</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">4. </span><span style="color:#333333">制作补丁</span></p> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:/storage/linus-git/linux-2.6$git-diff &gt; ../oom_kill.patch</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">5. </span><span style="color:#333333">还原</span><span style="color:#333333">git</span><span style="color:#333333">树</span></p> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:/storage/linus-git/linux-2.6$patch -p1 &lt; ../oom_kill.patch -R</span></p> 
 <p align="left"><span style="color:#333333">patching file mm/oom_kill.c</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">还原的方法或者采用下面方式</span></p> 
 <p align="left"><span style="color:#333333">XXX@ubuntu:/storage/linus-git/linux-2.6$git-gui</span></p> 
 <p align="left"><span style="color:#333333">界面出来后，点击</span><span style="color:#333333">Branch-&gt;reset</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">6.</span><span style="color:#333333">点击</span><span style="color:#333333">compose</span><span style="color:#333333">新建邮件</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">7. </span><span style="color:#333333">点击</span><span style="color:#333333">insert file </span><span style="color:#333333">载入补丁文件</span></p> 
 <p align="left"><span style="color:#333333">diff --git a/mm/oom_kill.cb/mm/oom_kill.c</span></p> 
 <p align="left"><span style="color:#333333">index 64e5b4b..460f90e 100644</span></p> 
 <p align="left"><span style="color:#333333">--- a/mm/oom_kill.c</span></p> 
 <p align="left"><span style="color:#333333">+++ b/mm/oom_kill.c</span></p> 
 <p align="left"><span style="color:#333333">@@ -38,7 +38,6 @@ staticDEFINE_SPINLOCK(zone_scan_mutex);</span></p> 
 <p align="left"><span style="color:#333333"> * badness - calculate a numeric value for how bad this task has been</span></p> 
 <p align="left"><span style="color:#333333"> * @p: task struct of which task we should calculate</span></p> 
 <p align="left"><span style="color:#333333"> * @uptime: current uptime in seconds</span></p> 
 <p align="left"><span style="color:#333333">- * @mem: target memory controller</span></p> 
 <p align="left"><span style="color:#333333"> *</span></p> 
 <p align="left"><span style="color:#333333"> * The formula used is relatively simple and documented inline in the</span></p> 
 <p align="left"><span style="color:#333333"> * function. The main rationale is that we want to select a good task</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">8. </span><span style="color:#333333">补全其他信息，比如</span><span style="color:#333333">标题，</span><span style="color:#333333">to, cc</span><span style="color:#333333">等，还有信件内容</span></p> 
 <p align="left"><span style="color:#333333">本例是：</span></p> 
 <p align="left"><span style="color:#333333">标题起为：</span><span style="color:#333333">[PATCH]mm/oom_kill.c: cleanup kerneldoc ofbadness() </span></p> 
 <p align="left"><span style="color:#333333">        //</span><span style="color:#333333">为讨好</span><span style="color:#333333">Randy.Dunlap</span><span style="color:#333333">，特意写了字眼</span><span style="color:#333333">kerneldoc</span><span style="color:#333333">，因为他是主管内核文档的</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">to "Randy.Dunlap"&lt;rdunlap@xenotime.net&gt; </span></p> 
 <p align="left"><span style="color:#333333">//</span><span style="color:#333333">收件人是谁得根据补丁的性质查看内核源码中的</span><span style="color:#333333">MAINTAINERS</span><span style="color:#333333">文件，</span></p> 
 <p align="left"><span style="color:#333333">//</span><span style="color:#333333">难以确认是谁时，可以到</span><span style="color:#333333">linus-git</span><span style="color:#333333">的</span><span style="color:#333333">web-git</span><span style="color:#333333">下参看你修改文件的历史记录，看别人是发给谁的</span></p> 
 <p align="left"><span style="color:#333333">cc linux-kernel@vger.kernel.org, //</span><span style="color:#333333">这个一定要有</span></p> 
 <p align="left"><span style="color:#333333">linux-mm@kvack.org               //</span><span style="color:#333333">修改文件所在的子系统的邮件列表，当收件人写错时，</span></p> 
 <p align="left"><span style="color:#333333">                                 //</span><span style="color:#333333">子系统的头目们可能会注意到和接受你的补丁</span><span style="color:#333333">  </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">邮件本身处理后变成下面的格式</span></p> 
 <p align="left"><span style="color:#333333">Paramter @mem has been removed sincev2.6.26, now delete its comment. //</span><span style="color:#333333">补丁的作用</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Signed-off-by: your-name&lt;your-address@gmail.com&gt;               //</span><span style="color:#333333">你的签收</span></p> 
 <p align="left"><span style="color:#333333">---              //</span><span style="color:#333333">三个</span><span style="color:#333333">'-'</span><span style="color:#333333">，表示下面的内容是补丁了。应用补丁的工具会根据这个标志提取补丁。</span></p> 
 <p align="left"><span style="color:#333333">diff --git a/mm/oom_kill.cb/mm/oom_kill.c</span></p> 
 <p align="left"><span style="color:#333333">index 64e5b4b..460f90e 100644</span></p> 
 <p align="left"><span style="color:#333333">--- a/mm/oom_kill.c</span></p> 
 <p align="left"><span style="color:#333333">+++ b/mm/oom_kill.c</span></p> 
 <p align="left"><span style="color:#333333">@@ -38,7 +38,6 @@ staticDEFINE_SPINLOCK(zone_scan_mutex);</span></p> 
 <p align="left"><span style="color:#333333"> * badness - calculate a numeric value for how bad this task has been</span></p> 
 <p align="left"><span style="color:#333333"> * @p: task struct of which task we should calculate</span></p> 
 <p align="left"><span style="color:#333333"> * @uptime: current uptime in seconds</span></p> 
 <p align="left"><span style="color:#333333">- * @mem: target memory controller</span></p> 
 <p align="left"><span style="color:#333333"> *</span></p> 
 <p align="left"><span style="color:#333333">  *The formula used is relatively simple and documented inline in the</span></p> 
 <p align="left"><span style="color:#333333"> * function. The main rationale is that we want to select a good task</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">9. </span><span style="color:#333333">然后发信</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">10. </span><span style="color:#333333">等待回复</span></p> 
 <p align="left"><span style="color:#333333">Randy Dunla</span><span style="color:#333333">果然勤快，两个小时不到就收到了他的信件</span></p> 
 <p align="left"><span style="color:#333333">Acked-by: Randy Dunlap&lt;rdunlap@xenotime.net&gt;</span></p> 
 <p align="left"><span style="color:#333333">Thanks.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">说明：</span></p> 
 <p align="left"><span style="color:#333333">Acked-by</span><span style="color:#333333">表示他认为补丁正确，但并不自己接收。</span><span style="color:#333333">维护者回复</span><span style="color:#333333">applied</span><span style="color:#333333">才算是接受了。</span></p> 
 <p align="left"><span style="color:#333333">当然如果得到比较有威望的人</span><span style="color:#333333">acked-by</span><span style="color:#333333">，被接受的可能性就大大的提高了。</span><span style="color:#333333">--Li Yang</span><span style="color:#333333">大牛</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">看来，我把补丁的维护人搞错了，因为</span><span style="color:#333333">Randy Dunlap</span><span style="color:#333333">并没领我的情</span><span style="color:#333333">:(</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">注意，这个不能急。有的补丁或许是因为太微小，对方都没回复你，其实他已经收录了你的补丁。</span></p> 
 <p align="left"><span style="color:#333333">到子系统树向</span><span style="color:#333333">linus</span><span style="color:#333333">的</span><span style="color:#333333">git</span><span style="color:#333333">树合并时就会看到你的补丁</span><span style="color:#333333">(</span><span style="color:#333333">通常会在</span><span style="color:#333333">LKML</span><span style="color:#333333">中有个集体通告，说明</span></p> 
 <p align="left"><span style="color:#333333">这批补丁中包含了哪些内容。</span><span style="color:#333333">)</span><span style="color:#333333">。等一个多星期无妨。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">后记：过了三四天后，收到了一封信如下。这是</span><span style="color:#333333">mm</span><span style="color:#333333">树的邮件系统发来的。可见</span><span style="color:#333333">Randy Dunlap</span></p> 
 <p align="left"><span style="color:#333333">把这个补丁提交给</span><span style="color:#333333">mm</span><span style="color:#333333">树了。在</span><span style="color:#333333">mm</span><span style="color:#333333">树经过验证补丁正确后就会再汇合到</span><span style="color:#333333">linus</span><span style="color:#333333">的主线树中。这是</span></p> 
 <p align="left"><span style="color:#333333">补丁接受的一种方式。当然，我遇到的情况有，子系统维护人回复你</span><span style="color:#333333">applied to xx(</span><span style="color:#333333">树</span><span style="color:#333333">)</span><span style="color:#333333">，</span></p> 
 <p align="left"><span style="color:#333333">然后该负责人就要求</span><span style="color:#333333">linus merge</span><span style="color:#333333">他的树，这样就收不到</span><span style="color:#333333">mm</span><span style="color:#333333">树的通知信。甚至有时子系统维护</span></p> 
 <p align="left"><span style="color:#333333">人接受补丁了都不吭一声，然后补丁又是直接</span><span style="color:#333333">merge</span><span style="color:#333333">到主线树中。补丁接受的流程大概就这样了。</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">From: akpm@linux-foundation.org</span></p> 
 <p align="left"><span style="color:#333333">To: mm-commits@vger.kernel.org</span></p> 
 <p align="left"><span style="color:#333333">Cc: qhfeng.kernel@gmail.com,rdunlap@xenotime.net</span></p> 
 <p align="left"><span style="color:#333333">Subject: +mm-oom_killc-fix-badness-kerneldoc.patch added to -mm tree</span></p> 
 <p align="left"><span style="color:#333333">Date: Thu, 30 Oct 2008 14:47:53 -0700</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">The patch titled</span></p> 
 <p align="left"><span style="color:#333333">    mm/oom_kill.c: fix badness() kerneldoc</span></p> 
 <p align="left"><span style="color:#333333">has been added to the -mm tree.  Its filename is</span></p> 
 <p align="left"><span style="color:#333333">    mm-oom_killc-fix-badness-kerneldoc.patch</span></p> 
 <p align="left"><span style="color:#333333">....</span><span style="color:#333333">省略</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">The current -mm tree may be found athttp://userweb.kernel.org/~akpm/mmotm/</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">------------------------------------------------------</span></p> 
 <p align="left"><span style="color:#333333">Subject: mm/oom_kill.c: fix badness()kerneldoc</span></p> 
 <p align="left"><span style="color:#333333">From: Qinghuang Feng&lt;qhfeng.kernel@gmail.com&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Paramter @mem has been removed sincev2.6.26, now delete its comment.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Signed-off-by: Qinghuang Feng&lt;qhfeng.kernel@gmail.com&gt;</span></p> 
 <p align="left"><span style="color:#333333">Acked-by: Randy Dunlap &lt;rdunlap@xenotime.net&gt;</span></p> 
 <p align="left"><span style="color:#333333">Signed-off-by: Andrew Morton&lt;akpm@linux-foundation.org&gt;</span></p> 
 <p align="left"><span style="color:#333333">---</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">...</span><span style="color:#333333">补丁内容省略</span></p> 
 <p align="left"><span style="color:#333333">_</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Patches currently in -mm which might befrom qhfeng.kernel@gmail.com are</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">origin.patch</span></p> 
 <p align="left"><span style="color:#333333">mm-oom_killc-fix-badness-kerneldoc.patch</span></p> 
 <p align="left"><span style="color:#333333">linux-next.patch</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">多补丁发送工具</span></strong></p> 
<p align="left"><span style="color:#333333">有很多此类工具，其中功能最强的是git-send-email.</span>但本人还是自己动手丰衣足食，参照其他工具写了一个。perl学得不久，很没 perl的味道.这个工具的优点是用perl自带的邮件引擎通过smtp.gmail.com（目前只支持gmail，其他没实验过）发送邮件，而不是通过 sendmail,mutt等第二方工具发送，省去了那些工具麻烦的设置过程。当然，最主要还是因为，自己写的东西可以随时改进，好玩。</p> 
<p align="left"><span style="color:#333333">使用</span></p> 
<p align="left"><span style="color:#333333">把下面的主程序复制到一个文本文件中，并把它命名为:sniperpatchcarrier.pl. </span>并写好另一个控制文件control。发送补丁时使用下面命令即可</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">perl sniperpatchcarrier.pl control</span></p> 
</div> 
<p align="left"><span style="color:#333333">控制文件的内容如下</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">SMTP:</span><span style="color:#333333">你的</span><span style="color:#333333">SMTP</span><span style="color:#333333">服务器地址</span></p> 
 <p align="left"><span style="color:#333333">USER:</span><span style="color:#333333">你所用</span><span style="color:#333333">SMTP</span><span style="color:#333333">对应邮箱的用户名</span></p> 
 <p align="left"><span style="color:#333333">PWD:</span><span style="color:#333333">你所用</span><span style="color:#333333">SMTP</span><span style="color:#333333">对应邮箱的用户密码</span></p> 
 <p align="left"><span style="color:#333333">From: </span><span style="color:#333333">你的名字</span><span style="color:#333333"> &lt;</span><span style="color:#333333">你的邮件地址</span><span style="color:#333333">&gt;</span></p> 
 <p align="left"><span style="color:#333333">To: </span><span style="color:#333333">目的地</span><span style="color:#333333"> &lt;</span><span style="color:#333333">目标邮箱地址</span><span style="color:#333333">&gt;</span></p> 
 <p align="left"><span style="color:#333333">Cc: </span><span style="color:#333333">其他人</span><span style="color:#333333"> &lt;</span><span style="color:#333333">邮件地址</span><span style="color:#333333">&gt;</span></p> 
 <p align="left"><span style="color:#333333">Cc: </span><span style="color:#333333">其他人</span><span style="color:#333333"> &lt;</span><span style="color:#333333">邮件地址</span><span style="color:#333333">&gt;</span></p> 
 <p align="left"><span style="color:#333333">Subject: [PATCH 1/n] </span><span style="color:#333333">第一个补丁的标题</span></p> 
 <p align="left"><span style="color:#333333">File: </span><span style="color:#333333">第一个补丁文件的路径</span></p> 
 <p align="left"><span style="color:#333333">Subject: [PATCH n/n] </span><span style="color:#333333">第</span><span style="color:#333333">n</span><span style="color:#333333">个补丁的标题</span></p> 
 <p align="left"><span style="color:#333333">File: </span><span style="color:#333333">第</span><span style="color:#333333">n</span><span style="color:#333333">个补丁文件的路径</span></p> 
</div> 
<p align="left"><span style="color:#333333">说明,</span>第一项（比如SMTP等)大小写都可，项目之间（比如To:和邮件地址）有无空格均可。邮件地址的用户名可有可无，没写明用户名时&lt;&gt; 符号可有可无。但为防止意外，还是建议照着下面的模版修改使用。注意，目前只支持gmail。要想支持其他邮箱，简单修改源码即可。</p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">SMTP: smtp.gmail.com</span></p> 
 <p align="left"><span style="color:#333333">USER: your-account@gmail.com</span></p> 
 <p align="left"><span style="color:#333333">PWD: your-password</span></p> 
 <p align="left"><span style="color:#333333">From: your-naem &lt;your-account@gmail.com&gt;</span></p> 
 <p align="left"><span style="color:#333333">To: linux-kernel@vger.nonexist.org</span></p> 
 <p align="left"><span style="color:#333333">Cc: Randy Dunlap&lt;rdunlap@nonexit.net&gt;</span></p> 
 <p align="left"><span style="color:#333333">Cc: Jeff Garzik&lt;jeff@nonexist.org&gt;</span></p> 
 <p align="left"><span style="color:#333333">Cc: linux-ide@vger.nonexist.org</span></p> 
 <p align="left"><span style="color:#333333">Bcc:</span></p> 
 <p align="left"><span style="color:#333333">Subject: [PATCH 1/2]drivers/ata/pata_radisys.c: cleanup kernel-doc </span></p> 
 <p align="left"><span style="color:#333333">File: radisys_set_dmamode.patch</span></p> 
 <p align="left"><span style="color:#333333">Subject: [PATCH 2/2]drivers/ata/libata-core.c: cleanup kernel-doc</span></p> 
 <p align="left"><span style="color:#333333">File: ata_qc_new_init.patch</span></p> 
</div> 
<p align="left"><span style="color:#333333">主程序</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">#!/usr/bin/perl</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">use Email::Send;</span></p> 
 <p align="left"><span style="color:#333333">use Email::Simple::Creator; # or otherEmail::</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">sub usage </span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      print&lt;&lt;EOT;    </span></p> 
 <p align="left"><span style="color:#333333">Usage: sniperpatchcarrier controlfile </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   Sample control file:</span></p> 
 <p align="left"><span style="color:#333333">       # this is a comment</span></p> 
 <p align="left"><span style="color:#333333">       SMTP: smtp.gmail.com</span></p> 
 <p align="left"><span style="color:#333333">      USER:your-smtp-account-username </span></p> 
 <p align="left"><span style="color:#333333">      PWD:your-smtp-account-password</span></p> 
 <p align="left"><span style="color:#333333">       From: Joe Blow &lt;jb\@example.com&gt;</span></p> 
 <p align="left"><span style="color:#333333">       To: Harry Hacker&lt;hhacker\@another.example.com&gt;</span></p> 
 <p align="left"><span style="color:#333333">       Cc: Lurker One &lt;lurker1\@yet_another.example.com&gt;</span></p> 
 <p align="left"><span style="color:#333333">       Cc: lurker2\@a_third.example.com</span></p> 
 <p align="left"><span style="color:#333333">       Bcc: blindrecipient\@secret_dropoff.example.com</span></p> 
 <p align="left"><span style="color:#333333">       Subject: [PATCH 1/2] Short sweet descriptive phrase</span></p> 
 <p align="left"><span style="color:#333333">       File: path-of-message-text-for-first-patch</span></p> 
 <p align="left"><span style="color:#333333">       Subject: [PATCH 2/2] Another short sweet phrase</span></p> 
 <p align="left"><span style="color:#333333">       File: path-of-message-text-for-second-patch</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   Above sends out two email messages, with specified Subject lines,</span></p> 
 <p align="left"><span style="color:#333333">   and contents from corresponding Files.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   Each "File" line sends a message, using the latest values for</span></p> 
 <p align="left"><span style="color:#333333">   the other keywords set so far in file. The To, Cc and Bcc lists</span></p> 
 <p align="left"><span style="color:#333333">   accumulate.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   First word on each line of control file is a keyword.  It can be</span></p> 
 <p align="left"><span style="color:#333333">   any mix of upper/lower case, with optional trailing colon.</span></p> 
 <p align="left"><span style="color:#333333">   The keyword "Subject" can be abbreviated as "Subj".</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   Try testing by first sending patch set only to one or more of</span></p> 
 <p align="left"><span style="color:#333333">   your own email addresses.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   The following documents explain how to submit patches to the</span></p> 
 <p align="left"><span style="color:#333333">   Linux kernel:</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">    1) Documentation/SubmittingPatches, a file in the kernel source</span></p> 
 <p align="left"><span style="color:#333333">       http://lxr.linux.no/source/Documentation/SubmittingPatches</span></p> 
 <p align="left"><span style="color:#333333">    2) Documentation/CodingStyle</span></p> 
 <p align="left"><span style="color:#333333">        http://lxr.linux.no/source/Documentation/CodingStyle</span></p> 
 <p align="left"><span style="color:#333333">    3) Andrew Morton's "The Perfect Patch", available at:</span></p> 
 <p align="left"><span style="color:#333333">         http://www.zip.com.au/~akpm/linux/patches/stuff/tpp.txt</span></p> 
 <p align="left"><span style="color:#333333">    4) Jeff Garzik's "Linux kernel patch submission format", at:</span></p> 
 <p align="left"><span style="color:#333333">         http://linux.yyz.us/patch-format.html</span></p> 
 <p align="left"><span style="color:#333333">    5) Greg Kroah-Hartman's "How to piss off a kernel subsystemmaintainer"</span></p> 
 <p align="left"><span style="color:#333333">        http://www.kroah.com/log/2005/03/31/</span></p> 
 <p align="left"><span style="color:#333333">    6) Linus's email on the canonical patch format:</span></p> 
 <p align="left"><span style="color:#333333">         http://lkml.org/lkml/2005/4/7/183</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   Linus describes the canonical patch format:</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      Thatcanonical format is:</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               Subject:[PATCH 001/123] [&lt;area&gt;:] &lt;explanation&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      togetherwith the first line of the body being a</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               From:Original Author &lt;origa@email.com&gt;</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      followedby an empty line and then the body of the explanation.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      Afterthe body of the explanation comes the "Signed-off-by:"</span></p> 
 <p align="left"><span style="color:#333333">      lines,and then a simple "---" line, and below that comes the</span></p> 
 <p align="left"><span style="color:#333333">      diffstatof the patch and then the patch itself.</span></p> 
 <p align="left"><span style="color:#333333">EOT</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      exit(1);</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$VERSION = "1.06";</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$smtpserver="";</span></p> 
 <p align="left"><span style="color:#333333">$smtpuser="";</span></p> 
 <p align="left"><span style="color:#333333">$smtppwd="";</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$fromaddr="";</span></p> 
 <p align="left"><span style="color:#333333">@subjects = ();  #note: don't to use ""!</span></p> 
 <p align="left"><span style="color:#333333">@patches = (); </span></p> 
 <p align="left"><span style="color:#333333">$toaddrs = ""; </span></p> 
 <p align="left"><span style="color:#333333">$ccaddrs = ""; </span></p> 
 <p align="left"><span style="color:#333333">$bccaddrs = ""; </span></p> 
 <p align="left"><span style="color:#333333">$refid = "";</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$patch_count = 0;</span></p> 
 <p align="left"><span style="color:#333333">$patch_content ="";</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">$control_file = "";</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">  </span></p> 
 <p align="left"><span style="color:#333333">sub parse_control</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      #0.verify the integrity of control file</span></p> 
 <p align="left"><span style="color:#333333">      if(open(INTEGRITY, $control_file)) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               my$integrity = 1;</span></p> 
 <p align="left"><span style="color:#333333">               my%integrity_panic = (</span></p> 
 <p align="left"><span style="color:#333333">                       "smtp"=&gt; "smtp:",</span></p> 
 <p align="left"><span style="color:#333333">                       "user"=&gt; "user:",</span></p> 
 <p align="left"><span style="color:#333333">                       "pwd"=&gt; "pwd:",</span></p> 
 <p align="left"><span style="color:#333333">                       "subj"=&gt; "subject:",</span></p> 
 <p align="left"><span style="color:#333333">                       "file"=&gt; "file:",</span></p> 
 <p align="left"><span style="color:#333333">               );</span></p> 
 <p align="left"><span style="color:#333333">               my$ctrl_file;</span></p> 
 <p align="left"><span style="color:#333333">               print"\n&gt;checking the integrity of control file...\n\n";</span></p> 
 <p align="left"><span style="color:#333333">               while(&lt;INTEGRITY&gt;) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       $ctrl_file.= $_;</span></p> 
 <p align="left"><span style="color:#333333">               }</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">               unless($ctrl_file =~ /smtp\s*\:/i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       $integrity= 0;</span></p> 
 <p align="left"><span style="color:#333333">               }else {$integrity_panic{"smtp"} = 0;}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               unless($ctrl_file =~ /user\s*\:/i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       $integrity= 0;</span></p> 
 <p align="left"><span style="color:#333333">               }else {$integrity_panic{"user"} = 0;}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               unless($ctrl_file =~ /pwd\s*\:/i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       $integrity= 0;</span></p> 
 <p align="left"><span style="color:#333333">               }else {$integrity_panic{"pwd"} = 0;}</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">               unless($ctrl_file =~ /subj(?:ect)?\s*\:/i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       $integrity= 0;</span></p> 
 <p align="left"><span style="color:#333333">               }else {$integrity_panic{"subj"} = 0;}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               unless($ctrl_file =~ /file\s*\:/i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       $integrity= 0;</span></p> 
 <p align="left"><span style="color:#333333">               }else {$integrity_panic{"file"} = 0;}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               if($integrity == 0) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       print"ERROR: control file is not integrate. \n";</span></p> 
 <p align="left"><span style="color:#333333">                       print"You must add the following item(s) to it!\n\n";</span></p> 
 <p align="left"><span style="color:#333333">                       my$key;</span></p> 
 <p align="left"><span style="color:#333333">                       my$value;</span></p> 
 <p align="left"><span style="color:#333333">                       while(($key, $value) = each %integrity_panic) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                #print$key."=&gt;".$value."\n";</span></p> 
 <p align="left"><span style="color:#333333">                                if($value){<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                         print$value."\n";</span></p> 
 <p align="left"><span style="color:#333333">                                }                                  </span></p> 
 <p align="left"><span style="color:#333333">                       }</span></p> 
 <p align="left"><span style="color:#333333">                       exit(1);</span></p> 
 <p align="left"><span style="color:#333333">               }else {print "ok!\n";}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      close(INTEGRITY);</span></p> 
 <p align="left"><span style="color:#333333">      #&lt;-open</span></p> 
 <p align="left"><span style="color:#333333">      }else {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               print"can't open control file!\n";</span></p> 
 <p align="left"><span style="color:#333333">               exit(1);</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      #1.parse control file</span></p> 
 <p align="left"><span style="color:#333333">      if(open(CTRLFILE, $control_file)) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               print"\n&gt;reading the control file\n";</span></p> 
 <p align="left"><span style="color:#333333">               while(&lt;CTRLFILE&gt;) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       print;</span></p> 
 <p align="left"><span style="color:#333333">                       #FIXME:why the last \s* doesn't work as what I want?</span></p> 
 <p align="left"><span style="color:#333333">                       #soI fix it in the following. see stuff under close(CTRLFILE)</span></p> 
 <p align="left"><span style="color:#333333">                       if(m{smtp\s*\:\s*(.*)\s*}i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                $smtpserver= $1;</span></p> 
 <p align="left"><span style="color:#333333">                       }elsif (m{user\s*\:\s*(.*)\s*}i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                $smtpuser= $1;</span></p> 
 <p align="left"><span style="color:#333333">                       }elsif (m{pwd\s*\:\s*(.*)\s*}i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                $smtppwd= $1;</span></p> 
 <p align="left"><span style="color:#333333">                       }elsif (m{from\s*\:\s*(.*)\s*}i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                $fromaddr= $1 ;</span></p> 
 <p align="left"><span style="color:#333333">                       }elsif (m{to\s*\:\s*(.*)\s*}i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                $toaddrs .=$1.", ";</span></p> 
 <p align="left"><span style="color:#333333">                       }elsif (m{\bcc\b\s*\:\s*(.*)\s*}i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                $ccaddrs .= $1.", ";</span></p> 
 <p align="left"><span style="color:#333333">                       }elsif (m{bcc\s*\:\s*(.*)\s*}i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                $bccaddrs .=$1.", ";</span></p> 
 <p align="left"><span style="color:#333333">                       }elsif (m{subj(?:ect)?\s*\:\s*(.*)\s*}i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                push@subjects, $1;                                 </span></p> 
 <p align="left"><span style="color:#333333">                       }elsif (m{file\s*\:\s*(.*)\s*}i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                push@patches, $1;</span></p> 
 <p align="left"><span style="color:#333333">                       }</span></p> 
 <p align="left"><span style="color:#333333">               }</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">      close(CTRLFILE);</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">      print"\nafter fixed\n";</span></p> 
 <p align="left"><span style="color:#333333">      #nowwe fix anything MAY introduce the bug. Pretty strictly! </span></p> 
 <p align="left"><span style="color:#333333">      print"\n&gt;smtp config:\n";</span></p> 
 <p align="left"><span style="color:#333333">      $smtpserver=~ s/\s+$//;</span></p> 
 <p align="left"><span style="color:#333333">      print$smtpserver."\n";</span></p> 
 <p align="left"><span style="color:#333333">      $smtpuser=~ s/\s+$//;</span></p> 
 <p align="left"><span style="color:#333333">      print$smtpuser."\n";</span></p> 
 <p align="left"><span style="color:#333333">      $smtppwd=~  s/\s+$//;</span></p> 
 <p align="left"><span style="color:#333333">      print$smtppwd."\n";</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">      print"\n&gt;mail address:\n";</span></p> 
 <p align="left"><span style="color:#333333">      #weassume that "," is invalid for a mail-address itself.</span></p> 
 <p align="left"><span style="color:#333333">      $fromaddr=~ s/(\s*\,\s*)$//;</span></p> 
 <p align="left"><span style="color:#333333">      print  "from:".$fromaddr."\n";</span></p> 
 <p align="left"><span style="color:#333333">      $toaddrs=~ s/(\s+\,)/\,/g;     #for user input</span></p> 
 <p align="left"><span style="color:#333333">      $toaddrs=~ s/(\,\s*)$//;       #for action ofsrcipt itself</span></p> 
 <p align="left"><span style="color:#333333">      print    " to:".$toaddrs."\n";</span></p> 
 <p align="left"><span style="color:#333333">      $ccaddrs=~ s/\s+\,/\,/g;</span></p> 
 <p align="left"><span style="color:#333333">      $ccaddrs=~ s/(\,\s*)$//;</span></p> 
 <p align="left"><span style="color:#333333">      print    " cc:".$ccaddrs."\n";</span></p> 
 <p align="left"><span style="color:#333333">      $bccaddrs=~ s/(\s+\,)/\,/g;</span></p> 
 <p align="left"><span style="color:#333333">      $bccaddrs=~ s/(\,\s*)$//;</span></p> 
 <p align="left"><span style="color:#333333">      print     " bcc:".$bccaddrs."\n";</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      #subjectsdon't need to fix.</span></p> 
 <p align="left"><span style="color:#333333">      #deferthe fix of patch file name to #2</span></p> 
 <p align="left"><span style="color:#333333">               </span></p> 
 <p align="left"><span style="color:#333333">      print"\nall mail address is ok?\nIf NO problem, press \"c\" tocontinue\n\n";</span></p> 
 <p align="left"><span style="color:#333333">      chomp(my $answer = &lt;STDIN&gt;); </span> </p> 
 <p align="left"><span style="color:#333333">      unless($answer =~ /^c$/) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               print"aborted by user.\n";</span></p> 
 <p align="left"><span style="color:#333333">               exit(1);</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      #2check configuration </span></p> 
 <p align="left"><span style="color:#333333">      print"&gt;&gt;checking the relation between subject and patchfile...\n\n";</span></p> 
 <p align="left"><span style="color:#333333">      if(scalar(@subjects) == scalar(@patches)) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               $patch_count= scalar(@subjects);</span></p> 
 <p align="left"><span style="color:#333333">               my$check_i;</span></p> 
 <p align="left"><span style="color:#333333">               for($check_i = 0; $check_i &lt; $patch_count; $check_i++) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       #thedefered fix</span></p> 
 <p align="left"><span style="color:#333333">                       $patches[$check_i]=~ s/\s+$//;</span></p> 
 <p align="left"><span style="color:#333333">                       my$show_i = $check_i + 1;</span></p> 
 <p align="left"><span style="color:#333333">                       print"$show_i:".$subjects[$check_i]."\n";</span></p> 
 <p align="left"><span style="color:#333333">                       print"$show_i:".$patches[$check_i]."\n\n";</span></p> 
 <p align="left"><span style="color:#333333">               }</span></p> 
 <p align="left"><span style="color:#333333">               print"All relations are ok?\nIf NO problem, press \"c\" tocontinure\n";</span></p> 
 <p align="left"><span style="color:#333333">               chomp(my $answer = &lt;STDIN&gt;);</span></p> 
 <p align="left"><span style="color:#333333">               unless($answer =~ /^c$/) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       print"aborted by user.\n";</span></p> 
 <p align="left"><span style="color:#333333">                       exit(1);</span></p> 
 <p align="left"><span style="color:#333333">               }</span></p> 
 <p align="left"><span style="color:#333333">      }else {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               print"&lt;&lt; ERROR! the count of subjects isn't equal to thepatches's\n";</span></p> 
 <p align="left"><span style="color:#333333">               exit(1);</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333">   </span></p> 
 <p align="left"><span style="color:#333333">      #//&lt;-open                </span> </p> 
 <p align="left"><span style="color:#333333">      }else {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               print"can't open control file!\n";</span></p> 
 <p align="left"><span style="color:#333333">               exit(1);</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      #3check the patches format</span></p> 
 <p align="left"><span style="color:#333333">      my$patch_i = undef;</span></p> 
 <p align="left"><span style="color:#333333">      $check_patch_global_success= 1;</span></p> 
 <p align="left"><span style="color:#333333">      print"\n&gt;&gt;checking patch format...\n\n";</span></p> 
 <p align="left"><span style="color:#333333">      for($patch_i = 0; $patch_i &lt; $patch_count; $patch_i++) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               my$show_patch_i = $patch_i + 1;</span></p> 
 <p align="left"><span style="color:#333333">               print"patch $show_patch_i: ";</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               #patch0 is not the real patch, don't check it.</span></p> 
 <p align="left"><span style="color:#333333">               if($subjects[$patch_i] =~ /\[\s*PATCH\s*0+\//i) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                print "found [PATCH 0/*], ingore it...\n\n";</span></p> 
 <p align="left"><span style="color:#333333">                next;</span></p> 
 <p align="left"><span style="color:#333333">               }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">               if(open(PATCH_CHECK, $patches[$patch_i])) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">                       my$success = 1;</span></p> 
 <p align="left"><span style="color:#333333">                       $line= undef;</span></p> 
 <p align="left"><span style="color:#333333">                       while(&lt;PATCH_CHECK&gt;) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                $line.= $_;</span></p> 
 <p align="left"><span style="color:#333333">                       }</span></p> 
 <p align="left"><span style="color:#333333">                       my$sign_match = undef;</span></p> 
 <p align="left"><span style="color:#333333">                       if($line =~ m{(\bSigned-off-by:\s+(?:.+?)\s+\&lt;(?:.+?\@.+?)\&gt;\s*\n)}) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                $sign_match=$1;</span></p> 
 <p align="left"><span style="color:#333333">                                #print$sign_match;</span></p> 
 <p align="left"><span style="color:#333333">                       }else {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                $success= 0;</span></p> 
 <p align="left"><span style="color:#333333">                                print"&lt;&lt; ERROR: no sign or sign format error.\n";</span></p> 
 <p align="left"><span style="color:#333333">                                print"Please obey the following example strictly.\n\n";</span></p> 
 <p align="left"><span style="color:#333333">                                print"Signed-off-by: your-name &lt;your-mail\@gmail.com&gt;\n";</span></p> 
 <p align="left"><span style="color:#333333">                       }</span></p> 
 <p align="left"><span style="color:#333333">                       </span></p> 
 <p align="left"><span style="color:#333333">                       if($success == 1){       </span></p> 
 <p align="left"><span style="color:#333333">                                unless($line =~ m{\b$sign_match\-\-\-\s*\n}) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                         $success= 0;    </span></p> 
 <p align="left"><span style="color:#333333">                                         print"&lt;&lt; ERROR: no patch separator \"---\"\n";</span></p> 
 <p align="left"><span style="color:#333333">                                         print"please add \"---\" in a new line just following theSigned-off-by line\n";</span></p> 
 <p align="left"><span style="color:#333333">                                }</span></p> 
 <p align="left"><span style="color:#333333">                       }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">                       if($success == 1) { </span></p> 
 <p align="left"><span style="color:#333333">                                print"ok\n"; </span></p> 
 <p align="left"><span style="color:#333333">                       }else {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                                print"ERROR\n";</span></p> 
 <p align="left"><span style="color:#333333">                                $check_patch_global_success= 0;</span></p> 
 <p align="left"><span style="color:#333333">                       }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">                       print"\n";</span></p> 
 <p align="left"><span style="color:#333333">                       close(PATCH_CHECK);</span></p> 
 <p align="left"><span style="color:#333333">               #&lt;-open</span></p> 
 <p align="left"><span style="color:#333333">               }else {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                       print"&lt;&lt; FATAL error: can't open \"$patches[$patch_i]\" It wasmis-typed?\n";</span></p> 
 <p align="left"><span style="color:#333333">                       exit(1); </span> </p> 
 <p align="left"><span style="color:#333333">               }</span></p> 
 <p align="left"><span style="color:#333333">      #&lt;-for</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">      #TODO:add a summarisation of bad patch?</span></p> 
 <p align="left"><span style="color:#333333">      if($check_patch_global_success == 0) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               print"Abort, please check your patch format.\n";</span></p> 
 <p align="left"><span style="color:#333333">               print"The following is a good example:\n\n";</span></p> 
 <p align="left"><span style="color:#333333">               print&lt;&lt;GOOD_PATCH;</span></p> 
 <p align="left"><span style="color:#333333">Paramter \@mem has been removed sincev2.6.26, now delete its comment.</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">Signed-off-by: your-name&lt;your-name\@gmail.com&gt;</span></p> 
 <p align="left"><span style="color:#333333">---</span></p> 
 <p align="left"><span style="color:#333333">diff --git a/mm/oom_kill.cb/mm/oom_kill.c</span></p> 
 <p align="left"><span style="color:#333333">index 64e5b4b..460f90e 100644</span></p> 
 <p align="left"><span style="color:#333333">--- a/mm/oom_kill.c</span></p> 
 <p align="left"><span style="color:#333333">+++ b/mm/oom_kill.c</span></p> 
 <p align="left"><span style="color:#333333">...(ignore the diff content)</span></p> 
 <p align="left"><span style="color:#333333">GOOD_PATCH</span></p> 
 <p align="left"><span style="color:#333333">               print"\n";</span></p> 
 <p align="left"><span style="color:#333333">               exit(1);</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">      #&lt;-if($check_patch...</span></p> 
 <p align="left"><span style="color:#333333">      }else {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               print"ok, all patches format are right.\n\n"</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">sub create_mailer      </span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      $mailer= Email::Send-&gt;new( {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               mailer=&gt; 'SMTP::TLS',</span></p> 
 <p align="left"><span style="color:#333333">               mailer_args =&gt; [</span></p> 
 <p align="left"><span style="color:#333333">                         Host=&gt; $smtpserver,</span></p> 
 <p align="left"><span style="color:#333333">                         Port=&gt; 587,</span></p> 
 <p align="left"><span style="color:#333333">                         User=&gt; $smtpuser,</span></p> 
 <p align="left"><span style="color:#333333">                         Password=&gt; $smtppwd,</span></p> 
 <p align="left"><span style="color:#333333">                         #Hello=&gt; 'fayland.org',</span></p> 
 <p align="left"><span style="color:#333333">               ]</span></p> 
 <p align="left"><span style="color:#333333">     } );</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">   </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">sub send_onemail</span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      my($index) = @_;</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">      my$email = Email::Simple-&gt;create(</span></p> 
 <p align="left"><span style="color:#333333">               header=&gt; [</span></p> 
 <p align="left"><span style="color:#333333">                       From    =&gt; $fromaddr,</span></p> 
 <p align="left"><span style="color:#333333">                       To      =&gt; $toaddrs,</span></p> 
 <p align="left"><span style="color:#333333">                       Cc       =&gt; $ccaddrs,</span></p> 
 <p align="left"><span style="color:#333333">                       Bcc      =&gt; $bccaddrs,</span></p> 
 <p align="left"><span style="color:#333333">                       Subject =&gt;$subjects[$index],</span></p> 
 <p align="left"><span style="color:#333333">               ],</span></p> 
 <p align="left"><span style="color:#333333">               body=&gt; $patch_content,</span></p> 
 <p align="left"><span style="color:#333333">      );</span></p> 
 <p align="left"><span style="color:#333333">      $email-&gt;header_set('User-Agent' =&gt; "sniper-patch-carrier/$VERSION" );</span></p> 
 <p align="left"><span style="color:#333333">      </span></p> 
 <p align="left"><span style="color:#333333">      print" sending email: $subjects[$index] ...\n";</span></p> 
 <p align="left"><span style="color:#333333">      eval{ $mailer-&gt;send($email) };</span></p> 
 <p align="left"><span style="color:#333333">      if(!$@) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               print"&gt;&gt;success!\n";</span></p> 
 <p align="left"><span style="color:#333333">      }else { die "&gt;&gt;Error sending email: $@"}</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">sub read_onemail </span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      my($index) = @_;</span></p> 
 <p align="left"><span style="color:#333333">      my$file = $patches[$index];</span></p> 
 <p align="left"><span style="color:#333333">      print" reading file: $file ...\n";</span></p> 
 <p align="left"><span style="color:#333333">      $patch_content= undef;</span></p> 
 <p align="left"><span style="color:#333333">      if(open(FILE, $file)) { </span> </p> 
 <p align="left"><span style="color:#333333">               while (&lt;FILE&gt;) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">                $patch_content .= $_; </span></p> 
 <p align="left"><span style="color:#333333">               }</span></p> 
 <p align="left"><span style="color:#333333">      close(FILE);</span></p> 
 <p align="left"><span style="color:#333333">      }else {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               print "can't openpatch!";</span></p> 
 <p align="left"><span style="color:#333333">               exit(1);</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">sub send_mails </span></p> 
 <p align="left"><span style="color:#333333">{     </span></p> 
 <p align="left"><span style="color:#333333">      print"&gt;&gt;now sending all patches...\n\n";</span></p> 
 <p align="left"><span style="color:#333333">      print" file count: $patch_count\n";</span></p> 
 <p align="left"><span style="color:#333333">      my$i ;</span></p> 
 <p align="left"><span style="color:#333333">      for($i = 0; $i &lt; $patch_count; $i++) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               my$show_i = $i + 1;</span></p> 
 <p align="left"><span style="color:#333333">               print"\n$show_i:\n";</span></p> 
 <p align="left"><span style="color:#333333">               read_onemail($i);</span></p> 
 <p align="left"><span style="color:#333333">               send_onemail($i);</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333">      print"\nGood! over\n\n";</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">sub parse_argv </span></p> 
 <p align="left"><span style="color:#333333">{<!-- --></span></p> 
 <p align="left"><span style="color:#333333">      unless($control_file = shift @ARGV) {<!-- --></span></p> 
 <p align="left"><span style="color:#333333">               usage;</span></p> 
 <p align="left"><span style="color:#333333">      }</span></p> 
 <p align="left"><span style="color:#333333">}</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">parse_argv;</span></p> 
 <p align="left"><span style="color:#333333">parse_control;</span></p> 
 <p align="left"><span style="color:#333333">create_mailer;</span></p> 
 <p align="left"><span style="color:#333333">send_mails; </span></p> 
</div> 
<p align="left"><strong><span style="color:#333333">git</span><span style="color:#333333">使用</span></strong></p> 
<p align="left"><span style="color:#333333">Git </span><span style="color:#333333">中文教程</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxsir.org/main/doc/git/gittutorcn.htm" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxsir.org/main/doc/git/gittutorcn.htm</span></a></span></p> 
<p align="left"><span style="color:#333333">git</span><span style="color:#333333">使用小结</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wangcong.org/blog/?p=307" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wangcong.org/blog/?p=307</span></a></span></p> 
<p align="left"><span style="color:#333333">学习 Git</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.zeuux.org/science/learning-git.cn.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.zeuux.org/science/learning-git.cn.html</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">附录：内核参考书籍文章</span></strong></p> 
<p align="left"><strong><span style="color:#333333">内核git</span>库</strong></p> 
<p align="left"><span style="color:#333333">内核git</span>库：</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://git.kernel.org/?p=linux/kernel/git" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://git.kernel.org/?p=linux/kernel/git</span></a></span></p> 
<p align="left"><span style="color:#333333">linus-git</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=summary" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=summary</span></a></span></p> 
<p align="left"><span style="color:#333333">net</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://git.kernel.org/?p=linux/kernel/git/davem/net-2.6.git;a=summary" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://git.kernel.org/?p=linux/kernel/git/davem/net-2.6.git;a=summary</span></a></span></p> 
<p align="left"><span style="color:#333333">net-next</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://git.kernel.org/?p=linux/kernel/git/davem/net-next-2.6.git;a=summary" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://git.kernel.org/?p=linux/kernel/git/davem/net-next-2.6.git;a=summary</span></a></span></p> 
<p align="left"><span style="color:#333333">linux-next</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://git.kernel.org/?p=linux/kernel/git/sfr/linux-next.git;a=summary" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://git.kernel.org/?p=linux/kernel/git/sfr/linux-next.git;a=summary</span></a></span></p> 
<p align="left"><span style="color:#333333">免费git</span>库<a target="_blank" href="http://repo.or.cz/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://repo.or.cz/</span></a></p> 
<p align="left"><strong><span style="color:#333333">书籍</span></strong></p> 
<p align="left"><span style="color:#333333">综合类：</span></p> 
<p align="left"><span style="color:#333333">“understanding thelinux kernel</span>”</p> 
<p align="left"><span style="color:#333333">”linux kerneldevelopment</span>“</p> 
<p align="left"><span style="color:#333333">“linux</span>源代码情景分析”</p> 
<p align="left"><span style="color:#333333">“Embedded.Linux.Primer.A.Practical.Real.World.Approach.</span>”</p> 
<p align="left"><span style="color:#333333">“The_Linux_Kernel_Primer_A_Top_Down_Approach_For_x86_and_PowerPC_Architectures</span>”</p> 
<p align="left"><span style="color:#333333">子系统类：</span></p> 
<p align="left"><span style="color:#333333">文件系统：</span></p> 
<p align="left"><span style="color:#333333">“UNIX FilesystemsEvolution, Design, and Implementation</span>”</p> 
<p align="left"><span style="color:#333333">“File SystemForensic Analysis</span>”</p> 
<p align="left"><span style="color:#333333">“Windows NT File SystemInternals</span>”</p> 
<p align="left"><span style="color:#333333">内存管理：</span></p> 
<p align="left"><span style="color:#333333">“Understanding TheLinux Virtual Memory Manager</span>”</p> 
<p align="left"><span style="color:#333333">网络系统：</span></p> 
<p align="left"><span style="color:#333333">“The Linux®Networking Architecture: Design and Implementation of Network Protocols in theLinux Kernel</span>”</p> 
<p align="left"><span style="color:#333333">“Understanding.Linux.Network.Internals</span>”</p> 
<p align="left"><span style="color:#333333">The Linux TCP/IPStack: Networking for Embedded Systems (2.6.0-test10)</span></p> 
<p align="left"><span style="color:#333333">网络协议</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.ietf.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ietf.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">通过编号查看 <a target="_blank" href="http://www.ietf.org/rfc.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ietf.org/rfc.html</span></a></span></p> 
<p align="left"><span style="color:#333333">通过名称查询 <a target="_blank" href="http://www.rfc-editor.org/rfcsearch.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.rfc-editor.org/rfcsearch.html</span></a></span></p> 
<p align="left"><span style="color:#333333">Where and how to getnew RFCs</span></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">to: rfc-info@isi.edu</span></p> 
 <p align="left"><span style="color:#333333">subject        gettingrfcs</span></p> 
 <p align="left"><span style="color:#333333">help:ways_to_get_rfcs</span></p> 
</div> 
<p align="left"><span style="color:#333333">TCP/IP</span><span style="color:#333333">详解中文版</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://220.113.41.171/cgi-bin/parker/search?String=TCP+IP+%E8%AF%A6%E8%A7%A3" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://220.113.41.171/cgi-bin/parker/search?String=TCP+IP+%E8%AF%A6%E8%A7%A3</span></a></span></p> 
<p align="left"><span style="color:#333333">TCP/IP</span><span style="color:#333333">详解 所用源码</span></p> 
<p align="left"><span style="color:#333333">4.4BSD-Lite.tar.gz</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.rcub.bg.ac.yu/~ggajic/pub/4.4BSD/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.rcub.bg.ac.yu/~ggajic/pub/4.4BSD/</span></a></span></p> 
<p align="left"><span style="color:#333333">大侠文章</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://blog.chinaunix.net/u2/64681/article_86575.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u2/64681/article_86575.html</span></a></span></p> 
<p align="left"><span style="color:#333333">网络编程</span></p> 
<p align="left"><span style="color:#333333">Unix NetworkProgramming Vol 1</span></p> 
<p align="left"><span style="color:#333333">Unix NetworkProgramming Vol 2</span></p> 
<p align="left"><span style="color:#333333">Network_Programming_With_Perl</span></p> 
<p align="left"><span style="color:#333333">Linux SocketProgramming By Example</span></p> 
<p align="left"><span style="color:#333333">网络教材</span></p> 
<p align="left"><span style="color:#333333">Computer Networks,Fourth Edition</span></p> 
<p align="left"><span style="color:#333333">驱动开发:</span></p> 
<p align="left"><span style="color:#333333">“linux devicedrivers</span>”</p> 
<p align="left"><span style="color:#333333">“Essential.Linux.Device.Drivers</span>”</p> 
<p align="left"><span style="color:#333333">源码本身及附带文档</span></p> 
<p align="left"><span style="color:#333333">其他操作系统的设计与实现：</span></p> 
<p align="left"><span style="color:#333333">The Design andImplementation of the 4.4BSD Operating System</span></p> 
<p align="left"><span style="color:#333333">The Design andImplementation of the FreeBSD Operating System</span></p> 
<p align="left"><span style="color:#333333">Solaris InternalsSolaris 10 and OpenSolaris Kernel Architecture</span></p> 
<p align="left"><strong><span style="color:#333333">子系统官方网站</span></strong></p> 
<p align="left"><span style="color:#333333">* MM</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://linux-mm.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://linux-mm.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">* USB</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linux-usb.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linux-usb.org/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.usb.org/home" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.usb.org/home</span></a></span></p> 
<p align="left"><span style="color:#333333">* MTD</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linux-mtd.infradead.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linux-mtd.infradead.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">* ARM</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.arm.linux.org.uk/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.arm.linux.org.uk/</span></a></span></p> 
<p align="left"><span style="color:#333333">* uclinux</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.uclinux.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.uclinux.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">* NET:</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxfoundation.org/en/Net" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxfoundation.org/en/Net</span></a></span></p> 
<p align="left"><span style="color:#333333">wireless</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://linuxwireless.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://linuxwireless.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">IPsec</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.ipsec-howto.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ipsec-howto.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">netfilter</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://netfilter.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://netfilter.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">Linux AdvancedRouting &amp; Traffic Control</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://lartc.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://lartc.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">Frame Diverter</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://diverter.sourceforge.net/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://diverter.sourceforge.net/</span></a></span></p> 
<p align="left"><span style="color:#333333">网络工具源码</span></p> 
<p align="left"><span style="color:#333333">iputils</span></p> 
<p align="left"><span style="color:#333333">$ apt-get sourceiputils</span></p> 
<p align="left"><span style="color:#333333">net-tools</span></p> 
<p align="left"><span style="color:#333333">$ apt-get sourcenet-tools</span></p> 
<p align="left"><span style="color:#333333">Iproute2</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxfoundation.org/en/Net:Iproute2" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxfoundation.org/en/Net:Iproute2</span></a></span></p> 
<p align="left"><span style="color:#333333">* FS:</span></p> 
<p align="left"><span style="color:#333333">List of file systems</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://en.wikipedia.org/wiki/List_of_file_systems" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://en.wikipedia.org/wiki/List_of_file_systems</span></a></span></p> 
<p align="left"><span style="color:#333333">ext4</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://sourceforge.net/mailarchive/forum.php?forum=ext2-devel" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceforge.net/mailarchive/forum.php?forum=ext2-devel</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.bullopensource.org/ext4/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.bullopensource.org/ext4/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://ext4.wiki.kernel.org/index.php/Main_Page" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://ext4.wiki.kernel.org/index.php/Main_Page</span></a></span></p> 
<p align="left"><span style="color:#333333">btrfs</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://btrfs.wiki.kernel.org/index.php/Project_ideas" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://btrfs.wiki.kernel.org/index.php/Project_ideas</span></a></span></p> 
<p align="left"><span style="color:#333333">coda</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.coda.cs.cmu.edu/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.coda.cs.cmu.edu/</span></a></span></p> 
<p align="left"><span style="color:#333333">nfs</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wiki.linux-nfs.org/wiki/index.php/Main_Page" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.linux-nfs.org/wiki/index.php/Main_Page</span></a></span></p> 
<p align="left"><span style="color:#333333">yaffs</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.yaffs.net/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.yaffs.net/</span></a></span></p> 
<p align="left"><span style="color:#333333">jffs</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://sourceware.org/jffs2/jffs2-html/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceware.org/jffs2/jffs2-html/</span></a></span></p> 
<p align="left"><span style="color:#333333">logfs</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.logfs.org/logfs/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.logfs.org/logfs/</span></a></span></p> 
<p align="left"><span style="color:#333333">ubifs</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linux-mtd.infradead.org/doc/ubifs.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linux-mtd.infradead.org/doc/ubifs.html</span></a></span></p> 
<p align="left"><span style="color:#333333">* </span><span style="color:#333333">其他:</span></p> 
<p align="left"><span style="color:#333333">U-Boot</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.denx.de/wiki/U-Boot" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.denx.de/wiki/U-Boot</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://sourceforge.net/projects/u-boot/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://sourceforge.net/projects/u-boot/</span></a></span></p> 
<p align="left"><span style="color:#333333">udev</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev.html</span></a></span></p> 
<p align="left"><span style="color:#333333">busybox</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.busybox.net/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.busybox.net/</span></a></span></p> 
<p align="left"><span style="color:#333333">skyeye</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.skyeye.org/index.shtml" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.skyeye.org/index.shtml</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">参考文章</span></strong></p> 
<p align="left"><span style="color:#333333">IBM-Linux </span><span style="color:#333333">相关专题 <a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/</span></a> </span>“Debugging Kernel Modules with User Mode Linux”</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxjournal.com/article/5749" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxjournal.com/article/5749</span></a></span></p> 
<p align="left"><span style="color:#333333">“Debugging Memory onLinux</span>” <a target="_blank" href="http://www.linuxjournal.com/article/4681" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxjournal.com/article/4681</span></a></p> 
<p align="left"><span style="color:#333333">“DDD</span>—Data Display Debugger” <a target="_blank" href="http://www.linuxjournal.com/article/2315" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxjournal.com/article/2315</span></a></p> 
<p align="left"><span style="color:#333333">“Linux </span>系统内核的调试” <a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-kdb/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-kdb/</span></a></p> 
<p align="left"><span style="color:#333333">System Dump</span><span style="color:#333333">和CoreDump</span>的区别 <a target="_blank" href="http://hi.baidu.com/iruler/blog/item/c203de3522ff398ea61e122c.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://hi.baidu.com/iruler/blog/item/c203de3522ff398ea61e122c.html</span></a></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxjournal.com/user/800887/track" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxjournal.com/user/800887/track</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxjournal.com/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxjournal.com/</span></a> <a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-devmapper/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-devmapper/index.html</span></a></span></p> 
<p align="left"><span style="color:#333333">read </span><span style="color:#333333">系统调用剖析 <a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-cn-read/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-cn-read/index.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://blog.chinaunix.net/u/4206/showart_501237.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u/4206/showart_501237.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://hi.baidu.com/linux_kernel/blog/category/pci%C9%E8%B1%B8%C7%FD%B6%AF" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://hi.baidu.com/linux%5Fkernel/blog/category/pci%C9%E8%B1%B8%C7%FD%B6%AF</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://wiki.jk2410.org/wiki/Main_Page" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://wiki.jk2410.org/wiki/Main_Page</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-cn-clocks/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-cn-clocks/index.html</span></a></span></p> 
<p align="left"><span style="color:#333333">利用Vmware5.5.1 </span>和 kgdb调试 x86平台的kernel</p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://blog.chinaunix.net/u/22617/showart_338509.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u/22617/showart_338509.html</span></a></span></p> 
<p align="left"><span style="color:#333333">Welcome to LinuxFrom Scratch</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxfromscratch.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxfromscratch.org/</span></a></span></p> 
<p align="left"><span style="color:#333333">Unreliable Guide ToLocking</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.kernel.org/pub/linux/kernel/people/rusty/kernel-locking/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.kernel.org/pub/linux/kernel/people/rusty/kernel-locking/index.html</span></a></span></p> 
<p align="left"><span style="color:#333333">How do I printk&lt;type&gt; correctly?</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://lkml.org/lkml/2008/10/23/132" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://lkml.org/lkml/2008/10/23/132</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.ibm.com/developerworks/cn/linux/l-linux-networking-stack/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.ibm.com/developerworks/cn/linux/l-linux-networking-stack/</span></a></span></p> 
<p align="left"><span style="color:#333333">KernelJanitors/Todo</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://kernelnewbies.org/KernelJanitors/Todo" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://kernelnewbies.org/KernelJanitors/Todo</span></a></span></p> 
<p align="left"><span style="color:#333333">sparse</span><span style="color:#333333">主页</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.kernel.org/pub/linux/kernel/people/josh/sparse/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.kernel.org/pub/linux/kernel/people/josh/sparse/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://linux.bkbits.net:8080/linux-2.6/search/?PAGE=search&amp;EXPR=sparse&amp;SEARCH=ChangeSet+comments" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://linux.bkbits.net:8080/linux-2.6/search/?PAGE=search&amp;EXPR=sparse&amp;SEARCH=ChangeSet+comments</span></a></span></p> 
<p align="left"><span style="color:#333333">Coccinelle - aFramework for Linux Device Driver Evolution</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.emn.fr/x-info/coccinelle/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.emn.fr/x-info/coccinelle/</span></a></span></p> 
<p align="left"><span style="color:#333333">linux</span><span style="color:#333333">论文 <a target="_blank" href="http://www.linuxsymposium.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxsymposium.org</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxsymposium.org/2006/linuxsymposium_procv2.pdf" rel="nofollow noopener noreferrer"><span style="color:#FF8373">www.linuxsymposium.org/2006/linuxsymposium_procv2.pdf</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxsymposium.org/2006/linuxsymposium_procv1.pdf" rel="nofollow noopener noreferrer"><span style="color:#FF8373">www.linuxsymposium.org/2006/linuxsymposium_procv1.pdf</span></a></span></p> 
<p align="left"><span style="color:#333333">understanding thelinux kernel </span> <span style="color:#333333">在线文档</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linux-security.cn/ebooks/ulk3-html/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linux-security.cn/ebooks/ulk3-html/</span></a></span></p> 
<p align="left"><span style="color:#333333">Data Structures andAlgorithms with Object-Oriented Design Patterns inC++/Java/C#/Python/Ruby/Lua/Perl/PHP</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.brpreiss.com/books/opus4/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.brpreiss.com/books/opus4/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="ftp://ftp.akaedu.org/1.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">ftp://ftp.akaedu.org/../1.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="ftp://ftp.freebsd.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">ftp://ftp.freebsd.org/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://bsd.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://bsd.org/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.micrium.com/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.micrium.com/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://v1.moblin.org/index.php" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://v1.moblin.org/index.php</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://moblin.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://moblin.org/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.linuxdriver.cn/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.linuxdriver.cn/</span></a></span></p> 
<p align="left"><span style="color:#333333">Integrating FlexibleSupport for Security Policies into the Linux Operating System</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.nsa.gov/selinux/papers/slinux/slinux.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.nsa.gov/selinux/papers/slinux/slinux.html</span></a></span></p> 
<p align="left"><strong><span style="color:#333333">私人备忘</span></strong></p> 
<div style="background:#F6F6F6"> 
 <p align="left"><span style="color:#333333">cpan</span><span style="color:#333333">设置</span></p> 
 <p align="left"><span style="color:#333333">Going to read/home/fqh/.cpan/sources/modules/02packages.details.txt.gz</span></p> 
 <p align="left"><span style="color:#333333">Warning: Your/home/fqh/.cpan/sources/modules/02packages.details.txt.gz does not contain aLine-Count header.</span></p> 
 <p align="left"><span style="color:#333333">是选取站点不可用造成的。</span></p> 
 <p align="left"><span style="color:#333333">http://tech.foolpig.com/2008/10/22/cpan-error-modulelist/</span></p> 
 <p align="left"><span style="color:#333333">1.</span><span style="color:#333333">删除掉</span><span style="color:#333333">.cpan</span></p> 
 <p align="left"><span style="color:#333333">2.perl -MCPAN -e shell</span></p> 
 <p align="left"><span style="color:#333333">或</span><span style="color:#333333">1,2</span><span style="color:#333333">步骤换为</span><span style="color:#333333">o conf init</span><span style="color:#333333">命令</span></p> 
 <p align="left"><span style="color:#333333">3.</span><span style="color:#333333">选了</span><span style="color:#333333">africa</span><span style="color:#333333">下的三个站点</span></p> 
 <p align="left"><span style="color:#333333">4.cpan</span><span style="color:#333333">设置完后，</span><span style="color:#333333">reload index</span><span style="color:#333333">即可</span></p> 
 <p align="left"><span style="color:#333333">5.</span><span style="color:#333333">列举模块</span><span style="color:#333333">m</span></p> 
 <p align="left"><span style="color:#333333">6.</span><span style="color:#333333">查询</span><span style="color:#333333"> d /</span><span style="color:#333333">模块</span><span style="color:#333333">/</span></p> 
 <p align="left"><span style="color:#333333">－－－</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
 <p align="left"><span style="color:#333333">__attribute__((context(x,0,1))) means"you need not hold x before, but</span></p> 
 <p align="left"><span style="color:#333333">you will hold one more of x after".</span></p> 
 <p align="left"><span style="color:#333333">__attribute__((context(x,1,0))) means"you must already hold x, and you</span></p> 
 <p align="left"><span style="color:#333333">will no longer hold x after".</span></p> 
 <p align="left"><span style="color:#333333">__attribute__((context(x,1,1))) means"you must already hold x, and you</span></p> 
 <p align="left"><span style="color:#333333">will continue to hold x".</span></p> 
 <p align="left"><span style="color:#333333"> </span></p> 
</div> 
<p align="left"><span style="color:#333333">sendpatchset </span><span style="color:#333333">的地址</span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://google.com/codesearch?hl=en&amp;q=show:UIY7Kd7jXdU:OMvU_Vh8FvE:EkVrWPVcX9w&amp;sa=N&amp;ct=rd&amp;cs_p=http://www.speakeasy.net&amp;cs_f=%7Epj99/sgi/sendpatchset" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://google.com/codesearch?hl=en&amp;q=show:UIY7Kd7jXdU:OMvU_Vh8FvE:EkVrWPVcX9w&amp;sa=N&amp;ct=rd&amp;cs_p=http://www.speakeasy.net&amp;cs_f=~pj99/sgi/sendpatchset</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://pleac.sourceforge.net/pleac_perl/index.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://pleac.sourceforge.net/pleac_perl/index.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://search.cpan.org/~fayland/Email-Send-SMTP-TLS-0.02/lib/Email/Send/SMTP/TLS.pm#___top" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://search.cpan.org/~fayland/Email-Send-SMTP-TLS-0.02/lib/Email/Send/SMTP/TLS.pm#___top</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.61dh.com/blog/2008/10/perl_27.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.61dh.com/blog/2008/10/perl_27.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://blog.chinaunix.net/u2/77776/showart_1227451.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://blog.chinaunix.net/u2/77776/showart_1227451.html</span></a></span></p> 
<p align="left"><span style="color:#333333">剑桥辞典 <a target="_blank" href="http://dictionary.cambridge.org/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://dictionary.cambridge.org/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.merriam-webster.com/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.merriam-webster.com/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://dictionary.reference.com/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://dictionary.reference.com/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://www.thefreedictionary.com/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://www.thefreedictionary.com/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://people.freebsd.org/~murray/bsd_flier.html" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://people.freebsd.org/~murray/bsd_flier.html</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://s3c24xx.wiki.zoho.com/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://s3c24xx.wiki.zoho.com/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://bobzhang.wiki.zoho.com/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://bobzhang.wiki.zoho.com/</span></a></span></p> 
<p align="left"><span style="color:#333333"><a target="_blank" href="http://code.google.com/p/root-kit/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://code.google.com/p/root-kit/</span></a></span></p> 
<p align="left"><span style="color:#333333">免费git</span>库<a target="_blank" href="http://repo.or.cz/" rel="nofollow noopener noreferrer"><span style="color:#FF8373">http://repo.or.cz/</span></a></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0aa5c67c3ee3a4ae36c7e946328bee4c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">liunx----putty--ssh--ppk---密文自动登陆</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5cfaedcccaaa1ad1ee2aef0c876cc01f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[转]session listener的配置和使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>