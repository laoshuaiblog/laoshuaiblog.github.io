<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>aidl文件生成Java、C&#43;&#43;[android]、C&#43;&#43;[ndk]、Rust接口 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/e2da79ea2e40f4329328ee05c6258544/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="aidl文件生成Java、C&#43;&#43;[android]、C&#43;&#43;[ndk]、Rust接口">
  <meta property="og:description" content="目录 前言一、Java二、C&#43;&#43;[android]三、C&#43;&#43;[ndk]四、Rust接口 前言 在 Android 开发中，AIDL 文件通常会被自动编译，生成对应语言的接口文件。对于应用层 Java 开发者来说，使用 AIDL 和 Binder 封装的接口可以让他们更加专注于应用逻辑，而不需要过多关注 Binder 的调用细节或 AIDL 的编译过程。
然而，对于中下层开发者来说，包括 framework 和 native 层开发，可能需要编写 native service，并且有必要理解 Binder 的底层机制。
关于编译 AIDL 文件的过程，通常是由构建系统自动完成。在编译过程中，AIDL 文件会被处理并生成相应的接口文件，以便后续开发使用。生成的接口文件内容会根据具体的需求和语言类型而有所不同，可以根据生成的接口文件来进行后续的开发工作。
如果使用 SDK 中的 aidl 工具，需要将其路径添加到系统的 PATH 环境变量中。通常位于路径：~/Android/Sdk/build-tools/33.0.2/aidl。而如果使用源码中的 aidl 工具，则在设置好源码编译环境后，这个工具会自动添加到系统的 PATH 环境变量中。源码中的 aidl 工具通常位于路径：out/soong/host/linux-x86/bin/aidl。 准备文件
ITestAudio.aidl
package henry.test.audio; interface ITestAudio{ int requestAudioFocus(int streamType, int durationHint); int abandonAudioFocus(); void requestAudioFocusForCall(int streamType, int durationHint); void abandonAudioFocusForCall(); void setMode(int mode); } 环境
源码环境：out/soong/host/linux-x86/bin/">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-28T11:58:30+08:00">
    <meta property="article:modified_time" content="2024-03-28T11:58:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">aidl文件生成Java、C&#43;&#43;[android]、C&#43;&#43;[ndk]、Rust接口</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_6" rel="nofollow">前言</a></li><li><a href="#Java_50" rel="nofollow">一、Java</a></li><li><a href="#Candroid_67" rel="nofollow">二、C++[android]</a></li><li><a href="#Cndk_102" rel="nofollow">三、C++[ndk]</a></li><li><a href="#Rust_130" rel="nofollow">四、Rust接口</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_6"></a>前言</h2> 
<p>在 Android 开发中，AIDL 文件通常会被自动编译，生成对应语言的接口文件。对于应用层 Java 开发者来说，使用 AIDL 和 Binder 封装的接口可以让他们更加专注于应用逻辑，而不需要过多关注 Binder 的调用细节或 AIDL 的编译过程。</p> 
<p>然而，对于中下层开发者来说，包括 framework 和 native 层开发，可能需要编写 native service，并且有必要理解 Binder 的底层机制。</p> 
<p>关于编译 AIDL 文件的过程，通常是由构建系统自动完成。在编译过程中，AIDL 文件会被处理并生成相应的接口文件，以便后续开发使用。生成的接口文件内容会根据具体的需求和语言类型而有所不同，可以根据生成的接口文件来进行后续的开发工作。</p> 
<blockquote> 
 <ul><li>如果使用 SDK 中的 aidl 工具，需要将其路径添加到系统的 PATH 环境变量中。通常位于路径：~/Android/Sdk/build-tools/33.0.2/aidl。</li><li>而如果使用源码中的 aidl 工具，则在设置好源码编译环境后，这个工具会自动添加到系统的 PATH 环境变量中。源码中的 aidl 工具通常位于路径：out/soong/host/linux-x86/bin/aidl。</li></ul> 
</blockquote> 
<p><strong>准备文件</strong><br> <code>ITestAudio.aidl</code></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">henry<span class="token punctuation">.</span>test<span class="token punctuation">.</span>audio</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">ITestAudio</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> <span class="token function">requestAudioFocus</span><span class="token punctuation">(</span><span class="token keyword">int</span> streamType<span class="token punctuation">,</span> <span class="token keyword">int</span> durationHint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">abandonAudioFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">requestAudioFocusForCall</span><span class="token punctuation">(</span><span class="token keyword">int</span> streamType<span class="token punctuation">,</span> <span class="token keyword">int</span> durationHint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">abandonAudioFocusForCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setMode</span><span class="token punctuation">(</span><span class="token keyword">int</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>环境</strong><br> 源码环境：out/soong/host/linux-x86/bin/</p> 
<p><strong>aidl命令</strong><br> aidl --lang={java|cpp|ndk} [options] input_aidl_file。</p> 
<blockquote> 
 <ul><li>–lang={java|cpp|ndk}<br> 指定生成接口类型。如果不指定，默认生成Java文件。</li><li>-o 指定输出目录<br> Java：省略-o参数，java文件生成到aidl文件目录下。<br> C++/Rust：必选参数。</li><li>-I DIR, --include=DIR<br> 指定依赖的aidl文件所在目录。不是C++头文件目录。<br> 例如：A.aidl引用了B.aidl，在生成A.aidl的时候需要指定-I参数才能正常编译。<br> 只要是AIDL文件中有依赖，生成任何类型的接口（Java、C++、Rust）都要指定这个参数。</li></ul> 
</blockquote> 
<h2><a id="Java_50"></a>一、Java</h2> 
<pre><code class="prism language-java">aidl <span class="token operator">-</span>o <span class="token punctuation">.</span>/java <span class="token operator">--</span>lang<span class="token operator">=</span>java henry<span class="token operator">/</span>test<span class="token operator">/</span>audio<span class="token operator">/</span><span class="token class-name">ITestAudio</span><span class="token punctuation">.</span>aidl
</code></pre> 
<pre><code class="prism language-java">tree <span class="token punctuation">.</span>/java
<span class="token punctuation">.</span>/java
└── henry
    └── test
        └── audio
            └── <span class="token class-name">ITestAudio</span><span class="token punctuation">.</span>java

<span class="token number">3</span> directories<span class="token punctuation">,</span> <span class="token number">1</span> file
</code></pre> 
<hr> 
<h2><a id="Candroid_67"></a>二、C++[android]</h2> 
<p>cpp：生成的代码是为了在Android源码中编译，代码中会调用Android源码中的native接口。<br> 例如，引用的头文件：<br> &lt;binder/IBinder.h&gt;，&lt;binder/IInterface.h&gt;，&lt;binder/Status.h&gt;，&lt;android-base/macros.h&gt;</p> 
<p>–lang=cpp，参数指定生成Android源码下编译的C++接口文件。</p> 
<p>-o和-h参数分别指定.cpp文件和.h文件输出的路径。可以指定不同的目录。<br> C++接口文件比较多，一个aidl文件生成4个文件。第一步编译ITestAudio.aidl后，生成文件包括：<br> 3个头文件：<br> 一个Interface头文件：ITestAudio.h<br> 一个Bp头文件：BpTestAudio.h<br> 一个Bn头文件：BnTestAudio.h<br> 一个源码文件：ITestAudio.cpp</p> 
<pre><code class="prism language-java">aidl <span class="token operator">-</span>h <span class="token punctuation">.</span>/cpp_android<span class="token operator">/</span> <span class="token operator">-</span>o <span class="token punctuation">.</span>/cpp_android <span class="token operator">--</span>lang<span class="token operator">=</span>cpp henry<span class="token operator">/</span>test<span class="token operator">/</span>audio<span class="token operator">/</span><span class="token class-name">ITestAudio</span><span class="token punctuation">.</span>aidl
</code></pre> 
<pre><code class="prism language-java">tree <span class="token punctuation">.</span>/cpp_android<span class="token operator">/</span>
<span class="token punctuation">.</span>/cpp_android<span class="token operator">/</span>
└── henry
    └── test
        └── audio
            ├── <span class="token class-name">BnTestAudio</span><span class="token punctuation">.</span>h
            ├── <span class="token class-name">BpTestAudio</span><span class="token punctuation">.</span>h
            ├── <span class="token class-name">ITestAudio</span><span class="token punctuation">.</span>cpp
            └── <span class="token class-name">ITestAudio</span><span class="token punctuation">.</span>h

<span class="token number">3</span> directories<span class="token punctuation">,</span> <span class="token number">4</span> files
</code></pre> 
<h2><a id="Cndk_102"></a>三、C++[ndk]</h2> 
<p>ndk：生成的代码是为了使用ndk独立编译，调用的是ndk的接口，<br> 例如，引用的头文件：<br> &lt;android/binder_interface_utils.h&gt; &lt;android/binder_ibinder.h&gt;<br> –lang=ndk</p> 
<pre><code class="prism language-java">aidl <span class="token operator">-</span>h <span class="token punctuation">.</span>/cpp_ndk <span class="token operator">-</span>o <span class="token punctuation">.</span>/cpp_ndk <span class="token operator">--</span>lang<span class="token operator">=</span>ndk henry<span class="token operator">/</span>test<span class="token operator">/</span>audio<span class="token operator">/</span><span class="token class-name">ITestAudio</span><span class="token punctuation">.</span>aidl
</code></pre> 
<pre><code class="prism language-java">tree <span class="token punctuation">.</span>/cpp_ndk<span class="token operator">/</span>
<span class="token punctuation">.</span>/cpp_ndk<span class="token operator">/</span>
├── aidl
│   └── henry
│       └── test
│           └── audio
│               ├── <span class="token class-name">BnTestAudio</span><span class="token punctuation">.</span>h
│               ├── <span class="token class-name">BpTestAudio</span><span class="token punctuation">.</span>h
│               └── <span class="token class-name">ITestAudio</span><span class="token punctuation">.</span>h
└── henry
    └── test
        └── audio
            └── <span class="token class-name">ITestAudio</span><span class="token punctuation">.</span>cpp

<span class="token number">7</span> directories<span class="token punctuation">,</span> <span class="token number">4</span> files
</code></pre> 
<h2><a id="Rust_130"></a>四、Rust接口</h2> 
<p>–lang=rust指定生成rust后端接口文件<br> <code>较新Android 版本才支持</code></p> 
<pre><code class="prism language-java">aidl <span class="token operator">-</span>o <span class="token punctuation">.</span>/rust <span class="token operator">--</span>lang<span class="token operator">=</span>rust henry<span class="token operator">/</span>test<span class="token operator">/</span>audio<span class="token operator">/</span><span class="token class-name">ITestAudio</span><span class="token punctuation">.</span>aidl
</code></pre> 
<pre><code class="prism language-java">tree <span class="token punctuation">.</span>/cpp_ndk<span class="token operator">/</span>
<span class="token punctuation">.</span>/rust<span class="token operator">/</span>
── henry
    └── test
        └── audio
            └── <span class="token class-name">ITestAudio</span><span class="token punctuation">.</span>rs
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/628768c2e3d89d49f3c95bd3217d3e9b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vulnhub靶场之driftingblues-2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d0b8d9a8cce5709a9c4c2a31cbc523b3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">软考中级(网络工程师考核要点)第一章 计算机网络系统(信道特性应用)第五期（曼彻斯特和差分曼彻斯特）重点考</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>