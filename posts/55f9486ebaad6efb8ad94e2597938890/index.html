<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apollo学习（超详细） - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/55f9486ebaad6efb8ad94e2597938890/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Apollo学习（超详细）">
  <meta property="og:description" content="Apollo 文章目录 Apollo1. 学习地址2. 概览1. 什么是配置2. 什么是配置中心 3. Apollo简介1. 主流配置中心1.1. 功能特性对比1.2 总结 2. Apollo简介3. Apollo特性 4. Apollo快速入门1. 执行流程2. 安装Apollo2.1 运行时环境2.2 下载配置2.3 创建数据库2.4 启动Apollo 5. 代码实现1. 发布配置2. 应用读取配置1. 新建Maven工程2. 编写测试类GetConfigTest3. 测试4. 修改配置5. 热发布 6. Apollo应用1. Apollo工作原理1. 各模块职责2. 分步执行流程 2. 核心概念3. 项目管理1. 基础设置2. 创建项目3. 删除项目 4. 配置管理1. 添加发布配置项2. 修改配置3. 删除配置4. 添加Namespace 1. 学习地址 地址
2. 概览 1. 什么是配置 应用程序在启动和运行的时候往往需要读取一些配置信息，配置基本上伴随着应用程序的整个生命周期，比如：数据库连接参数、启动参数等。
配置主要有以下几个特点：
配置是独立于程序的只读变量 配置首先是独立于程序的，同一份程序在不同的配置下会有不同的行为其次，配置对于程序是只读的，程序通过读取配置来改变自己的行为，但是程序不应该去改变配置 配置伴随应用的整个生命周期 配置贯穿于应用的整个生命周期，应用在启动时通过读取配置来初始化，在运行时根据配置调整行为。比如：启动时需要读取服务的端口号、系统在运行过程中需要读取定时策略执行定时任务等。 配置可以有多种加载方式 常见的有程序内部硬编码，配置文件，环境变量，启动参数，基于数据库等 配置需要治理 权限控制：由于配置能改变程序的行为，不正确的配置甚至能引起灾难，所以对配置的修改必须有比较完善的权限控制不同环境、集群配置管理：同一份程序在不同的环境（开发，测试，生产）、不同的集群（如不同的数据中心）经常需要有不同的配置，所以需要有完善的环境、集群配置管理 2. 什么是配置中心 传统单体应用存在一些潜在缺陷，如随着规模的扩大，部署效率降低，团队协作效率差，系统可靠性变差，维护困难，新功能上线周期长等，所以迫切需要一种新的架构去解决这些问题，而微服务（ microservices ）架构正是当下一种流行的解法。">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-11-15T15:46:59+08:00">
    <meta property="article:modified_time" content="2022-11-15T15:46:59+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apollo学习（超详细）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Apollo_0"></a>Apollo</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Apollo_0" rel="nofollow">Apollo</a></li><li><ul><li><a href="#1___3" rel="nofollow">1. 学习地址</a></li><li><a href="#2___7" rel="nofollow">2. 概览</a></li><li><ul><li><a href="#1___9" rel="nofollow">1. 什么是配置</a></li><li><a href="#2__26" rel="nofollow">2. 什么是配置中心</a></li></ul> 
   </li><li><a href="#3_Apollo_54" rel="nofollow">3. Apollo简介</a></li><li><ul><li><a href="#1__56" rel="nofollow">1. 主流配置中心</a></li><li><ul><li><a href="#11__84" rel="nofollow">1.1. 功能特性对比</a></li><li><a href="#12__105" rel="nofollow">1.2 总结</a></li></ul> 
    </li><li><a href="#2_Apollo_109" rel="nofollow">2. Apollo简介</a></li><li><a href="#3_Apollo_125" rel="nofollow">3. Apollo特性</a></li></ul> 
   </li><li><a href="#4_Apollo_152" rel="nofollow">4. Apollo快速入门</a></li><li><ul><li><a href="#1__154" rel="nofollow">1. 执行流程</a></li><li><a href="#2_Apollo_166" rel="nofollow">2. 安装Apollo</a></li><li><ul><li><a href="#21__168" rel="nofollow">2.1 运行时环境</a></li><li><a href="#22__183" rel="nofollow">2.2 下载配置</a></li><li><a href="#23__195" rel="nofollow">2.3 创建数据库</a></li><li><a href="#24_Apollo_233" rel="nofollow">2.4 启动Apollo</a></li></ul> 
   </li></ul> 
   </li><li><a href="#5__288" rel="nofollow">5. 代码实现</a></li><li><ul><li><a href="#1__290" rel="nofollow">1. 发布配置</a></li><li><a href="#2__308" rel="nofollow">2. 应用读取配置</a></li><li><ul><li><a href="#1__Maven_310" rel="nofollow">1. 新建Maven工程</a></li><li><a href="#2__GetConfigTest_363" rel="nofollow">2. 编写测试类GetConfigTest</a></li><li><a href="#3___385" rel="nofollow">3. 测试</a></li><li><a href="#4__397" rel="nofollow">4. 修改配置</a></li><li><a href="#5__407" rel="nofollow">5. 热发布</a></li></ul> 
   </li></ul> 
   </li><li><a href="#6_Apollo_443" rel="nofollow">6. Apollo应用</a></li><li><ul><li><a href="#1__Apollo_445" rel="nofollow">1. Apollo工作原理</a></li><li><ul><li><a href="#1__451" rel="nofollow">1. 各模块职责</a></li><li><a href="#2__464" rel="nofollow">2. 分步执行流程</a></li></ul> 
    </li><li><a href="#2__472" rel="nofollow">2. 核心概念</a></li><li><a href="#3__502" rel="nofollow">3. 项目管理</a></li><li><ul><li><a href="#1__504" rel="nofollow">1. 基础设置</a></li><li><a href="#2__534" rel="nofollow">2. 创建项目</a></li><li><a href="#3__566" rel="nofollow">3. 删除项目</a></li></ul> 
    </li><li><a href="#4__574" rel="nofollow">4. 配置管理</a></li><li><ul><li><a href="#1___578" rel="nofollow">1. 添加发布配置项</a></li><li><a href="#2__606" rel="nofollow">2. 修改配置</a></li><li><a href="#3__615" rel="nofollow">3. 删除配置</a></li><li><a href="#4_Namespace_625" rel="nofollow">4. 添加Namespace</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1___3"></a>1. 学习地址</h3> 
<p><a href="http://www.pbteach.com/java/java_05_03/20210527/582534840956485632.html" rel="nofollow">地址</a></p> 
<h3><a id="2___7"></a>2. 概览</h3> 
<h4><a id="1___9"></a>1. 什么是配置</h4> 
<p>应用程序在启动和运行的时候往往需要读取一些配置信息，配置基本上伴随着应用程序的整个生命周期，比如：数据库连接参数、启动参数等。</p> 
<p>配置主要有以下几个特点：</p> 
<ul><li>配置是独立于程序的只读变量 
  <ul><li>配置首先是独立于程序的，同一份程序在不同的配置下会有不同的行为</li><li>其次，配置对于程序是只读的，程序通过读取配置来改变自己的行为，但是程序不应该去改变配置</li></ul> </li><li>配置伴随应用的整个生命周期 
  <ul><li>配置贯穿于应用的整个生命周期，应用在启动时通过读取配置来初始化，在运行时根据配置调整行为。比如：启动时需要读取服务的端口号、系统在运行过程中需要读取定时策略执行定时任务等。</li></ul> </li><li>配置可以有多种加载方式 
  <ul><li>常见的有程序内部硬编码，配置文件，环境变量，启动参数，基于数据库等</li></ul> </li><li>配置需要治理 
  <ul><li>权限控制：由于配置能改变程序的行为，不正确的配置甚至能引起灾难，所以对配置的修改必须有比较完善的权限控制</li><li>不同环境、集群配置管理：同一份程序在不同的环境（开发，测试，生产）、不同的集群（如不同的数据中心）经常需要有不同的配置，所以需要有完善的环境、集群配置管理</li></ul> </li></ul> 
<h4><a id="2__26"></a>2. 什么是配置中心</h4> 
<p>传统单体应用存在一些潜在缺陷，如随着规模的扩大，部署效率降低，团队协作效率差，系统可靠性变差，维护困难，新功能上线周期长等，所以迫切需要一种新的架构去解决这些问题，而微服务（ microservices ）架构正是当下一种流行的解法。</p> 
<p>不过，解决一个问题的同时，往往会诞生出很多新的问题，所以微服务化的过程中伴随着很多的挑战，其中一个挑战就是有关服务（应用）配置的。当系统从一个单体应用，被拆分成分布式系统上一个个服务节点后，配置文件也必须跟着迁移（分割），这样配置就分散了，不仅如此，分散中还包含着冗余，如下图：</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ZLjlglrF-1668498215689)(http://img.pbteach.com/pbresource/image/course/apollo/20180925155636662.png)]</p> 
<p>配置中心将配置从应用中剥离出来，统一管理，优雅的解决了配置的动态变更、持久化、运维成本等问题。</p> 
<p>应用自身既不需要去添加管理配置接口，也不需要自己去实现配置的持久化，更不需要引入“定时任务”以便降低运维成本。</p> 
<p>总得来说，配置中心就是一种统一管理各种应用配置的基础服务组件。</p> 
<p>在系统架构中，配置中心是整个微服务基础架构体系中的一个组件，如下图，它的功能看上去并不起眼，无非就是配置的管理和存取，但它是整个微服务架构中不可或缺的一环。</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-b7FtBDKI-1668498215696)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190621162125196.png)]</p> 
<p>集中管理配置，那么就要将应用的配置作为一个单独的服务抽离出来了，同理也需要解决新的问题，比如：版本管理（为了支持回滚），权限管理等。</p> 
<p>总结一下，在传统巨型单体应用纷纷转向细粒度微服务架构的历史进程中，配置中心是微服务化不可缺少的一个系统组件，在这种背景下中心化的配置服务即配置中心应运而生，一个合格的配置中心需要满足：</p> 
<ul><li>配置项容易读取和修改</li><li>添加新配置简单直接</li><li>支持对配置的修改的检视以把控风险</li><li>可以查看配置修改的历史记录</li><li>不同部署环境支持隔离</li></ul> 
<h3><a id="3_Apollo_54"></a>3. Apollo简介</h3> 
<h4><a id="1__56"></a>1. 主流配置中心</h4> 
<p>目前市面上用的比较多的配置中心有：（按开源时间排序）</p> 
<ol><li> <p>Disconf</p> <p>2014年7月百度开源的配置管理中心，专注于各种「分布式系统配置管理」的「通用组件」和「通用平台」, 提供统一的「配置管理服务」。目前已经不再维护更新。</p> <p>https://github.com/knightliao/disconf</p> </li><li> <p>Spring Cloud Config</p> <p>2014年9月开源，Spring Cloud 生态组件，可以和Spring Cloud体系无缝整合。</p> <p>https://github.com/spring-cloud/spring-cloud-config</p> </li><li> <p>Apollo</p> <p>2016年5月，携程开源的配置管理中心，能够集中化管理应用不同环境、不同集群的配置，配置修改后能够实时推送到应用端，并且具备规范的权限、流程治理等特性，适用于微服务配置管理场景。</p> <p>https://github.com/ctripcorp/apollo</p> </li><li> <p>Nacos</p> <p>2018年6月，阿里开源的配置中心，也可以做DNS和RPC的服务发现。</p> <p>https://github.com/alibaba/nacos</p> </li></ol> 
<h5><a id="11__84"></a>1.1. 功能特性对比</h5> 
<p>由于Disconf不再维护，下面主要对比一下Spring Cloud Config、Apollo和Nacos。</p> 
<table><thead><tr><th align="left">功能点</th><th align="left">Spring Cloud Config</th><th align="left">Apollo</th><th align="left">Nacos</th></tr></thead><tbody><tr><td align="left">配置实时推送</td><td align="left">支持(Spring Cloud Bus)</td><td align="left">支持(HTTP长轮询1s内)</td><td align="left">支持(HTTP长轮询1s内)</td></tr><tr><td align="left">版本管理</td><td align="left">支持(Git)</td><td align="left">支持</td><td align="left">支持</td></tr><tr><td align="left">配置回滚</td><td align="left">支持(Git)</td><td align="left">支持</td><td align="left">支持</td></tr><tr><td align="left">灰度发布</td><td align="left">支持</td><td align="left">支持</td><td align="left">不支持</td></tr><tr><td align="left">权限管理</td><td align="left">支持(依赖Git)</td><td align="left">支持</td><td align="left">不支持</td></tr><tr><td align="left">多集群</td><td align="left">支持</td><td align="left">支持</td><td align="left">支持</td></tr><tr><td align="left">多环境</td><td align="left">支持</td><td align="left">支持</td><td align="left">支持</td></tr><tr><td align="left">监听查询</td><td align="left">支持</td><td align="left">支持</td><td align="left">支持</td></tr><tr><td align="left">多语言</td><td align="left">只支持Java</td><td align="left">主流语言，提供了Open API</td><td align="left">主流语言，提供了Open API</td></tr><tr><td align="left">配置格式校验</td><td align="left">不支持</td><td align="left">支持</td><td align="left">支持</td></tr><tr><td align="left">单机读(QPS)</td><td align="left">7(限流所致)</td><td align="left">9000</td><td align="left">15000</td></tr><tr><td align="left">单击写(QPS)</td><td align="left">5(限流所致)</td><td align="left">1100</td><td align="left">1800</td></tr><tr><td align="left">3节点读(QPS)</td><td align="left">21(限流所致)</td><td align="left">27000</td><td align="left">45000</td></tr><tr><td align="left">3节点写(QPS)</td><td align="left">5限流所致()</td><td align="left">3300</td><td align="left">5600</td></tr></tbody></table> 
<h5><a id="12__105"></a>1.2 总结</h5> 
<p>总的来看，Apollo和Nacos相对于Spring Cloud Config的生态支持更广，在配置管理流程上做的更好。Apollo相对于Nacos在配置管理做的更加全面，Nacos则使用起来相对比较简洁，在对性能要求比较高的大规模场景更适合。但对于一个开源项目的选型，项目上的人力投入（迭代进度、文档的完整性）、社区的活跃度（issue的数量和解决速度、Contributor数量、社群的交流频次等），这些因素也比较关键，考虑到Nacos开源时间不长和社区活跃度，所以从目前来看Apollo应该是最合适的配置中心选型。</p> 
<h4><a id="2_Apollo_109"></a>2. Apollo简介</h4> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-hwHcgqbL-1668498215697)(http://img.pbteach.com/pbresource/image/course/apollo/logo-simple.png)]</p> 
<p>Apollo - A reliable configuration management system</p> 
<p>https://github.com/ctripcorp/apollo</p> 
<p>Apollo（阿波罗）是携程框架部门研发的分布式配置中心，能够集中化管理应用的不同环境、不同集群的配置，配置修改后能够实时推送到应用端，并且具备规范的权限、流程治理等特性，适用于微服务配置管理场景。</p> 
<p>Apollo包括服务端和客户端两部分：</p> 
<p>服务端基于Spring Boot和Spring Cloud开发，打包后可以直接运行，不需要额外安装Tomcat等应用容器。</p> 
<p>Java客户端不依赖任何框架，能够运行于所有Java运行时环境，同时对Spring/Spring Boot环境也有较好的支持。</p> 
<h4><a id="3_Apollo_125"></a>3. Apollo特性</h4> 
<p>基于配置的特殊性，所以Apollo从设计之初就立志于成为一个有治理能力的配置发布平台，目前提供了以下的特性：</p> 
<ul><li>统一管理不同环境、不同集群的配置 
  <ul><li>Apollo提供了一个统一界面集中式管理不同环境（environment）、不同集群（cluster）、不同命名空间（namespace）的配置。</li><li>同一份代码部署在不同的集群，可以有不同的配置，比如zookeeper的地址等</li><li>通过命名空间（namespace）可以很方便地支持多个不同应用共享同一份配置，同时还允许应用对共享的配置进行覆盖</li></ul> </li><li>配置修改实时生效（热发布） 
  <ul><li>用户在Apollo修改完配置并发布后，客户端能实时（1秒）接收到最新的配置，并通知到应用程序</li></ul> </li><li>版本发布管理 
  <ul><li>所有的配置发布都有版本概念，从而可以方便地支持配置的回滚</li></ul> </li><li>灰度发布 
  <ul><li>支持配置的灰度发布，比如点了发布后，只对部分应用实例生效，等观察一段时间没问题后再推给所有应用实例</li></ul> </li><li>权限管理、发布审核、操作审计 
  <ul><li>应用和配置的管理都有完善的权限管理机制，对配置的管理还分为了编辑和发布两个环节，从而减少人为的错误。</li><li>所有的操作都有审计日志，可以方便地追踪问题</li></ul> </li><li>客户端配置信息监控 
  <ul><li>可以在界面上方便地看到配置在被哪些实例使用</li></ul> </li><li>提供Java和.Net原生客户端 
  <ul><li>提供了Java和.Net的原生客户端，方便应用集成</li><li>支持Spring Placeholder, Annotation和Spring Boot的ConfigurationProperties，方便应用使用（需要Spring 3.1.1+）</li><li>同时提供了Http接口，非Java和.Net应用也可以方便地使用</li></ul> </li><li>提供开放平台API 
  <ul><li>Apollo自身提供了比较完善的统一配置管理界面，支持多环境、多数据中心配置管理、权限、流程治理等特性。不过Apollo出于通用性考虑，不会对配置的修改做过多限制，只要符合基本的格式就能保存，不会针对不同的配置值进行针对性的校验，如数据库用户名、密码，Redis服务地址等</li><li>对于这类应用配置，Apollo支持应用方通过开放平台API在Apollo进行配置的修改和发布，并且具备完善的授权和权限控制</li></ul> </li></ul> 
<h3><a id="4_Apollo_152"></a>4. Apollo快速入门</h3> 
<h4><a id="1__154"></a>1. 执行流程</h4> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-yNDgKI3p-1668498215700)(C:\Users\maido\AppData\Roaming\Typora\typora-user-images\image-20221115143644155.png)]</p> 
<p>操作流程如下：</p> 
<p>1、在Apollo配置中心修改配置</p> 
<p>2、应用程序通过Apollo客户端从配置中心拉取配置信息</p> 
<p>用户通过Apollo配置中心修改或发布配置后，会有两种机制来保证应用程序来获取最新配置：一种是Apollo配置中心会向客户端推送最新的配置；另外一种是Apollo客户端会定时从Apollo配置中心拉取最新的配置，通过以上两种机制共同来保证应用程序能及时获取到配置。</p> 
<h4><a id="2_Apollo_166"></a>2. 安装Apollo</h4> 
<h5><a id="21__168"></a>2.1 运行时环境</h5> 
<p>Java</p> 
<ul><li>Apollo服务端：1.8+</li><li>Apollo客户端：1.7+</li></ul> 
<p>由于需要同时运行服务端和客户端，所以建议安装Java 1.8+。</p> 
<p>MySQL</p> 
<ul><li>版本要求：8.0</li></ul> 
<p>Apollo的表结构对<code>timestamp</code>使用了多个default声明，所以需要5.6.5以上版本。</p> 
<h5><a id="22__183"></a>2.2 下载配置</h5> 
<p>访问Apollo的官方主页获取安装包（本次使用1.8.2版本）：</p> 
<p>​ [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-KynPob0g-1668498215702)(C:\Users\maido\AppData\Roaming\Typora\typora-user-images\image-20221115144027013.png)]</p> 
<p>打开1.8.2发布链接，下载必须的安装包：https://github.com/ctripcorp/apollo/releases/tag/v1.3.0 [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-SBQ43MTw-1668498215705)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190916182704171.png)]</p> 
<ol><li>解压安装包后将apollo-configservice-1.8.2.jar, apollo-adminservice-1.8.2.jar, apollo-portal-1.8.2.jar放置于apollo目录下</li></ol> 
<h5><a id="23__195"></a>2.3 创建数据库</h5> 
<p>Apollo服务端共需要两个数据库：<code>ApolloPortalDB</code>和<code>ApolloConfigDB</code>，ApolloPortalDB只需要在生产环境部署一个即可，而ApolloConfigDB需要在每个环境部署一套。</p> 
<p>创建ApolloPortalDB，sql脚本下载地址：https://gitee.com/apolloconfig/apollo/blob/1.8.2/scripts/sql/apolloportaldb.sql</p> 
<p>以MySQL原生客户端为例：</p> 
<pre><code> source apollo/ApolloPortalDB.sql
</code></pre> 
<p>验证ApolloPortalDB</p> 
<p>导入成功后，可以通过执行以下sql语句来验证：</p> 
<pre><code> select `Id`, `Key`, `Value`, `Comment` from `ApolloPortalDB`.`ServerConfig` limit 1;
</code></pre> 
<p>注：ApolloPortalDB只需要在生产环境部署一个即可</p> 
<p>创建ApolloConfigDB，sql脚本下载地址：https://gitee.com/apolloconfig/apollo/blob/1.8.2/scripts/sql/apolloconfigdb.sql</p> 
<p>以MySQL原生客户端为例：</p> 
<pre><code> source apollo/ApolloConfigDB.sql
</code></pre> 
<p>验证ApolloConfigDB</p> 
<p>导入成功后，可以通过执行以下sql语句来验证：</p> 
<pre><code> select `Id`, `Key`, `Value`, `Comment` from `ApolloConfigDB`.`ServerConfig` limit 1;
</code></pre> 
<h5><a id="24_Apollo_233"></a>2.4 启动Apollo</h5> 
<ol><li> <p>确保端口未被占用</p> <p>Apollo默认会启动3个服务，分别使用8070, 8080, 8090端口，请确保这3个端口当前没有被使用</p> </li><li> <p>启动apollo-configservice，在apollo目录下执行如下命令</p> <p>可通过-Dserver.port=8080修改默认端口</p> <pre><code>java -Xms256m -Xmx256m -Dspring.datasource.url="jdbc:mysql://localhost:3306/ApolloConfigDB?characterEncoding=utf8&amp;serverTimezone=UTC" -Dspring.datasource.username=root -Dspring.datasource.password=root -jar apollo-configservice-1.8.2.jar
</code></pre> </li></ol> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ecUZ14r2-1668498215707)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190916185334497.png)]</p> 
<p>启动apollo-adminservice</p> 
<p>可通过-Dserver.port=8090修改默认端口</p> 
<pre><code> java -Xms256m -Xmx256m -Dspring.datasource.url="jdbc:mysql://localhost:3306/ApolloConfigDB?characterEncoding=utf8&amp;serverTimezone=UTC" -Dspring.datasource.username=root -Dspring.datasource.password=root -jar apollo-adminservice-1.8.2.jar
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-nBIXAvvC-1668498215708)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190917100531147.png)]</p> 
<p>启动apollo-portal</p> 
<p>可通过-Dserver.port=8070修改默认端口</p> 
<pre><code>java -Xms256m -Xmx256m -Ddev_meta=http://localhost:8080/ -Dserver.port=8070 -Dspring.datasource.url="jdbc:mysql://localhost:3306/ApolloPortalDB?characterEncoding=utf8&amp;serverTimezone=UTC" -Dspring.datasource.username=root -Dspring.datasource.password=root -jar apollo-portal-1.8.2.jar
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-77ztSo5Z-1668498215709)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190917100803548.png)]</p> 
<p>也可以使用提供的runApollo.bat快速启动三个服务（修改数据库连接地址，数据库以及密码）</p> 
<pre><code class="prism language-tex"> echo
 ​
 set url="localhost:3306"
 set username="root"
 set password="123"
 ​
 start "configService" java -Xms256m -Xmx256m -Dapollo_profile=github -Dspring.datasource.url=jdbc:mysql://%url%/ApolloConfigDB?characterEncoding=utf8 -Dspring.datasource.username=%username% -Dspring.datasource.password=%password% -Dlogging.file=.\logs\apollo-configservice.log -jar .\apollo-configservice-1.3.0.jar
 start "adminService" java -Xms256m -Xmx256m -Dapollo_profile=github -Dspring.datasource.url=jdbc:mysql://%url%/ApolloConfigDB?characterEncoding=utf8 -Dspring.datasource.username=%username% -Dspring.datasource.password=%password% -Dlogging.file=.\logs\apollo-adminservice.log -jar .\apollo-adminservice-1.3.0.jar
 start "ApolloPortal" java -Xms256m -Xmx256m -Dapollo_profile=github,auth -Ddev_meta=http://localhost:8080/ -Dserver.port=8070 -Dspring.datasource.url=jdbc:mysql://%url%/ApolloPortalDB?characterEncoding=utf8 -Dspring.datasource.username=%username% -Dspring.datasource.password=%password% -Dlogging.file=.\logs\apollo-portal.log -jar .\apollo-portal-1.3.0.jar
</code></pre> 
<ol><li>运行runApollo.bat即可启动Apollo</li><li>待启动成功后，访问<a href="http://localhost:8070/" rel="nofollow">管理页面</a> apollo/admin</li></ol> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-6aYhfK0B-1668498215711)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716095006110.png)]</p> 
<h3><a id="5__288"></a>5. 代码实现</h3> 
<h4><a id="1__290"></a>1. 发布配置</h4> 
<p>打开<a href="http://localhost:8070/" rel="nofollow">apollo</a> ：新建项目apollo-quickstart</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-OlZNaSqX-1668498215712)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190919144634885.png)]</p> 
<p>新建配置项sms.enable</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-iCKE0Ej7-1668498215714)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190919144817438.png)]</p> 
<p>确认提交配置项</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Tsya6geU-1668498215715)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716091009049.png)]</p> 
<p>发布配置项</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-I07u38LL-1668498215717)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716091034424.png)]</p> 
<h4><a id="2__308"></a>2. 应用读取配置</h4> 
<h5><a id="1__Maven_310"></a>1. 新建Maven工程</h5> 
<p>打开idea，新建apollo-quickstart项目</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-FNRVqfrM-1668498215718)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190919113331126.png)]</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-hidTikeN-1668498215721)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190919141052497.png)]</p> 
<p>打开pom.xml文件添加apollo依赖，配置JDK为1.8</p> 
<pre><code class="prism language-java"> <span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>project xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span>
          xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
          xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>modelVersion<span class="token punctuation">&gt;</span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>
 ​
     <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>pbteach<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>apollo<span class="token operator">-</span>quickstart<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.0</span><span class="token operator">-</span><span class="token constant">SNAPSHOT</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
 ​
     <span class="token generics"><span class="token punctuation">&lt;</span>properties<span class="token punctuation">&gt;</span></span>
         <span class="token generics"><span class="token punctuation">&lt;</span>java<span class="token punctuation">.</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>java<span class="token punctuation">.</span>version<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>
 ​
     <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
         <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
             <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>ctrip<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>apollo<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
             <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>apollo<span class="token operator">-</span>client<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
             <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.1</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
 ​
         <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
             <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>slf4j<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
             <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>slf4j<span class="token operator">-</span>simple<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
             <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.7</span><span class="token number">.28</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>build<span class="token punctuation">&gt;</span></span>
         <span class="token generics"><span class="token punctuation">&lt;</span>plugins<span class="token punctuation">&gt;</span></span>
             <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
                 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>maven<span class="token punctuation">.</span>plugins<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
                 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
                 <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
                     <span class="token generics"><span class="token punctuation">&lt;</span>source<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>source<span class="token operator">&gt;</span>
                     <span class="token generics"><span class="token punctuation">&lt;</span>target<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>target<span class="token operator">&gt;</span>
                 <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>plugins<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>build<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre> 
<h5><a id="2__GetConfigTest_363"></a>2. 编写测试类GetConfigTest</h5> 
<p>新建com.pbteach.apollo.quickstart包，添加测试类GetConfigTest</p> 
<p>添加如下代码读取sms.enable的值</p> 
<pre><code class="prism language-java"> <span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>pbteach<span class="token punctuation">.</span>apollo<span class="token punctuation">.</span>quickstart</span><span class="token punctuation">;</span>
 ​
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetConfigTest</span> <span class="token punctuation">{<!-- --></span>
 ​
 <span class="token comment">// VM options:</span>
 <span class="token comment">// -Dapp.id=apollo-quickstart -Denv=DEV -Ddev_meta=http://localhost:8080</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token class-name">ConfigService</span><span class="token punctuation">.</span><span class="token function">getAppConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">String</span> someKey <span class="token operator">=</span> <span class="token string">"sms.enable"</span><span class="token punctuation">;</span>
 <span class="token class-name">String</span> value <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>someKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sms.enable: "</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> 
<h5><a id="3___385"></a>3. 测试</h5> 
<p>配置VM options，设置系统属性：</p> 
<pre><code> -Dapp.id=apollo-quickstart -Denv=DEV -Ddev_meta=http://localhost:8080
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-8BqCC9uV-1668498215723)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190919145322810.png)]</p> 
<p>运行GetConfigTest，打开控制台，观察输出结果 [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-U1QXBNfl-1668498215725)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190916171554598.png)]</p> 
<h5><a id="4__397"></a>4. 修改配置</h5> 
<p>修改sms.enable的值为false</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-9p03kZi3-1668498215727)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190919145948976.png)]</p> 
<p>再次运行GetConfigTest，可以看到输出结果已为false</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-XBk7JoUa-1668498215729)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190919150422055.png)]</p> 
<h5><a id="5__407"></a>5. 热发布</h5> 
<p>修改代码为每3秒获取一次</p> 
<pre><code class="prism language-java"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetConfigTest</span> <span class="token punctuation">{<!-- --></span>
 ​
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{<!-- --></span>
 <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token class-name">ConfigService</span><span class="token punctuation">.</span><span class="token function">getAppConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">String</span> someKey <span class="token operator">=</span> <span class="token string">"sms.enable"</span><span class="token punctuation">;</span>
 ​
 <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 <span class="token class-name">String</span> value <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>someKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"now: %s, sms.enable: %s%n"</span><span class="token punctuation">,</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>运行GetConfigTest观察输出结果</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-tghcMIZD-1668498215731)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190919150514947.png)]</p> 
<p>在Apollo管理界面修改配置项</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-dtdfXptq-1668498215732)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716091957990.png)]</p> 
<p>发布配置</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-2f1ccKoa-1668498215734)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716092045381.png)]</p> 
<p>在控制台查看详细情况：可以看到程序获取的sms.enable的值已由false变成了修改后的true</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-3rUTDUDI-1668498215736)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190919150725071.png)]</p> 
<h3><a id="6_Apollo_443"></a>6. Apollo应用</h3> 
<h4><a id="1__Apollo_445"></a>1. Apollo工作原理</h4> 
<p>下图是Apollo架构模块的概览</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-OnU0Q1hn-1668498215736)(http://img.pbteach.com/pbresource/image/course/apollo/overall-architecture.png)]</p> 
<h5><a id="1__451"></a>1. 各模块职责</h5> 
<p>上图简要描述了Apollo的总体设计，我们可以从下往上看：</p> 
<ul><li>Config Service提供配置的读取、推送等功能，服务对象是Apollo客户端</li><li>Admin Service提供配置的修改、发布等功能，服务对象是Apollo Portal（管理界面）</li><li>Eureka提供服务注册和发现，为了简单起见，目前Eureka在部署时和Config Service是在一个JVM进程中的</li><li>Config Service和Admin Service都是多实例、无状态部署，所以需要将自己注册到Eureka中并保持心跳</li><li>在Eureka之上架了一层Meta Server用于封装Eureka的服务发现接口</li><li>Client通过域名访问Meta Server获取Config Service服务列表（IP+Port），而后直接通过IP+Port访问服务，同时在Client侧会做load balance、错误重试</li><li>Portal通过域名访问Meta Server获取Admin Service服务列表（IP+Port），而后直接通过IP+Port访问服务，同时在Portal侧会做load balance、错误重试</li><li>为了简化部署，我们实际上会把Config Service、Eureka和Meta Server三个逻辑角色部署在同一个JVM进程中</li></ul> 
<h5><a id="2__464"></a>2. 分步执行流程</h5> 
<ol><li>Apollo启动后，Config/Admin Service会自动注册到Eureka服务注册中心，并定期发送保活心跳。</li><li>Apollo Client和Portal管理端通过配置的Meta Server的域名地址经由Software Load Balancer(软件负载均衡器)进行负载均衡后分配到某一个Meta Server</li><li>Meta Server从Eureka获取Config Service和Admin Service的服务信息，相当于是一个Eureka Client</li><li>Meta Server获取Config Service和Admin Service（IP+Port）失败后会进行重试</li><li>获取到正确的Config Service和Admin Service的服务信息后，Apollo Client通过Config Service为应用提供配置获取、实时更新等功能；Apollo Portal管理端通过Admin Service提供配置新增、修改、发布等功能</li></ol> 
<h4><a id="2__472"></a>2. 核心概念</h4> 
<ol><li> <p>application (应用)</p> <p>这个很好理解，就是实际使用配置的应用，Apollo客户端在运行时需要知道当前应用是谁，从而可以去获取对应的配置</p> <p>关键字：appId</p> </li><li> <p>environment (环境)</p> <p>配置对应的环境，Apollo客户端在运行时需要知道当前应用处于哪个环境，从而可以去获取应用的配置</p> <p>关键字：env</p> </li><li> <p>cluster (集群)</p> <p>一个应用下不同实例的分组，比如典型的可以按照数据中心分，把上海机房的应用实例分为一个集群，把北京机房的应用实例分为另一个集群。</p> <p>关键字：cluster</p> </li><li> <p>namespace (命名空间)</p> <p>一个应用下不同配置的分组，可以简单地把namespace类比为文件，不同类型的配置存放在不同的文件中，如数据库配置文件，RPC配置文件，应用自身的配置文件等</p> <p>关键字：namespaces</p> </li></ol> 
<p>它们的关系如下图所示：</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-nRT2fiPp-1668498215738)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190919170234623.png)]</p> 
<h4><a id="3__502"></a>3. 项目管理</h4> 
<h5><a id="1__504"></a>1. 基础设置</h5> 
<p>部门管理</p> 
<p>apollo 默认部门有两个。要增加自己的部门，可在系统参数中修改：</p> 
<ul><li>进入系统参数设置</li></ul> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-DdAqunfQ-1668498215741)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716115120642.png)]</p> 
<p>输入key查询已存在的部门设置：organizations</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-EwBYBE1K-1668498215742)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716115230543.png)]</p> 
<p>修改value值来添加新部门，下面添加一个微服务部门：</p> 
<pre><code> [{"orgId":"TEST1","orgName":"样例部门1"},{"orgId":"TEST2","orgName":"样例部门2"},{"orgId":"micro_service","orgName":"微服务部门"}]
</code></pre> 
<p>添加用户</p> 
<p>apollo默认提供一个超级管理员: apollo，可以自行添加用户</p> 
<ul><li>新建用户张三</li></ul> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-turzl98A-1668498215743)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190720181559923.png)]</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-PQ8Y2BnE-1668498215744)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190720181647695.png)]</p> 
<h5><a id="2__534"></a>2. 创建项目</h5> 
<ol><li>打开apollo-portal主页：http://localhost:8070/</li><li>点击“创建项目”：account-service</li></ol> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-D8v5PJpD-1668498215746)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716101236392.png)]</p> 
<p>输入项目信息</p> 
<ul><li> <p>部门：选择应用所在的部门</p> </li><li> <p>应用AppId：用来标识应用身份的唯一id，格式为string，需要和项目配置文件applications.properties中配置的app.id对应</p> </li><li> <p>应用名称：应用名，仅用于界面展示</p> </li><li> <p>应用负责人：选择的人默认会成为该项目的管理员，具备项目权限管理、集群创建、Namespace创建等权限</p> <p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-dbIRHanD-1668498215747)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716101502009.png)]</p> </li></ul> 
<p>创建成功后，会自动跳转到项目首页</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-wJevSgsx-1668498215748)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190720182520071.png)]</p> 
<p>将修改和发布权限都授权给张三</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Ipefyf5W-1668498215750)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190720182858984.png)]</p> 
<p>使用zhangsan登录，查看项目配置</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-PfEpn8tc-1668498215752)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190720183023342.png)]</p> 
<ul><li>点击account-service即可管理配置</li></ul> 
<h5><a id="3__566"></a>3. 删除项目</h5> 
<p>如果要删除整个项目，点击右上角的“管理员工具–》删除应用、集群…”</p> 
<p>首先查询出要删除的项目，点击“删除应用”</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-0hmmQsct-1668498215753)(http://img.pbteach.com/pbresource/image/course/apollo/1570248995936.png)]</p> 
<h4><a id="4__574"></a>4. 配置管理</h4> 
<p>下边在account-service项目中进行配置。</p> 
<h5><a id="1___578"></a>1. 添加发布配置项</h5> 
<p>通过表格模式添加配置</p> 
<ul><li>点击新增配置</li></ul> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-iGeQRpWx-1668498215754)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190917113735222.png)]</p> 
<p>输入配置项：sms.enable，点击提交</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-HZL5quti-1668498215756)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190917113829772.png)]</p> 
<p>通过文本模式编辑</p> 
<p>Apollo除了支持表格模式，逐个添加、修改配置外，还提供文本模式批量添加、修改。 这个对于从已有的properties文件迁移尤其有用</p> 
<ul><li>切换到文本编辑模式</li></ul> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-j5wnRO8l-1668498215758)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190917113953166.png)]</p> 
<p>输入配置项，并点击提交修改</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-SAD6UWSC-1668498215759)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190917114051248.png)]</p> 
<p>发布配置</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Scc5m4a2-1668498215760)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190917114118871.png)]</p> 
<h5><a id="2__606"></a>2. 修改配置</h5> 
<p>找到对应的配置项，点击修改</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-XlCoHLEC-1668498215761)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190917114952136.png)]</p> 
<ol><li>修改为需要的值，点击提交</li><li>发布配置</li></ol> 
<h5><a id="3__615"></a>3. 删除配置</h5> 
<p>找到需要删除的配置项，点击删除</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-qYTT9cJh-1668498215763)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190917140811049.png)]</p> 
<p>确认删除后，点击发布</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-8GLDbs3p-1668498215765)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190917140920348.png)]</p> 
<h5><a id="4_Namespace_625"></a>4. 添加Namespace</h5> 
<p>Namespace作为配置的分类，可当成一个配置文件。</p> 
<p>以添加rocketmq配置为例，添加“spring-rocketmq” Namespace配置rocketmq相关信息。</p> 
<ol><li> <p>添加项目私有Namespace：spring-rocketmq</p> <p>进入项目首页，点击左下脚的“添加Namespace”，共包括两项：关联公共Namespace和创建Namespace，这里选择“创建Namespace”</p> <p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-MPG3BwHD-1668498215766)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716135746538.png)]</p> </li></ol> 
<p>添加配置项</p> 
<pre><code> rocketmq.name-server = 127.0.0.1:9876 
 rocketmq.producer.group = PID_ACCOUNT
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-gFhfptZ6-1668498215768)(http://img.pbteach.com/pbresource/image/course/apollo/image-20190716141257636.png)]</p> 
<p>发布配置</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-8vv4hE2p-1668498215769)(E:\md\image\apollo\image-20190716141330583.png)]</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/68d38ba81577d1589d1820949cbac301/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux之查看进程ps -ef、进程的前后台切换fg、挂起后的激活bg、标准输入/输出/错误三者的重定向、管道</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/66200a3d0317105ee65c0caf8baf754e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">枚举与联合体</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>