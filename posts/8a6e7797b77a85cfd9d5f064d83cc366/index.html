<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在线程中弹出自定义对话框 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/8a6e7797b77a85cfd9d5f064d83cc366/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="在线程中弹出自定义对话框">
  <meta property="og:description" content="在线程中弹出自定义对话框 | 火苗999℃的博客
弹出对话框的代码 ：
主要是弹出对话框的时候可以在后台做某些动作：
与直接弹出对话框前开启线程，在线程中做某些动作效果相同。
MsgBoxThread mbt; mbt.MesgBoxPopup(10, &#34;请按手指！&#34;); // do something // do something mbt.WaitFor(); // 等待线程退出 使用到的MsgThread和对话框类
#include &#34;StdAfx.h&#34; #include &#34;MsgBoxThread.h&#34; #include &#34;YF_GCM.h&#34; #include &#34;DlgMesgBox.h&#34; unsigned int __stdcall ThreadBox(LPVOID); MsgBoxThread::MsgBoxThread(void) { } MsgBoxThread::~MsgBoxThread(void) { } int MsgBoxThread::MesgBoxPopup(int time, const CString&amp;amp; szText) { m_Mesg.text = szText; m_Mesg.time = time; m_handle[0] = (HANDLE)_beginthreadex(NULL, 0, ThreadBox, (LPVOID)&amp;amp;m_Mesg, 0, NULL); return 0; } unsigned int __stdcall ThreadBox(LPVOID lp) { _mesg *pTmpMesg = (_mesg *)lp; CDlgMesgBox box; box.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-10-18T14:32:38+08:00">
    <meta property="article:modified_time" content="2022-10-18T14:32:38+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在线程中弹出自定义对话框</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><a href="http://www.alom.com.cn/20131014/deploy/2013-10-14-%E5%9C%A8%E7%BA%BF%E7%A8%8B%E4%B8%AD%E5%BC%B9%E5%87%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%AF%9D%E6%A1%86/" rel="nofollow" title="在线程中弹出自定义对话框 | 火苗999℃的博客">在线程中弹出自定义对话框 | 火苗999℃的博客</a></p> 
<p>弹出对话框的代码 ：</p> 
<p>主要是弹出对话框的时候可以在后台做某些动作：</p> 
<p>与直接弹出对话框前开启线程，在线程中做某些动作效果相同。</p> 
<p></p> 
<pre class="has"><code class="language-cpp">    MsgBoxThread mbt;
    mbt.MesgBoxPopup(10, "请按手指！");
    // do something 
    // do something
    mbt.WaitFor(); // 等待线程退出</code></pre> 
<p></p> 
<p></p> 
<p>使用到的MsgThread和对话框类</p> 
<p></p> 
<div> 
 <pre class="has"><code class="language-cpp">#include "StdAfx.h"
#include "MsgBoxThread.h"

#include "YF_GCM.h"
#include "DlgMesgBox.h"

unsigned int __stdcall ThreadBox(LPVOID);  

MsgBoxThread::MsgBoxThread(void)
{
}

MsgBoxThread::~MsgBoxThread(void)
{
}

int MsgBoxThread::MesgBoxPopup(int time, const CString&amp; szText)
{
    m_Mesg.text = szText;
    m_Mesg.time = time;

    m_handle[0] = (HANDLE)_beginthreadex(NULL, 0, ThreadBox, (LPVOID)&amp;m_Mesg, 0, NULL); 
    return 0;
}

unsigned int __stdcall ThreadBox(LPVOID lp)
{
    _mesg *pTmpMesg = (_mesg *)lp;
    CDlgMesgBox box;
    box.SetDlgLifetime(pTmpMesg-&gt;time);
    box.SetBoxText(pTmpMesg-&gt;text);
    box.DoModal();
//     
    return 0;
}
int MsgBoxThread::WaitFor(void)
{
    WaitForMultipleObjects(1, m_handle, TRUE, INFINITE);  
    return 0;
}
#pragma once
struct _mesg{
    CString text;
    int time;
};
class MsgBoxThread
{
public:
    MsgBoxThread(void);
    virtual ~MsgBoxThread(void);
    int MesgBoxPopup(int time, const CString&amp; szText);
private:
    _mesg m_Mesg;
    HANDLE m_handle[1];
public:
    int WaitFor(void);
};
#pragma once


// CDlgMesgBox 对话框

class CDlgMesgBox : public CDialog
{
	DECLARE_DYNAMIC(CDlgMesgBox)

public:
	CDlgMesgBox(CWnd* pParent = NULL);   // 标准构造函数
	virtual ~CDlgMesgBox();

// 对话框数据
	enum { IDD = IDD_DIALOG_MESGBOX };

protected:
	virtual void DoDataExchange(CDataExchange* pDX);    // DDX/DDV 支持

	DECLARE_MESSAGE_MAP()
public:
    int SetDlgLifetime(int secTime);
private:
    enum{BoxLifetime = 1, BoxUpdate = 2};
    int m_Lifetime;
public:
    virtual BOOL OnInitDialog();
    afx_msg void OnTimer(UINT_PTR nIDEvent);
    void UpdateBox(void);
    void SetBoxText(const CString&amp; szText);
private:
    CString m_szMsgText;
public:
    afx_msg void OnBnClickedBoxButtonExit();
};
// DlgMesgBox.cpp : 实现文件
//

#include "stdafx.h"
#include "YF_GCM.h"
#include "DlgMesgBox.h"


// CDlgMesgBox 对话框

IMPLEMENT_DYNAMIC(CDlgMesgBox, CDialog)

CDlgMesgBox::CDlgMesgBox(CWnd* pParent /*=NULL*/)
	: CDialog(CDlgMesgBox::IDD, pParent)
    , m_Lifetime(10000)
    , m_szMsgText(_T(""))
{

}

CDlgMesgBox::~CDlgMesgBox()
{
}

void CDlgMesgBox::DoDataExchange(CDataExchange* pDX)
{
	CDialog::DoDataExchange(pDX);
}


BEGIN_MESSAGE_MAP(CDlgMesgBox, CDialog)
    ON_WM_TIMER()
    ON_BN_CLICKED(IDC_BOX_BUTTON_EXIT, &amp;CDlgMesgBox::OnBnClickedBoxButtonExit)
END_MESSAGE_MAP()


// CDlgMesgBox 消息处理程序

int CDlgMesgBox::SetDlgLifetime(int secTime)
{
    m_Lifetime = secTime;
    return 0;
}

BOOL CDlgMesgBox::OnInitDialog()
{
    CDialog::OnInitDialog();

    // TODO:  在此添加额外的初始化

    SetTimer(BoxUpdate, 1000, NULL);
    SetDlgItemText(IDC_BOX_STATIC_MSG, m_szMsgText);

    return TRUE;  // return TRUE unless you set the focus to a control
    // 异常: OCX 属性页应返回 FALSE
}

void CDlgMesgBox::OnTimer(UINT_PTR nIDEvent)
{
    // TODO: 在此添加消息处理程序代码和/或调用默认值
    switch (nIDEvent)
    {
    case BoxUpdate: 
        UpdateBox();
        if (0 == m_Lifetime)
        {
            SendMessage(WM_CLOSE);
        }
        else
        {
            --m_Lifetime;
        }
        break;
    default:break;
    }
    CDialog::OnTimer(nIDEvent);
}

void CDlgMesgBox::UpdateBox(void)
{
    CString szText;
    szText.Format(_T("关闭(%d)"), m_Lifetime);
    SetDlgItemText(IDC_BOX_BUTTON_EXIT, szText); // 在按钮上显示关闭倒计时
}

void CDlgMesgBox::SetBoxText(const CString&amp; szText)
{
    m_szMsgText = szText;
}

void CDlgMesgBox::OnBnClickedBoxButtonExit()
{
    // TODO: 在此添加控件通知处理程序代码
    SendMessage(WM_CLOSE);
}
</code></pre> 
</div> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/46482eccfc6a17eb54f5bd1ad07ee9a2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LVS&#43;Keepalived负载均衡高可用群集</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ccb96fbf27d0becf09bd19a61e079a66/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">无法重命名，文件不可信，后台被自动关闭，“Notebook Untitled.ipynb is not trusted jupyter”</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>