<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python 利用pandas和mysql-connector获取Excel数据写入到MySQL数据库 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/c542afa7d1f823995505440317b0bc71/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Python 利用pandas和mysql-connector获取Excel数据写入到MySQL数据库">
  <meta property="og:description" content="如何将Excel数据插入到MySQL数据库中 在实际应用中，我们可能需要将Excel表格中的数据导入到MySQL数据库中，以便于进行进一步的数据分析和处理。本文将介绍如何使用Python将Excel表格中的数据插入到MySQL数据库中。 导入必要的库 首先，我们需要导入pandas库和MySQL Connector/Python库，以便于读取Excel文件和连接MySQL数据库。
import pandas as pd # 导入pandas库，用于读取Excel文件和处理数据 import mysql.connector # 导入MySQL Connector/Python库，用于连接MySQL数据库 连接数据库 接下来，我们需要连接MySQL数据库。可以通过MySQL Connector/Python库提供的connect()方法来连接数据库。
# 连接数据库 mydb = mysql.connector.connect( host=host, # 数据库主机地址 user=user, # 数据库用户名 password=password, # 数据库密码 database=database # 数据库名称 ) 其中，host、user、password和database分别是数据库主机地址、数据库用户名、数据库密码和数据库名称，需要根据实际情况进行修改。
创建游标对象 连接成功后，我们需要创建游标对象。可以通过MySQL Connector/Python库提供的cursor()方法来创建游标对象。
# 创建游标对象 mycursor = mydb.cursor() 读取Excel文件 接下来，我们需要读取Excel文件中的数据。可以使用pandas库提供的read_excel()方法来读取Excel文件。
# 读取Excel文件 df = pd.read_excel(filename) 其中，filename是Excel文件的路径，需要根据实际情况进行修改。
将日期时间类型的列转换为字符串类型 在将数据插入到MySQL数据库中之前，我们需要将日期时间类型的列转换为字符串类型。可以通过遍历DataFrame中的每一列，并判断该列的数据类型是否为日期时间类型，然后将该列的数据类型转换为字符串类型。
# 将日期时间类型的列转换为字符串类型 for col in df.columns: # 遍历DataFrame中的每一列 if df[col].dtype == &#39;datetime64[ns]&#39;: # 如果该列的数据类型是日期时间类型 df[col] = df[col].">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-20T11:16:24+08:00">
    <meta property="article:modified_time" content="2024-03-20T11:16:24+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python 利用pandas和mysql-connector获取Excel数据写入到MySQL数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>如何将Excel数据插入到MySQL数据库中</h4> 
<h4>在实际应用中，我们可能需要将Excel表格中的数据导入到MySQL数据库中，以便于进行进一步的数据分析和处理。本文将介绍如何使用Python将Excel表格中的数据插入到MySQL数据库中。</h4> 
<h3>导入必要的库</h3> 
<p>首先，我们需要导入pandas库和MySQL Connector/Python库，以便于读取Excel文件和连接MySQL数据库。</p> 
<pre>import pandas as pd  # 导入pandas库，用于读取Excel文件和处理数据
import mysql.connector  # 导入MySQL Connector/Python库，用于连接MySQL数据库</pre> 
<h3>连接数据库</h3> 
<p>接下来，我们需要连接MySQL数据库。可以通过MySQL Connector/Python库提供的connect()方法来连接数据库。</p> 
<p></p> 
<pre># 连接数据库
mydb = mysql.connector.connect(
    host=host,  # 数据库主机地址
    user=user,  # 数据库用户名
    password=password,  # 数据库密码
    database=database  # 数据库名称
)</pre> 
<p></p> 
<p>其中，host、user、password和database分别是数据库主机地址、数据库用户名、数据库密码和数据库名称，需要根据实际情况进行修改。</p> 
<h3>创建游标对象</h3> 
<p>连接成功后，我们需要创建游标对象。可以通过MySQL Connector/Python库提供的cursor()方法来创建游标对象。</p> 
<pre># 创建游标对象
mycursor = mydb.cursor()</pre> 
<h3>读取Excel文件</h3> 
<p>接下来，我们需要读取Excel文件中的数据。可以使用pandas库提供的read_excel()方法来读取Excel文件。</p> 
<pre># 读取Excel文件
df = pd.read_excel(filename)</pre> 
<p>其中，filename是Excel文件的路径，需要根据实际情况进行修改。</p> 
<h3>将日期时间类型的列转换为字符串类型</h3> 
<p>在将数据插入到MySQL数据库中之前，我们需要将日期时间类型的列转换为字符串类型。可以通过遍历DataFrame中的每一列，并判断该列的数据类型是否为日期时间类型，然后将该列的数据类型转换为字符串类型。</p> 
<pre># 将日期时间类型的列转换为字符串类型
for col in df.columns:  # 遍历DataFrame中的每一列
    if df[col].dtype == 'datetime64[ns]':  # 如果该列的数据类型是日期时间类型
        df[col] = df[col].astype(str)  # 将该列的数据类型转换为字符串类型</pre> 
<h3>遍历Excel表格中的每一行，并将每一行插入到数据库中</h3> 
<p>接下来，我们需要遍历Excel表格中的每一行，并将每一行插入到数据库中。可以使用pandas库提供的itertuples()方法来遍历DataFrame中的每一行，并使用MySQL Connector/Python库提供的execute()方法来执行SQL插入语句。</p> 
<pre># 遍历Excel表格中的每一行，并将每一行插入到数据库中
for row in df.itertuples(index=False):  # 遍历DataFrame中的每一行
    sql = f"INSERT INTO {table} (id, 姓名, 国家, 出生日期) VALUES (%s, %s, %s, %s)"  # SQL插入语句
    val = row  # 插入的数据
    mycursor.execute(sql, val)  # 执行SQL插入语句
    print("正在插入数据:", val)  # 输出正在插入的数据</pre> 
<p>其中，table是数据库表名，需要根据实际情况进行修改。</p> 
<h3>提交更改并关闭数据库连接</h3> 
<p>最后，我们需要提交更改并关闭数据库连接。可以使用MySQL Connector/Python库提供的commit()方法来提交更改，并使用close()方法来关闭游标对象和数据库连接。</p> 
<pre># 提交更改并关闭数据库连接
mydb.commit()  # 提交更改
mycursor.close()  # 关闭游标对象
mydb.close()  # 关闭数据库连接</pre> 
<h3>完整代码如下：</h3> 
<p></p> 
<pre>import pandas as pd  # 导入pandas库，用于读取Excel文件和处理数据
import mysql.connector  # 导入MySQL Connector/Python库，用于连接MySQL数据库

def insert_excel_data_to_mysql(filename, host, user, password, database, table):
    # 连接数据库
    mydb = mysql.connector.connect(
        host=host,  # 数据库主机地址
        user=user,  # 数据库用户名
        password=password,  # 数据库密码
        database=database  # 数据库名称
    )

    # 创建游标对象
    mycursor = mydb.cursor()

    # 读取Excel文件
    df = pd.read_excel(filename)

    # 将日期时间类型的列转换为字符串类型
    for col in df.columns:  # 遍历DataFrame中的每一列
        if df[col].dtype == 'datetime64[ns]':  # 如果该列的数据类型是日期时间类型
            df[col] = df[col].astype(str)  # 将该列的数据类型转换为字符串类型

    # 遍历Excel表格中的每一行，并将每一行插入到数据库中
    for row in df.itertuples(index=False):  # 遍历DataFrame中的每一行
        sql = f"INSERT INTO {table} (id, 姓名, 国家, 出生日期) VALUES (%s, %s, %s, %s)"  # SQL插入语句
        val = row  # 插入的数据
        mycursor.execute(sql, val)  # 执行SQL插入语句
        print("正在插入数据:", val)  # 输出正在插入的数据

    # 提交更改并关闭数据库连接
    mydb.commit()  # 提交更改
    mycursor.close()  # 关闭游标对象
    mydb.close()  # 关闭数据库连接

# 使用示例
filename = r'C:\\Users\\Admin\\Desktop\\重新开始\\Python操作MySQL数据库\\sheet1.xlsx'  # Excel文件路径
host = "localhost"  # 数据库主机地址
user = "root"  # 数据库用户名
password = "123456"  # 数据库密码
database = "caiwu"  # 数据库名称
table = "yonghu"  # 数据库表名

insert_excel_data_to_mysql(filename, host, user, password, database, table)  # 调用函数，将Excel数据插入到MySQL数据库中</pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd356f0239ccb6933c33b26edac75a0c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【什么是Internet？网络边缘，网络核心，分组交换 vs 电路交换，接入网络和物理媒体】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f2d0c2d43d2843a7474841725e85d799/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">HTML是什么，它在前端开发中扮演什么角色？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>