<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Pyhton实例，抓取百度词条关于Python的内容（二） - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/7a4b3d49f330be0938a700e7d8b508a5/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Pyhton实例，抓取百度词条关于Python的内容（二）">
  <meta property="og:description" content="直接上代码 1.UrlManager 管理器
# coding:utf8 class UrlManager(object): #初始化，待爬取URL和已爬取URL def __init__(self): self.new_urls = set() self.old_urls = set() #添加新URL进管理器 def add_new_url(self, url): if url is None: return if url not in self.new_urls and url not in self.old_urls: self.new_urls.add(url) #批量添加URLS def add_new_urls(self, urls): if urls is None or len(urls) == 0: return for url in urls: self.add_new_url(url) def has_new_url(self): return len(self.new_urls) != 0 #pop方法可以把其中的一个URL给弹出，并且移除 def get_new_url(self): new_url = self.new_urls.pop() self.old_urls.add(new_url) return new_url 2.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2017-01-07T15:20:57+08:00">
    <meta property="article:modified_time" content="2017-01-07T15:20:57+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Pyhton实例，抓取百度词条关于Python的内容（二）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>直接上代码 <br> 1.UrlManager 管理器</p> 
<pre class="prettyprint"><code class=" hljs python"><span class="hljs-comment"># coding:utf8</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UrlManager</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-comment">#初始化，待爬取URL和已爬取URL</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.new_urls = set()
        self.old_urls = set()
    <span class="hljs-comment">#添加新URL进管理器</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_new_url</span><span class="hljs-params">(self, url)</span>:</span>
        <span class="hljs-keyword">if</span> url <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
            <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">if</span> url <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.new_urls <span class="hljs-keyword">and</span> url <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.old_urls:
            self.new_urls.add(url)
    <span class="hljs-comment">#批量添加URLS</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_new_urls</span><span class="hljs-params">(self, urls)</span>:</span>
        <span class="hljs-keyword">if</span> urls <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span> <span class="hljs-keyword">or</span> len(urls) == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls:
            self.add_new_url(url)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_new_url</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> len(self.new_urls) != <span class="hljs-number">0</span>
    <span class="hljs-comment">#pop方法可以把其中的一个URL给弹出，并且移除</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_new_url</span><span class="hljs-params">(self)</span>:</span>
        new_url = self.new_urls.pop()
        self.old_urls.add(new_url)
        <span class="hljs-keyword">return</span> new_url</code></pre> 
<p>2.Urldoawnloader 下载器</p> 
<pre class="prettyprint"><code class=" hljs python"><span class="hljs-comment"># coding:utf8</span>
<span class="hljs-keyword">import</span> urllib2


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HtmlDownloader</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">download</span><span class="hljs-params">(self, url)</span>:</span>
        <span class="hljs-keyword">if</span> url <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">None</span>

        response = urllib2.urlopen(url)

        <span class="hljs-keyword">if</span> response.getcode() !=<span class="hljs-number">200</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">None</span>

        <span class="hljs-keyword">return</span> response.read()
</code></pre> 
<p>3.Parser 解析器</p> 
<pre class="prettyprint"><code class=" hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span>
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> urlparse

<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HtmlParser</span><span class="hljs-params">(object)</span>:</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span><span class="hljs-params">(self, page_url, html_cont)</span>:</span>
        <span class="hljs-keyword">if</span> page_url <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span> <span class="hljs-keyword">or</span> html_cont <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
            <span class="hljs-keyword">return</span>

        soup = BeautifulSoup(html_cont,<span class="hljs-string">'html.parser'</span>,from_encoding=<span class="hljs-string">'utf-8'</span>)
        new_urls = self._get_new_urls(page_url,soup)
        new_data = self._get_new_data(page_url,soup)
        <span class="hljs-keyword">return</span> new_urls,new_data

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get_new_urls</span><span class="hljs-params">(self, page_url, soup)</span>:</span>
        new_urls = set()
        <span class="hljs-comment"># /view/123.htm</span>
        links = soup.find_all(<span class="hljs-string">'a'</span>, href=re.compile(<span class="hljs-string">r"/view/\d+\.htm"</span>))
        <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> links:
            new_url = link[<span class="hljs-string">'href'</span>]
            <span class="hljs-comment">#urljoin 函数可以将new_url 按page_url 的格式拼接成一个全新的url</span>
            new_full_url = urlparse.urljoin(page_url,new_url)
            new_urls.add(new_full_url)
        <span class="hljs-keyword">return</span> new_urls
    <span class="hljs-comment">#获取的数据为 title and summary</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get_new_data</span><span class="hljs-params">(self, page_url, soup)</span>:</span>
        res_data = {}

        <span class="hljs-comment">#url</span>
        res_data[<span class="hljs-string">'url'</span>] = page_url

        <span class="hljs-comment">#获取 title</span>
        <span class="hljs-comment">#&lt;dd class="lemmaWgt-lemmaTitle-title"&gt; &lt;h1&gt;Python&lt;/h1&gt;</span>
        title_node = soup.find(<span class="hljs-string">'dd'</span>,class_=<span class="hljs-string">"lemmaWgt-lemmaTitle-title"</span>).find(<span class="hljs-string">'h1'</span>)
        res_data[<span class="hljs-string">'title'</span>] = title_node.get_text()

        <span class="hljs-comment">#获取 summary</span>
        <span class="hljs-comment">#&lt;div class="lemma-summary" label-module="lemmaSummary"&gt;</span>
        summary_node = soup.find(<span class="hljs-string">'div'</span>,class_=<span class="hljs-string">"lemma-summary"</span>)
        res_data[<span class="hljs-string">'summary'</span>] = summary_node.get_text()

        <span class="hljs-keyword">return</span> res_data

</code></pre> 
<p>4.Outputer 输出器</p> 
<pre class="prettyprint"><code class=" hljs python"><span class="hljs-comment"># coding:utf8</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HtmlOutputer</span><span class="hljs-params">(object)</span>:</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.datas = []

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">collect_data</span><span class="hljs-params">(self,data)</span>:</span>
        <span class="hljs-keyword">if</span> data <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
            <span class="hljs-keyword">return</span>
        self.datas.append(data)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">output_html</span><span class="hljs-params">(self)</span>:</span>
        fout = open(<span class="hljs-string">'outputer.html'</span>,<span class="hljs-string">'w'</span>)

        fout.write(<span class="hljs-string">"&lt;html&gt;"</span>)
        fout.write(<span class="hljs-string">'&lt;body&gt;'</span>)
        fout.write(<span class="hljs-string">'&lt;table&gt;'</span>)

        <span class="hljs-comment">#ascii</span>
        <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> self.datas
            fout.write(<span class="hljs-string">"&lt;tr&gt;"</span>)
            fout.write(<span class="hljs-string">'&lt;td&gt;%s&lt;/td&gt;'</span> % data[<span class="hljs-string">'url'</span>])
            fout.write(<span class="hljs-string">'&lt;td&gt;%s&lt;/td&gt;'</span> % data[<span class="hljs-string">'title'</span>].encode(<span class="hljs-string">"utf-8"</span>))
            fout.write(<span class="hljs-string">'&lt;td&gt;%s&lt;/td&gt;'</span> % data[<span class="hljs-string">'summary'</span>].encode(<span class="hljs-string">"utf-8"</span>))
            fout.write(<span class="hljs-string">"&lt;/tr&gt;"</span>)

        fout.write(<span class="hljs-string">'&lt;/table&gt;'</span>)
        fout.write(<span class="hljs-string">'&lt;/body&gt;'</span>)
        fout.write(<span class="hljs-string">"&lt;/html&gt;"</span>)

        fout.close()</code></pre> 
<p>总结：BeautifulSoup的使用方法为：创建BeautifulSoup对象-&gt;搜索节点find-all/find-&gt;访问节点（名称，属性，文字）。 <br> 形如;soup = BeautifulSoup(html_cont,’html.parser’,from_encoding=’utf-8’),第一个参数传网页，第二个参数传解析器，第三个参数编码。至此，可以完全爬取百度百科的Python词条。 <br> 不足之处欢迎指正。</p> 
<p>附git链接：<a href="https://github.com/gexrior/PytBaidu.git">https://github.com/gexrior/PytBaidu.git</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/32c54633e2bb91fcc60cec9bf292a282/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JS实现HTML中frameset浏览器全屏和退出全屏</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c715a2a2cb4440149dab467da470c9eb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">debug看源码小技巧：当有多个子类时，调用的是哪个子类的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>