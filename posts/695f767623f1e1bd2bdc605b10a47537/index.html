<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32F0 硬件I2C驱动调试 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/695f767623f1e1bd2bdc605b10a47537/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="STM32F0 硬件I2C驱动调试">
  <meta property="og:description" content="本以为很快能搞定，结果还是花了大半天，大意地把下面两句合并成一句了：
GPIO_PinAFConfig(GPIOB, GPIO_PinSource6, GPIO_AF_1);
GPIO_PinAFConfig(GPIOB, GPIO_PinSource7, GPIO_AF_1);
GPIO_PinAFConfig(GPIOB, GPIO_PinSource6 | GPIOB, GPIO_PinSource7, GPIO_AF_1); //错误写法
下面把代码贴出来，供大家参考，避免浪费时间。
void I2C1_init()
{
I2C_InitTypeDef I2C_InitStructure;
GPIO_InitTypeDef GPIO_InitStructure;
I2C_DeInit(I2C1);
RCC_I2CCLKConfig(RCC_I2C1CLK_SYSCLK);//时钟源设定
RCC_APB1PeriphClockCmd(RCC_APB1Periph_I2C1, ENABLE); //使能I2C1的时钟
RCC_AHBPeriphClockCmd(RCC_AHBPeriph_GPIOB, ENABLE);
GPIO_PinAFConfig(GPIOB, GPIO_PinSource6, GPIO_AF_1); //配置PB6 PB7 成第二功能引脚
GPIO_PinAFConfig(GPIOB, GPIO_PinSource7, GPIO_AF_1);
GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6 | GPIO_Pin_7;
GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
GPIO_InitStructure.GPIO_Speed = GPIO_Speed_2MHz;
GPIO_InitStructure.GPIO_OType = GPIO_OType_OD;
GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;
GPIO_Init(GPIOB, &amp;amp;GPIO_InitStructure);
I2C_InitStructure.I2C_Mode = I2C_Mode_I2C;
I2C_InitStructure.I2C_AcknowledgedAddress = I2C_AcknowledgedAddress_7bit;
I2C_InitStructure.I2C_AnalogFilter = I2C_AnalogFilter_Enable;
I2C_InitStructure.I2C_DigitalFilter = 0x01;">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-07-25T19:19:19+08:00">
    <meta property="article:modified_time" content="2019-07-25T19:19:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32F0 硬件I2C驱动调试</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>本以为很快能搞定，结果还是花了大半天，大意地把下面两句合并成一句了：</p> 
<p>GPIO_PinAFConfig(GPIOB, GPIO_PinSource6, GPIO_AF_1);</p> 
<p>GPIO_PinAFConfig(GPIOB, GPIO_PinSource7, GPIO_AF_1);</p> 
<p><span style="color:#f33b45;">GPIO_PinAFConfig(GPIOB, GPIO_PinSource6 | GPIOB, GPIO_PinSource7, GPIO_AF_1);   //错误写法</span></p> 
<p>下面把代码贴出来，供大家参考，避免浪费时间。</p> 
<p>void I2C1_init()<br> {<!-- --><br>     I2C_InitTypeDef I2C_InitStructure;<br>     GPIO_InitTypeDef GPIO_InitStructure;</p> 
<p>    I2C_DeInit(I2C1);</p> 
<p>    RCC_I2CCLKConfig(RCC_I2C1CLK_SYSCLK);//时钟源设定<br>     RCC_APB1PeriphClockCmd(RCC_APB1Periph_I2C1, ENABLE);   //使能I2C1的时钟<br>     RCC_AHBPeriphClockCmd(RCC_AHBPeriph_GPIOB, ENABLE);</p> 
<p>    GPIO_PinAFConfig(GPIOB, GPIO_PinSource6, GPIO_AF_1);       //配置PB6 PB7 成第二功能引脚<br>     GPIO_PinAFConfig(GPIOB, GPIO_PinSource7, GPIO_AF_1);</p> 
<p>    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6 | GPIO_Pin_7;<br>     GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;<br>     GPIO_InitStructure.GPIO_Speed = GPIO_Speed_2MHz;<br>     GPIO_InitStructure.GPIO_OType = GPIO_OType_OD;<br>     GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;<br>     GPIO_Init(GPIOB, &amp;GPIO_InitStructure);</p> 
<p>    I2C_InitStructure.I2C_Mode = I2C_Mode_I2C;<br>     I2C_InitStructure.I2C_AcknowledgedAddress = I2C_AcknowledgedAddress_7bit;<br>     I2C_InitStructure.I2C_AnalogFilter = I2C_AnalogFilter_Enable;<br>     I2C_InitStructure.I2C_DigitalFilter = 0x01;<br>     I2C_InitStructure.I2C_OwnAddress1 = 0x00;<br>     I2C_InitStructure.I2C_Ack = I2C_Ack_Enable;<br>     I2C_InitStructure.I2C_Timing = 0x40B22536; //100kHz 0x10950C27; //400kHz<br>     I2C_Init(I2C1, &amp;I2C_InitStructure);<br>     I2C_Cmd(I2C1, ENABLE);<br> }</p> 
<p>/*************************************************************<br> * 名    称：I2C_ByteWrite<br> * 功    能：I2C写入单字节<br> * 入口参数：addr 写入数据的地址<br> *           data 写入数据<br> * 出口参数：无<br> * 说    明：<br> **************************************************************/<br> void I2C_ByteWrite(INT8U addr, INT8U data)<br> {<!-- --><br>     while(I2C_GetFlagStatus(I2C1, I2C_FLAG_BUSY) != RESET);<br>     I2C_TransferHandling(I2C1, MPL3115_ADDR, 1, I2C_Reload_Mode, I2C_Generate_Start_Write);<br>     while(I2C_GetFlagStatus(I2C1, I2C_FLAG_TXIS) == RESET);<br>     I2C_SendData(I2C1, addr);<br>     while(I2C_GetFlagStatus(I2C1, I2C_FLAG_TCR) == RESET);<br>     I2C_TransferHandling(I2C1, MPL3115_ADDR, 1, I2C_AutoEnd_Mode, I2C_No_StartStop);<br>     while(I2C_GetFlagStatus(I2C1, I2C_FLAG_TXIS) == RESET);<br>     I2C_SendData(I2C1, data);<br>     while(I2C_GetFlagStatus(I2C1, I2C_FLAG_STOPF) == RESET);<br> }</p> 
<p><br> /*************************************************************<br> * 名    称：I2C_ByteRead<br> * 功    能：I2C读取单字节<br> * 入口参数：读取地址<br> * 出口参数：读取的一个字节<br> * 说    明：每个AD字0.305mV<br> **************************************************************/<br> UINT8 I2C_ByteRead(INT8U addr)<br> {<!-- --><br>     UINT8 ret;</p> 
<p>    while(I2C_GetFlagStatus(I2C1, I2C_FLAG_BUSY) != RESET);<br>     I2C_TransferHandling(I2C1, MPL3115_ADDR, 1, I2C_SoftEnd_Mode, I2C_Generate_Start_Write);<br>     while(I2C_GetFlagStatus(I2C1, I2C_FLAG_TXIS) == RESET);<br>     I2C_SendData(I2C1, addr);<br>     while(I2C_GetFlagStatus(I2C1, I2C_FLAG_TC) == RESET);<br>     I2C_TransferHandling(I2C1,MPL3115_ADDR, 1, I2C_AutoEnd_Mode, I2C_Generate_Start_Read);<br>     while(I2C_GetFlagStatus(I2C1, I2C_FLAG_RXNE) == RESET);<br>     ret = I2C_ReceiveData(I2C1);<br>     while(I2C_GetFlagStatus(I2C1, I2C_FLAG_STOPF) == RESET);<br>     return ret;<br> }</p> 
<p>以上实现了读取单个字节，如果需要连续读写多个字节，只须在读写字节部分增加循环读写就可以。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6b730342cd1a3e15f55a7bf50975f542/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">go mod常用命令 以及 常见问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4c29fa1265e15e0a3da8394c29ab0283/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">导入项目：Error:No such property: GradleVersion for class: JetGradlePlugin</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>