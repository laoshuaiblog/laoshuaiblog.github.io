<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何从HDFS导入数据到ClickHouse - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/9dc6de5837c9d81e8e43e1c29743e974/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="如何从HDFS导入数据到ClickHouse">
  <meta property="og:description" content="从ClickHouse 18.16.0版本开始支持从HDFS读文件，在 19.1.6 版本对HDFS访问功能进行了增强，支持读和写，在 19.4 版本以后开始支持Parquet格式。本文介绍了如何从HDFS中读数据到ClickHouse中，测试版本为：19.4
在访问HDFS之前需要定义一个访问HDFS的表，指定表引擎为HDFS。表创建完成后，就可以对这张表进行查询。
目录
一、查询CSV文件
二、查询Parquet文件
三、从HDFS导入数据
四、总结
五、参考资料
一、查询CSV文件 例如，在HDFS上有一个数据文件：books.csv，内容如下：
hadoop fs -cat /user/hive/ck/book_csv/books.csv
0553573403,book,A Game of Thrones,7.99 0553579908,book,A Clash of Kings,7.99 055357342X,book,A Storm of Swords,7.99 0553293354,book,Foundation,7.99 0812521390,book,The Black Company,6.99 0812550706,book,Ender&#39;s Game,6.99 0441385532,book,Jhereg,7.95 0380014300,book,Nine Princes In Amber,6.99 0805080481,book,The Book of Three,5.99 080508049X,book,The Black Cauldron,5.99 在ClickHouse上创建一个访问books.csv文件的表：
CREATE TABLE hdfs_books_csv ( isbn String, cat String, name String, price Float64 ) ENGINE = HDFS(&#39;hdfs://host123:9000/user/hive/ck/book_csv/books.csv&#39;, &#39;CSV&#39;) 查询hdfs_books_csv表：
SELECT * FROM hdfs_books_csv ┌─isbn───────┬─cat──┬─name──────────────────┬─price─┐ │ 0553573403 │ book │ A Game of Thrones │ 7.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-03-15T23:40:12+08:00">
    <meta property="article:modified_time" content="2019-03-15T23:40:12+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何从HDFS导入数据到ClickHouse</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-indent:50px;">从ClickHouse 18.16.0版本开始支持从HDFS读文件，在 19.1.6 版本对HDFS访问功能进行了增强，支持读和写，在 19.4 版本以后开始支持Parquet格式。本文介绍了如何从HDFS中读数据到ClickHouse中，测试版本为：19.4<br> 在访问HDFS之前需要定义一个访问HDFS的表，指定表引擎为HDFS。表创建完成后，就可以对这张表进行查询。</p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E6%9F%A5%E8%AF%A2CSV%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E6%9F%A5%E8%AF%A2CSV%E6%96%87%E4%BB%B6" rel="nofollow">一、查询CSV文件</a></p> 
<p id="%E4%BA%8C%E3%80%81%E6%9F%A5%E8%AF%A2Parquet%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E4%BA%8C%E3%80%81%E6%9F%A5%E8%AF%A2Parquet%E6%96%87%E4%BB%B6" rel="nofollow">二、查询Parquet文件</a></p> 
<p id="%E4%B8%89%E3%80%81%E4%BB%8EHDFS%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE-toc" style="margin-left:80px;"><a href="#%E4%B8%89%E3%80%81%E4%BB%8EHDFS%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE" rel="nofollow">三、从HDFS导入数据</a></p> 
<p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:80px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">四、总结</a></p> 
<p id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-toc" style="margin-left:80px;"><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" rel="nofollow">五、参考资料</a></p> 
<hr id="hr-toc"> 
<h4 id="%E6%9F%A5%E8%AF%A2CSV%E6%96%87%E4%BB%B6">一、查询CSV文件</h4> 
<p>例如，在HDFS上有一个数据文件：books.csv，内容如下：</p> 
<p>hadoop fs -cat /user/hive/ck/book_csv/books.csv</p> 
<pre class="has"><code>0553573403,book,A Game of Thrones,7.99
0553579908,book,A Clash of Kings,7.99
055357342X,book,A Storm of Swords,7.99
0553293354,book,Foundation,7.99
0812521390,book,The Black Company,6.99
0812550706,book,Ender's Game,6.99
0441385532,book,Jhereg,7.95
0380014300,book,Nine Princes In Amber,6.99
0805080481,book,The Book of Three,5.99
080508049X,book,The Black Cauldron,5.99</code></pre> 
<p>在ClickHouse上创建一个访问books.csv文件的表：</p> 
<pre class="has"><code class="language-sql">CREATE TABLE hdfs_books_csv
(
    isbn String,
    cat String,
    name String,
    price Float64
)
ENGINE = HDFS('hdfs://host123:9000/user/hive/ck/book_csv/books.csv', 'CSV')</code></pre> 
<p>查询hdfs_books_csv表：</p> 
<pre class="has"><code class="language-sql">SELECT * FROM hdfs_books_csv</code></pre> 
<pre class="has"><code>┌─isbn───────┬─cat──┬─name──────────────────┬─price─┐
│ 0553573403 │ book │ A Game of Thrones │ 7.99 │
│ 0553579908 │ book │ A Clash of Kings │ 7.99 │
│ 055357342X │ book │ A Storm of Swords │ 7.99 │
│ 0553293354 │ book │ Foundation │ 7.99 │
│ 0812521390 │ book │ The Black Company │ 6.99 │
│ 0812550706 │ book │ Ender's Game │ 6.99 │
│ 0441385532 │ book │ Jhereg │ 7.95 │
│ 0380014300 │ book │ Nine Princes In Amber │ 6.99 │
│ 0805080481 │ book │ The Book of Three │ 5.99 │
│ 080508049X │ book │ The Black Cauldron │ 5.99 │
└────────────┴──────┴───────────────────────┴───────┘</code></pre> 
<p>查询出的数据与books.csv的内容相同。</p> 
<p>当用户执行 SELECT * FROM hdfs_books_csv 语句时，数据流向如下图：</p> 
<p><img alt="在ClickHouse直接查询HDFS的数据" class="has" src="https://images2.imgbox.com/fa/e4/o2OZCHaJ_o.png"></p> 
<p>这种使用场景相当于把HDFS做为ClickHouse的外部存储，当查询数据时，直接访问HDFS的文件，而不需要把HDFS文件导入到ClickHouse再进行查询。由于是从HDFS拉取数据，相对于ClickHouse的本地存储查询，速度较慢。</p> 
<h4 id="%E4%BA%8C%E3%80%81%E6%9F%A5%E8%AF%A2Parquet%E6%96%87%E4%BB%B6">二、查询Parquet文件</h4> 
<p>ClickHouse 19.4 以后开始支持Parquet格式，下面对Parquet格式的HDFS数据文件进行测试，先上传一个Parquet数据文件 books.parquet 到HDFS，文件内容与books.csv相同，在HDFS上的路径如下：<br> /user/hive/ck/book_parquet/books.parquet</p> 
<p>创建一个访问books.parquet文件的表：</p> 
<pre class="has"><code class="language-sql">CREATE TABLE hdfs_books_parquet
(
    isbn String,
    cat String,
    name String,
    price Float64
)
ENGINE = HDFS('hdfs://host123:9000/user/hive/ck/book_parquet/books.parquet', 'Parquet')</code></pre> 
<p>在ClickHouse查询 hdfs_books_parquet 表：</p> 
<pre class="has"><code class="language-sql">SELECT * FROM hdfs_books_parquet</code></pre> 
<p>查询出的数据与books.csv的内容相同。</p> 
<p>以上的操作是从HDFS上直接查询数据，也可以将读取的数据加载到ClickHouse的本地表。</p> 
<h4 id="%E4%B8%89%E3%80%81%E4%BB%8EHDFS%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE">三、从HDFS导入数据</h4> 
<p>在ClickHouse先创建一个目标表，然后执行INSERT...SELECT从HDFS导入数据。</p> 
<pre class="has"><code class="language-sql">--创建目标表
CREATE TABLE books_local
(
    isbn String,
    cat String,
    name String,
    price Float64
)
ENGINE = Log;
--从HDFS导入数据
INSERT INTO books_local SELECT * FROM hdfs_books_parquet;
--查询目标表
SELECT * FROM books_local;</code></pre> 
<p>从HDFS导入数据到ClickHouse，然后查询ClickHouse本地表的数据流向图如下：</p> 
<p><img alt="导入流程" class="has" src="https://images2.imgbox.com/73/13/iIp9BkJJ_o.png"></p> 
<blockquote> 
 <p>ClickHouse支持的文件格式参见：<a href="https://clickhouse.yandex/docs/en/interfaces/formats/" rel="nofollow">https://clickhouse.yandex/docs/en/interfaces/formats/</a></p> 
</blockquote> 
<h4 id="%E6%80%BB%E7%BB%93">四、总结</h4> 
<p>用户通过执行SQL语句，可以在ClickHouse中直接读取HDFS的文件，也可以将读取的数据导入到ClickHouse本地表。ClickHouse提供了对Hadoop生态圈更加友好的访问方式。</p> 
<h4 id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">五、参考资料</h4> 
<p><a href="https://github.com/yandex/ClickHouse/pull/3617/">https://github.com/yandex/ClickHouse/pull/3617/</a></p> 
<p><a href="https://github.com/yandex/ClickHouse/pull/4084/">https://github.com/yandex/ClickHouse/pull/4084/</a></p> 
<p>原创作品，转载请注明出处：https://blog.csdn.net/yangzhaohui168/article/details/88583489</p> 
<p>本文同步发布于 <a href="https://www.toutiao.com/i6667925339810824711/" rel="nofollow">头条号ClickHouse</a></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3c7d5192f4dc106efd93281eadfeaac8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">jquery实现表情图添加与发布功能</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6c10a3c0eeebee23fe88bcc8e06dead6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux系统下安装nginx详细步骤！（亲测）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>