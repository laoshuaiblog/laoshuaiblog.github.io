<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java duplicate key_java.lang.IllegalStateException: Duplicate key 1 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/cf2b3ad80b11dfde7c3709fd1335989a/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="java duplicate key_java.lang.IllegalStateException: Duplicate key 1">
  <meta property="og:description" content="前言
昨天项目报错
java.lang.IllegalStateException: Duplicate key 1
代码如下：
Map userId2BatchId = userLevelList.stream().collect(Collectors.toMap(RazUserLevel::getUserId, RazUserLevel::getBatchId);
原因是存在重复key导致
正文
查看toMap文档
toMap
public static Collector&amp;gt; toMap(Function super T,? extends K&amp;gt; keyMapper,
Function super T,? extends U&amp;gt; valueMapper)
1
2
Returns a Collector that accumulates elements into a Map whose keys and values are the result of applying the provided mapping functions to the input elements.
If the mapped keys contains duplicates (according to Object.equals(Object)), an IllegalStateException is thrown when the collection operation is performed.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-02-27T00:38:30+08:00">
    <meta property="article:modified_time" content="2021-02-27T00:38:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java duplicate key_java.lang.IllegalStateException: Duplicate key 1</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>前言</p> 
 <p>昨天项目报错</p> 
 <p>java.lang.IllegalStateException: Duplicate key 1</p> 
 <p>代码如下：</p> 
 <p>Map userId2BatchId = userLevelList.stream().collect(Collectors.toMap(RazUserLevel::getUserId, RazUserLevel::getBatchId);</p> 
 <p>原因是存在重复key导致</p> 
 <p>正文</p> 
 <p>查看toMap文档</p> 
 <p>toMap</p> 
 <p>public static Collector&gt; toMap(Function super T,? extends K&gt; keyMapper,</p> 
 <p>Function super T,? extends U&gt; valueMapper)</p> 
 <p>1</p> 
 <p>2</p> 
 <p>Returns a Collector that accumulates elements into a Map whose keys and values are the result of applying the provided mapping functions to the input elements.</p> 
 <p>If the mapped keys contains duplicates (according to Object.equals(Object)), an IllegalStateException is thrown when the collection operation is performed. If the mapped keys may have duplicates, use toMap(Function, Function, BinaryOperator) instead.</p> 
 <p>API Note:</p> 
 <p>It is common for either the key or the value to be the input elements. In this case, the utility method Function.identity() may be helpful. For example, the following produces a Map mapping students to their grade point average:</p> 
 <p>Map studentToGPA students.stream()</p> 
 <p>.collect(toMap(Functions.identity(), student -&gt; computeGPA(student)));</p> 
 <p>1</p> 
 <p>2</p> 
 <p>And the following produces a Map mapping a unique identifier to students:</p> 
 <p>Map studentIdToStudent</p> 
 <p>students.stream().collect(toMap(Student::getId, Functions.identity());</p> 
 <p>如果在最后生成map的时候，mapped到的keys中如果包含重复的键(通过key类型的equals方法来判断)，则会抛出异常IllegalStateException。但是，后面也提到，如果keys中包含有相同的键，则可以使用toMap(Function, Function, BinaryOperator)方法来替代。</p> 
 <p>我的改进如下：</p> 
 <p>Map userId2BatchId = userLevelList.stream().collect(Collectors.toMap(RazUserLevel::getUserId, RazUserLevel::getBatchId, (e1, e2) -&gt; e1));</p> 
 <p>也就是有重复值的时候，我取先进来的值，也就是e1。</p> 
 <p>总结</p> 
 <p>java8不熟，查api</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/03c4f86994250c16aad8927e415b5283/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java程序是依赖于什么执行的_Java程序运行依赖操作系统吗</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e239706f1b52c80eb579d4cd3903c074/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java读取rdb_剖析Redis RDB文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>