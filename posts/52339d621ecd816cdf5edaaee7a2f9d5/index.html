<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何主动唤起文件选择框 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/52339d621ecd816cdf5edaaee7a2f9d5/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="如何主动唤起文件选择框">
  <meta property="og:description" content="如题，搞过文件上传的，肯定会有这种想法，也是初学者经常犯的“误区”
let input = document.createElement(&#39;input&#39;); input.type = &#39;file&#39;; input.click(); 像我这样经验老道的，一看，“不可能，这会受到浏览器安全策略限制”，牛逼哄哄的祭出正解
让 input[type=file] 飘在点击区上方，老手的惯用伎俩，这就叫“经验”，但最近一些事，让我啪啪打脸，颠覆了我的认知，不信你试试在 Chrome 的 Console 中试一下上面的三行代码。
。。。。。。
是不是很意外，让你在 Chrome 中试，是因为目前好像只有 Chrome 能这么大胆的放开，让你这么放肆，我们再尝试在 Safari 下试一下
。。。。。。
好像没效果，我们可联想到，浏览器限制这些东西，无非是想确定是人为操作，而非自动运行，在很多类似的情形，都有类似要求“人机交互事件发生时”，比如用户点击、键盘敲击。我们可以这么尝试一下
&amp;lt;input id=&#34;file&#34; type=&#34;file&#34; style=&#34;display:none&#34; /&amp;gt; &amp;lt;button id=&#34;trigger&#34;&amp;gt;选择&amp;lt;/button&amp;gt; &amp;lt;script&amp;gt; let input = document.getElementById(&#39;file&#39;); document.getElementById(&#39;trigger&#39;).onclick = function () { input.click(); }; &amp;lt;/script&amp;gt; 这种情况很适合那种，“原生的input的太丑，我想弄个漂亮的按钮触发上传”、“我想更优雅的控制上传”
还有一种情况我想在输入域中输入某个命令，回车触发上传
&amp;lt;input id=&#34;file&#34; type=&#34;file&#34; style=&#34;display:none&#34; /&amp;gt; &amp;lt;div id=&#34;trigget&#34; contenteditable&amp;gt;敲击回车触发上传&amp;lt;/div&amp;gt; &amp;lt;script&amp;gt; let input = document.getElementById(&#39;file&#39;); document.getElementById(&#39;trigger&#39;).onkeypress = function (e) { e.preventDefault(); input.click(); }; &amp;lt;/script&amp;gt; 浏览器兼容性如下">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-03-29T05:28:13+08:00">
    <meta property="article:modified_time" content="2018-03-29T05:28:13+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何主动唤起文件选择框</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="article fmt article__content"> 
 <p>如题，搞过文件上传的，肯定会有这种想法，也是初学者经常犯的“误区”</p> 
 <pre><code class="js">let input = document.createElement('input');
input.type = 'file';
input.click();</code></pre> 
 <p>像我这样经验老道的，一看，“不可能，这会受到浏览器安全策略限制”，牛逼哄哄的祭出正解</p> 
 <p><span class="img-wrap"><img src="https://images2.imgbox.com/2b/c2/jgNDHVhj_o.png" alt="solution" title="solution"></span></p> 
 <p>让 <code>input[type=file]</code> 飘在点击区上方，老手的惯用伎俩，这就叫“经验”，但最近一些事，让我啪啪打脸，颠覆了我的认知，不信你试试在 Chrome 的 Console 中试一下上面的三行代码。</p> 
 <p>。。。。。。</p> 
 <p>是不是很意外，让你在 Chrome 中试，是因为目前好像只有 Chrome 能这么大胆的放开，让你这么放肆，我们再尝试在 Safari 下试一下</p> 
 <p>。。。。。。</p> 
 <p>好像没效果，我们可联想到，浏览器限制这些东西，无非是想确定是人为操作，而非自动运行，在很多类似的情形，都有类似要求“人机交互事件发生时”，比如用户点击、键盘敲击。我们可以这么尝试一下</p> 
 <pre><code class="html">&lt;input id="file" type="file" style="display:none" /&gt;
&lt;button id="trigger"&gt;选择&lt;/button&gt;

&lt;script&gt;
let input = document.getElementById('file');

document.getElementById('trigger').onclick = function () {
  input.click();
};
&lt;/script&gt;</code></pre> 
 <p>这种情况很适合那种，“原生的<code>input</code>的太丑，我想弄个漂亮的按钮触发上传”、“我想更优雅的控制上传”</p> 
 <p>还有一种情况我想在输入域中输入某个命令，回车触发上传</p> 
 <pre><code class="html">&lt;input id="file" type="file" style="display:none" /&gt;
&lt;div id="trigget" contenteditable&gt;敲击回车触发上传&lt;/div&gt;
&lt;script&gt;
let input = document.getElementById('file');

document.getElementById('trigger').onkeypress = function (e) {
  e.preventDefault();
  input.click();
};
&lt;/script&gt;</code></pre> 
 <p>浏览器兼容性如下</p> 
 <table><thead><tr><th>Ability</th><th>IE</th><th>Firefox(41)</th><th>Safari(11)</th><th>Chrome(65)</th></tr></thead><tbody><tr><td>直接唤起</td><td>no</td><td>no</td><td>no</td><td>yes</td></tr><tr><td>事件沙盒（click/keyup）唤起</td><td>8,9,10,11</td><td>yes</td><td>yes</td><td>yes</td></tr></tbody></table> 
 <p>可以说是<strong>全兼容</strong>。</p> 
 <blockquote>
   有些版本我懒得测了，但我想连IE8都行，其它的不用测了吧 
  <br>IE 下， 
  <code>input[type=file]</code> 需要存在文档流中 
 </blockquote> 
 <p>至此，我想你之前经历过的，<code>input</code> 飘在某个按钮上方这种别扭设计可以扔掉了。</p> 
 <p><strong>但是还没完</strong>，不知道大家有没有想到 <code>labelFor</code> 的应用场景，如果只是想点击事件转移，我们可以尝试以下方案</p> 
 <pre><code class="html">&lt;input id="file" type="file" style="display:none" /&gt;
&lt;label for="file"&gt;
  &lt;span&gt;点击上传&lt;/span&gt;
&lt;/label&gt;</code></pre> 
 <p>或者</p> 
 <pre><code class="html">&lt;label&gt;
  &lt;span&gt;点击上传&lt;/span&gt;
  &lt;input type="file" style="display:none" /&gt;
&lt;/label&gt;</code></pre> 
 <p>这种方式，属于html原生支持的、设计如此的，不需要一句js脚本，适用于简单朴素的原生表单。</p> 
 <p>到目前为止，所谓"强壮的"的众多上传控件，仍然在使用惯用伎俩，这种不优雅的方式，早该被淘汰了，该是重构的时候了。</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c4cf701d7f6747640358eb682bc5b9d5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">学习Java读取excel表格笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fcac2d0d6b4004c6490a577ecf88ef81/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Kotlin协程（同步、异步和常用的API）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>