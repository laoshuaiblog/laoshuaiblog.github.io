<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JWT 做 token 签发 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/73eee65473226cfe1de9e96f4ff732b5/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="JWT 做 token 签发">
  <meta property="og:description" content="文章目录 JWT简介JWT 数据格式案例 JWT 交互流程JWT 存在的问题实战 JWT 简介 JWT，全称是 Json Web Token ， 是一种 JSON 风格的轻量级的授权和身份认证规范，可实现无状态、分布式的 Web 应用授权。
JWT 作为一种规范，并没有和某一种语言绑定在一起，常用的 Java 实现是 GitHub 上的开源项目 jjwt，地址如下：https://github.com/jwtk/jjwt
JWT 数据格式 JWT 包含三部分数据：
1.Header：头部，通常头部有两部分信息：
声明类型，这里是JWT
加密算法，自定义
我们会对头部进行 Base64Url 编码（可解码），得到第一部分数据。
2.Payload：载荷，就是有效数据，在官方文档中(RFC7519)，这里给了 7 个示例信息：
iss (issuer)：表示签发人
exp (expiration time)：表示token过期时间
sub (subject)：主题
aud (audience)：受众
nbf (Not Before)：生效时间
iat (Issued At)：签发时间
jti (JWT ID)：编号
这部分也会采用 Base64Url 编码，得到第二部分数据。
3.Signature：签名，是整个数据的认证信息。一般根据前两步的数据，再加上服务的的密钥 secret（密钥保存在服务端，不能泄露给客户端），通过 Header 中配置的加密算法生成。用于验证整个数据完整和可靠性。
生成的数据格式如下图：
注意，这里的数据通过 . 隔开成了三部分，分别对应前面提到的三部分，另外，这里数据是不换行的，图片换行只是为了展示方便而已。
案例 eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzaG9wX2lkIjo2NjY2NjYsInVzZXJfaWQiOiJjaGVuZnUiLCJvcGVuX2lkIjoiY2hlbmZ1IiwiYXBwX2lkIjoiY2hlbmZ1In0.Q6qVIxPOf8jpK5idQgm7g3yUatyrh5RnF_JQhyZZeRU JWT 交互流程 流程图：">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-09-28T17:37:20+08:00">
    <meta property="article:modified_time" content="2022-09-28T17:37:20+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JWT 做 token 签发</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#JWT_2" rel="nofollow">JWT</a></li><li><ul><li><a href="#_4" rel="nofollow">简介</a></li><li><a href="#JWT__10" rel="nofollow">JWT 数据格式</a></li><li><ul><li><a href="#_46" rel="nofollow">案例</a></li></ul> 
   </li><li><a href="#JWT__50" rel="nofollow">JWT 交互流程</a></li><li><a href="#JWT__67" rel="nofollow">JWT 存在的问题</a></li><li><a href="#_79" rel="nofollow">实战</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="JWT_2"></a>JWT</h2> 
<h3><a id="_4"></a>简介</h3> 
<p>JWT，全称是 Json Web Token ， 是一种 JSON 风格的轻量级的授权和身份认证规范，可实现无状态、分布式的 Web 应用授权。</p> 
<blockquote> 
 <p>JWT 作为一种规范，并没有和某一种语言绑定在一起，常用的 Java 实现是 GitHub 上的开源项目 jjwt，地址如下：<code>https://github.com/jwtk/jjwt</code></p> 
</blockquote> 
<h3><a id="JWT__10"></a>JWT 数据格式</h3> 
<p>JWT 包含三部分数据：</p> 
<p>1.Header：头部，通常头部有两部分信息：</p> 
<ul><li> <p>声明类型，这里是JWT</p> </li><li> <p>加密算法，自定义</p> </li></ul> 
<p>我们会对头部进行 Base64Url 编码（可解码），得到第一部分数据。</p> 
<p>2.Payload：载荷，就是有效数据，在官方文档中(RFC7519)，这里给了 7 个示例信息：</p> 
<ul><li> <p>iss (issuer)：表示签发人</p> </li><li> <p>exp (expiration time)：表示token过期时间</p> </li><li> <p>sub (subject)：主题</p> </li><li> <p>aud (audience)：受众</p> </li><li> <p>nbf (Not Before)：生效时间</p> </li><li> <p>iat (Issued At)：签发时间</p> </li><li> <p>jti (JWT ID)：编号</p> </li></ul> 
<p>这部分也会采用 Base64Url 编码，得到第二部分数据。</p> 
<p>3.Signature：签名，是整个数据的认证信息。一般根据前两步的数据，再加上服务的的密钥 secret（密钥保存在服务端，不能泄露给客户端），通过 Header 中配置的加密算法生成。用于验证整个数据完整和可靠性。<br> 生成的数据格式如下图：<br> <img src="https://images2.imgbox.com/19/68/Si5ugVLy_o.png" alt="图片"><br> 注意，这里的数据通过 <code>.</code> 隔开成了三部分，分别对应前面提到的三部分，另外，这里数据是不换行的，图片换行只是为了展示方便而已。</p> 
<h4><a id="_46"></a>案例</h4> 
<pre><code class="prism language-bash">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzaG9wX2lkIjo2NjY2NjYsInVzZXJfaWQiOiJjaGVuZnUiLCJvcGVuX2lkIjoiY2hlbmZ1IiwiYXBwX2lkIjoiY2hlbmZ1In0.Q6qVIxPOf8jpK5idQgm7g3yUatyrh5RnF_JQhyZZeRU
</code></pre> 
<h3><a id="JWT__50"></a>JWT 交互流程</h3> 
<p>流程图：</p> 
<p><img src="https://images2.imgbox.com/eb/1c/umgGVsYV_o.png" alt="图片"></p> 
<p>步骤翻译：</p> 
<ol><li> <p>应用程序或客户端向授权服务器请求授权</p> </li><li> <p>获取到授权后，授权服务器会向应用程序返回访问令牌</p> </li><li> <p>应用程序使用访问令牌来访问受保护资源（如API）</p> </li></ol> 
<p>因为 JWT 签发的 token 中已经包含了用户的身份信息，并且每次请求都会携带，这样服务的就无需保存用户信息，甚至无需去数据库查询，这样就符合了 RESTful 的无状态规范。</p> 
<h3><a id="JWT__67"></a>JWT 存在的问题</h3> 
<p>说了这么多，JWT 也不是天衣无缝，由客户端维护登录状态带来的一些问题在这里依然存在，举例如下：</p> 
<ol><li> <p>续签问题，这是被很多人诟病的问题之一，传统的 cookie+session 的方案天然的支持续签，但是 jwt 由于服务端不保存用户状态，因此很难完美解决续签问题，如果引入 redis，虽然可以解决问题，但是 jwt 也变得不伦不类了。</p> </li><li> <p>注销问题，由于服务端不再保存用户信息，所以一般可以通过修改 secret 来实现注销，服务端 secret 修改后，已经颁发的未过期的 token 就会认证失败，进而实现注销，不过毕竟没有传统的注销方便。</p> </li><li> <p>密码重置，密码重置后，原本的 token 依然可以访问系统，这时候也需要强制修改 secret。</p> </li><li> <p>基于第 2 点和第 3 点，一般建议不同用户取不同 secret。</p> </li></ol> 
<h3><a id="_79"></a>实战</h3> 
<p><a href="http://chenfu1201.github.io/2020/05/14/J2EE/jwt/" rel="nofollow">实战代码</a></p> 
<p>参考</p> 
<ol><li><a href="https://mp.weixin.qq.com/s?__biz=MzI1NDY0MTkzNQ==&amp;mid=2247486735&amp;idx=1&amp;sn=4208470b30cbe5b7bbfb0ab53e6914a3&amp;scene=21#wechat_redirect" rel="nofollow">Spring Security 结合 Jwt 实现无状态登录</a></li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/276360d59512d3c32c8a2e6c1d30e075/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring Security 登录获取用户信息流程分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8a96ced9de09c4b1fe4ce5f61eb0e7bb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CAD图清晰打印设置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>