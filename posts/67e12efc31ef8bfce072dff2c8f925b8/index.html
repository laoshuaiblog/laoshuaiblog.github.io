<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ES的集群节点发现故障排除指南（2） - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/67e12efc31ef8bfce072dff2c8f925b8/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="ES的集群节点发现故障排除指南（2）">
  <meta property="og:description" content=" 本文是ES官方文档关于集群节点发现与互联互通的问题排查指南内容，第二部分。
原文参考及相关内容：
英文原文（官网）
第一部分-（1）
已选出主节点但状态不稳定？ 当一个节点赢得主节点选举时，它会在日志中记录一条包含 “elected-as-master” 的消息。如果这种情况重复发生，则说明当选为主节点的节点处于不稳定状态。在这种情况下，应重点关注来自主节点候选节点的日志，以了解为什么选举胜出者停止作为主节点并触发新一轮选举。
排查步骤 如果日志显示主节点由于超时或网络相关问题而不稳定，那么请按照以下方式缩小问题范围进行排查。
垃圾回收暂停 垃圾回收暂停会记录在Elasticsearch默认生成的GC日志中，同时也会通常被JvmMonitorService记录到主节点日志中。利用这些日志可以确认节点是否正在经历高堆内存使用率以及长时间的GC暂停。如果是这样的话，对于高堆内存使用率的排查指南提供了一些进一步调查的建议，但通常情况下，你需要在堆内存高使用率期间捕获堆转储，以便全面理解问题所在。 虚拟机暂停 虚拟机暂停同时也会影响同一主机上的其他进程。虚拟机暂停通常会导致系统时钟出现不连续性，Elasticsearch会在其日志中报告这一现象。如果你看到有证据表明其他进程在同一时间暂停运行，或者出现了意外的时钟不连续，那么应当对运行Elasticsearch的基础架构进行深入调查。 数据包捕获 数据包捕获将揭示系统级和网络级的故障，特别是在所有相关节点同时捕获网络流量时。你应该能够观察到节点间连接中的任何重传、丢包或其他延迟情况。通过获取Elasticsearch主进程的堆栈转储（例如，使用jstack工具）或执行一段时间内的性能追踪（例如，使用Java Flight Recorder），可以识别出等待特定线程可用时的长时间等待。 节点热点线程API 节点热点线程API有时能提供有用的信息，但需注意该API在集群中的所有节点上都需要一定数量的transport_worker和generic线程。该API可能会受到你正试图诊断的问题的影响。相比之下，jstack更加可靠，因为它不需要任何JVM线程的支持。 参阅网络线程模型 参与发现和集群成员管理的线程主要是transport_worker和cluster_coordination线程，它们不应出现长时间等待的情况。在Elasticsearch日志中，尤其是来自org.elasticsearch.transport.InboundHandler的警告日志中，也可能存在有关线程长时间等待的证据。有关更多信息，请参阅网络线程模型文档。 ">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-22T15:21:49+08:00">
    <meta property="article:modified_time" content="2024-03-22T15:21:49+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ES的集群节点发现故障排除指南（2）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本文是ES官方文档关于集群节点发现与互联互通的问题排查指南内容，第二部分。</p> 
<p>原文参考及相关内容：</p> 
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/discovery-troubleshooting.html" rel="nofollow">英文原文（官网）</a></p> 
<p><a href="https://blog.csdn.net/yuand7/article/details/136872997?spm=1001.2014.3001.5501">第一部分-（1）</a><br> <img src="https://images2.imgbox.com/61/9e/rh1aqJsM_o.jpg" alt="在这里插入图片描述"></p> 
<h3><a id="_9"></a>已选出主节点但状态不稳定？</h3> 
<p>当一个节点赢得主节点选举时，它会在日志中记录一条包含 “elected-as-master” 的消息。如果这种情况重复发生，则说明当选为主节点的节点处于不稳定状态。在这种情况下，应重点关注来自主节点候选节点的日志，以了解为什么选举胜出者停止作为主节点并触发新一轮选举。</p> 
<h3><a id="_12"></a>排查步骤</h3> 
<p>如果日志显示主节点由于超时或网络相关问题而不稳定，那么请按照以下方式缩小问题范围进行排查。</p> 
<h4><a id="_15"></a>垃圾回收暂停</h4> 
<ul><li><strong>垃圾回收暂停</strong>会记录在Elasticsearch默认生成的GC日志中，同时也会通常被JvmMonitorService记录到主节点日志中。利用这些日志可以确认节点是否正在经历高堆内存使用率以及长时间的GC暂停。如果是这样的话，对于高堆内存使用率的排查指南提供了一些进一步调查的建议，但通常情况下，你需要在堆内存高使用率期间捕获堆转储，以便全面理解问题所在。</li></ul> 
<h4><a id="_17"></a>虚拟机暂停</h4> 
<ul><li><strong>虚拟机暂停</strong>同时也会影响同一主机上的其他进程。虚拟机暂停通常会导致系统时钟出现不连续性，Elasticsearch会在其日志中报告这一现象。如果你看到有证据表明其他进程在同一时间暂停运行，或者出现了意外的时钟不连续，那么应当对运行Elasticsearch的基础架构进行深入调查。</li></ul> 
<h4><a id="_19"></a>数据包捕获</h4> 
<ul><li><strong>数据包捕获</strong>将揭示系统级和网络级的故障，特别是在所有相关节点同时捕获网络流量时。你应该能够观察到节点间连接中的任何重传、丢包或其他延迟情况。</li><li>通过获取Elasticsearch主进程的堆栈转储（例如，使用jstack工具）或执行一段时间内的性能追踪（例如，使用Java Flight Recorder），可以识别出等待特定线程可用时的长时间等待。</li></ul> 
<h4><a id="API_22"></a>节点热点线程API</h4> 
<ul><li><strong>节点热点线程API</strong>有时能提供有用的信息，但需注意该API在集群中的所有节点上都需要一定数量的transport_worker和generic线程。该API可能会受到你正试图诊断的问题的影响。相比之下，jstack更加可靠，因为它不需要任何JVM线程的支持。</li></ul> 
<h4><a id="_25"></a>参阅<strong>网络线程模型</strong></h4> 
<ul><li>参与发现和集群成员管理的线程主要是transport_worker和cluster_coordination线程，它们不应出现长时间等待的情况。在Elasticsearch日志中，尤其是来自org.elasticsearch.transport.InboundHandler的警告日志中，也可能存在有关线程长时间等待的证据。有关更多信息，请参阅<strong>网络线程模型</strong>文档。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/097daab60c54ff1cba037427ba1c697a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【报错】ResizeObserver loop completed with undelivered notifications</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/864c9e02cb9a141981b893e5af68f5dd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微服务保护</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>