<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>计算机视觉——增强现实（Augmented Reality） - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/d7839c816ab888a51aecc1267b2b5c51/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="计算机视觉——增强现实（Augmented Reality）">
  <meta property="og:description" content="文章目录 一、增强现实原理及介绍1、增强现实介绍2、增强现实原理介绍 二、增强现实应用1、应用背景介绍2、AR应用2.1、相机矩阵标定2.2、作为目标背景的图片2.3、代码部分2.4、合成结果 一、增强现实原理及介绍 1、增强现实介绍 增强现实，是将物体和相应信息放置在图像数据上的一系列操作的总称。事实上，增强现实在我们生活中的应用已经相当广泛了。比如任天堂的pokeman go，这个产品可以使你看到皮卡丘，杰尼龟出现在现实世界的场景里， 并捕捉他们，这个应该是无数90后小时候的梦想，AR使它变成了现实。
2、增强现实原理介绍 对于背景场景，我们需要首先给定标记，通过计算，获得自己计算机的标定信息，使用获取信息，放置目标模型的图像，获得我们需要的增强现实结果。
二、增强现实应用 1、应用背景介绍 应用目的是将一个茶杯图像放置到一段视频里，下面我们将进行计算机标定，以及目标合成。
2、AR应用 2.1、相机矩阵标定 下面这张是用来进行相机矩阵标定的图片
首先，相机到目标物体的距离d为500mm，计算出书的边长fX,fY。以及相片里书的边长fx,fy
利用
Px=fx/fX∗d
fy=fy/fY∗d
计算出相机的焦距。
2.2、作为目标背景的图片 2.3、代码部分 import math import pickle from pylab import * from OpenGL.GL import * from OpenGL.GLU import * from OpenGL.GLUT import * import pygame, pygame.image from pygame.locals import * from PCV.geometry import homography, camera from PCV.localdescriptors import sift def cube_points(c, wid): &#34;&#34;&#34; Creates a list of points for plotting a cube with plot.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-04-07T15:57:19+08:00">
    <meta property="article:modified_time" content="2019-04-07T15:57:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">计算机视觉——增强现实（Augmented Reality）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、增强现实原理及介绍</a></li><li><ul><li><a href="#1_2" rel="nofollow">1、增强现实介绍</a></li><li><a href="#2_4" rel="nofollow">2、增强现实原理介绍</a></li></ul> 
  </li><li><a href="#_6" rel="nofollow">二、增强现实应用</a></li><li><ul><li><a href="#1_7" rel="nofollow">1、应用背景介绍</a></li><li><a href="#2AR_9" rel="nofollow">2、AR应用</a></li><li><ul><li><a href="#21_10" rel="nofollow">2.1、相机矩阵标定</a></li><li><a href="#22_18" rel="nofollow">2.2、作为目标背景的图片</a></li><li><a href="#23_21" rel="nofollow">2.3、代码部分</a></li><li><a href="#24_183" rel="nofollow">2.4、合成结果</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、增强现实原理及介绍</h2> 
<h3><a id="1_2"></a>1、增强现实介绍</h3> 
<p>增强现实，是将物体和相应信息放置在图像数据上的一系列操作的总称。事实上，增强现实在我们生活中的应用已经相当广泛了。比如任天堂的pokeman go，这个产品可以使你看到皮卡丘，杰尼龟出现在现实世界的场景里， 并捕捉他们，这个应该是无数90后小时候的梦想，AR使它变成了现实。</p> 
<h3><a id="2_4"></a>2、增强现实原理介绍</h3> 
<p>对于背景场景，我们需要首先给定标记，通过计算，获得自己计算机的标定信息，使用获取信息，放置目标模型的图像，获得我们需要的增强现实结果。</p> 
<h2><a id="_6"></a>二、增强现实应用</h2> 
<h3><a id="1_7"></a>1、应用背景介绍</h3> 
<p>应用目的是将一个茶杯图像放置到一段视频里，下面我们将进行计算机标定，以及目标合成。</p> 
<h3><a id="2AR_9"></a>2、AR应用</h3> 
<h4><a id="21_10"></a>2.1、相机矩阵标定</h4> 
<p>下面这张是用来进行相机矩阵标定的图片<br> <img src="https://images2.imgbox.com/60/2d/PWdBMsFl_o.jpg" alt="在这里插入图片描述"><br> 首先，相机到目标物体的距离d为500mm，计算出书的边长fX,fY。以及相片里书的边长fx,fy<br> 利用<br> Px=fx/fX∗d<br> fy=fy/fY∗d<br> 计算出相机的焦距。</p> 
<h4><a id="22_18"></a>2.2、作为目标背景的图片</h4> 
<p><img src="https://images2.imgbox.com/e2/f3/xu13o8bZ_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d8/cb/JqONX6AJ_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="23_21"></a>2.3、代码部分</h4> 
<pre><code>import math
import pickle
from pylab import *
from OpenGL.GL import * 
from OpenGL.GLU import * 
from OpenGL.GLUT import * 
import pygame, pygame.image 
from pygame.locals import *
from PCV.geometry import homography, camera
from PCV.localdescriptors import sift

def cube_points(c, wid):
    """ Creates a list of points for plotting
        a cube with plot. (the first 5 points are
        the bottom square, some sides repeated). """
    p = []
    # bottom
    p.append([c[0]-wid, c[1]-wid, c[2]-wid])
    p.append([c[0]-wid, c[1]+wid, c[2]-wid])
    p.append([c[0]+wid, c[1]+wid, c[2]-wid])
    p.append([c[0]+wid, c[1]-wid, c[2]-wid])
    p.append([c[0]-wid, c[1]-wid, c[2]-wid]) #same as first to close plot
    
    # top
    p.append([c[0]-wid, c[1]-wid, c[2]+wid])
    p.append([c[0]-wid, c[1]+wid, c[2]+wid])
    p.append([c[0]+wid, c[1]+wid, c[2]+wid])
    p.append([c[0]+wid, c[1]-wid, c[2]+wid])
    p.append([c[0]-wid, c[1]-wid, c[2]+wid]) #same as first to close plot
    
    # vertical sides
    p.append([c[0]-wid, c[1]-wid, c[2]+wid])
    p.append([c[0]-wid, c[1]+wid, c[2]+wid])
    p.append([c[0]-wid, c[1]+wid, c[2]-wid])
    p.append([c[0]+wid, c[1]+wid, c[2]-wid])
    p.append([c[0]+wid, c[1]+wid, c[2]+wid])
    p.append([c[0]+wid, c[1]-wid, c[2]+wid])
    p.append([c[0]+wid, c[1]-wid, c[2]-wid])
    
    return array(p).T
    
def my_calibration(sz):
    row, col = sz
    fx = 2245*col/3120
    fy = 2173*row/4160
    K = diag([fx, fy, 1])
    K[0, 2] = 0.5*col
    K[1, 2] = 0.5*row
    return K

def set_projection_from_camera(K): 
	glMatrixMode(GL_PROJECTION) 
	glLoadIdentity()
	fx = K[0,0] 
	fy = K[1,1] 
	fovy = 2*math.atan(0.5*height/fy)*180/math.pi 
	aspect = (width*fy)/(height*fx)
	near = 0.1 
	far = 100.0
	gluPerspective(fovy,aspect,near,far) 
	glViewport(0,0,width,height)

def set_modelview_from_camera(Rt): 
	glMatrixMode(GL_MODELVIEW) 
	glLoadIdentity()
	Rx = np.array([[1,0,0],[0,0,-1],[0,1,0]])
	R = Rt[:,:3] 
	U,S,V = np.linalg.svd(R) 
	R = np.dot(U,V) 
	R[0,:] = -R[0,:]
	t = Rt[:,3]
	M = np.eye(4) 
	M[:3,:3] = np.dot(R,Rx) 
	M[:3,3] = t
	M = M.T
	m = M.flatten()
	glLoadMatrixf(m)

def draw_background(imname):
	bg_image = pygame.image.load(imname).convert() 
	bg_data = pygame.image.tostring(bg_image,"RGBX",1)
	glMatrixMode(GL_MODELVIEW) 
	glLoadIdentity()

	glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT)
	glEnable(GL_TEXTURE_2D) 
	glBindTexture(GL_TEXTURE_2D,glGenTextures(1)) 
	glTexImage2D(GL_TEXTURE_2D,0,GL_RGBA,width,height,0,GL_RGBA,GL_UNSIGNED_BYTE,bg_data) 
	glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST) 
	glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST)
	glBegin(GL_QUADS) 
	glTexCoord2f(0.0,0.0); glVertex3f(-1.0,-1.0,-1.0) 
	glTexCoord2f(1.0,0.0); glVertex3f( 1.0,-1.0,-1.0) 
	glTexCoord2f(1.0,1.0); glVertex3f( 1.0, 1.0,-1.0) 
	glTexCoord2f(0.0,1.0); glVertex3f(-1.0, 1.0,-1.0) 
	glEnd()
	glDeleteTextures(1)


def draw_teapot(size):
	glEnable(GL_LIGHTING) 
	glEnable(GL_LIGHT0) 
	glEnable(GL_DEPTH_TEST) 
	glClear(GL_DEPTH_BUFFER_BIT)
	glMaterialfv(GL_FRONT,GL_AMBIENT,[0,0,0,0]) 
	glMaterialfv(GL_FRONT,GL_DIFFUSE,[0.5,0.0,0.0,0.0]) 
	glMaterialfv(GL_FRONT,GL_SPECULAR,[0.7,0.6,0.6,0.0]) 
	glMaterialf(GL_FRONT,GL_SHININESS,0.25*128.0) 
	glutSolidTeapot(size)

width,height = 1000,747
def setup():
	pygame.init() 
	pygame.display.set_mode((width,height),OPENGL | DOUBLEBUF) 
	pygame.display.set_caption("OpenGL AR demo")    

# compute features
sift.process_image('book_frontal.JPG', 'im0.sift')
l0, d0 = sift.read_features_from_file('im0.sift')

sift.process_image('book_perspective.JPG', 'im1.sift')
l1, d1 = sift.read_features_from_file('im1.sift')

# match features and estimate homography
matches = sift.match_twosided(d0, d1)
ndx = matches.nonzero()[0]
fp = homography.make_homog(l0[ndx, :2].T)
ndx2 = [int(matches[i]) for i in ndx]
tp = homography.make_homog(l1[ndx2, :2].T)

model = homography.RansacModel()
H, inliers = homography.H_from_ransac(fp, tp, model)

K = my_calibration((747, 1000))
cam1 = camera.Camera(hstack((K, dot(K, array([[0], [0], [-1]])))))
box = cube_points([0, 0, 0.1], 0.1)
box_cam1 = cam1.project(homography.make_homog(box[:, :5]))
box_trans = homography.normalize(dot(H,box_cam1))
cam2 = camera.Camera(dot(H, cam1.P))
A = dot(linalg.inv(K), cam2.P[:, :3])
A = array([A[:, 0], A[:, 1], cross(A[:, 0], A[:, 1])]).T
cam2.P[:, :3] = dot(K, A)

Rt=dot(linalg.inv(K),cam2.P)
 
setup() 
draw_background("book_perspective.bmp") 
set_projection_from_camera(K) 
set_modelview_from_camera(Rt)
draw_teapot(0.05)

pygame.display.flip()
while True: 
	for event in pygame.event.get():
		if event.type==pygame.QUIT:
			sys.exit()


</code></pre> 
<h4><a id="24_183"></a>2.4、合成结果</h4> 
<p><img src="https://images2.imgbox.com/cf/b4/7pORu6mJ_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6ad285999138c789d7df507a8c564002/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">window环境下使用Qemu运行自己制作的img映像文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/380940c73f080cdd5ee1eff1071120e5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IDEA中的lombok失效的解决办法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>