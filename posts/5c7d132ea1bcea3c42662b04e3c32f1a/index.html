<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ibatis处理器异常（executor.ExecutorException）解决方法 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/5c7d132ea1bcea3c42662b04e3c32f1a/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="ibatis处理器异常（executor.ExecutorException）解决方法">
  <meta property="og:description" content="org.apache.ibatis.exceptions.PersistenceException: ### Error querying database. Cause: org.apache.ibatis.executor.ExecutorException: Executor was closed. ### Cause: org.apache.ibatis.executor.ExecutorException: Executor was closed. at org.apache.ibatis.exceptions.ExceptionFactory.wrapException(ExceptionFactory.java:23) at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:104) at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:95) at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:124) at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:90) at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:40) at com.sun.proxy.$Proxy3.getAgeRange(Unknown Source) at com.lrq.service.impl.UserServiceImpl.getAgeRange(UserServiceImpl.java:49) at com.lrq.test.Test.testQuery(Test.java:54) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222) at org.junit.runners.ParentRunner.run(ParentRunner.java:300) at org.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2017-03-24T20:28:39+08:00">
    <meta property="article:modified_time" content="2017-03-24T20:28:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ibatis处理器异常（executor.ExecutorException）解决方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    org.apache.ibatis.exceptions.PersistenceException:  
<br> 
<span style="color:#cc0000"><strong>### Error querying database.  Cause: org.apache.ibatis.executor.ExecutorException: Executor was closed.</strong></span> 
<br> ### Cause: org.apache.ibatis.executor.ExecutorException: Executor was closed. 
<br> 
<span style="white-space:pre"></span>at org.apache.ibatis.exceptions.ExceptionFactory.wrapException(ExceptionFactory.java:23) 
<br> 
<span style="white-space:pre"></span>at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:104) 
<br> 
<span style="white-space:pre"></span>at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:95) 
<br> 
<span style="white-space:pre"></span>at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:124) 
<br> 
<span style="white-space:pre"></span>at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:90) 
<br> 
<span style="white-space:pre"></span>at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:40) 
<br> 
<span style="white-space:pre"></span>at com.sun.proxy.$Proxy3.getAgeRange(Unknown Source) 
<br> 
<span style="white-space:pre"></span>at com.lrq.service.impl.UserServiceImpl.getAgeRange(UserServiceImpl.java:49) 
<br> 
<span style="white-space:pre"></span>at com.lrq.test.Test.testQuery(Test.java:54) 
<br> 
<span style="white-space:pre"></span>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 
<br> 
<span style="white-space:pre"></span>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) 
<br> 
<span style="white-space:pre"></span>at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45) 
<br> 
<span style="white-space:pre"></span>at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42) 
<br> 
<span style="white-space:pre"></span>at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222) 
<br> 
<span style="white-space:pre"></span>at org.junit.runners.ParentRunner.run(ParentRunner.java:300) 
<br> 
<span style="white-space:pre"></span>at org.junit.runner.JUnitCore.run(JUnitCore.java:157) 
<br> 
<span style="white-space:pre"></span>at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:74) 
<br> 
<span style="white-space:pre"></span>at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:211) 
<br> 
<span style="white-space:pre"></span>at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:67) 
<br> 
<span style="white-space:pre"></span>at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 
<br> 
<span style="white-space:pre"></span>at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) 
<br> 
<span style="white-space:pre"></span>at com.intellij.rt.execution.application.AppMain.main(AppMain.java:134) 
<br> Caused by: org.apache.ibatis.executor.ExecutorException: Executor was closed. 
<br> 
<span style="white-space:pre"></span>at org.apache.ibatis.executor.BaseExecutor.createCacheKey(BaseExecutor.java:168) 
<br> 
<span style="white-space:pre"></span>at org.apache.ibatis.executor.CachingExecutor.createCacheKey(CachingExecutor.java:140) 
<br> 
<span style="white-space:pre"></span>at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:80) 
<br> 
<span style="white-space:pre"></span>at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:101) 
<br> 
<p><span style="white-space:pre"></span>... 33 more</p> 
<p><br> </p> 
<p><span style="font-size:18px">ibatis处理器处理器异常，上面显示原因是<span style="color:rgb(204,0,0)">Executor was closed.则很有可能是ibatis的session被关闭了，</span></span></p> 
<p><span style="font-size:18px"><span style="color:rgb(204,0,0)">你这边如果使用全局变量的service进行操作，由于session每次得到dao接口都必须先提交然后关闭，</span></span></p> 
<p><span style="font-size:18px"><span style="color:rgb(204,0,0)">共享<span style="color:rgb(204,0,0); font-size:18px">service对象导致下一个不可用</span></span></span></p> 
<p><br> </p> 
<p><span style="font-size:18px"><span style="color:rgb(204,0,0)"><span style="color:rgb(204,0,0); font-size:18px"></span></span></span></p> 
<pre><code class="language-java">全局变量：</code></pre> 
<pre><code class="language-java">public class UserServiceImpl implements UserService {
    private static SqlSession session= MyBatisUtil.getSession();
    private static UserDao userDao=session.getMapper(UserDao.class);</code></pre> 
<br> 
<p></p> 
<p><span style="font-size:18px"><span style="color:rgb(204,0,0)"><img src="https://images2.imgbox.com/72/ca/zcQlbmDP_o.jpg" alt=""><br> </span></span></p> 
<p><br> </p> 
<p><img src="https://images2.imgbox.com/bf/80/DJ4QU7cD_o.jpg" alt=""><br> </p> 
<p><br> </p> 
<p>所以解决方法是不使用全局变量或者把getSession全部封装到Util里面</p> 
<p><br> </p> 
<p>不用全局变量</p> 
<p></p> 
<pre><code class="language-java">    @Override
    public int add(User user) {
	SqlSession session= MyBatisUtil.getSession();
	UserDao userDao=session.getMapper(UserDao.class);
        int rs=userDao.add(user);
        session.commit();
        session.close();
        return rs;
    }</code></pre> 
<br> 
<br> 
<p></p> 
<p>全部封装到Util里面</p> 
<p></p> 
<pre><code class="language-java">package com.lrq.util;
import com.lrq.dao.UserDao;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;
import java.io.IOException;
import java.io.Reader;
/**
 * Created by Administrator on 2017/3/24.
 */
public class MyBatisUtil {
    private static SqlSessionFactory sessionFactory;
    //类加载时执行静态块，静态块只执行一次，以后不再执行
    static{
        Reader reader=null;
        try {
            reader= Resources.getResourceAsReader("mybatis.xml");
        } catch (IOException e) {
            e.printStackTrace();
        }
        sessionFactory=new SqlSessionFactoryBuilder().build(reader);
    }</code></pre> 
<pre><code class="language-java">
    public static SqlSession getSession(){
        SqlSession session=sessionFactory.openSession();
        return  session;
    }</code></pre> 
<pre><code class="language-java">}
</code></pre> 
<br> 
<br> 
<p></p> 
<p><br> </p> 
<p><br> </p> 
<p><br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e9031e41644904055383d0ff3a4821cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">cpu性能评测(i5-4460,i5-4400,i5-3470,i5-2400s,i3-3220T,G860)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/65a8ba36eaf34261c08c6e5a3e4b9f99/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Angular简介和入门</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>