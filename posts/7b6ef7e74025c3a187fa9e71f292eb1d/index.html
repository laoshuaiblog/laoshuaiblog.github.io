<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>k8s集群架构维护k8s集群以及搭建k8s集群以及k8s集群的常见问题 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/7b6ef7e74025c3a187fa9e71f292eb1d/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="k8s集群架构维护k8s集群以及搭建k8s集群以及k8s集群的常见问题">
  <meta property="og:description" content="一、k8s架构 Kubernetes（K8s）是一个由Google主导开发的开源容器编排平台，用于自动化部署、扩展和管理容器化应用程序。它的设计目标是简化容器化应用程序在生产环境中的部署和运营。Kubernetes的架构设计复杂且高效，主要包括以下几个核心组件：
1、控制平面（Control Plane）
API服务器（API Server）：作为集群的大脑，它提供了用于管理集群的RESTful API接口。所有对集群资源的操作都需要通过API服务器进行。
调度器（Scheduler）：负责根据预定的策略将Pod调度到合适的节点上运行。
控制器管理器（Controller Manager）：负责运行各种控制器，如部署控制器、节点控制器、服务控制器等，以确保集群的状态符合用户的定义。
etcd：一个分布式键值存储系统，用于存储集群的状态信息，如Pod、节点、服务等的元数据。
2、工作节点（Worker Nodes）
Kubelet：在节点上运行的组件，负责Pod的创建、配置和运行。
Kube-Proxy：在节点上运行的网络代理，负责为Pod提供网络代理服务，实现Pod之间的网络通信。
3、Pod
Kubernetes的基本工作单元，一个Pod可以包含一个或多个容器。Pod中的容器共享网络和存储资源，并且总是运行在同一个宿主机上。
4、服务（Service）
用于定义一组Pod的抽象，它定义了如何访问这一组Pod，如IP地址、端口号等。服务可以暴露内部的服务，也可以隐藏底层的Pod。
5、部署（Deployment）
用于控制应用程序的版本和扩展。Deployment定义了应用程序的预期状态，Kubernetes会自动确保应用程序的实际状态与预期状态一致。
6、副本控制器（ReplicaSet）
确保指定的Pod副本数在任何时候都得到维护。如果Pod丢失，副本控制器会自动创建新的Pod来替换它。
7、持久化存储（Persistent Storage）
用于提供持久的存储卷，以供Pod使用。支持多种存储系统，如本地存储、iSCSI、NFS、Ceph等。
8、网络插件（Network Plugins）
用于为Kubernetes提供网络功能。不同的网络插件支持不同的网络模型和特性。
9、Addon Manager
负责管理和配置集群中的附加组件，如监控、日志记录等。
二、k8s集群搭建以及高可用集群搭建 1、准备环境：
确保所有节点（物理机或虚拟机）的操作系统都是兼容的，通常使用Linux系统，如Ubuntu、CentOS等。
每个节点都需要有一个唯一的MAC地址和主机名。
2、安装Docker：
在所有节点上安装Docker。Docker是Kubernetes用来运行容器的引擎。
3、安装Kubeadm、Kubelet和Kubectl：
Kubeadm是一个工具，用于初始化和管理Kubernetes集群。
Kubelet是在集群中所有机器上运行的组件，负责启动Pod和容器等。
Kubectl是集群管理员和开发人员与集群通信的命令行工具。
4、使用kubeadm创建集群：
在主节点上运行kubeadm init命令来初始化集群。
按照命令输出中的指示，配置kubectl，使其能够与集群通信。
5、配置高可用集群：
安装一个高可用性的存储解决方案，如etcd集群。
配置负载均衡器，以便管理节点通信。
6、加入节点：
使用kubeadm join命令将工作节点加入到集群中。
7、验证集群状态：
使用kubectl get nodes命令来检查所有节点的状态。
搭建高可用Kubernetes集群
高可用Kubernetes集群的目的是确保集群的关键组件（如API服务器、etcd等）在面对故障时能够继续运行。
8、增加集群组件的冗余：
使用多个API服务器实例，通过负载均衡器提供服务。
创建etcd集群，通常需要至少三台机器，以实现数据的冗余和故障转移。
9、使用控制器管理器的高可用模式：
配置控制器管理器以在多个节点上运行，确保即使一个节点失败，其他控制器管理器仍然可以继续工作。
10、配置服务发现和负载均衡：
使用高可用性的服务发现方案，如CoreDNS和Calico，确保服务即使在节点故障的情况下也能够正常发现和通信。
11、灾难恢复计划：
制定灾难恢复计划，包括备份集群状态、离线恢复等。
12、监控和告警：
安装监控工具，如Prometheus和Grafana，以及配置适当的告警规则，以便在集群出现问题时及时通知维护人员。">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-20T09:40:28+08:00">
    <meta property="article:modified_time" content="2024-03-20T09:40:28+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">k8s集群架构维护k8s集群以及搭建k8s集群以及k8s集群的常见问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 style="text-align:left;"><strong><strong><strong>一、k8s架构</strong></strong></strong></h3> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/a8/5c/FrmNKu8u_o.png" width="1200"></p> 
<p style="margin-left:0;text-align:left;">Kubernetes（K8s）是一个由Google主导开发的开源容器编排平台，用于自动化部署、扩展和管理容器化应用程序。它的设计目标是简化容器化应用程序在生产环境中的部署和运营。Kubernetes的架构设计复杂且高效，主要包括以下几个核心组件：<br>     1、控制平面（Control Plane）<br>     API服务器（API Server）：作为集群的大脑，它提供了用于管理集群的RESTful API接口。所有对集群资源的操作都需要通过API服务器进行。<br>     调度器（Scheduler）：负责根据预定的策略将Pod调度到合适的节点上运行。<br>     控制器管理器（Controller Manager）：负责运行各种控制器，如部署控制器、节点控制器、服务控制器等，以确保集群的状态符合用户的定义。<br>    etcd：一个分布式键值存储系统，用于存储集群的状态信息，如Pod、节点、服务等的元数据。<br> 2、工作节点（Worker Nodes）<br>     Kubelet：在节点上运行的组件，负责Pod的创建、配置和运行。<br> Kube-Proxy：在节点上运行的网络代理，负责为Pod提供网络代理服务，实现Pod之间的网络通信。<br> 3、Pod<br>     Kubernetes的基本工作单元，一个Pod可以包含一个或多个容器。Pod中的容器共享网络和存储资源，并且总是运行在同一个宿主机上。<br> 4、服务（Service）<br>     用于定义一组Pod的抽象，它定义了如何访问这一组Pod，如IP地址、端口号等。服务可以暴露内部的服务，也可以隐藏底层的Pod。<br> 5、部署（Deployment）<br>     用于控制应用程序的版本和扩展。Deployment定义了应用程序的预期状态，Kubernetes会自动确保应用程序的实际状态与预期状态一致。<br> 6、副本控制器（ReplicaSet）<br>     确保指定的Pod副本数在任何时候都得到维护。如果Pod丢失，副本控制器会自动创建新的Pod来替换它。<br> 7、持久化存储（Persistent Storage）<br>     用于提供持久的存储卷，以供Pod使用。支持多种存储系统，如本地存储、iSCSI、NFS、Ceph等。<br> 8、网络插件（Network Plugins）<br>     用于为Kubernetes提供网络功能。不同的网络插件支持不同的网络模型和特性。<br> 9、Addon Manager<br>     负责管理和配置集群中的附加组件，如监控、日志记录等。</p> 
<h3 style="margin-left:0px;text-align:left;">二、k8s集群搭建以及高可用集群搭建</h3> 
<p style="margin-left:0;text-align:left;">1、准备环境：<br>     确保所有节点（物理机或虚拟机）的操作系统都是兼容的，通常使用Linux系统，如Ubuntu、CentOS等。<br> 每个节点都需要有一个唯一的MAC地址和主机名。<br> 2、安装Docker：<br> 在所有节点上安装Docker。Docker是Kubernetes用来运行容器的引擎。<br> 3、安装Kubeadm、Kubelet和Kubectl：<br> Kubeadm是一个工具，用于初始化和管理Kubernetes集群。<br> Kubelet是在集群中所有机器上运行的组件，负责启动Pod和容器等。<br> Kubectl是集群管理员和开发人员与集群通信的命令行工具。<br> 4、使用kubeadm创建集群：<br> 在主节点上运行kubeadm init命令来初始化集群。<br> 按照命令输出中的指示，配置kubectl，使其能够与集群通信。<br> 5、配置高可用集群：<br> 安装一个高可用性的存储解决方案，如etcd集群。<br> 配置负载均衡器，以便管理节点通信。<br> 6、加入节点：<br> 使用kubeadm join命令将工作节点加入到集群中。<br> 7、验证集群状态：<br> 使用kubectl get nodes命令来检查所有节点的状态。<br> 搭建高可用Kubernetes集群<br> 高可用Kubernetes集群的目的是确保集群的关键组件（如API服务器、etcd等）在面对故障时能够继续运行。<br> 8、增加集群组件的冗余：<br> 使用多个API服务器实例，通过负载均衡器提供服务。<br> 创建etcd集群，通常需要至少三台机器，以实现数据的冗余和故障转移。<br> 9、使用控制器管理器的高可用模式：<br> 配置控制器管理器以在多个节点上运行，确保即使一个节点失败，其他控制器管理器仍然可以继续工作。<br> 10、配置服务发现和负载均衡：<br> 使用高可用性的服务发现方案，如CoreDNS和Calico，确保服务即使在节点故障的情况下也能够正常发现和通信。<br> 11、灾难恢复计划：<br> 制定灾难恢复计划，包括备份集群状态、离线恢复等。<br> 12、监控和告警：<br> 安装监控工具，如Prometheus和Grafana，以及配置适当的告警规则，以便在集群出现问题时及时通知维护人员。</p> 
<p style="margin-left:0;text-align:left;"></p> 
<h3 style="margin-left:0px;text-align:left;">三、k8s部署业务</h3> 
<p style="margin-left:0;text-align:left;">1、准备环境：<br> 确保你有可用的Kubernetes集群。你可以使用Minikube或者一个云服务提供的Kubernetes服务，如阿里云、腾讯云等。<br> 安装并配置kubectl，这是Kubernetes的命令行工具，用于与集群进行通信。<br> 2、编写Dockerfile：<br> 为了在Kubernetes上部署你的应用程序，你首先需要将其容器化。创建一个Dockerfile来定义如何构建你的应用程序容器。<br> 3、构建镜像：<br> 使用Dockerfile构建你的应用程序镜像，并将其推送到容器镜像仓库中，如Docker Hub或Harbor。<br> 4、编写部署配置文件：<br> 创建Kubernetes配置文件（通常是YAML格式），定义你的应用部署的详细信息。这包括设置部署（Deployment）、服务（Service）、必要的 ConfigMap 和 Secret 对象等。<br> 5、部署应用：<br> 使用kubectl工具将配置应用到Kubernetes集群中。例如，通过执行kubectl apply -f &lt;配置文件&gt;.yaml来创建或更新资源。<br> 6、验证部署：<br> 检查应用程序的状态，确保它正在运行。可以使用kubectl get pods查看 pod 的状态，使用kubectl logs &lt;pod名称&gt;查看日志等。<br> 7、暴露服务：<br> 如果应用程序需要被外部访问，你需要配置一个Service（如LoadBalancer类型）来暴露它。在某些云平台上，这将自动创建一个外部可访问的负载均衡器。<br> 8、持续监控和管理：<br> 部署应用后，需要监控应用的性能和健康状态，并根据需要进行扩展或滚动更新。<br> 9、安全性：<br> 确保应用程序的安全，配置合适的网络策略、身份验证和授权机制。<br> 10、备份和灾难恢复：<br> 制定备份策略，确保数据的安全，同时设置灾难恢复方案以应对可能的问题。</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="848" src="https://images2.imgbox.com/6d/82/oGPUMgrf_o.png" width="1200"></p> 
<h3 style="margin-left:0px;text-align:left;">四、k8s集群常见问题</h3> 
<p style="margin-left:0;text-align:left;">1、我如何在腾讯云上创建一个新的K8s容器服务集群？<br>     在腾讯云上创建一个新的K8s容器服务集群，你需要首先登录到腾讯云，然后按照一些基本步骤进行操作，例如，为你的集群起一个名字，配置组件等。具体步骤可以参考腾讯云的官方文档。<br> 2、  如何部署一个ELK服务在k8s集群中？<br>      在k8s集群中部署ELK服务，即Elasticsearch、Logstash、Kibana这三者组成的日志管理系统。部署过程包括初始化宿主机，创建并配置ELK服务的命名空间，部署相关的配置文件，查看es服务是否正常启动等步骤。<br> 3、如何在k8s中删除一个master节点并重新加入集群？<br>      在k8s中，如果你想要删除一个master节点并重新加入集群，你可以按照以下步骤进行：首先，删除master节点的etcd，然后重置master的k8s，使其成为一个干净的节点。接下来，从etcd集群中删除master的成员身份，并在master上创建存放证书的目录。将其他控制节点的证书拷贝到master上，最后将master重新加入集群。<br> 注：master节点是k8s集群的重要组成部分，包含了API服务器、etcd等核心组件，所以在操作时需要备份数据并确保在新的master节点上重新安装并配置好所有需要的软件和证书。<br> 4、如何检查k8s集群的健康状态？<br>     检查k8s集群的健康状态通常有以下几种方式：<br> 节点健康指标：检查节点状态、资源利用率、网络连通性等。<br> Pod健康指标：关注Pod状态、容器状态、资源使用情况等。<br> 服务健康指标：关注服务的可用性、响应时间、错误率等。<br> 网络健康指标：检查集群的网络连通性、网络延迟、丢包率等。<br> 存储健康指标：包括持久卷状态、持久卷声明状态等。<br> 以上步骤可以通过使用kubectl命令和监控系统（如Prometheus）来完成。<br> 5、如何将本地应用部署至k8s集群？<br>      将本地应用部署至k8s集群通常需要以下步骤：部署集群镜像仓库，使用helm在k8s集群上安装docker的私有镜像仓库，向仓库推送镜像和拉取镜像，使用Dockerfile打包镜像等。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/48aff8a100a529cd6beef261d886751a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL数据库的基本概念与安装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/19a0aa00d0be9e3701cda3e71b2f224e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java注解类-导入Excel文件到数据库中</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>