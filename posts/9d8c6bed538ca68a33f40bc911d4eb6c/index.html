<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Pandas - A value is trying to be set on a copy of a slice from a DataFrame - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/9d8c6bed538ca68a33f40bc911d4eb6c/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Pandas - A value is trying to be set on a copy of a slice from a DataFrame">
  <meta property="og:description" content="(想要直接解决问题的请直接拉到最后)
使用的DataFrame的
yearstatepopdebtone2000Ohio1.5NaNtwo1000Ohio1.71000three2002Ohio3.6NaNfour2001Nevada2.4-1.5five2002Nevada2.9-1.7 当使用 frame2[&#39;year&#39;][&#39;two&#39;] = 10000, 即df名[列名][行名]的方式去赋值就会报错, 提示如下
SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame
See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
进入提示网页, 查找与SettingWithCopyWarning有关部分, 这里简单翻译了一下(渣翻译, 推荐大家去看原文, 在最后几部分里)
chained indexing
这就是出现警告的原因, 我们在使用pandas中要极力避免出现chained index)
下面是一个例子解释到底什么是chained indexing
In [4]: dfmi = pd.DataFrame([list(&#39;abcd&#39;), list(&#39;efgh&#39;), list(&#39;ijkl&#39;), list(&#39;mnop&#39;)], ...: columns=pd.MultiIndex.from_product([[&#39;one&#39;, &#39;two&#39;], [&#39;first&#39;, &#39;second&#39;]])) ...: In [5]: dfmi Out[5]: one two first second first second 0 a b c d 1 e f g h 2 i j k l 3 m n o p 我们通过两种不同的方式去访问同一值">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-05-22T21:24:16+08:00">
    <meta property="article:modified_time" content="2019-05-22T21:24:16+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Pandas - A value is trying to be set on a copy of a slice from a DataFrame</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>(想要直接解决问题的请直接拉到最后)</p> 
<p>使用的DataFrame的</p> 
<table cellspacing="0" style="width:260pt;"><tbody><tr><td style="vertical-align:bottom;width:52pt;"> </td><td style="vertical-align:bottom;width:52pt;"><span style="color:#000000;">year</span></td><td style="vertical-align:bottom;width:52pt;"><span style="color:#000000;">state</span></td><td style="vertical-align:bottom;width:52pt;"><span style="color:#000000;">pop</span></td><td style="vertical-align:bottom;width:52pt;"><span style="color:#000000;">debt</span></td></tr><tr><td style="vertical-align:bottom;"><span style="color:#000000;">one</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">2000</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">Ohio</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">1.5</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">NaN</span></td></tr><tr><td style="vertical-align:bottom;"><span style="color:#000000;">two</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">1000</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">Ohio</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">1.7</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">1000</span></td></tr><tr><td style="vertical-align:bottom;"><span style="color:#000000;">three</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">2002</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">Ohio</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">3.6</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">NaN</span></td></tr><tr><td style="vertical-align:bottom;"><span style="color:#000000;">four</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">2001</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">Nevada</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">2.4</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">-1.5</span></td></tr><tr><td style="vertical-align:bottom;"><span style="color:#000000;">five</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">2002</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">Nevada</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">2.9</span></td><td style="vertical-align:bottom;"><span style="color:#000000;">-1.7</span></td></tr></tbody></table> 
<p> </p> 
<p>当使用 frame2['year']['two'] = 10000, 即df名[列名][行名]的方式去赋值就会报错, 提示如下</p> 
<p>SettingWithCopyWarning:<br> A value is trying to be set on a copy of a slice from a DataFrame</p> 
<p>See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy</p> 
<p>进入提示网页, 查找与SettingWithCopyWarning有关部分, 这里简单翻译了一下(渣翻译, 推荐大家去看原文, 在最后几部分里)</p> 
<blockquote> 
 <p style="margin-left:0in;">chained indexing</p> 
 <p style="margin-left:0in;">这就是出现警告的原因, 我们在使用pandas中要极力避免出现chained index)</p> 
</blockquote> 
<p style="margin-left:0in;">下面是一个例子解释到底什么是chained indexing</p> 
<pre class="has"><code class="language-python">	In [4]: dfmi = pd.DataFrame([list('abcd'), list('efgh'), list('ijkl'), list('mnop')],
	   ...:                     columns=pd.MultiIndex.from_product([['one', 'two'], ['first', 'second']]))
	   ...:
	
	In [5]: dfmi
	Out[5]:
	    one          two
	  first second first second
	0     a      b     c      d
	1     e      f     g      h
	2     i      j     k      l
	3     m      n     o      p
</code></pre> 
<p>我们通过两种不同的方式去访问同一值</p> 
<pre class="has"><code>	#第一种方式
        In [6]: dfmi['one']['second']
	Out[6]:
	0    b
	1    f
	2    j
	3    n
	Name: second, dtype: object
	
        #第二种方式
	In [7]: dfmi.loc[:,('one', 'second')]
	Out[7]:
	0    b
	1    f
	2    j
	3    n
	Name: (one, second), dtype: object
</code></pre> 
<p>可以看出虽然访问方式不同, 但是返回的结果是相同的. 相同结果, 但其实第二种访问方式应该是我们所推荐使用的, 原因如下</p> 
<blockquote> 
 <p style="margin-left:0in;">第一种访问方式</p> 
</blockquote> 
<p style="margin-left:0in;">使用dfmi['one']['second']其实是分为两个独立事件完成的, 一个事情接着一件事情发生:</p> 
<p style="text-indent:50px;">第一步 执行dfmi['one']</p> 
<p style="text-indent:50px;">第二步 在第一步的基础上执行dfmi_with_one['second'], 相当于在第一步返回Series基础上, 检索索引['second']</p> 
<p style="text-indent:0;">看似是一步到位的访问, 其实在内部调用了两次__getitem__</p> 
<blockquote> 
 <p style="text-indent:0;">第二种方式访问</p> 
</blockquote> 
<p style="margin-left:0in;">fmi.loc[:,('one', 'second')] 相当于将一个嵌套的元组(slice(None), ('one', 'second'))传递给一个__getitem__, 这就使得pandas将其作为一个整体来处理, 第二种方式比第一种方式速度更快</p> 
<hr> 
<p style="margin-left:0in;">这里的第一种访问方式就是chained indexing, 接下来解决为什么chained indexing会造成警告.</p> 
<pre class="has"><code class="language-python">		#第二种访问方式(推荐方式)
                dfmi.loc[:, ('one', 'second')] = value
		#其实在编译器中是这样操作的
		dfmi.iloc.setitem((slice(None), ('one', 'second')), value)
		
		#但是这一段代码编译器处理就很不同了
        
                #第一种访问方式chained indexing
		dfmi['one']['second'] = value
		#其实在编译器中是这样操作的
		dfmi.__getitem__('one').__setitem__('second', value)
</code></pre> 
<p style="margin-left:0in;">问题的关键就出在这里的__getitem__上, 因为我们很难预测到这里的__getitem__返回的是一个视图或是一个copy, 因为我们无法确定__setitem))修改的到底是真实的dfmi或是暂时的copy副本, 这就是<span style="color:#3e4349;">SettingWithCopy</span>想要警告我们的.</p> 
<p style="margin-left:0in;">到此问题就算是解决了, 出现警告的原因在于无法预测到底修改的是视图还是副本.</p> 
<blockquote> 
 <p style="margin-left:0in;">注意</p> 
 <p style="margin-left:0in;">dfmi.loc保证是dfmi本身伴随修改索引行为(这句话有点不太通顺, 大家可以去看看原文, 重点是后面一句), 所以dfmi.loc.__getitem__和dfmi.loc__setitem__方法一定是直接作用在dfmi上的. 当然dfmi.loc.__getitem__(idx)就无法预测到时作用在视图上或是副本上了.</p> 
</blockquote> 
<p style="margin-left:0in;">另一种会出现这种警告的情形, 虽然这里并没有明显的链式索引.</p> 
<pre class="has"><code class="language-python">	In [9]: def do_something(df):
	   ...:     foo = df[['bar', 'baz']]
	   ...:     #对于foo是视图或是副本, 其实我们是无法得知的
	   ...:     foo['quux'] = value
	   ...:     return foo
</code></pre> 
<hr> 
<p>解决警告的方案:</p> 
<p style="text-indent:50px;">使用 DafaFrameming.loc[行名, 列名] = 值 的方式去赋值, 而不是使用DataFrame[][]的形式去赋值.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/776ba128391469082af32c108d3f2adf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux系统挂起进程的几种方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0451ddccdb9897b36b3d37a43b2abe9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信公众平台服务号配置JS接口安全域名</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>