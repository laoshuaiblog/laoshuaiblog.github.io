<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>el-admin前端学习笔记 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/a9439864aac3d1a19b952b0b9753c1a2/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="el-admin前端学习笔记">
  <meta property="og:description" content="###　1.用v-permission代替v-if，即使用自定义指令代替v-if
###　2.路由跳转发起get请求的流程
views/xxx/index.vue
cruds() { return CRUD({ title: &#34;部署&#34;, url: &#34;api/deploy&#34;, crudMethod: { ...crudDeploy }, }); }, components/Crud/crud.js
created() { for (const k in this.$crud) { if (this.$crud[k].queryOnPresenterCreated) { // 默认查询 this.$crud[k].toQuery() } } }, // 搜索 toQuery() { crud.page.page = 1 crud.refresh() }, // 刷新 refresh() { if (!callVmHook(crud, CRUD.HOOK.beforeRefresh)) { return } return new Promise((resolve, reject) =&amp;gt; { crud.loading = true // 请求数据 initData(crud.url, crud.getQueryParams()).then(res =&amp;gt; { // console.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-03-07T22:29:24+08:00">
    <meta property="article:modified_time" content="2021-03-07T22:29:24+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">el-admin前端学习笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>###　1.用v-permission代替v-if，即使用自定义指令代替v-if</p> 
<p>###　2.路由跳转发起get请求的流程</p> 
<p>views/xxx/index.vue</p> 
<pre><code class="prism language-javascript"><span class="token function">cruds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token constant">CRUD</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      title<span class="token punctuation">:</span> <span class="token string">"部署"</span><span class="token punctuation">,</span>
      url<span class="token punctuation">:</span> <span class="token string">"api/deploy"</span><span class="token punctuation">,</span>
      crudMethod<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span>crudDeploy <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>components/Crud/crud.js</p> 
<pre><code class="prism language-javascript"><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> k <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$crud<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$crud<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>queryOnPresenterCreated<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 默认查询</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$crud<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 搜索</span>
    <span class="token function">toQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        crud<span class="token punctuation">.</span>page<span class="token punctuation">.</span>page <span class="token operator">=</span> <span class="token number">1</span>
        crud<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 刷新</span>
        <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>beforeRefresh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                crud<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token comment">// 请求数据</span>
                <span class="token function">initData</span><span class="token punctuation">(</span>crud<span class="token punctuation">.</span>url<span class="token punctuation">,</span> crud<span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// console.log(123456)</span>
                    <span class="token comment">// console.log(res)</span>
                    <span class="token keyword">const</span> table <span class="token operator">=</span> crud<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>table <span class="token operator">&amp;&amp;</span> table<span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 懒加载子节点数据，清掉已加载的数据</span>
                        table<span class="token punctuation">.</span>store<span class="token punctuation">.</span>states<span class="token punctuation">.</span>treeData <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
                        table<span class="token punctuation">.</span>store<span class="token punctuation">.</span>states<span class="token punctuation">.</span>lazyTreeNodeMap <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    crud<span class="token punctuation">.</span>page<span class="token punctuation">.</span>total <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pages <span class="token operator">===</span> undefined <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>total
                    crud<span class="token punctuation">.</span>data <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pages <span class="token operator">===</span> undefined <span class="token operator">?</span> res<span class="token punctuation">.</span>data <span class="token punctuation">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>records
                    crud<span class="token punctuation">.</span><span class="token function">resetDataStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token comment">// time 毫秒后显示表格</span>
                    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                        crud<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
                        <span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>afterRefresh<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span> crud<span class="token punctuation">.</span>time<span class="token punctuation">)</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                    crud<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

</code></pre> 
<p>api/data.js</p> 
<pre><code class="prism language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initData</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token punctuation">:</span> url <span class="token operator">+</span> <span class="token string">'?'</span> <span class="token operator">+</span> qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> indices<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    method<span class="token punctuation">:</span> <span class="token string">'get'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3_77"></a>3.添加按钮发起请求流程</h4> 
<p>components/Crud/CRUD.operation.vue</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>el<span class="token operator">-</span>button
    v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"crud.optShow.add"</span>
    v<span class="token operator">-</span>permission<span class="token operator">=</span><span class="token string">"permission.add"</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"filter-item"</span>
    size<span class="token operator">=</span><span class="token string">"mini"</span>
    type<span class="token operator">=</span><span class="token string">"primary"</span>
    icon<span class="token operator">=</span><span class="token string">"el-icon-plus"</span>
    @click<span class="token operator">=</span><span class="token string">"crud.toAdd"</span>
    <span class="token operator">&gt;</span>
        新增
<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token constant">CRUD</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> crud <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@crud/crud'</span>

</code></pre> 
<p>component/Crud/crud.js</p> 
<pre><code class="prism language-javascript"><span class="token function">toAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      crud<span class="token punctuation">.</span><span class="token function">resetForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>beforeToAdd<span class="token punctuation">,</span> crud<span class="token punctuation">.</span>form<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> 				<span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>beforeToCU<span class="token punctuation">,</span> crud<span class="token punctuation">.</span>form<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      crud<span class="token punctuation">.</span>status<span class="token punctuation">.</span>add <span class="token operator">=</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">STATUS</span><span class="token punctuation">.</span><span class="token constant">PREPARED</span>
      <span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>afterToAdd<span class="token punctuation">,</span> crud<span class="token punctuation">.</span>form<span class="token punctuation">)</span>
      <span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>afterToCU<span class="token punctuation">,</span> crud<span class="token punctuation">.</span>form<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">/**
     * 重置表单
     * @param {Array} data 数据
     */</span>
        <span class="token function">resetForm</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> form <span class="token operator">=</span> data <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> crud<span class="token punctuation">.</span>defaultForm <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>crud<span class="token punctuation">.</span>defaultForm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> crud<span class="token punctuation">.</span>defaultForm<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>crud<span class="token punctuation">.</span><span class="token function">findVM</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> crudFrom <span class="token operator">=</span> crud<span class="token punctuation">.</span>form
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> form<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>crudFrom<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    crudFrom<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> form<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    Vue<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>crudFrom<span class="token punctuation">,</span> key<span class="token punctuation">,</span> form<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// hook VM</span>
<span class="token keyword">function</span> <span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> hook<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>crud<span class="token punctuation">.</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'callVmHook: '</span> <span class="token operator">+</span> hook<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> tagHook <span class="token operator">=</span> crud<span class="token punctuation">.</span>tag <span class="token operator">?</span> hook <span class="token operator">+</span> <span class="token string">'$'</span> <span class="token operator">+</span> crud<span class="token punctuation">.</span>tag <span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">const</span> nargs <span class="token operator">=</span> <span class="token punctuation">[</span>crud<span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    nargs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 有些组件扮演了多个角色，调用钩子时，需要去重</span>
  <span class="token keyword">const</span> vmSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  crud<span class="token punctuation">.</span>vms<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>vm <span class="token operator">=&gt;</span> vm <span class="token operator">&amp;&amp;</span> vmSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>vm<span class="token punctuation">)</span><span class="token punctuation">)</span>
  vmSet<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>vm <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">[</span>hook<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      ret <span class="token operator">=</span> vm<span class="token punctuation">[</span>hook<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> nargs<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> ret
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tagHook <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">[</span>tagHook<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      ret <span class="token operator">=</span> vm<span class="token punctuation">[</span>tagHook<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> nargs<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> ret
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> ret
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="4_150"></a>4.添加部署实现</h4> 
<p>新增编辑前做的操作</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> crudDeploy <span class="token keyword">from</span> <span class="token string">"@/api/mnt/deploy"</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>beforeToCU<span class="token punctuation">]</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> form<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> deploys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      form<span class="token punctuation">.</span>deploys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>deploy<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        deploys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>deploy<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>deploys <span class="token operator">=</span> deploys<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
        
<span class="token function">initSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      crudDeploy<span class="token punctuation">.</span><span class="token function">getApps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>apps <span class="token operator">=</span> res<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      crudDeploy<span class="token punctuation">.</span><span class="token function">getServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>servers <span class="token operator">=</span> res<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
        
</code></pre> 
<p>api/mnt/deploy.js</p> 
<pre><code>export function getApps() {
  return request({
    url: 'api/app',
    method: 'get'
  })
}

export function getServers() {
  return request({
    url: 'api/server-deploy',
    method: 'get'
  })
}
</code></pre> 
<p>点击提交前</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span><span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>beforeSubmit<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> deploys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>deploys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> deploy <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> id<span class="token punctuation">:</span> data <span class="token punctuation">}</span><span class="token punctuation">;</span>
        deploys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>deploy<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>deploys <span class="token operator">=</span> deploys<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
     
</code></pre> 
<p>提交</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>el<span class="token operator">-</span>button
          <span class="token punctuation">:</span>loading<span class="token operator">=</span><span class="token string">"crud.status.cu === 2"</span>
          type<span class="token operator">=</span><span class="token string">"primary"</span>
          @click<span class="token operator">=</span><span class="token string">"crud.submitCU"</span>
          <span class="token operator">&gt;</span>确认<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token constant">CRUD</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> presenter<span class="token punctuation">,</span> header<span class="token punctuation">,</span> form<span class="token punctuation">,</span> crud <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@crud/crud"</span><span class="token punctuation">;</span>
<span class="token comment">/**
     * 提交新增/编辑
     */</span>
<span class="token operator">/</span>components<span class="token operator">/</span>Crud<span class="token operator">/</span>crud<span class="token punctuation">.</span>js

<span class="token function">submitCU</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>beforeValidateCU<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    crud<span class="token punctuation">.</span><span class="token function">findVM</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">'form'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>valid <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>afterValidateCU<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>crud<span class="token punctuation">.</span>status<span class="token punctuation">.</span>add <span class="token operator">===</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">STATUS</span><span class="token punctuation">.</span><span class="token constant">PREPARED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            crud<span class="token punctuation">.</span><span class="token function">doAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>crud<span class="token punctuation">.</span>status<span class="token punctuation">.</span>edit <span class="token operator">===</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">STATUS</span><span class="token punctuation">.</span><span class="token constant">PREPARED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            crud<span class="token punctuation">.</span><span class="token function">doEdit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">doAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>beforeSubmit<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      crud<span class="token punctuation">.</span>status<span class="token punctuation">.</span>add <span class="token operator">=</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">STATUS</span><span class="token punctuation">.</span><span class="token constant">PROCESSING</span>
      crud<span class="token punctuation">.</span>crudMethod<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>crud<span class="token punctuation">.</span>form<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        crud<span class="token punctuation">.</span>status<span class="token punctuation">.</span>add <span class="token operator">=</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">STATUS</span><span class="token punctuation">.</span><span class="token constant">NORMAL</span>
        crud<span class="token punctuation">.</span><span class="token function">resetForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        crud<span class="token punctuation">.</span><span class="token function">addSuccessNotify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>afterSubmit<span class="token punctuation">)</span>
        crud<span class="token punctuation">.</span><span class="token function">toQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        crud<span class="token punctuation">.</span>status<span class="token punctuation">.</span>add <span class="token operator">=</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">STATUS</span><span class="token punctuation">.</span><span class="token constant">PREPARED</span>
        <span class="token function">callVmHook</span><span class="token punctuation">(</span>crud<span class="token punctuation">,</span> <span class="token constant">CRUD</span><span class="token punctuation">.</span><span class="token constant">HOOK</span><span class="token punctuation">.</span>afterAddError<span class="token punctuation">)</span><span class="token number">2332342442</span>we
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
    
crudMethod<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    add<span class="token punctuation">:</span> <span class="token punctuation">(</span>form<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    del<span class="token punctuation">:</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    edit<span class="token punctuation">:</span> <span class="token punctuation">(</span>form<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">/</span>views<span class="token operator">/</span>xxx<span class="token operator">/</span>index<span class="token punctuation">.</span>vue
<span class="token function">cruds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token constant">CRUD</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      title<span class="token punctuation">:</span> <span class="token string">"部署"</span><span class="token punctuation">,</span>
      url<span class="token punctuation">:</span> <span class="token string">"api/deploy"</span><span class="token punctuation">,</span>
      crudMethod<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span>crudDeploy <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
      
<span class="token operator">/</span>api<span class="token operator">/</span>mnt<span class="token operator">/</span>deploy<span class="token punctuation">.</span>js
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token punctuation">:</span> <span class="token string">'api/deploy'</span><span class="token punctuation">,</span>
    method<span class="token punctuation">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
    data
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


</code></pre> 
<h4><a id="5_286"></a>5.查询服务器和项目记录</h4> 
<pre><code class="prism language-vue">发起获取数据的请求，响应到数据中的res.data.records中 
crudDeploy.getApps().then((res) =&gt; {
        this.apps = res.data.records
      })
      crudDeploy.getServers().then((res) =&gt; {
        this.servers = res.data.records
      })

</code></pre> 
<h4><a id="6_299"></a>6.组件挂载</h4> 
<p>自动挂载</p> 
<pre><code class="prism language-vue">var app=new Vue({
	el:'#app-3',
	data:{
	seen:true
	}
})
</code></pre> 
<p>手动挂载</p> 
<pre><code class="prism language-vue">//可以实现延迟按需挂载
&lt;p id="app"&gt;
    {<!-- -->{name}}
&lt;/p&gt;
&lt;button οnclick="test()"&gt;挂载
&lt;/button&gt;
&lt;script&gt;
 var obj= {name: '张三'}
 var vm = new Vue({
 	data: obj
 })
 function test() {
 vm.$mount("#app");
 }
&lt;/script&gt;
</code></pre> 
<pre><code class="prism language-vue">// Vue.extend()创建没有挂载的的子类,可以使用该子累创建多个实例  
var app= Vue.extend({
template: '{<!-- -->{message}}',
 data: function () {
 return {
  message: 'message'
  }
 }
 })
new app().$mount('#app') // 创建 app实例，并挂载到一个元素上
</code></pre> 
<h4><a id="7_347"></a>7.无法加载验证码</h4> 
<p>①看控制台请求是否返回，查看状态码</p> 
<p>②查看响应拦截器</p> 
<p>③询问后端返回的状态码是否和前端响应处理的一致</p> 
<h4><a id="8_355"></a>8.路由跳转的四种方式及区别</h4> 
<h5><a id="1routerlink_357"></a>1）router-link</h5> 
<pre><code class="prism language-vue">1. 不带参数
 &lt;router-link :to="{name:'home'}"&gt; 
&lt;router-link :to="{path:'/home'}"&gt; //name,path都行, 建议用name 
// 注意：router-link中链接如果是'/'开始就是从根路由开始，如果开始不带'/'，则从当前路由开始。
 2.带参数
 &lt;router-link :to="{name:'home', params: {id:1}}"&gt; 
// params传参数 (类似post)
// 路由配置 path: "/home/:id" 或者 path: "/home:id" 
// 不配置path ,第一次可请求,刷新页面id会消失
// 配置path,刷新页面id会保留
// html 取参 $route.params.id
// script 取参 this.$route.params.id
&lt;router-link :to="{name:'home', query: {id:1}}"&gt; 
// query传参数 (类似get,url后面会显示参数)
// 路由可不配置
// html 取参 $route.query.id
// script 取参 this.$route.query.id
</code></pre> 
<h5><a id="2thisrouterpush_379"></a>2)函数中调用this.$router.push()</h5> 
<pre><code class="prism language-javascript"><span class="token number">1.</span> 不带参数
 <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">:</span><span class="token string">'home'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>path<span class="token punctuation">:</span><span class="token string">'/home'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token number">2.</span> query传参 
 <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">:</span><span class="token string">'home'</span><span class="token punctuation">,</span>query<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>id<span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>path<span class="token punctuation">:</span><span class="token string">'/home'</span><span class="token punctuation">,</span>query<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>id<span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// html 取参 $route.query.id</span>
<span class="token comment">// script 取参 this.$route.query.id</span>
<span class="token number">3.</span> params传参
 <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">:</span><span class="token string">'home'</span><span class="token punctuation">,</span>params<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>id<span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 只能用 name</span>
 
<span class="token comment">// 路由配置 path: "/home/:id" 或者 path: "/home:id" ,</span>
<span class="token comment">// 不配置path ,第一次可请求,刷新页面id会消失</span>
<span class="token comment">// 配置path,刷新页面id会保留</span>
<span class="token comment">// html 取参 $route.params.id</span>
<span class="token comment">// script 取参 this.$route.params.id</span>
<span class="token number">4.</span> query和params区别
query类似 <span class="token keyword">get</span><span class="token punctuation">,</span> 跳转之后页面 url后面会拼接参数<span class="token punctuation">,</span>类似<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> 非重要性的可以这样传<span class="token punctuation">,</span> 密码之类还是用params刷新页面id还在
 params类似 post<span class="token punctuation">,</span> 跳转之后页面 url后面不会拼接参数 <span class="token punctuation">,</span> 但是刷新页面id 会消失
</code></pre> 
<h5><a id="3thisrouterreplace_404"></a>3)this.$router.replace()用法同上</h5> 
<p>repalace和push的区别：push跳转后会向history栈中添加一个记录，而replace不会，点击后退会跳转到上上个页面。</p> 
<h5><a id="4thisroutergon_408"></a>4)this.$router.go(n)</h5> 
<p>n代表向前或向后跳转几个页面，正数为前，负数为后</p> 
<h4><a id="9elselection_412"></a>9.el-selection绑定多个值</h4> 
<p>v-model=“value”</p> 
<p>使用：value="item.label+’/’+item.value "</p> 
<p>value.split(’/’)[0]</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0dc5562c65de0419077ce7daee2bb625/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Session 简单的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ad495433e7520bc2460cc1f5d3204739/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue学习笔记 单向数据流机制</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>