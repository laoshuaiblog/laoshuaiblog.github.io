<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在 SQL 中计算总行数的百分比 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/8cdc4517eeec904eaffef316ad30d26f/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="在 SQL 中计算总行数的百分比">
  <meta property="og:description" content="很多时候，你会希望知道一行（或一组行）在总行数所占的比重。换句话说，即是一行占总计数的百分比是多少。为了说明这一点，让我们看看以下显示在 Navicat Premium 16 中的表：
通过结合 count() 函数和 Group By 子句，我们可以很容易地找出每种水果有多少订单：
那么现在我们如何查看每种水果的订单占订单总数的百分比？事实上，在 SQL 中计算行百分比有三种标准方法。他们是：
使用 OVER() 子句使用子查询使用公用表表达式，或 CTE 本文的其余部分将依次探讨其中的每一种。
OVER() 子句 OVER 子句主要与窗口函数一起使用，用于确定将查询中的哪些行应用于函数、该函数以什么顺序计算这些行以及何时重新开始函数的计算。
OVER 子句是 SQL 中计算行百分比的最有效方法，因此如果你最着重效率，它应该是你的首选。以下是获得百分比的公式：
count(*) * 100.0 / sum(count(*)) over() 将上述 SQL 添加到原本的查询中会产生以下结果：
看起来不错，但稍微四舍五入也没什么坏处。不幸的是，使用 over() 子句并不容易做到这一点。也许下一个选项会更适合你。
使用子查询 并非所有数据库都支持 OVER() 子句，因此子查询方法可能是非常有用的后备解决方案。它有时被称为“通用解决方案”，因为它适用于所有数据库。这种方法的另一个好处是它是最易与 Round() 等函数合并使用。以下是我们需要添加到查询中的内容：
count(*) * 100.0 / (select count(*) from &amp;lt;YourTable&amp;gt;) 以下是实行的通用解决方案：
使用公用表表达式（CTE） With common_table_expression 子句指定一个临时命名结果集，称为公用表表达式（CTE）。然后，我们可以从临时结果集中进行选择，以将更多函数应用于检索到的字段。在我们的例子中，我们可以将 sum() 函数应用于计数以得到百分比：
请记住，这种方法效率最低，因为 CTE 基本上针对内部（初始）查询的结果运行第二个查询。话虽如此，有时你可能需要使用 CTE 执行无法一次轻松完成的额外处理。
总结 在这篇文章中，我们学习了三种方法来表示一行（或一组行）在总行数所占的比重。每种方法都有自己的优点和缺点，因此你必须根据自己的具体要求选择。如果你想试用 Navicat 16，可以在这里下载 Navicat 的 14 天全功能免费试用版。">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-05-25T13:39:35+08:00">
    <meta property="article:modified_time" content="2023-05-25T13:39:35+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在 SQL 中计算总行数的百分比</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>很多时候，你会希望知道一行（或一组行）在总行数所占的比重。换句话说，即是一行占总计数的百分比是多少。为了说明这一点，让我们看看以下显示在 <a href="https://link.zhihu.com/?target=https%3A//navicat.com.cn/products/navicat-premium" rel="nofollow" title="Navicat Premium 16">Navicat Premium 16</a> 中的表：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d3/b0/14oZw6gU_o.png"></p> 
<p>通过结合 count() 函数和 Group By 子句，我们可以很容易地找出每种水果有多少订单：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f2/3f/ymhwhWgV_o.png"></p> 
<p>那么现在我们如何查看每种水果的订单占订单总数的百分比？事实上，在 SQL 中计算行百分比有三种标准方法。他们是：</p> 
<ul><li>使用 OVER() 子句</li><li>使用子查询</li><li>使用公用表表达式，或 CTE</li></ul> 
<p>本文的其余部分将依次探讨其中的每一种。</p> 
<h3></h3> 
<h3>OVER() 子句</h3> 
<p>OVER 子句主要与窗口函数一起使用，用于确定将查询中的哪些行应用于函数、该函数以什么顺序计算这些行以及何时重新开始函数的计算。</p> 
<p>OVER 子句是 SQL 中计算行百分比的最有效方法，因此如果你最着重效率，它应该是你的首选。以下是获得百分比的公式：</p> 
<pre><code>count(*) * 100.0 / sum(count(*)) over()
</code></pre> 
<p>将上述 SQL 添加到原本的查询中会产生以下结果：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a1/cb/aqgL6QLT_o.png"></p> 
<p>看起来不错，但稍微四舍五入也没什么坏处。不幸的是，使用 over() 子句并不容易做到这一点。也许下一个选项会更适合你。</p> 
<h3></h3> 
<h3>使用子查询</h3> 
<p>并非所有数据库都支持 OVER() 子句，因此子查询方法可能是非常有用的后备解决方案。它有时被称为“通用解决方案”，因为它适用于所有数据库。这种方法的另一个好处是它是最易与 Round() 等函数合并使用。以下是我们需要添加到查询中的内容：</p> 
<pre><code>count(*) * 100.0 / (select count(*) from &lt;YourTable&gt;)
</code></pre> 
<p>以下是实行的通用解决方案：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c7/39/9ueRKdDK_o.png"></p> 
<h3></h3> 
<h3>使用公用表表达式（CTE）</h3> 
<p><em>With common_table_expression</em> 子句指定一个临时命名结果集，称为公用表表达式（CTE）。然后，我们可以从临时结果集中进行选择，以将更多函数应用于检索到的字段。在我们的例子中，我们可以将 sum() 函数应用于计数以得到百分比：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/27/f4/RnZnIi3L_o.png"></p> 
<p>请记住，这种方法效率最低，因为 CTE 基本上针对内部（初始）查询的结果运行第二个查询。话虽如此，有时你可能需要使用 CTE 执行无法一次轻松完成的额外处理。</p> 
<h3></h3> 
<h3>总结</h3> 
<p>在这篇文章中，我们学习了三种方法来表示一行（或一组行）在总行数所占的比重。每种方法都有自己的优点和缺点，因此你必须根据自己的具体要求选择。如果你想试用 Navicat 16，可以在<a href="https://link.zhihu.com/?target=https%3A//navicat.com.cn/download/navicat-premium" rel="nofollow" title="这里">这里</a>下载 Navicat 的 14 天全功能免费试用版。</p> 
<h2></h2> 
<h3>往期回顾 </h3> 
<ol><li><a href="https://navicat.blog.csdn.net/article/details/130426124?spm=1001.2014.3001.5502" rel="nofollow" title="招募 Navicat Monitor 3.0 监控工具体验官 | 好礼相送">招募 Navicat Monitor 3.0 监控工具体验官 | 好礼相送</a></li><li><a href="https://blog.csdn.net/weixin_53935287/article/details/130522780" title="保姆级教程 | Navicat 人工备份和自动备份">保姆级教程 | Navicat 人工备份和自动备份</a></li><li><a href="https://navicat.blog.csdn.net/article/details/129324609?spm=1001.2014.3001.5502" rel="nofollow" title="Navicat 16 正式支持 OceanBase 全线数据库产品">Navicat 16 正式支持 OceanBase 全线数据库产品</a></li><li><a href="https://navicat.blog.csdn.net/article/details/128829336?spm=1001.2014.3001.5502" rel="nofollow" title="Navicat 16 即将支持 Redis">Navicat 16 即将支持 Redis</a></li><li><a href="https://blog.csdn.net/weixin_53935287/article/details/125031037?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167150648216800213076548%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=167150648216800213076548&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-125031037-null-null.nonecase&amp;utm_term=%E8%AF%95%E7%94%A8&amp;spm=1018.2226.3001.4450" title="免费试用 Navicat 16">免费试用 Navicat 16</a></li><li><a href="https://blog.csdn.net/weixin_53935287/article/details/127243790?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167150641216782427436473%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=167150641216782427436473&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-127243790-null-null.nonecase&amp;utm_term=%E5%8F%91%E5%B1%95%E5%8F%B2&amp;spm=1018.2226.3001.4450" title="Navicat 20年发展史 | 1999 年成立于中国香港">Navicat 20年发展史 | 1999 年成立于中国香港</a></li><li><a href="https://blog.csdn.net/weixin_53935287/article/details/125227028?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167150658816782427454355%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=167150658816782427454355&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-125227028-null-null.nonecase&amp;utm_term=SQL%20%E8%AF%AD%E5%8F%A5%E4%B8%AD%20WHERE%201%3D1%20%E7%9A%84%E4%BD%9C%E7%94%A8&amp;spm=1018.2226.3001.4450" title="SQL 语句中 WHERE 1=1 的作用">SQL 语句中 WHERE 1=1 的作用</a></li><li><a href="https://blog.csdn.net/Ajekseg/article/details/126081039?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167150662116800211578163%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167150662116800211578163&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-126081039-null-null.142%5Ev68%5Epc_rank_34_queryrelevant25,201%5Ev4%5Eadd_ask,213%5Ev2%5Et3_control1&amp;utm_term=SQL%20%E4%B8%AD%E8%AE%A1%E7%AE%97%E6%80%BB%E8%A1%8C%E6%95%B0%E7%9A%84%E7%99%BE%E5%88%86%E6%AF%94&amp;spm=1018.2226.3001.4187" title="SQL 中计算总行数的百分比">SQL 中计算总行数的百分比</a></li><li><a href="https://blog.csdn.net/weixin_53935287/article/details/125448236?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167150664416782425152993%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=167150664416782425152993&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-125448236-null-null.nonecase&amp;utm_term=%E4%BA%92%E5%8A%A8%E6%9C%89%E7%A4%BC&amp;spm=1018.2226.3001.4450" title="互动有礼活动进行中 | 奖品为价值 819 元 Navicat Premium">互动有礼活动进行中 | 奖品为价值 819 元 Navicat Premium</a></li><li><a href="https://navicat.blog.csdn.net/article/details/128292320" rel="nofollow" title="假冒网站引发多重安全风险 | 官方严正声明：切勿在非官方渠道购买或下载 Navicat 软件">假冒网站引发多重安全风险 | 官方严正声明：切勿在非官方渠道购买或下载 Navicat 软件</a></li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6945d4217de54947f9964e39a068852/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于C语言的哈夫曼树的实现(包含完整代码)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/89bf696e7c58278dfc1c71c44b26074f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL 语句中 WHERE 1=1 的作用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>