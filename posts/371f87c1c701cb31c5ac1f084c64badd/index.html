<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>netstat 命令详解 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/371f87c1c701cb31c5ac1f084c64badd/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="netstat 命令详解">
  <meta property="og:description" content="文章目录 简介命令格式常用选项常用命令查询进程所占用的端口号查看端口号的使用情况显示所有连接和监听端口并显示每个连接相关的进程ID显示UDP、TCP协议的连接的统计信息并显示每个连接相关的进程 ID显示所有已建立的连接显示每个进程的连接数显示每个IP地址的连接数显示每种类型TCP/UDP的连接数显示每种网络状态的数量显示指定进程ID网络状态的数量显示端口占用数量显示指定进程ID指定协议的数量 网络状态 简介 netstat 命令是 Linux 系统中一个非常常用的网络工具，用于查询和统计网络连接的状态和数据传输情况。在网络故障排除和性能调优中，netstat 命令是必不可少的工具之一。本文将详细介绍 netstat 命令的常用参数及其用法。
命令格式 netstat [-a] [-c] [-e] [-f] [-i] [-n] [-o] [-p protocol] [-r] [-s] [-t] [-u] [interval]
常用选项 netstat 命令的常用选项如下：
-a（all）：显示所有连接状态，包括 TCP、UDP 和 Unix 域套接字； -t（tcp）：显示 TCP 连接状态；-u（udp）：显示 UDP 连接状态；-x：列出所有unix端口 -c（continuous）：连续显示网络状态信息。按 Ctrl &#43; C 结束。-e（extend）：显示网络统计信息。包括网络接口、协议等。-f：显示外部地址的完全限定域名（FQDN）。-i：显示网络接口信息。-n：以数字形式显示地址和端口号。-o：显示与每个连接相关的进程 ID。-p protocol：显示特定协议（tcp、udp 或 icmp）的连接。-r：显示路由表。-s：显示网络统计信息。包括网络接口、协议等。-t：显示 TCP 协议的连接。-u：显示 UDP 协议的连接。interval：指定连续显示网络状态信息的时间间隔（单位为秒）。 常用命令 查询进程所占用的端口号 netstat -ano | grep 进程ID 查看端口号的使用情况 netstat -ano | grep 端口号 显示所有连接和监听端口并显示每个连接相关的进程ID netstat -ano 显示UDP、TCP协议的连接的统计信息并显示每个连接相关的进程 ID netstat -so -p udp netstat -so -p tcp IPv4 的 TCP 统计信息 主动开放 = 8055 被动开放 = 1136 失败的连接尝试 = 2469 重置连接 = 1712 当前连接 = 67 接收的分段 = 2473796 发送的分段 = 454254 重新传输的分段 = 10493 活动连接 协议 本地地址 外部地址 状态 PID TCP 127.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-03-10T14:52:41+08:00">
    <meta property="article:modified_time" content="2023-03-10T14:52:41+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">netstat 命令详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">简介</a></li><li><a href="#_5" rel="nofollow">命令格式</a></li><li><a href="#_9" rel="nofollow">常用选项</a></li><li><a href="#_30" rel="nofollow">常用命令</a></li><li><ul><li><a href="#_32" rel="nofollow">查询进程所占用的端口号</a></li><li><a href="#_38" rel="nofollow">查看端口号的使用情况</a></li><li><a href="#ID_44" rel="nofollow">显示所有连接和监听端口并显示每个连接相关的进程ID</a></li><li><a href="#UDPTCP_ID_50" rel="nofollow">显示UDP、TCP协议的连接的统计信息并显示每个连接相关的进程 ID</a></li><li><a href="#_74" rel="nofollow">显示所有已建立的连接</a></li><li><a href="#_82" rel="nofollow">显示每个进程的连接数</a></li><li><a href="#IP_172" rel="nofollow">显示每个IP地址的连接数</a></li><li><a href="#TCPUDP_197" rel="nofollow">显示每种类型TCP/UDP的连接数</a></li><li><a href="#_205" rel="nofollow">显示每种网络状态的数量</a></li><li><a href="#ID_216" rel="nofollow">显示指定进程ID网络状态的数量</a></li><li><a href="#_227" rel="nofollow">显示端口占用数量</a></li><li><a href="#ID_243" rel="nofollow">显示指定进程ID指定协议的数量</a></li></ul> 
   </li><li><a href="#_259" rel="nofollow">网络状态</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>简介</h3> 
<p>netstat 命令是 Linux 系统中一个非常常用的网络工具，用于查询和统计网络连接的状态和数据传输情况。在网络故障排除和性能调优中，netstat 命令是必不可少的工具之一。本文将详细介绍 netstat 命令的常用参数及其用法。</p> 
<h3><a id="_5"></a>命令格式</h3> 
<p>netstat [-a] [-c] [-e] [-f] [-i] [-n] [-o] [-p protocol] [-r] [-s] [-t] [-u] [interval]</p> 
<h3><a id="_9"></a>常用选项</h3> 
<p><code>netstat</code> 命令的常用选项如下：</p> 
<ul><li><code>-a</code>（all）：显示所有连接状态，包括 TCP、UDP 和 Unix 域套接字； 
  <ul><li><code>-t</code>（tcp）：显示 TCP 连接状态；</li><li><code>-u</code>（udp）：显示 UDP 连接状态；</li><li><code>-x</code>：列出所有unix端口</li></ul> </li><li><code>-c</code>（continuous）：连续显示网络状态信息。按 Ctrl + C 结束。</li><li><code>-e</code>（extend）：显示网络统计信息。包括网络接口、协议等。</li><li><code>-f</code>：显示外部地址的完全限定域名（FQDN）。</li><li><code>-i</code>：显示网络接口信息。</li><li><code>-n</code>：以数字形式显示地址和端口号。</li><li><code>-o</code>：显示与每个连接相关的进程 ID。</li><li><code>-p protocol</code>：显示特定协议（tcp、udp 或 icmp）的连接。</li><li><code>-r</code>：显示路由表。</li><li><code>-s</code>：显示网络统计信息。包括网络接口、协议等。</li><li><code>-t</code>：显示 TCP 协议的连接。</li><li><code>-u</code>：显示 UDP 协议的连接。</li><li><code>interval</code>：指定连续显示网络状态信息的时间间隔（单位为秒）。</li></ul> 
<h3><a id="_30"></a>常用命令</h3> 
<h4><a id="_32"></a>查询进程所占用的端口号</h4> 
<pre><code class="prism language-sh"> netstat -ano | grep 进程ID
</code></pre> 
<h4><a id="_38"></a>查看端口号的使用情况</h4> 
<pre><code class="prism language-sh"> netstat -ano | grep 端口号
</code></pre> 
<h4><a id="ID_44"></a>显示所有连接和监听端口并显示每个连接相关的进程ID</h4> 
<pre><code class="prism language-sh">netstat -ano
</code></pre> 
<h4><a id="UDPTCP_ID_50"></a>显示UDP、TCP协议的连接的统计信息并显示每个连接相关的进程 ID</h4> 
<pre><code class="prism language-sh">netstat -so -p udp

netstat -so -p tcp
IPv4 的 TCP 统计信息

  主动开放                        = 8055
  被动开放                       = 1136
  失败的连接尝试          = 2469
  重置连接                   = 1712
  当前连接                 = 67
  接收的分段                   = 2473796
  发送的分段                       = 454254
  重新传输的分段              = 10493

活动连接

  协议  本地地址          外部地址        状态           PID
  TCP    127.0.0.1:6000         kubernetes:51683       ESTABLISHED     16460
  TCP    127.0.0.1:6000         kubernetes:51684       ESTABLISHED     16460
</code></pre> 
<h4><a id="_74"></a>显示所有已建立的连接</h4> 
<pre><code class="prism language-sh">netstat -ano | grep ESTABLISHED
TCP    127.0.0.1:6000         127.0.0.1:51684        ESTABLISHED     16460
TCP    127.0.0.1:6000         127.0.0.1:51685        ESTABLISHED     16460
</code></pre> 
<h4><a id="_82"></a>显示每个进程的连接数</h4> 
<pre><code class="prism language-sh">netstat -ano | grep ESTABLISHED | awk '{print $5}' | sort | uniq -c | sort -nr | head -10
</code></pre> 
<p><code>netstat -ano</code>： 显示所有连接和监听端口，以数字形式显示地址和端口号，并显示与每个连接相关的进程 ID</p> 
<pre><code class="prism language-ini">  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       1044
  TCP    127.0.0.1:4244         0.0.0.0:0              LISTENING       15104
  TCP    127.0.0.1:6000         127.0.0.1:51683        ESTABLISHED     16460
  TCP    127.0.0.1:6000         127.0.0.1:51685        ESTABLISHED     16460
  ...
  UDP    192.168.2.226:1900     *:*                                    10428
  UDP    192.168.2.226:61395    *:*                                    10428
  UDP    [::]:3702              *:*                                    15956
  UDP    [::]:57584             *:*                                    15956
  UDP    [::1]:1900             *:*                                    10428
  UDP    [::1]:61392            *:*                                    10428
  UDP    [fe80::b131:35eb:14b3:8958%50]:1900  *:*                                    10428
</code></pre> 
<p><code>grep ESTABLISHED</code> ：过滤出已建立的连接。</p> 
<pre><code class="prism language-ini">  TCP    127.0.0.1:6000         127.0.0.1:51683        ESTABLISHED     16460
  TCP    127.0.0.1:6000         127.0.0.1:51685        ESTABLISHED     16460
  TCP    127.0.0.1:49671        127.0.0.1:62522        ESTABLISHED     8244
  TCP    127.0.0.1:49672        127.0.0.1:49673        ESTABLISHED     6952
  TCP    127.0.0.1:49673        127.0.0.1:49672        ESTABLISHED     6952
  TCP    127.0.0.1:51058        127.0.0.1:51059        ESTABLISHED     4612
  TCP    127.0.0.1:51059        127.0.0.1:51058        ESTABLISHED     4612
  TCP    127.0.0.1:51061        127.0.0.1:51062        ESTABLISHED     4612
</code></pre> 
<p><code>awk '{print $5}'</code> ：提取出第5列进程ID。</p> 
<pre><code class="prism language-ini">16460
16460
8244
6952
6952
4612
4612
4612
</code></pre> 
<p><code>sort | uniq -c | sort -nr</code> ：排序统计每个进程ID的连接数量，并按照连接数量从高到低排序；</p> 
<ul><li><code>sort</code>：排序。</li><li><code>uniq -c</code>：用于在文本中查找并计数唯一行，有点像count - group by</li><li><code>sort -nr</code>：用于对文本进行排序。 
  <ul><li><code>-n</code> 选项表示按照数值大小排序，而不是按照字典序排序；</li><li><code>-r</code> 选项表示按照逆序排序，即从大到小排序。</li></ul> </li></ul> 
<pre><code class="prism language-ini">netstat -ano | grep ESTABLISHED | awk '{print $5}' | sort
16460
16460
4612
4612
4612
6952
6952
8244

netstat -ano | grep ESTABLISHED | awk '{print $5}' | sort | uniq -c
2 16460
3 4612
2 6952
1 8244

netstat -ano | grep ESTABLISHED | awk '{print $5}' | sort | uniq -c | sort -nr
3 4612
2 16460
2 6952
1 8244
</code></pre> 
<p><code>head</code> : 显示前面的若干行。</p> 
<pre><code class="prism language-ini">netstat -ano | grep ESTABLISHED | awk '{print $5}' | sort | uniq -c | sort -nr | head -2
3 4612
2 16460
</code></pre> 
<h4><a id="IP_172"></a>显示每个IP地址的连接数</h4> 
<pre><code class="prism language-sh">netstat -ano | awk '{print $3}' | cut -d: -f1 | sort | uniq -c | sort -rn
</code></pre> 
<p><code>cut -d: -f1 </code>：用于从文本中剪切文本并打印出指定字段。目的是从连接信息中提取远程 IP 地址，剔除掉冒号和端口号。</p> 
<ul><li><code>-d:</code> 表示使用冒号作为分隔符</li><li><code>-f1</code> 表示提取分隔符左边的第一个字段</li></ul> 
<pre><code class="prism language-ini">netstat -ano | grep ESTABLISHED | awk '{print $3}'
127.0.0.1:51240
10.2.3.411:443
110.236.32.1:443

netstat -ano | awk '{print $3}' | cut -d: -f1
127.0.0.1
10.2.3.411
110.236.32.1
</code></pre> 
<p>其他命令跟上面一样单步调试即可。</p> 
<h4><a id="TCPUDP_197"></a>显示每种类型TCP/UDP的连接数</h4> 
<pre><code class="prism language-sh">netstat -ano | awk '{print $1}' | sort | uniq -c
120 TCP
82 UDP
</code></pre> 
<h4><a id="_205"></a>显示每种网络状态的数量</h4> 
<pre><code class="prism language-sh">// TCP 网络状态的数量
netstat -ano |grep TCP | awk '{print $4}' | sort | uniq -c
62 ESTABLISHED
51 LISTENING
 2 TIME_WAIT

</code></pre> 
<h4><a id="ID_216"></a>显示指定进程ID网络状态的数量</h4> 
<pre><code class="prism language-sh">// TCP 网络状态的数量
netstat -ano |grep 进程ID | awk '{print $4}' | sort | uniq -c
62 ESTABLISHED
51 LISTENING
 2 TIME_WAIT

</code></pre> 
<h4><a id="_227"></a>显示端口占用数量</h4> 
<pre><code class="prism language-sh">netstat -ano | grep -c :
或者
netstat -a -n | grep -c "TCP"
netstat -a -n | grep -c "UDP"
netstat -a -n | grep -w "TCP" | wc -l
netstat -ano | awk 'NR&gt;2{print $1}' | sort | uniq -c | awk '{print $2 "占用了"$1"个端口"}'
上面的都有重复
netstat -ano | awk '{print $3}' | cut -d: -f1 | sort | uniq -c | sort -rn
</code></pre> 
<p><code>grep -c :</code> : grep 命令用于在文件或输出中查找与指定模式匹配的行，并将匹配的行打印出来。</p> 
<ul><li>其中 -c 选项用于统计匹配到的行数</li><li><code> :</code> : 表示匹配冒号字符。<br> 因此，<code>grep -c : </code>命令会统计输出或文件中包含冒号字符的行数。</li></ul> 
<h4><a id="ID_243"></a>显示指定进程ID指定协议的数量</h4> 
<pre><code class="prism language-sh">netstat -ano | grep 进程ID | grep UDP | grep -v -E ':5353|::' 
</code></pre> 
<ul><li> <p><code>-v</code>：排除相关的行。<code>grep -v UDP</code>排除UDP相关的行。</p> </li><li> <p><code>-E 'keyword1|keyword2|keyword3'</code> : 匹配多个关键词，<code>keyword1</code>、<code>keyword2</code>和<code>keyword3</code>是关键词，用<code>|</code>分隔。</p> </li><li> <p><code>wc -l</code> : 用于统计文件的行数</p> 
  <blockquote> 
   <p><code>netstat -ano | grep 6712 | grep UDP | grep -v -E ':5353|::' | wc -l</code></p> 
  </blockquote> </li></ul> 
<h3><a id="_259"></a>网络状态</h3> 
<table><thead><tr><th>State</th><th>状态</th></tr></thead><tbody><tr><td>LISTENING</td><td>监听中，服务端需要打开一个socket进行监听，侦听来自远方TCP端口的连接请求</td></tr><tr><td>ESTABLISHED</td><td>已连接，代表一个打开的连接，双方可以进行或已经在数据交互了</td></tr><tr><td>SYN_SENT</td><td>客户端通过应用程序调用connect发送一个SYN以请求建立一个连接。在收到ACK后，状态转为ESTABLIHSED。</td></tr><tr><td>CLOSE_WAIT</td><td><strong>被动关闭端</strong>接到FIN后，就发出ACK以回应FIN请求(它的接收也作为文件结束符传递给上层应用程序)</td></tr><tr><td>TIME_WAIT</td><td><strong>主动关闭端</strong>接收到FIN后，TCP就发送ACK包，并进入TIME-WAIT状态</td></tr><tr><td>LAST_ACK</td><td>等待对方回应一个ACK（这是准备关闭连接的一个步骤，意味着这个连接正在关闭）</td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0518717029c56c33a205da165a87a974/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">中国全国地面站点数据(1981-2010)、月平均气象、月平均降水、月平均相对湿度、月最大降水、月最高温度最低温度、月最高温平均值最低温平均值、高低温站点基础数据，气候数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/51044c66aade0887ef2e4fa2b85d55d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">移动web</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>