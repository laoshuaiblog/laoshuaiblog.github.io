<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker安装DolphinScheduler - mysql - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/5231eea327ad77ead1ffee6bc1ac22a9/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Docker安装DolphinScheduler - mysql">
  <meta property="og:description" content="默认已安装Docker和Docker-compose环境
本案例安装海豚调度3.1.0 并将PostgreSQL 替换为mysql
这是官网docker部署教程：https://dolphinscheduler.apache.org/zh-cn/docs/3.1.0/guide/start/docker
但是官网教程里并没有表名基于docker的情况下如何将数据库替换为mysql
一、资源下载 源码下载：https://archive.apache.org/dist/dolphinscheduler/3.1.0/apache-dolphinscheduler-3.1.0-src.tar.gz mysql驱动下载：https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.16/mysql-connector-java-8.0.16.jar 二、安装 解压后有很多文件夹，其实这些都是些源码。可以不用管，也可以删除
tar -zxf apache-dolphinscheduler-3.1.0-src.tar.gz cd apache-dolphinscheduler-3.1.0-src/deploy/docker ls -a 里面只有两个文件是我们需要用到的，.env文件是所有镜像需要用到的环境变量，平时是隐藏的 docker-compose.yml .env 打开docker-compose.yml文件将里面的PostgreSQL 删除加入mysql启动命令
同时将下载好的mysql镜像放到和docker-compose.yml同级目录
一下是我调整后完整的docker-compose.yml文件：
# Licensed to the Apache Software Foundation (ASF) under one # or more contributor license agreements. See the NOTICE file # distributed with this work for additional information # regarding copyright ownership. The ASF licenses this file # to you under the Apache License, Version 2.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-08-04T14:02:43+08:00">
    <meta property="article:modified_time" content="2023-08-04T14:02:43+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker安装DolphinScheduler - mysql</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>默认已<a href="https://so.csdn.net/so/search?q=%E5%AE%89%E8%A3%85Docker&amp;spm=1001.2101.3001.7020" title="安装Docker">安装Docker</a>和Docker-compose环境<br> 本案例安装海豚调度3.1.0 并将PostgreSQL 替换为mysql</p> 
<p>这是官网docker部署教程：<a href="https://dolphinscheduler.apache.org/zh-cn/docs/3.1.0/guide/start/docker" rel="nofollow" title="https://dolphinscheduler.apache.org/zh-cn/docs/3.1.0/guide/start/docker">https://dolphinscheduler.apache.org/zh-cn/docs/3.1.0/guide/start/docker</a></p> 
<p>但是官网教程里并没有表名基于docker的情况下如何将数据库替换为mysql</p> 
<h2>一、资源下载</h2> 
<h6>源码下载：<a href="https://archive.apache.org/dist/dolphinscheduler/3.1.0/apache-dolphinscheduler-3.1.0-src.tar.gz" rel="nofollow" title="https://archive.apache.org/dist/dolphinscheduler/3.1.0/apache-dolphinscheduler-3.1.0-src.tar.gz">https://archive.apache.org/dist/dolphinscheduler/3.1.0/apache-dolphinscheduler-3.1.0-src.tar.gz</a></h6> 
<h6>mysql驱动下载：<a href="https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.16/mysql-connector-java-8.0.16.jar" rel="nofollow" title="https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.16/mysql-connector-java-8.0.16.jar">https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.16/mysql-connector-java-8.0.16.jar</a></h6> 
<h2>二、安装</h2> 
<p>解压后有很多文件夹，其实这些都是些源码。可以不用管，也可以删除</p> 
<pre><code class="language-bash">tar -zxf apache-dolphinscheduler-3.1.0-src.tar.gz

cd apache-dolphinscheduler-3.1.0-src/deploy/docker

ls -a
里面只有两个文件是我们需要用到的，.env文件是所有镜像需要用到的环境变量，平时是隐藏的
docker-compose.yml .env</code></pre> 
<p>打开docker-compose.yml文件将里面的PostgreSQL 删除加入mysql启动命令</p> 
<p>同时将下载好的mysql镜像放到和docker-compose.yml同级目录</p> 
<p>一下是我调整后完整的docker-compose.yml文件：</p> 
<pre><code class="language-bash"># Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

version: "3.8"

services:
  mysql:
    image: "registry.creditx.com/xfeature/xai_mysql:latest"
    profiles: ["all", "schema"]
    command: --max_allowed_packet=209715200
    ports:
      - "3306:3306"
    volumes:
      - "./mysql/init-sql:/docker-entrypoint-initdb.d"
      - "./mysql/data:/var/lib/mysql"
    environment:
      - MYSQL_ROOT_PASSWORD=CraiditX123
      - MYSQL_DATABASE=dolphinscheduler
      - TZ=Asia/Shanghai
    networks:
      - dolphinscheduler

  dolphinscheduler-zookeeper:
    image: bitnami/zookeeper:3.6.2
    profiles: ["all"]
    environment:
      ALLOW_ANONYMOUS_LOGIN: "yes"
      ZOO_4LW_COMMANDS_WHITELIST: srvr,ruok,wchs,cons
    volumes:
      - dolphinscheduler-zookeeper:/bitnami/zookeeper
    healthcheck:
      test: ["CMD", "bash", "-c", "cat &lt; /dev/null &gt; /dev/tcp/127.0.0.1/2181"]
      interval: 5s
      timeout: 60s
      retries: 120
    networks:
      - dolphinscheduler

  dolphinscheduler-schema-initializer:
    image: apache/dolphinscheduler-tools:3.1.0
    env_file: .env
    profiles: ["schema"]
    command: [ tools/bin/upgrade-schema.sh ]
    depends_on:
      - mysql
    volumes:
      - dolphinscheduler-logs:/opt/dolphinscheduler/logs
      - dolphinscheduler-shared-local:/opt/soft
      - dolphinscheduler-resource-local:/dolphinscheduler
      - "./mysql-connector-java-8.0.16.jar:/opt/dolphinscheduler/tools/libs/mysql-connector-java-8.0.16.jar"
    networks:
      - dolphinscheduler

  dolphinscheduler-api:
    image: apache/dolphinscheduler-api:3.1.0
    ports:
      - "12345:12345"
      - "25333:25333"
    profiles: ["all"]
    env_file: .env
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:12345/dolphinscheduler/actuator/health" ]
      interval: 30s
      timeout: 5s
      retries: 3
    depends_on:
      dolphinscheduler-zookeeper:
        condition: service_healthy
    volumes:
      - dolphinscheduler-logs:/opt/dolphinscheduler/logs
      - dolphinscheduler-shared-local:/opt/soft
      - dolphinscheduler-resource-local:/dolphinscheduler
      - "./mysql-connector-java-8.0.16.jar:/opt/dolphinscheduler/libs/mysql-connector-java-8.0.16.jar"
    networks:
      - dolphinscheduler

  dolphinscheduler-alert:
    image: apache/dolphinscheduler-alert-server:3.1.0
    profiles: ["all"]
    env_file: .env
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:50053/actuator/health" ]
      interval: 30s
      timeout: 5s
      retries: 3
    volumes:
      - dolphinscheduler-logs:/opt/dolphinscheduler/logs
      - "./mysql-connector-java-8.0.16.jar:/opt/dolphinscheduler/libs/mysql-connector-java-8.0.16.jar"
    networks:
      - dolphinscheduler

  dolphinscheduler-master:
    image: apache/dolphinscheduler-master:3.1.0
    profiles: ["all"]
    env_file: .env
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:5679/actuator/health" ]
      interval: 30s
      timeout: 5s
      retries: 3
    depends_on:
      dolphinscheduler-zookeeper:
        condition: service_healthy
    volumes:
      - dolphinscheduler-logs:/opt/dolphinscheduler/logs
      - dolphinscheduler-shared-local:/opt/soft
      - "./mysql-connector-java-8.0.16.jar:/opt/dolphinscheduler/libs/mysql-connector-java-8.0.16.jar"
    networks:
      - dolphinscheduler

  dolphinscheduler-worker:
    image: apache/dolphinscheduler-worker:3.1.0
    profiles: ["all"]
    env_file: .env
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:1235/actuator/health" ]
      interval: 30s
      timeout: 5s
      retries: 3
    depends_on:
      dolphinscheduler-zookeeper:
        condition: service_healthy
    volumes:
      - dolphinscheduler-worker-data:/tmp/dolphinscheduler
      - dolphinscheduler-logs:/opt/dolphinscheduler/logs
      - dolphinscheduler-shared-local:/opt/soft
      - dolphinscheduler-resource-local:/dolphinscheduler
      - "./mysql-connector-java-8.0.16.jar:/opt/dolphinscheduler/libs/mysql-connector-java-8.0.16.jar"
    networks:
      - dolphinscheduler

networks:
  dolphinscheduler:
    driver: bridge

volumes:
  mysql:
  dolphinscheduler-zookeeper:
  dolphinscheduler-worker-data:
  dolphinscheduler-logs:
  dolphinscheduler-shared-local:
  dolphinscheduler-resource-local:
</code></pre> 
<h2>三、启动</h2> 
<p>初始化数据库：</p> 
<p>docker-compose --profile schema up -d<br> 有可能mysql还未启动起来导致初始化失败可以再启动一下tool模块<br> docker-compose --profile schema start dolphinscheduler-schema-initializer</p> 
<p>初始化完成后启动所有服务</p> 
<p>docker-compose --profile all up -d</p> 
<p></p> 
<p>备注：我本来是打算直接部署最新版本3.1.7的。但是apache/dolphinscheduler-tools:3.1.7容器一直启动不起来抛资源不够，但是我还有7个G的运行内存，没找到原因：</p> 
<p><img alt="" height="120" src="https://images2.imgbox.com/43/12/X1ZDEXFK_o.png" width="859"></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/35b7f2e5305acf3b04e10f9a864b70f2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">use strict 是什么意思？使用它区别是什么？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3684cbbebce33462152b9a6b008dda96/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">GATK4实用技巧丨如何正确设置线程数和内存大小？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>