<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LVS&#43;Keepalived 高可用群集--部署 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/916b429f8eb187e93320eb2c057e4676/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="LVS&#43;Keepalived 高可用群集--部署">
  <meta property="og:description" content="实际操作 LVS &#43; Keepalived 高可用群集
环境设备
LVS1192.168.6.88 （MASTER）LVS2192.168.6.87 （BACKUP）web1192.168.6.188web2192.168.6.189客户端192.168.6.86VIP192.168.6.180 （一）web服务器 首先配置web服务
1.下载安装web服务
yum install httpd -y
2.建立虚拟IP
3.调整内核参数
vim /etc/sysctl.conf
调整完毕后开启web服务：systemctl start network
在站点目录下构建数据文件
两台web服务器同样操作
（二）LVS集群服务器 1.下载服务
yum install ipvsadm.x86_64 -y &amp;amp;&amp;amp; yum install keepalived_64 -y
先启动ipvsadm服务
ipvsadm-save &amp;gt;/etc/sysconfig/ipvsadm #生成配置信息文件
systemctl start ipvsadm.service #启动服务
2.配置文件
在配置文件之前，最好先进行备份
cp /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak
删除60行以下的内容
配置全局设置
配置VRRP热备实例
配置虚拟路由 (注意空格）
配置完毕后启动服务：systemctl start keepalived.service
查看规则情况:ipvsadw -ln
另一台服务器与其基本一致
可主服务配置信息拷到这台机器
需要修改12，19，22行信息，其余配置与主服务一致
配置完毕后启动服务
ipvsadm-save &amp;gt;/etc/sysconfig/ipvsadm
systemctl start ipvsadm.service
systemctl start keepalived.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-18T14:55:59+08:00">
    <meta property="article:modified_time" content="2024-03-18T14:55:59+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LVS&#43;Keepalived 高可用群集--部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 id="%E5%9B%9B%E3%80%81%E5%AE%9E%E9%99%85%E6%93%8D%E4%BD%9C">实际操作</h3> 
<p>LVS + Keepalived 高可用群集</p> 
<p>环境设备</p> 
<table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td><strong>LVS1</strong></td><td><strong>192.168.6.88 （MASTER）</strong></td></tr><tr><td><strong>LVS2</strong></td><td><strong>192.168.6.87 （BACKUP）</strong></td></tr><tr><td><strong>web1</strong></td><td><strong>192.168.6.188</strong></td></tr><tr><td><strong>web2</strong></td><td><strong>192.168.6.189</strong></td></tr><tr><td><strong>客户端</strong></td><td><strong>192.168.6.86</strong></td></tr><tr><td><strong>VIP</strong></td><td><strong>192.168.6.180</strong></td></tr></tbody></table> 
<h4 id="%EF%BC%88%E4%B8%80%EF%BC%89web%E6%9C%8D%E5%8A%A1%E5%99%A8" style="background-color:transparent;">（一）web服务器</h4> 
<p>首先配置web服务</p> 
<p><strong>1.下载安装web服务</strong></p> 
<p>yum install  httpd  -y</p> 
<p><img alt="" height="119" src="https://images2.imgbox.com/85/8d/fVrRHhR3_o.png" width="1029"></p> 
<p><strong>2.建立虚拟IP</strong></p> 
<p><img alt="" height="348" src="https://images2.imgbox.com/45/24/F709XAul_o.png" width="1200"></p> 
<p> <strong>3.调整内核参数</strong></p> 
<p><strong>vim /etc/sysctl.conf</strong></p> 
<p><img alt="" height="367" src="https://images2.imgbox.com/a1/1b/Tt6Thg7P_o.png" width="1151"></p> 
<p><img alt="" height="152" src="https://images2.imgbox.com/b1/12/pFYbEAno_o.png" width="468"></p> 
<p><strong>调整完毕后开启web服务：systemctl  start  network</strong></p> 
<p><strong>在站点目录下构建数据文件</strong></p> 
<p><img alt="" height="119" src="https://images2.imgbox.com/85/36/pIdRsleu_o.png" width="743"></p> 
<p><strong>两台web服务器同样操作</strong></p> 
<p><img alt="" height="414" src="https://images2.imgbox.com/4e/ac/ix8SbfWi_o.png" width="804"> <img alt="" height="115" src="https://images2.imgbox.com/f8/00/4Yv6IsDN_o.png" width="806"></p> 
<p></p> 
<h4 id="%EF%BC%88%E4%BA%8C%EF%BC%89LVS%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E5%99%A8" style="background-color:transparent;">（二）LVS集群服务器</h4> 
<p><strong>1.下载服务</strong></p> 
<p>yum install ipvsadm.x86_64 -y   &amp;&amp;   yum install keepalived_64 -y</p> 
<p>先启动ipvsadm服务</p> 
<p><strong>ipvsadm-save &gt;/etc/sysconfig/ipvsadm  #生成配置信息文件<br> systemctl start ipvsadm.service              #启动服务</strong></p> 
<p><img alt="" height="163" src="https://images2.imgbox.com/ce/69/qGVDGD2E_o.png" width="1044"></p> 
<p><img alt="" height="267" src="https://images2.imgbox.com/36/c0/bSuZhalM_o.png" width="1200"></p> 
<p></p> 
<p><strong>2.配置文件</strong></p> 
<p><strong>在配置文件之前，最好先进行备份</strong></p> 
<p><strong>cp  /etc/keepalived/keepalived.conf   /etc/keepalived/keepalived.conf.bak</strong></p> 
<p>删除60行以下的内容</p> 
<p><strong>配置全局设置</strong></p> 
<p><img alt="" height="85" src="https://images2.imgbox.com/fa/a1/5wDZUm1q_o.png" width="1102"></p> 
<p> <img alt="" height="453" src="https://images2.imgbox.com/01/43/EyGbEyNG_o.png" width="1051"></p> 
<p> <strong>配置VRRP热备实例</strong></p> 
<p> <img alt="" height="368" src="https://images2.imgbox.com/f7/31/6HCyRhmR_o.png" width="1173"></p> 
<p><strong>配置虚拟路由</strong> </p> 
<p><img alt="" height="636" src="https://images2.imgbox.com/1e/0e/iayiyCuR_o.png" width="1200"></p> 
<p> (注意空格）</p> 
<p><strong>配置完毕后启动服务：systemctl start  keepalived.service</strong></p> 
<p><strong>查看规则情况:ipvsadw -ln</strong></p> 
<p><img alt="" height="259" src="https://images2.imgbox.com/dd/c7/WINIWsji_o.png" width="1072"></p> 
<p><strong>另一台服务器与其基本一致</strong></p> 
<p>可主服务配置信息拷到这台机器</p> 
<p><img alt="" height="219" src="https://images2.imgbox.com/46/cf/T3RScVCg_o.png" width="1200"></p> 
<p><strong>需要修改12，19，22行信息，其余配置与主服务一致</strong></p> 
<p><img alt="" height="612" src="https://images2.imgbox.com/7a/10/C1U3Kgqx_o.png" width="862"></p> 
<p> <strong>配置完毕后启动服务</strong></p> 
<p><strong>ipvsadm-save &gt;/etc/sysconfig/ipvsadm<br> systemctl start  ipvsadm.service<br> systemctl start  keepalived.service</strong></p> 
<h4><strong>（三）客户端测试</strong> </h4> 
<p></p> 
<h4><img alt="" height="322" src="https://images2.imgbox.com/fc/24/i1ijQD9O_o.png" width="1074"></h4> 
<h3 id="%E4%BA%94%E3%80%81keepalive%E7%AE%A1%E7%90%86" style="background-color:transparent;">keepalive管理</h3> 
<h4 id="%EF%BC%88%E4%B8%80%EF%BC%89%E4%B8%BB%E4%BB%8E%E6%9B%B4%E6%9B%BF" style="background-color:transparent;"><a name="t20"></a>（一）主从更替</h4> 
<h4>抢占模式</h4> 
<p><img alt="" height="514" src="https://images2.imgbox.com/5b/07/ki87lqCR_o.png" width="1129"></p> 
<p><img alt="" height="456" src="https://images2.imgbox.com/3b/7a/LVANAt3r_o.png" width="1200"></p> 
<p>此时虚拟VIP在备用服务器，优先级最高BACKUP会立马变成MASTER继续工作</p> 
<p><img alt="" height="497" src="https://images2.imgbox.com/32/1d/ZQpVpolW_o.png" width="992"></p> 
<p><img alt="" height="521" src="https://images2.imgbox.com/fe/ef/rBU5P9sw_o.png" width="1163"></p> 
<p>开启主服务器后，主服务器会抢占，因为主服务器优先级高，又会变成MASTER,</p> 
<p>即为抢占模式（默认）</p> 
<p><img alt="" height="513" src="https://images2.imgbox.com/52/0e/Ks2QplYc_o.png" width="1159"></p> 
<h4 style="background-color:transparent;">非抢占模式</h4> 
<p>可以通过添加<strong>nopreempt</strong>参数，服务器state配置为BACKUP</p> 
<p>设置为非抢占模式 <img alt="" height="506" src="https://images2.imgbox.com/d3/22/82acYGST_o.png" width="1043"></p> 
<p><img alt="" height="468" src="https://images2.imgbox.com/28/97/qzbdWXxG_o.png" width="1042"></p> 
<p><img alt="" height="493" src="https://images2.imgbox.com/9a/a9/pJwByB20_o.png" width="894"></p> 
<h4>延迟抢占</h4> 
<p>也可以设置延迟抢占，同样在虚拟服务器段配置</p> 
<p><img alt="" height="773" src="https://images2.imgbox.com/07/b6/ZYO7McH2_o.png" width="1052"></p> 
<p><img alt="" height="870" src="https://images2.imgbox.com/ce/46/6T1BNU7T_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0c01dc341877dcf87a7bf1ac3851aaa7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">k8s的网络组件有哪些？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8b51b267725683b176a2ce024ba25b74/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">获取年月日时分秒的npm插件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>