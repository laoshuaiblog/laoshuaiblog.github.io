<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android自定义圆环进度条/刻度仪表盘(单环单点带进度动画) - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/4ebb10508a02f537eb33cad0df421c05/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Android自定义圆环进度条/刻度仪表盘(单环单点带进度动画)">
  <meta property="og:description" content="效果图: 1.自定义SleepDashBoardView /** * 睡眠刻度仪表盘 */ public class SleepDashBoardView extends View { private static final float START_ANGLE = 135f; private static final float MAX_ANGLE = 270f; private float progress = 0; private float centerX; private float centerY; private float width; private float height; private int lineWidth = dp2px(8); // 绘制圆环的线宽 private int pointWidth = dp2px(2); // 绘制圆点线宽 private int rectangleWidth = dp2px(1); // 绘制矩形的线宽 private SweepGradient sweepGradient; private Paint paint = new Paint(Paint.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-07-14T14:56:10+08:00">
    <meta property="article:modified_time" content="2023-07-14T14:56:10+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android自定义圆环进度条/刻度仪表盘(单环单点带进度动画)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>效果图:</h4> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f5/60/KhJ9h97e_o.png"></p> 
<h4>1.自定义SleepDashBoardView</h4> 
<pre><code class="language-java">/**
 * 睡眠刻度仪表盘
 */
public class SleepDashBoardView extends View {
    private static final float START_ANGLE = 135f;
    private static final float MAX_ANGLE = 270f;
    private float progress = 0;
    private float centerX;
    private float centerY;
    private float width;
    private float height;
    private int lineWidth = dp2px(8); // 绘制圆环的线宽
    private int pointWidth = dp2px(2); // 绘制圆点线宽
    private int rectangleWidth = dp2px(1); // 绘制矩形的线宽

    private SweepGradient sweepGradient;

    private Paint paint = new Paint(Paint.ANTI_ALIAS_FLAG);
    private Paint bgPaint = new Paint(Paint.ANTI_ALIAS_FLAG);
    private Paint rectPaint = new Paint(Paint.ANTI_ALIAS_FLAG);
    private Paint pointPaint = new Paint(Paint.ANTI_ALIAS_FLAG);
    private ObjectAnimator animator;

    private int[] colors = {
            Color.parseColor("#C6BCFF"),
            Color.parseColor("#C6BCFF"),//浅色
            Color.parseColor("#C6BCFF"),
            Color.parseColor("#C6BBFF"),
            Color.parseColor("#AEA0F6"),
            Color.parseColor("#9A8AEF"),
            Color.parseColor("#9888EF"),
            Color.parseColor("#9888EF"),//深色
    };

    public SleepDashBoardView(Context context) {
        this(context, null);
    }

    public SleepDashBoardView(Context context, @Nullable AttributeSet attrs) {
        this(context, attrs, 0);
    }

    public SleepDashBoardView(Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        paint.setColor(Color.GRAY);
        paint.setStyle(Paint.Style.STROKE);
        paint.setStrokeCap(Paint.Cap.ROUND);
        paint.setStrokeWidth(lineWidth);

        bgPaint.setColor(Color.parseColor("#F6F6F6"));
        bgPaint.setStyle(Paint.Style.STROKE);
        bgPaint.setStrokeCap(Paint.Cap.ROUND);
        bgPaint.setStrokeWidth(lineWidth);

        pointPaint.setColor(Color.WHITE);
        pointPaint.setStyle(Paint.Style.STROKE);
        pointPaint.setStrokeWidth(pointWidth);

        rectPaint.setColor(Color.WHITE);
    }

    private void setProgress(float progress) {
        this.progress = progress;
        invalidate();
    }

    public void setSleepProgress(float progress) {
        animator = ObjectAnimator.ofFloat(this, "progress", 0, progress);
        animator.setDuration(2000);
        animator.setInterpolator(new FastOutSlowInInterpolator());
        animator.start();
    }

    @Override
    protected void onSizeChanged(int w, int h, int oldw, int oldh) {
        super.onSizeChanged(w, h, oldw, oldh);
        width = getWidth();
        height = getHeight();
        centerX = getWidth() / 2;
        centerY = getHeight() / 2;
        sweepGradient = new SweepGradient(centerX, centerY, colors, null);
        //改变开始渐变的角度(默认从右边开始画圆渐变,旋转90度就从下方开始画圆渐变,旋转之后更好设置颜色渐变值)
        Matrix matrix = new Matrix();
        matrix.setRotate(90, centerX, centerY);
        sweepGradient.setLocalMatrix(matrix);
        paint.setShader(sweepGradient);
    }

    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
        // 绘制环形
        drawArc(canvas);
        // 绘制矩形白条
//        draRectangle(canvas);
        // 绘制末尾圆点
        drawPoint(canvas);
    }

    private void drawArc(Canvas canvas) {
        float sweepAngle = MAX_ANGLE * progress / 100;
        int padding = lineWidth + pointWidth;
        canvas.drawArc(padding, padding, width - padding, height - padding, START_ANGLE, MAX_ANGLE, false, bgPaint);
        canvas.drawArc(padding, padding, width - padding, height - padding, START_ANGLE, sweepAngle, false, paint);
    }

    private void draRectangle(Canvas canvas) {
        float sweepAngle = MAX_ANGLE * progress / 100;
        if (sweepAngle &gt; 70) {
            // 旋转到左侧
            canvas.save();
            canvas.rotate(-80f, centerX, centerY);
            canvas.drawRect(centerX - rectangleWidth, rectangleWidth, centerX + rectangleWidth, ConvertUtils.dp2px(20), rectPaint);
            canvas.restore();
        }
        if (sweepAngle &gt; 150f) {
            //绘制中间矩形
            canvas.drawRect(centerX - rectangleWidth, 0, centerX + rectangleWidth, ConvertUtils.dp2px(20), rectPaint);
        }
        if (sweepAngle &gt; 230f) {
            // 旋转到右侧
            canvas.save();
            canvas.rotate(80f, centerX, centerY);
            canvas.drawRect(centerX - rectangleWidth, 0, centerX + rectangleWidth, ConvertUtils.dp2px(20), rectPaint);
            canvas.restore();
        }
    }

    private void drawPoint(Canvas canvas) {
        Path path = new Path();
        float sweepAngle = MAX_ANGLE * progress / 100;
        int padding = lineWidth + pointWidth;
        path.addArc(padding, padding, width - padding, height - padding, START_ANGLE, sweepAngle);
        PathMeasure measure = new PathMeasure(path, false);
        float[] pos = new float[2];
        measure.getPosTan(measure.getLength() - 1, pos, null);
        pointPaint.setColor(Color.parseColor("#7F43FB"));
        pointPaint.setStyle(Paint.Style.FILL);//仅填充内部
        canvas.drawCircle(pos[0], pos[1], lineWidth - pointWidth, pointPaint);

        pointPaint.setColor(Color.WHITE);
        pointPaint.setStyle(Paint.Style.STROKE);//仅描边
        canvas.drawCircle(pos[0], pos[1], lineWidth - pointWidth, pointPaint);
    }

    public int dp2px(final float dpValue) {
        final float scale = Resources.getSystem().getDisplayMetrics().density;
        return (int) (dpValue * scale + 0.5f);
    }
}
</code></pre> 
<h4>2.布局中使用</h4> 
<pre><code class="language-java">            &lt;com.hwd.flowfit.ui.widget.SleepDashBoardView
                android:id="@+id/sleepChart"
                android:layout_width="130dp"
                android:layout_height="130dp"
                android:layout_marginStart="30dp"
                app:layout_constraintBottom_toBottomOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toTopOf="parent" /&gt;</code></pre> 
<h4>3.设置进度</h4> 
<pre><code class="language-java">sleepChart.setSleepProgress(75F)</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/70c3a600e8f129ee9534bd190ca1c47b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">element ui固定在下方‘合计行‘实现，并且可点击</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1868dfa767be59240a52db1741093103/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">亲测有效！！解决MySQL8误删root账号无法登录的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>