<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python二进制转化模块struct - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/95dd8f6d0f6655a921de0c5dd97cc747/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="python二进制转化模块struct">
  <meta property="og:description" content="文章目录 struct模块与C语言的类型匹配关系 struct模块 在pyton中，通过struct模块来对二进制进行转换，主要包括两大类函数，即用于打包的pack和用于解包的unpack。
其中，struct.pack的输入格式为struct.pack(format, v1, v2, ...)，其中format为格式字符串，v1,v2..为将要转成bytes的字符。
例如
&amp;gt;&amp;gt;&amp;gt; import struct &amp;gt;&amp;gt;&amp;gt; struct.pack(&#39;i&#39;, 15) b&#39;\x0f\x00\x00\x00&#39; &amp;gt;&amp;gt;&amp;gt; struct.pack(&#39;iii&#39;, 15, 16, 17) b&#39;\x0f\x00\x00\x00\x10\x00\x00\x00\x11\x00\x00\x00&#39; &amp;gt;&amp;gt;&amp;gt; struct.pack(&#39;b&#39;, 255) #b格式的取值范围是-128到127 struct.error: byte format requires -128 &amp;lt;= number &amp;lt;= 127 &amp;gt;&amp;gt;&amp;gt; struct.pack(&#39;B&#39;, 200) b&#39;\xc8&#39; &amp;gt;&amp;gt;&amp;gt; struct.pack(&#39;B&#39;, 71) #128以内可用ASCII表示 b&#39;G&#39; i代表int，15对应的二进制代码为F000，故其输出为b\x0f\x00\x00\x00。当格式字符串为iii时，说明要将三个数字以整数类型转化为二进制。
与C语言的类型匹配关系 格式化字符串中的每个字符都代表一种数据类型，其中整型相关的字符如下，左侧为带符号整型，右侧为无符号整型
C语言类型C语言类型标准大小bsigned charBunsigned char1hshortHunsigned short2iintIunsigned int4llongLunsigned long4qlong longQunsigned long long8nssize_tNsize_t 其他类型
格式C 类型Python 类型标准大小x填充字节无cchar长度为1的字节串?_Boolbool1efloat2ffloatfloat4ddoublefloat8schar[]字节串pchar[]字节串Pvoid*整数 struct中提供了获取标准大小的函数，calcsize:
&amp;gt;&amp;gt;&amp;gt; struct.calcsize(&#39;B&#39;) 1 &amp;gt;&amp;gt;&amp;gt; struct.calcsize(&#39;i&#39;) 4 除了声明被格式化时的数据类型，struct还可以指定对齐方式，例如
&amp;gt;&amp;gt;&amp;gt; struct.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-08-11T19:18:24+08:00">
    <meta property="article:modified_time" content="2023-08-11T19:18:24+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python二进制转化模块struct</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#struct_1" rel="nofollow">struct模块</a></li><li><a href="#C_25" rel="nofollow">与C语言的类型匹配关系</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="struct_1"></a>struct模块</h3> 
<p>在pyton中，通过<code>struct</code>模块来对二进制进行转换，主要包括两大类函数，即用于打包的pack和用于解包的unpack。</p> 
<p>其中，<code>struct.pack</code>的输入格式为<code>struct.pack(format, v1, v2, ...)</code>，其中<code>format</code>为格式字符串，<code>v1,v2..</code>为将要转成<code>bytes</code>的字符。</p> 
<p>例如</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> struct
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
<span class="token string">b'\x0f\x00\x00\x00'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'iii'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span>
<span class="token string">b'\x0f\x00\x00\x00\x10\x00\x00\x00\x11\x00\x00\x00'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>   <span class="token comment">#b格式的取值范围是-128到127</span>
struct<span class="token punctuation">.</span>error<span class="token punctuation">:</span> byte <span class="token builtin">format</span> requires <span class="token operator">-</span><span class="token number">128</span> <span class="token operator">&lt;=</span> number <span class="token operator">&lt;=</span> <span class="token number">127</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
<span class="token string">b'\xc8'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">)</span>    <span class="token comment">#128以内可用ASCII表示</span>
<span class="token string">b'G'</span>
</code></pre> 
<p><code>i</code>代表<code>int</code>，15对应的二进制代码为<code>F000</code>，故其输出为<code>b\x0f\x00\x00\x00</code>。当格式字符串为<code>iii</code>时，说明要将三个数字以整数类型转化为二进制。</p> 
<h3><a id="C_25"></a>与C语言的类型匹配关系</h3> 
<p>格式化字符串中的每个字符都代表一种数据类型，其中整型相关的字符如下，左侧为带符号整型，右侧为无符号整型</p> 
<table><thead><tr><th></th><th>C语言类型</th><th></th><th>C语言类型</th><th>标准大小</th></tr></thead><tbody><tr><td><strong>b</strong></td><td>signed char</td><td><strong>B</strong></td><td>unsigned char</td><td>1</td></tr><tr><td><strong>h</strong></td><td>short</td><td><strong>H</strong></td><td>unsigned short</td><td>2</td></tr><tr><td><strong>i</strong></td><td>int</td><td><strong>I</strong></td><td>unsigned int</td><td>4</td></tr><tr><td><strong>l</strong></td><td>long</td><td><strong>L</strong></td><td>unsigned long</td><td>4</td></tr><tr><td><strong>q</strong></td><td>long long</td><td><strong>Q</strong></td><td>unsigned long long</td><td>8</td></tr><tr><td><strong>n</strong></td><td>ssize_t</td><td><strong>N</strong></td><td>size_t</td><td></td></tr></tbody></table> 
<p>其他类型</p> 
<table><thead><tr><th>格式</th><th>C 类型</th><th>Python 类型</th><th>标准大小</th></tr></thead><tbody><tr><td><strong>x</strong></td><td>填充字节</td><td>无</td><td></td></tr><tr><td><strong>c</strong></td><td>char</td><td>长度为1的字节串</td><td></td></tr><tr><td><strong>?</strong></td><td>_Bool</td><td>bool</td><td>1</td></tr><tr><td><strong>e</strong></td><td></td><td>float</td><td>2</td></tr><tr><td><strong>f</strong></td><td>float</td><td>float</td><td>4</td></tr><tr><td><strong>d</strong></td><td>double</td><td>float</td><td>8</td></tr><tr><td><strong>s</strong></td><td>char[]</td><td>字节串</td><td></td></tr><tr><td><strong>p</strong></td><td>char[]</td><td>字节串</td><td></td></tr><tr><td><strong>P</strong></td><td>void*</td><td>整数</td><td></td></tr></tbody></table> 
<p><code>struct</code>中提供了获取标准大小的函数，<code>calcsize</code>:</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>calcsize<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>calcsize<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">)</span>
<span class="token number">4</span>
</code></pre> 
<p>除了声明被格式化时的数据类型，<code>struct</code>还可以指定对齐方式，例如</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"i"</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span>
<span class="token string">b'\x0f\x00\x00\x00'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"&gt;i"</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span>    <span class="token comment">#小端序</span>
<span class="token string">b'\x00\x00\x00\x0f'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"&lt;i"</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span>    <span class="token comment">#大端序</span>
<span class="token string">b'\x0f\x00\x00\x00'</span>
</code></pre> 
<p>其对应字符的含义分别为</p> 
<table><thead><tr><th><code>@</code></th><th><code>=</code></th><th><code>&lt;</code></th><th><code>&gt;</code></th><th><code>!</code></th></tr></thead><tbody><tr><td>本机</td><td>本机</td><td>小端</td><td>大端</td><td>网络(大端)</td></tr></tbody></table> 
<p>其中默认为<code>@</code>，即本机字节顺序。</p> 
<p>在熟悉了<code>pack</code>之后，与之对偶的<code>unpack</code>也就没啥难度了</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> test <span class="token operator">=</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"III"</span><span class="token punctuation">,</span><span class="token number">125</span><span class="token punctuation">,</span><span class="token number">1255</span><span class="token punctuation">,</span><span class="token number">12555</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">"III"</span><span class="token punctuation">,</span>test<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">1255</span><span class="token punctuation">,</span> <span class="token number">12555</span><span class="token punctuation">)</span>
</code></pre> 
<p>除了<code>pack</code>和<code>unpack</code>，<code>struct</code>模块还提供了C语言风格的一对函数<code>pack_into</code>和<code>unpack_from</code>，二者的声明分别为</p> 
<pre><code class="prism language-python">struct<span class="token punctuation">.</span>pack_into<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">,</span> <span class="token builtin">buffer</span><span class="token punctuation">,</span> offset<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
struct<span class="token punctuation">.</span>unpack_from<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">,</span> <span class="token builtin">buffer</span><span class="token punctuation">,</span> offset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>其中<code>buffer</code>表示缓冲流，在<code>pack_into</code>中，将<code>v1,v2...</code>以<code>offset</code>的偏置打包入<code>buffer</code>中；在<code>unpack_from</code>中，将<code>buffer</code>中的数据从<code>offset</code>处依次取出。</p> 
<p><code>struct</code>中封装了用于二进制处理的类<code>Struct</code>，按照以往经验，其<code>pack</code>函数的实现方法很有可能是下面这种</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">pack</span><span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Struct<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
</code></pre> 
<p>其中<code>Struct</code>的初始化方法就是输入一个格式化字符串，例如</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> s <span class="token operator">=</span> struct<span class="token punctuation">.</span>Struct<span class="token punctuation">(</span><span class="token string">"III"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> s<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token string">b'\x01\x00\x00\x00\x02\x00\x00\x00\x03\x00\x00\x00'</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9331b1b6a1e163bd5d49258e2ac3867a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安捷伦Agilent E8257D信号发生器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/775812eaf0435832138812db69eb7224/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【问题解决】uniapp-Vue3中u-popup滑动页面穿透问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>