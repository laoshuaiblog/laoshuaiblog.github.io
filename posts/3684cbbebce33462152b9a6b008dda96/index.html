<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GATK4实用技巧丨如何正确设置线程数和内存大小？ - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/3684cbbebce33462152b9a6b008dda96/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="GATK4实用技巧丨如何正确设置线程数和内存大小？">
  <meta property="og:description" content="GATK4 实用技巧 前言 本篇笔记围绕GATK4流程中注意事项进行介绍，包括如何选择合适的线程和内存？如何按步骤进行数据预处理。
GATK实战工作流程 脚本优化方法 参数设置技巧 GATK 全称“基因组分析工具箱” Genome Analysis Toolkit,它是一组命令行工具，用于分析高通量测序数据，主要侧重于变异发现。这些工具可以单独使用，也可以链接在一起形成完整的工作流程。
所需数据与软件 需要有简单的Linux知识储备和高通量基因组学基础，流程中用到的软件如下：
GATK 4.3.0.0
fastp 0.20.1
bwa 0.7.17
samtools 1.11
mosdepth 0.3.0
示例数据来自ERP001960项目，数据结构为illumina测序原始数据，包含三个样本，如果想重复测试需要大概700GB空间。 数据预处理 预处理的步骤包括质控、去接头、排序等，需要用到FATSP等工具，为了提高效率建议直接用fastp标准输出到BAM文件，避免不必要的磁盘读写，用管道串联起来能提高工作效率。
无论是否进行排序，都不要直接将未压缩的sam文件写入磁盘！最好用管道直接把两步合为一起生成排序去重之后的bam文件
fastp去除接头 使用fastp程序进行操作，为了提高数据吞吐效率，将默认输出信息定向到/dev/null中，避免磁盘读写。
fastp -i /lscratch/${SLURM_JOB_ID}/$(basename $r1) \
-I /lscratch/${SLURM_JOB_ID}/$(basename $r2) \
--stdout --thread $threads \
-j &#34;${logs}/fastp-${SLURM_JOB_ID}.json&#34; \
-h &#34;${logs}/fastp-${SLURM_JOB_ID}.html&#34; \
&amp;gt; /dev/null
下图展示了不同线程与处理速度的关系，很显然啊！这里如果超过6个线程就没多大意义了，设置6个线程就能达到最佳计算效率。 bwa mem 序列比对 比对过程实际上是拿着参考基因组，然后把每个小片段进行对齐，举个比较抽象的例子，就好比是拼图的过程，目的是让每一个小碎片都找到匹配的位置。
使用bwa mem程序进行比对，注意这里每个样品需要两条序列（因为二代双端测序两个方向是一对儿）。
bwa mem -M -t ${threads} \
-R &#34;@RG\tID:$id\tPL:ILLUMINA\tLB:$lb\tSM:$sm&#34; \
$genome \">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-08-06T10:03:17+08:00">
    <meta property="article:modified_time" content="2023-08-06T10:03:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GATK4实用技巧丨如何正确设置线程数和内存大小？</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <section id="nice" style="font-size: 16px; color: black; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; font-family: Roboto, Oxygen, Ubuntu, Cantarell, PingFangSC-light, PingFangTC-light, 'Open Sans', 'Helvetica Neue', sans-serif;"> 
 <h2 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; font-size: 1.5em; color: #009688; margin: 0.1em auto; text-align: center; border-bottom: 1px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">GATK4 实用技巧</span><span class="suffix"></span></h2> 
 <h3 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; font-size: 22px; color: #009688; padding-left: 10px; margin: 1em auto; border-left: 5px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">前言</span><span class="suffix"></span></h3> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;"><strong style="font-weight: bold; color: black;">本篇笔记围绕GATK4流程中注意事项进行介绍，包括如何选择合适的线程和内存？如何按步骤进行数据预处理。</strong></p> 
 <ul style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;"><li> 
   <section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">
     GATK实战工作流程 
   </section></li><li> 
   <section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">
     脚本优化方法 
   </section></li><li> 
   <section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">
     参数设置技巧 
   </section></li></ul> 
 <hr style="height: 1px; margin-top: 10px; margin-bottom: 10px; border: none; border-top: 1px solid black; margin: 20px 0;"> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">GATK 全称“基因组分析工具箱” Genome Analysis Toolkit,它是一组命令行工具，用于分析高通量测序数据，主要侧重于变异发现。这些工具可以单独使用，也可以链接在一起形成完整的工作流程。</p> 
 <h3 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; font-size: 22px; color: #009688; padding-left: 10px; margin: 1em auto; border-left: 5px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">所需数据与软件</span><span class="suffix"></span></h3> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">需要有简单的Linux知识储备和高通量基因组学基础，流程中用到的软件如下：</p> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #272822; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #272822; border-radius: 5px;">GATK 4.3.0.0<br>fastp 0.20.1<br>bwa 0.7.17<br>samtools 1.11<br>mosdepth 0.3.0<br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">示例数据来自ERP001960项目，数据结构为illumina测序原始数据，包含三个样本，如果想重复测试需要大概700GB空间。 <img src="https://images2.imgbox.com/66/88/8h9fvlkP_o.png" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px;"></p> 
 <h3 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; font-size: 22px; color: #009688; padding-left: 10px; margin: 1em auto; border-left: 5px solid #009688;"><span class="prefix" style="display: none;"></span><span class="content">数据预处理</span><span class="suffix"></span></h3> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">预处理的步骤包括质控、去接头、排序等，需要用到FATSP等工具，为了提高效率建议直接用fastp标准输出到BAM文件，避免不必要的磁盘读写，用管道串联起来能提高工作效率。</p> 
 <blockquote class="multiquote-1" style="border: none; display: block; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(0, 0, 0, 0.05); padding-top: 10px; padding-bottom: 10px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; border-left: 4px solid #898; padding-left: 1em; color: #777;"> 
  <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; text-align: justify; margin: 0px; color: black; line-height: 26px;"><strong style="font-weight: bold; color: black;">无论是否进行排序，都不要直接将未压缩的sam文件写入磁盘！</strong>最好用管道直接把两步合为一起生成排序去重之后的bam文件</p> 
 </blockquote> 
 <h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; margin: 0.6em auto; padding-left: 10px; font-size: 1.3em; border-left: 3px solid #451261;"><span class="prefix" style="display: none;"></span><span class="content">fastp去除接头</span><span class="suffix" style="display: none;"></span></h4> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">使用fastp程序进行操作，为了提高数据吞吐效率，将默认输出信息定向到/dev/null中，避免磁盘读写。</p> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #272822; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #272822; border-radius: 5px;">fastp -i /lscratch/<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${SLURM_JOB_ID}</span>/$(basename <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$r1</span>) \<br>     -I /lscratch/<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${SLURM_JOB_ID}</span>/$(basename <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$r2</span>) \<br>     --stdout --thread <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$threads</span> \<br>     -j <span class="hljs-string" style="color: #a6e22e; line-height: 26px;">"<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${logs}</span>/fastp-<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${SLURM_JOB_ID}</span>.json"</span> \<br>     -h <span class="hljs-string" style="color: #a6e22e; line-height: 26px;">"<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${logs}</span>/fastp-<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${SLURM_JOB_ID}</span>.html"</span> \<br>     &gt; /dev/null<br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">下图展示了不同线程与处理速度的关系，很显然啊！这里如果超过6个线程就没多大意义了，设置6个线程就能达到最佳计算效率。 <img src="https://images2.imgbox.com/61/da/eYbE3B6x_o.png" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px;"></p> 
 <h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; margin: 0.6em auto; padding-left: 10px; font-size: 1.3em; border-left: 3px solid #451261;"><span class="prefix" style="display: none;"></span><span class="content">bwa mem 序列比对</span><span class="suffix" style="display: none;"></span></h4> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">比对过程实际上是拿着参考基因组，然后把每个小片段进行对齐，举个比较抽象的例子，就好比是拼图的过程，目的是让每一个小碎片都找到匹配的位置。</p> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">使用bwa mem程序进行比对，注意这里每个样品需要两条序列（因为二代双端测序两个方向是一对儿）。</p> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #272822; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #272822; border-radius: 5px;">bwa mem -M -t <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${threads}</span> \<br>        -R <span class="hljs-string" style="color: #a6e22e; line-height: 26px;">"@RG\tID:<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$id</span>\tPL:ILLUMINA\tLB:<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$lb</span>\tSM:<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$sm</span>"</span> \<br>        <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$genome</span> \<br>        /lscratch/<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$SLURM_JOBID</span>/$(basename <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${r1[small]}</span>) \<br>        /lscratch/<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$SLURM_JOBID</span>/$(basename <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${r2[small]}</span>) \<br>        &gt; /dev/null<br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">通过下图可以看出线程数与计算效率的关系，很明显在32线程以内基本呈正相关，因此建议此处设置的线程数稍微高一点，理论上线程数越多的话，拼图的速度也越快，就好比你找了几个小伙伴帮你同时拼图。</p> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;"><img src="https://images2.imgbox.com/64/1a/0bYMqfAt_o.png" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px;"> 但是，也需要注意不要设置的太高，否侧多个线程的并行过程可能出现干扰，反而影响速度。就好比你为了拼一张地图把全校的人都叫过来了，一间屋里全是人，每个人移动起来都费劲，<strong style="font-weight: bold; color: black;">CPU也一样，线程过多相互打架</strong>。</p> 
 <h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; margin: 0.6em auto; padding-left: 10px; font-size: 1.3em; border-left: 3px solid #451261;"><span class="prefix" style="display: none;"></span><span class="content">samtools sort 排序</span><span class="suffix" style="display: none;"></span></h4> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">SAM文件输出后直接管道传递给sort进行排序，这样可以避免磁盘读写浪费时间（就好比买了一份外卖我直接吃就行了，没必要拿到厨房加工一下再取出来，多此一举浪费时间）。可以再理解一下磁盘吞吐和溢出概念，这对提高性能非常重要。</p> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">使用重定向把输出信息丢弃，基准测试过程中BAM文件大概25GB左右，临时文件储存在lscratch中，需要格外注意设置<strong style="font-weight: bold; color: black;">线程数</strong>和<strong style="font-weight: bold; color: black;">每个线程的内存大小</strong>时综合考虑，需要根据机器配置和计算需求灵活修改。</p> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #272822; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #272822; border-radius: 5px;">samtools sort -T /lscratch/<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$SLURM_JOBID</span>/part \<br>    -m <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${mem_mb_per_thread}</span>M \<br>    -@ <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${threads}</span> \<br>    -O BAM \<br>    /lscratch/<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$SLURM_JOBID</span>/$(basename <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$bam</span>) \<br>     &gt; /dev/null<br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">通过对比可以发现，在设置10个线程时，计算效率最高，盲目的增加线程数反而导致计算效率降低了。另外，启用10个线程之后，设置内存参数也对速度有影响，例如16线程状态下，采用10GB内存的速度比30GB明显要快。 <img src="https://images2.imgbox.com/95/39/IIyR3US1_o.png" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px;"> 为了方便理解，举个不太抽象的例子：假如有很多乒乓球，每个上面有一个数字编号，打乱后放在一个屋子里，想让你按顺序排好放到另一个屋子。</p> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">如果人数增加很明显是有助于提高排序速度（线程数增加），正常情况下每个人一次只能拿一个球（单个线程内存比较小），如果让每个人每次可以多拿几个球就可以避免来回跑（增加内存也能提高效率）。</p> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">但是存在某个临界情况，此时整体效率最大，也就是线程数和内存最匹配（上面图中的最高点处）。</p> 
 <h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; margin: 0.6em auto; padding-left: 10px; font-size: 1.3em; border-left: 3px solid #451261;"><span class="prefix" style="display: none;"></span><span class="content">samtools view转换bam文件</span><span class="suffix" style="display: none;"></span></h4> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">上步生成的sam文件要转换成bam文件，使用如下命令，此步骤占用的内存相对较少。</p> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #272822; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #272822; border-radius: 5px;">samtools view -@ <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${threads}</span> \<br>    -O BAM \<br>    /lscratch/\<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$SLURM_JOBID</span>/$(basename <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$sam</span>) \<br>    &gt; /dev/null<br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">通过下图发现这一步设置的线程数和计算速度呈正比关系，测试最大采用16线程。 <img src="https://images2.imgbox.com/6d/63/19kQOOFU_o.png" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px;"></p> 
 <h4 style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; margin: 0.6em auto; padding-left: 10px; font-size: 1.3em; border-left: 3px solid #451261;"><span class="prefix" style="display: none;"></span><span class="content">脚本的优化过程</span><span class="suffix" style="display: none;"></span></h4> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">有没有一种更厉害的方法，能达到比较高的计算效率呢？</p> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">下述代码中，使用两个管道命令将中间结果依次传递，采用32核心进行计算，完成了fastp、bwa、samtools等步骤。</p> 
 <pre class="custom" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #272822; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #272822; border-radius: 5px;">fastp -i <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$read1</span> -I <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$read2</span> \<br>    --stdout --thread 2 \<br>    -j <span class="hljs-string" style="color: #a6e22e; line-height: 26px;">"<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${logs}</span>/fastp-<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${SLURM_JOB_ID}</span>.json"</span> \<br>    -h <span class="hljs-string" style="color: #a6e22e; line-height: 26px;">"<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${logs}</span>/fastp-<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${SLURM_JOB_ID}</span>.html"</span> \<br>    2&gt; <span class="hljs-string" style="color: #a6e22e; line-height: 26px;">"<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${logs}</span>/fastp-<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${SLURM_JOB_ID}</span>.log"</span> \<br>| bwa mem -v 2 -M -t 32 -p \<br>    -R <span class="hljs-string" style="color: #a6e22e; line-height: 26px;">"@RG\tID:<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$id</span>\tPL:ILLUMINA\tLB:<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$lb</span>\tSM:<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$sm</span>"</span> \<br>    <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$genome</span> - 2&gt; <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${logs}</span>/bwa-<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${SLURM_JOB_ID}</span>.<span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">log</span> \<br>| samtools sort -T /lscratch/<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$SLURM_JOBID</span>/part \<br>    -m 1706M \<br>    -@ 12 \<br>    -O BAM \<br>    -o /lscratch/<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$SLURM_JOBID</span>/<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">$bam</span> \<br>    2&gt; <span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${logs}</span>/samtools-<span class="hljs-variable" style="color: #a6e22e; line-height: 26px;">${SLURM_JOB_ID}</span>.<span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">log</span><br></code></pre> 
 <p style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black; text-align: justify;">运行中占用的最大线程数为45左右，最大内存为60GB左右，大部分时间都是32线程进行运算，比对结果逐步记录到缓存区，当缓存区满了后再进行排序，这样极大地提高了效率。</p> 
 <figure style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"> 
  <img src="https://images2.imgbox.com/23/c1/sBB6lrA7_o.png" alt="alt" style="display: block; margin: 0 auto; max-width: 100%; margin-top: 10px; margin-bottom: 10px;"> 
 </figure> 
</section> 
<p>本文由<a href="https://mdnice.com/?platform=4" rel="nofollow"> mdnice </a>多平台发布</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5231eea327ad77ead1ffee6bc1ac22a9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Docker安装DolphinScheduler - mysql</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b1c20ecf56b7f7159d9ed4b6031b9603/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【PyTorch】nn.Conv2d函数详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>