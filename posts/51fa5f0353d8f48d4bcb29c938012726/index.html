<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python 墨西哥湾流（gulf stream）可视化 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/51fa5f0353d8f48d4bcb29c938012726/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Python 墨西哥湾流（gulf stream）可视化">
  <meta property="og:description" content="背景介绍 墨西哥湾流和黑潮分别是北半球两支强大的西边界流，墨西哥湾流的流速还要强于黑潮，也是温盐环流的重要组成部分。
引入涡度的概念，将涡度分为两个部分：
1、行星涡度，记为 f f f，与地球自转有关，纬度越高行星涡度越大，2、相对涡度，记为 ζ \zeta ζ，逆时针旋转为正涡度，顺时针旋转为负涡度。 位涡守恒：正压理想流体满足 d d t ( f &#43; ζ H ) = 0 \frac{d}{d t}\left(\frac{f&#43;\zeta}{H}\right)=0 dtd​(Hf&#43;ζ​)=0，其中 H H H表示流体柱高度。
在流体柱高度即水深不变的情况下，简化为 d f d t &#43; d ζ d t = 0 \frac{d f}{d t}&#43;\frac{d \zeta}{d t}=0 dtdf​&#43;dtdζ​=0
赤道盛行东风，中纬盛行西风，风生环流顺时针旋转，相对涡度为负。
在东边界，洋流向低纬，行星涡度 f f f减小，则风生环流涡度 ζ \zeta ζ必须增加，产生一个逆时针的环流抵消原本顺时针的环流，故东边界洋流速度减小。
在西边界，洋流向高纬，行星涡度 f f f增大，则风生环流涡度 ζ \zeta ζ必须减小，产生一个顺时针的环流增强原本顺时针的环流，故西边界洋流速度增大。
旋转效应下独有的西边界流强化的现象，又由于连续方程被约束在狭窄的通道内，于是就有了这么一条流速可高达2 m/s,相当于全世界河流总流量x十倍的物质流。
海表面温度的快照 上图为墨西哥湾海表面温度的快照
# This script takes sea-surface temperature data from Oct 27th 2017 and makes a nice plot.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-05-20T20:19:01+08:00">
    <meta property="article:modified_time" content="2023-05-20T20:19:01+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python 墨西哥湾流（gulf stream）可视化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>背景介绍</h3> 
<p><strong>墨西哥湾流</strong>和<strong>黑潮</strong>分别是北半球两支强大的西边界流，墨西哥湾流的流速还要强于黑潮，也是温盐环流的重要组成部分。<br> <img src="https://images2.imgbox.com/69/08/V3KkOO8Z_o.png" alt="在这里插入图片描述"></p> 
<p>引入涡度的概念，将涡度分为两个部分：</p> 
<ul><li>1、行星涡度，记为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          f 
         
        
       
         f 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span></span></span></span></span>，与地球自转有关，纬度越高行星涡度越大，</li><li>2、相对涡度，记为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ζ 
         
        
       
         \zeta 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0738em;">ζ</span></span></span></span></span>，逆时针旋转为正涡度，顺时针旋转为负涡度。</li></ul> 
<p>位涡守恒：正压理想流体满足<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          d 
         
         
         
           d 
          
         
           t 
          
         
        
        
        
          ( 
         
         
          
          
            f 
           
          
            + 
           
          
            ζ 
           
          
         
           H 
          
         
        
          ) 
         
        
       
         = 
        
       
         0 
        
       
      
        \frac{d}{d t}\left(\frac{f+\zeta}{H}\right)=0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.8em; vertical-align: -0.65em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8801em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">t</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9322em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em;">H</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4461em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1076em;">f</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right: 0.0738em;">ζ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0</span></span></span></span></span>，其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         H 
        
       
      
        H 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0813em;">H</span></span></span></span></span>表示流体柱高度。<br> 在流体柱高度即水深不变的情况下，简化为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
         
           d 
          
         
           f 
          
         
         
         
           d 
          
         
           t 
          
         
        
       
         + 
        
        
         
         
           d 
          
         
           ζ 
          
         
         
         
           d 
          
         
           t 
          
         
        
       
         = 
        
       
         0 
        
       
      
        \frac{d f}{d t}+\frac{d \zeta}{d t}=0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.2772em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9322em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">t</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4461em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1076em;">df</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.2772em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9322em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">t</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4461em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight" style="margin-right: 0.0738em;">ζ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0</span></span></span></span></span></p> 
<p>赤道盛行东风，中纬盛行西风，风生环流顺时针旋转，相对涡度为负。</p> 
<blockquote> 
 <p>在东边界，洋流向低纬，行星涡度<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          f 
         
        
       
         f 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span></span></span></span></span>减小，则风生环流涡度<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ζ 
         
        
       
         \zeta 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0738em;">ζ</span></span></span></span></span>必须增加，产生一个逆时针的环流抵消原本顺时针的环流，故东边界洋流速度减小。<br> 在西边界，洋流向高纬，行星涡度<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          f 
         
        
       
         f 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span></span></span></span></span>增大，则风生环流涡度<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ζ 
         
        
       
         \zeta 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0738em;">ζ</span></span></span></span></span>必须减小，产生一个顺时针的环流增强原本顺时针的环流，故西边界洋流速度增大。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/03/4c/weBHiJnM_o.png" alt="在这里插入图片描述"><br> 旋转效应下独有的西边界流强化的现象，又由于连续方程被约束在狭窄的通道内，于是就有了这么一条流速可高达<code>2 m/s</code>,相当于全世界河流总流量x十倍的物质流。</p> 
<h3><a id="_20"></a>海表面温度的快照</h3> 
<center> 
 <img src="https://images2.imgbox.com/27/b6/eb4BRVHH_o.png" width="80%"> 
</center> 
<blockquote> 
 <p>上图为墨西哥湾海表面温度的快照</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># This script takes sea-surface temperature data from Oct 27th 2017 and makes a nice plot. The data is high-resolution satellite data.</span>
<span class="token comment"># 9点的快照</span>

<span class="token keyword">from</span> netCDF4 <span class="token keyword">import</span> Dataset
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>basemap <span class="token keyword">import</span> Basemap

<span class="token comment">########## 导入数据 ##########</span>
<span class="token comment"># 注意在这里使用的是ECMWF的海表面温度</span>
<span class="token comment"># 经度是0-360，0度开始于英国本初子午线</span>
data <span class="token operator">=</span> Dataset<span class="token punctuation">(</span><span class="token string">'data/20171027_9.nc'</span><span class="token punctuation">)</span>

<span class="token comment"># get SST data into a numpy array</span>
sst <span class="token operator">=</span> np<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span> data<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">'sst'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>

<span class="token comment"># get lon and lat vectors</span>
lon <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span> data<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">'longitude'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
lat <span class="token operator">=</span> np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span> data<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">'latitude'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>

<span class="token comment"># extract the North Atlantic region </span>
<span class="token comment"># 显示范围</span>
lonMap<span class="token punctuation">,</span> latMap <span class="token operator">=</span> <span class="token number">270</span><span class="token punctuation">,</span> <span class="token number">20</span>    <span class="token comment"># lower left corner of region</span>
w<span class="token punctuation">,</span> h <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">80</span>          <span class="token comment"># width and height of region in degrees</span>

lon0<span class="token punctuation">,</span> lat0 <span class="token operator">=</span> lonMap<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> latMap<span class="token operator">-</span><span class="token number">20</span>  <span class="token comment"># coordinates to extract SST values</span>
<span class="token comment"># 由于倾斜所以这个范围要显示更大</span>

sst <span class="token operator">=</span> sst<span class="token punctuation">[</span> <span class="token punctuation">(</span>lat<span class="token operator">&gt;</span>lat0<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>lat<span class="token operator">&lt;</span>lat0<span class="token operator">+</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">:</span> <span class="token punctuation">]</span>
sst <span class="token operator">=</span> sst<span class="token punctuation">[</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>lon<span class="token operator">&gt;</span>lon0<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>lon<span class="token operator">&lt;</span>lon0<span class="token operator">+</span>w<span class="token punctuation">)</span> <span class="token punctuation">]</span>

lon <span class="token operator">=</span> lon<span class="token punctuation">[</span> <span class="token punctuation">(</span>lon<span class="token operator">&gt;</span>lon0<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>lon<span class="token operator">&lt;</span>lon0<span class="token operator">+</span>w<span class="token punctuation">)</span> <span class="token punctuation">]</span>
lat <span class="token operator">=</span> lat<span class="token punctuation">[</span> <span class="token punctuation">(</span>lat<span class="token operator">&gt;</span>lat0<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>lat<span class="token operator">&lt;</span>lat0<span class="token operator">+</span>h<span class="token punctuation">)</span> <span class="token punctuation">]</span>

<span class="token comment"># land values are represented by a large negative number; modify these to NaNs</span>
sst<span class="token punctuation">[</span> sst <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">290</span>

<span class="token comment">########## Construct a basemap instance ##########</span>

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token comment"># ax = fig.add_axes( [0.1,0.1,0.8,0.8], axisbg='white' )</span>
ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_axes<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># make an initial map  # 显示中心的位置</span>
m0 <span class="token operator">=</span> Basemap<span class="token punctuation">(</span>projection<span class="token operator">=</span><span class="token string">'ortho'</span><span class="token punctuation">,</span>lon_0<span class="token operator">=</span>lonMap<span class="token operator">+</span><span class="token number">30</span><span class="token punctuation">,</span>lat_0<span class="token operator">=</span>latMap<span class="token punctuation">,</span>resolution<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>

<span class="token comment"># make a map viewing the edge of the earth</span>
myMap <span class="token operator">=</span> Basemap<span class="token punctuation">(</span> projection<span class="token operator">=</span><span class="token string">'ortho'</span><span class="token punctuation">,</span> lon_0<span class="token operator">=</span>lonMap<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span> lat_0<span class="token operator">=</span>latMap<span class="token punctuation">,</span> resolution<span class="token operator">=</span><span class="token string">'l'</span><span class="token punctuation">,</span>
            llcrnrx<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1e6</span><span class="token punctuation">,</span>llcrnry<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>urcrnrx<span class="token operator">=</span>m0<span class="token punctuation">.</span>urcrnrx<span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span>urcrnry<span class="token operator">=</span>m0<span class="token punctuation">.</span>urcrnry<span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># add details</span>
myMap<span class="token punctuation">.</span>drawcoastlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
myMap<span class="token punctuation">.</span>drawmapboundary<span class="token punctuation">(</span>fill_color<span class="token operator">=</span><span class="token string">'aqua'</span><span class="token punctuation">)</span>
myMap<span class="token punctuation">.</span>fillcontinents<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">'grey'</span><span class="token punctuation">,</span>lake_color<span class="token operator">=</span><span class="token string">'slateblue'</span><span class="token punctuation">)</span>
myMap<span class="token punctuation">.</span>drawcountries<span class="token punctuation">(</span><span class="token punctuation">)</span>
myMap<span class="token punctuation">.</span>drawparallels<span class="token punctuation">(</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
myMap<span class="token punctuation">.</span>drawmeridians<span class="token punctuation">(</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">360</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
myMap<span class="token punctuation">.</span>drawmapboundary<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment">########## Plotting ##########</span>

<span class="token comment"># get projection coordinates from lat and lon</span>
lon<span class="token punctuation">,</span> lat <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span> lon<span class="token punctuation">,</span> lat <span class="token punctuation">)</span>
x<span class="token punctuation">,</span> y <span class="token operator">=</span> myMap<span class="token punctuation">(</span> lon<span class="token punctuation">,</span> lat <span class="token punctuation">)</span>

<span class="token comment"># plot SST contours</span>
myMap<span class="token punctuation">.</span>pcolor<span class="token punctuation">(</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> sst <span class="token operator">-</span> <span class="token number">273.15</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'coolwarm'</span><span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">28</span> <span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Sea-Surface Temperature on 9:00 27/10/2017"</span><span class="token punctuation">)</span>

<span class="token comment"># add a colorbar</span>
cBar <span class="token operator">=</span> plt<span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span><span class="token punctuation">)</span>
cBar<span class="token punctuation">.</span>set_label<span class="token punctuation">(</span><span class="token string">'Temperature ($^\circ$C)'</span><span class="token punctuation">)</span>
cBar<span class="token punctuation">.</span>set_ticks<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
cBar<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'&lt;5.0'</span><span class="token punctuation">,</span><span class="token string">'10.0'</span><span class="token punctuation">,</span><span class="token string">'15.0'</span><span class="token punctuation">,</span><span class="token string">'20.0'</span><span class="token punctuation">,</span><span class="token string">'25.0'</span><span class="token punctuation">,</span><span class="token string">'&gt;28.0'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>

<span class="token comment">#plt.savefig( 'test.png', format='png', dpi=400 )</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>这段代码是一个从2017年10月27日获取高分辨率卫星海表温度数据，并生成一个漂亮的图形的脚本。代码中使用了NetCDF4库来导入海表温度数据，使用了NumPy库进行数据处理和数组操作，以及使用了Matplotlib库和Basemap模块来进行绘图和地图投影。</p> 
<p>代码的主要步骤如下：</p> 
<ol><li> <p>导入所需的库：从NetCDF4库中导入Dataset类，从NumPy库中导入numpy模块，从Matplotlib库中导入pyplot模块，从Basemap模块中导入Basemap类。</p> </li><li> <p>导入数据：使用Dataset类打开一个NetCDF文件，并将海表温度数据（‘sst’）以numpy数组的形式读取出来。同时获取经度（‘longitude’）和纬度（‘latitude’）的向量数据。</p> </li><li> <p>提取感兴趣的区域：根据指定的经纬度范围，从整个数据集中提取出所需的区域和相应的经纬度数据。同时将陆地上的数值修改为NaN。</p> </li><li> <p>构建Basemap实例：创建一个图形，并在图形上添加一个Axes对象。使用Basemap类创建两个地图实例，一个是初始的地图（projection=‘ortho’），另一个是显示特定区域的地图。</p> </li><li> <p>添加地图细节：在显示特定区域的地图上添加海岸线、地图边界、陆地填充、国家边界以及纬度和经度线。</p> </li><li> <p>绘图：根据经纬度数据，将其转换为投影坐标，并使用pcolor方法绘制海表温度数据的等值线图。</p> </li><li> <p>添加标题和颜色条：为图形添加标题，并使用colorbar方法添加颜色条，以显示温度的范围和相应的标签。</p> </li><li> <p>显示图形：使用show方法显示生成的图形。</p> </li></ol> 
<p>这段代码的目标是生成一个展示2017年10月27日9点海表温度数据的图形，并使用颜色条表示温度范围。图形展示了北大西洋地区的海表温度，以及周围的地理特征和地图投影效果。</p> 
<h3><a id="3D_130"></a>地形3D图</h3> 
<pre><code class="prism language-python"><span class="token comment"># This script takes a snapshot of sea-surface height and makes a</span>
<span class="token comment"># 3D visualisation of the data.</span>
<span class="token keyword">import</span> matplotlib

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io <span class="token keyword">as</span> sio
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> Axes3D
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> cm

<span class="token comment">########## Prepare data ##########</span>

<span class="token comment"># load data</span>
adt <span class="token operator">=</span> np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span> sio<span class="token punctuation">.</span>loadmat<span class="token punctuation">(</span><span class="token string">'data/adt.mat'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'adt_all'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

<span class="token comment"># choose day to visualise</span>
t0 <span class="token operator">=</span> <span class="token number">100</span>
snapshot <span class="token operator">=</span> np<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span> adt<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>t0<span class="token punctuation">]</span> <span class="token punctuation">)</span>

<span class="token comment"># change land values</span>
adt<span class="token punctuation">[</span> np<span class="token punctuation">.</span>isnan<span class="token punctuation">(</span> adt <span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.5</span>

<span class="token comment"># define lon and lat</span>
lon<span class="token punctuation">,</span> lat <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">121</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">81</span><span class="token punctuation">)</span>
lon<span class="token punctuation">,</span> lat <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span> lon<span class="token punctuation">,</span> lat <span class="token punctuation">)</span>

<span class="token comment">########## Plotting #########</span>

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
ax3D <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span> <span class="token number">111</span><span class="token punctuation">,</span> projection<span class="token operator">=</span><span class="token string">'3d'</span> <span class="token punctuation">)</span>

<span class="token comment"># make custom palette</span>
cMap <span class="token operator">=</span> cm<span class="token punctuation">.</span>bone
cMap<span class="token punctuation">.</span>set_under<span class="token punctuation">(</span> <span class="token string">'saddlebrown'</span> <span class="token punctuation">)</span>

<span class="token comment"># draw surface</span>
surf3D <span class="token operator">=</span> ax3D<span class="token punctuation">.</span>plot_surface<span class="token punctuation">(</span> lon<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> snapshot<span class="token punctuation">,</span> cmap<span class="token operator">=</span>cMap<span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">1.5</span> <span class="token punctuation">)</span>

<span class="token comment"># tidy up</span>
ax3D<span class="token punctuation">.</span>set_zlim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
ax3D<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
ax3D<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

ax3D<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">75</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">55</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
ax3D<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'75$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'70$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'65$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'60$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'55$^\circ$'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
ax3D<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
ax3D<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'32$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'36$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'40$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'44$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'48$^\circ$'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

ax3D<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_tick_params<span class="token punctuation">(</span> labelsize<span class="token operator">=</span><span class="token number">12</span> <span class="token punctuation">)</span>
ax3D<span class="token punctuation">.</span>yaxis<span class="token punctuation">.</span>set_tick_params<span class="token punctuation">(</span> labelsize<span class="token operator">=</span><span class="token number">12</span> <span class="token punctuation">)</span>
ax3D<span class="token punctuation">.</span>zaxis<span class="token punctuation">.</span>set_tick_params<span class="token punctuation">(</span> labelsize<span class="token operator">=</span><span class="token number">12</span> <span class="token punctuation">)</span>

ax3D<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Latitude'</span><span class="token punctuation">)</span>
ax3D<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'Longitude'</span><span class="token punctuation">)</span>
ax3D<span class="token punctuation">.</span>set_zlabel<span class="token punctuation">(</span><span class="token string">'Height'</span><span class="token punctuation">)</span>

<span class="token comment"># add colorbar</span>
cBar <span class="token operator">=</span> fig<span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span> surf3D<span class="token punctuation">,</span> extend<span class="token operator">=</span><span class="token string">'both'</span> <span class="token punctuation">)</span>
cBar<span class="token punctuation">.</span>set_label<span class="token punctuation">(</span><span class="token string">'Sea surface heigt (m)'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span> <span class="token punctuation">)</span>

<span class="token comment"># change 'camera' position</span>
ax3D<span class="token punctuation">.</span>view_init<span class="token punctuation">(</span> elev<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> azim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">150</span> <span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span> <span class="token string">'gulfStreamSSH3D_snapshot.png'</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">800</span> <span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>这个 Python 脚本创建了一个海表面高度数据的 3D 可视化。以下是代码的具体步骤：</p> 
<ol><li>导入所需的模块：<code>matplotlib</code>、<code>numpy</code>、<code>scipy.io</code>、<code>pandas</code> 和 <code>mpl_toolkits.mplot3d</code> 中的 <code>Axes3D</code>。</li><li>使用 <code>scipy.io</code> 模块的 <code>loadmat()</code> 函数从 .mat 文件中加载海表面高度数据。<code>transpose()</code> 函数用于交换数据数组的维度顺序。</li><li>选择要可视化的数据快照。</li><li>将数据数组中的任何 <code>NaN</code> 值替换为 <code>-0.5</code>。</li><li>使用 <code>numpy</code> 的 <code>linspace()</code> 和 <code>meshgrid()</code> 函数定义数据网格的经度和纬度值。</li><li>创建一个具有 3D 坐标轴的新图形，使用 <code>fig.add_subplot()</code> 函数并设置 <code>projection='3d'</code> 参数。</li><li>使用 <code>cm.bone</code> 设置自定义颜色映射，并使用 <code>set_under()</code> 和 <code>vmin</code>、<code>vmax</code> 参数设置颜色映射的最小和最大值。</li><li>使用<code>plot_surface()</code> 函数绘制数据的表面，将 <code>lon</code>、<code>lat</code> 和 <code>snapshot</code> 数据数组作为参数。</li><li>使用 <code>set_xlim()</code>、<code>set_ylim()</code>、<code>set_zlim()</code>、<code>set_xticks()</code>、<code>set_yticks()</code>、<code>set_xticklabels()</code> 和 <code>set_yticklabels()</code> 设置 x、y 和 z 轴的限制和标签。</li><li>使用 <code>colorbar()</code> 为图形添加颜色条。</li><li>使用 <code>set_label()</code> 设置颜色条和 z 轴的标签。</li><li>使用 <code>view_init()</code> 更改 3D 绘图的视角。</li><li>使用 <code>savefig()</code> 将图形保存为 PNG 图像。</li><li>使用 <code>show()</code> 显示图形。</li></ol> 
<p><img src="https://images2.imgbox.com/fc/da/rfrxFS2e_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="GIF_221"></a>海表面高度的GIF图</h3> 
<pre><code class="prism language-python"><span class="token comment"># This script takes absolute dynamic topography (ADT) satellite altimetry data from</span>
<span class="token comment"># the Gulf Stream region, and produces an animation from the daily 2D snapshots.</span>

<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib <span class="token keyword">as</span> mpl
matplotlib<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">'TkAgg'</span><span class="token punctuation">)</span>
<span class="token comment"># matplotlib.use("Agg")</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io <span class="token keyword">as</span> sio
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>basemap <span class="token keyword">import</span> Basemap
<span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>cm <span class="token keyword">import</span> get_cmap
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>animation <span class="token keyword">as</span> manimation

<span class="token comment"># uncomment this line if you want to see the plots as they are saved</span>
<span class="token comment">#plt.ion()</span>

<span class="token comment"># load data</span>
adt <span class="token operator">=</span> np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span> sio<span class="token punctuation">.</span>loadmat<span class="token punctuation">(</span><span class="token string">'data/adt.mat'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'adt_all'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token comment"># 转换 经度 纬度</span>

<span class="token comment">########## Make a basemap instance ##########</span>

cMap <span class="token operator">=</span> get_cmap<span class="token punctuation">(</span><span class="token string">'ocean'</span><span class="token punctuation">)</span>
lakeColor <span class="token operator">=</span> cMap<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

<span class="token comment"># set up orthographic map projection with perspective of satellite looking down at 40N, 65W.</span>
<span class="token builtin">map</span> <span class="token operator">=</span> Basemap<span class="token punctuation">(</span> projection<span class="token operator">=</span><span class="token string">'stere'</span><span class="token punctuation">,</span> lat_0<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span> lon_0<span class="token operator">=</span><span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span> resolution<span class="token operator">=</span><span class="token string">'l'</span><span class="token punctuation">,</span> llcrnrlon<span class="token operator">=</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span> llcrnrlat<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">.</span><span class="token punctuation">,</span> urcrnrlon<span class="token operator">=</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> urcrnrlat<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> suppress_ticks<span class="token operator">=</span><span class="token boolean">True</span> <span class="token punctuation">)</span>

<span class="token comment"># get projections of lon and lat in axis coordinates</span>
lon<span class="token punctuation">,</span> lat <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">121</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">81</span> <span class="token punctuation">)</span>
lonGrid<span class="token punctuation">,</span> latGrid <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span> lon<span class="token punctuation">,</span> lat <span class="token punctuation">)</span>
x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span> lonGrid<span class="token punctuation">,</span> latGrid <span class="token punctuation">)</span>

<span class="token comment"># get projections for various places  单独的几个城市</span>
xNY<span class="token punctuation">,</span> yNY <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">74.00</span><span class="token punctuation">,</span> <span class="token number">40.71</span> <span class="token punctuation">)</span>     <span class="token comment"># New York</span>
xCH<span class="token punctuation">,</span> yCH <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">75.54</span><span class="token punctuation">,</span> <span class="token number">35.25</span> <span class="token punctuation">)</span>     <span class="token comment"># Cape Hatteras</span>
xB<span class="token punctuation">,</span> yB <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">71.06</span><span class="token punctuation">,</span> <span class="token number">42.36</span> <span class="token punctuation">)</span>       <span class="token comment"># Boston</span>

<span class="token comment"># define ADT spacings for contourf function and the datelist for title</span>
adtSpacings <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">13</span> <span class="token punctuation">)</span>
dateList <span class="token operator">=</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span> <span class="token string">'1993-01-01'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span>adt<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'D'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment">########## Make video ##########</span>

FFMpegWriter <span class="token operator">=</span> manimation<span class="token punctuation">.</span>writers<span class="token punctuation">[</span><span class="token string">'ffmpeg'</span><span class="token punctuation">]</span>
metadata <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span> title<span class="token operator">=</span><span class="token string">'Gulf Stream SSH'</span><span class="token punctuation">,</span> artist<span class="token operator">=</span><span class="token string">'Tom Bolton'</span><span class="token punctuation">,</span> comment<span class="token operator">=</span><span class="token string">'Gulf Stream Visualization of AVISO ADT data.'</span> <span class="token punctuation">)</span>
writer <span class="token operator">=</span> FFMpegWriter<span class="token punctuation">(</span> fps<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">,</span> metadata<span class="token operator">=</span>metadata<span class="token punctuation">,</span> bitrate<span class="token operator">=</span><span class="token number">30000</span><span class="token punctuation">,</span> codec<span class="token operator">=</span><span class="token string">'libx264'</span> <span class="token punctuation">)</span>

<span class="token keyword">with</span> writer<span class="token punctuation">.</span>saving<span class="token punctuation">(</span> fig<span class="token punctuation">,</span> <span class="token string">"gulfStreamSSH_b.gif"</span><span class="token punctuation">,</span> <span class="token number">100</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span>

    <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># t 时间维度</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>

        <span class="token comment"># draw coastlines, country boundaries, fill continents.</span>
        <span class="token builtin">map</span><span class="token punctuation">.</span>drawcoastlines<span class="token punctuation">(</span>linewidth<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">)</span>
        <span class="token builtin">map</span><span class="token punctuation">.</span>fillcontinents<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">'indianred'</span><span class="token punctuation">,</span> lake_color<span class="token operator">=</span>lakeColor<span class="token punctuation">)</span>

        <span class="token comment"># add lon and lat axis labels</span>
        <span class="token builtin">map</span><span class="token punctuation">.</span>drawparallels<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">)</span>
        <span class="token builtin">map</span><span class="token punctuation">.</span>drawmeridians<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">)</span>

        <span class="token comment"># draw the edge of the map projection region (the projection limb)</span>
        <span class="token builtin">map</span><span class="token punctuation">.</span>drawmapboundary<span class="token punctuation">(</span>fill_color<span class="token operator">=</span>lakeColor<span class="token punctuation">)</span>
        <span class="token builtin">map</span><span class="token punctuation">.</span>drawstates<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token builtin">map</span><span class="token punctuation">.</span>drawcountries<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># make a string for the date</span>
        titleString <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>dateList<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span>
        titleString <span class="token operator">=</span> titleString<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>

        <span class="token comment"># plot the sea-surface height contours</span>
        cf <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> adt<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token punctuation">]</span><span class="token punctuation">,</span> levels<span class="token operator">=</span>adtSpacings<span class="token punctuation">,</span> extend<span class="token operator">=</span><span class="token string">'max'</span><span class="token punctuation">,</span>
                          cmap<span class="token operator">=</span><span class="token string">'ocean'</span><span class="token punctuation">,</span> vmin<span class="token operator">=</span>adtSpacings<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span>adtSpacings<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>

        <span class="token comment"># if SSH value goes over the max level, make this appear as white</span>
        <span class="token comment"># cmap = mpl.cm.get_cmap("ocean").copy()</span>
        <span class="token comment"># cf.cmap.set_over('white')</span>

        <span class="token comment"># add colorbar</span>
        cbar <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span> cf<span class="token punctuation">,</span> location<span class="token operator">=</span><span class="token string">'right'</span> <span class="token punctuation">)</span>
        cbar<span class="token punctuation">.</span>set_label<span class="token punctuation">(</span><span class="token string">'SSH (m)'</span><span class="token punctuation">)</span>

        <span class="token comment"># plot title</span>
        plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span> <span class="token string">"Sea-surface height     "</span> <span class="token operator">+</span> titleString<span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">15</span> <span class="token punctuation">)</span>

        <span class="token comment"># annotate New York</span>
        plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span> xNY<span class="token operator">-</span><span class="token number">50000</span><span class="token punctuation">,</span> yNY<span class="token punctuation">,</span> <span class="token string">'New York'</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'white'</span><span class="token punctuation">,</span> fontweight<span class="token operator">=</span><span class="token string">'bold'</span> <span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span> xNY<span class="token punctuation">,</span> yNY<span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> mfc<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> mec<span class="token operator">=</span><span class="token string">'white'</span><span class="token punctuation">,</span> mew<span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">)</span>

        <span class="token comment"># annotate Cape Hatteras</span>
        plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span>xCH <span class="token operator">-</span> <span class="token number">50000</span><span class="token punctuation">,</span> yCH<span class="token punctuation">,</span> <span class="token string">'Cape\n Hatteras'</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'white'</span><span class="token punctuation">,</span> fontweight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>xCH<span class="token punctuation">,</span> yCH<span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> mfc<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> mec<span class="token operator">=</span><span class="token string">'white'</span><span class="token punctuation">,</span> mew<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token comment"># annotate Boston</span>
        plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span>xB <span class="token operator">-</span> <span class="token number">50000</span><span class="token punctuation">,</span> yB<span class="token punctuation">,</span> <span class="token string">'Boston'</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'white'</span><span class="token punctuation">,</span> fontweight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>xB<span class="token punctuation">,</span> yB<span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> mfc<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> mec<span class="token operator">=</span><span class="token string">'white'</span><span class="token punctuation">,</span> mew<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token comment"># save this figure as a frame</span>
        plt<span class="token punctuation">.</span>pause<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>grab_frame<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># clear the axis data so it doesn't accumulate</span>
        plt<span class="token punctuation">.</span>cla<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>这个 Python 脚本从海洋中心的绝对动态地形（Absolute Dynamic Topography，ADT）卫星高度计数据中，生成每日 2D 快照的动画。</p> 
<p>以下是代码的具体步骤：</p> 
<ol><li>导入所需的模块：<code>matplotlib</code>、<code>numpy</code>、<code>scipy.io</code>、<code>pandas</code>、<code>Basemap</code> 和 <code>animation</code> 中的 <code>FFMpegWriter</code>。</li><li>加载数据。使用 <code>scipy.io</code> 模块的 <code>loadmat()</code> 函数从 .mat 文件中加载海表面高度数据。使用 <code>transpose()</code> 函数将数据数组的维度顺序进行转换。</li><li>创建一个 <code>Basemap</code> 实例，设置地图投影方式、中心点、边界、分辨率等参数，并获取经度和纬度在轴坐标系中的投影。</li><li>定义 ADT 间距和日期列表以用于标题。</li><li>创建一个 <code>FFMpegWriter</code> 实例，设置输出视频的参数，包括帧率、元数据、比特率和编解码器。</li><li>在 <code>writer.saving()</code> 中使用 <code>grab_frame()</code> 函数和 <code>writer</code> 对象来保存视频。</li><li>在每个时间步骤中，绘制海岸线、国界线和大陆，添加经度和纬度轴标签，绘制地图边界、州界和国界等。</li><li>将当前时间步骤的日期转换为字符串格式，并将其用作标题的一部分。</li><li>使用 <code>contourf()</code> 函数绘制 ADT 数据的海表面高度轮廓，设置轮廓线的间距和颜色映射。</li><li>添加颜色条，并设置其标签。</li><li>标注三个城市（纽约、哈特角和波士顿），并在地图上绘制它们的位置。</li><li>保存当前帧，并清除坐标轴数据以避免积累。</li></ol> 
<p>值得注意的是，此脚本生成的视频需要依赖第三方库 <code>ffmpeg</code>，需要先安装该库才能运行脚本。</p> 
<p><img src="https://images2.imgbox.com/43/83/wgexQ2Lt_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="_357"></a>流场的快照</h3> 
<pre><code class="prism language-python"><span class="token comment"># This script takes velocity data from within the Gulf Stream and makes</span>
<span class="token comment"># a stream plot.</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io <span class="token keyword">as</span> sio


<span class="token comment">########## Prepare data ##########</span>

data <span class="token operator">=</span> sio<span class="token punctuation">.</span>loadmat<span class="token punctuation">(</span><span class="token string">'data/uv.mat'</span><span class="token punctuation">)</span>

u <span class="token operator">=</span> np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span> data<span class="token punctuation">[</span><span class="token string">'u_all'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
v <span class="token operator">=</span> np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span> data<span class="token punctuation">[</span><span class="token string">'v_all'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

lon<span class="token punctuation">,</span> lat <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">121</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">81</span> <span class="token punctuation">)</span>

lon1 <span class="token operator">=</span> lon<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
lat1 <span class="token operator">=</span> lat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

speed <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span> np<span class="token punctuation">.</span>square<span class="token punctuation">(</span> u<span class="token punctuation">,</span> u <span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>square<span class="token punctuation">(</span> v<span class="token punctuation">,</span> v <span class="token punctuation">)</span> <span class="token punctuation">)</span>

<span class="token comment"># make a land mask (from nan values)</span>
landMask <span class="token operator">=</span> np<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span> speed<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
landMask<span class="token punctuation">[</span> <span class="token operator">~</span>np<span class="token punctuation">.</span>isnan<span class="token punctuation">(</span> landMask <span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
landMask<span class="token punctuation">[</span> np<span class="token punctuation">.</span>isnan<span class="token punctuation">(</span> landMask <span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
landMask<span class="token punctuation">[</span> landMask <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan

lonGrid<span class="token punctuation">,</span> latGrid <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span> lon1<span class="token punctuation">,</span> lat1 <span class="token punctuation">)</span>

<span class="token comment">#lonLand, latLand = lonGrid[ np.isnan( landMask ) ], latGrid[ np.isnan( landMask ) ]</span>
<span class="token comment">#land = landMask[ np.isnan( landMask ) ]</span>
<span class="token comment">#land = 1</span>

<span class="token comment">########## Plotting ##########</span>

<span class="token comment"># prepare subplots</span>
fig<span class="token punctuation">,</span> axArr <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> sharex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> sharey<span class="token operator">=</span><span class="token boolean">True</span> <span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>set_size_inches<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

<span class="token comment"># sub-sampling rate for quiver</span>
n<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># choose which day to plot</span>
t0 <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment"># use each method</span>
im0 <span class="token operator">=</span> axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pcolor<span class="token punctuation">(</span> lon<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> speed<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>t0<span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'hot'</span><span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">1.6</span> <span class="token punctuation">)</span>
im1 <span class="token operator">=</span> axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contourf<span class="token punctuation">(</span> lon<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> speed<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>t0<span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'hot'</span><span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">1.6</span> <span class="token punctuation">)</span>
im2 <span class="token operator">=</span> axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>quiver<span class="token punctuation">(</span> lon1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">,</span> lat1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">,</span> u<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span>t0<span class="token punctuation">]</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span>t0<span class="token punctuation">]</span><span class="token punctuation">,</span> speed<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span>t0<span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'hot'</span><span class="token punctuation">,</span> clim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1.6</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
im3 <span class="token operator">=</span> axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>streamplot<span class="token punctuation">(</span> lon<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> u<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>t0<span class="token punctuation">]</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>t0<span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span>speed<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>t0<span class="token punctuation">]</span><span class="token punctuation">,</span>
                             density<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'hot'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token operator">*</span>speed<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>t0<span class="token punctuation">]</span><span class="token punctuation">,</span> arrowsize<span class="token operator">=</span><span class="token number">0.5</span> <span class="token punctuation">)</span>

<span class="token comment"># add land to each plot</span>
axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contourf<span class="token punctuation">(</span> lonGrid<span class="token punctuation">,</span> latGrid<span class="token punctuation">,</span> landMask<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'Greys'</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contourf<span class="token punctuation">(</span> lonGrid<span class="token punctuation">,</span> latGrid<span class="token punctuation">,</span> landMask<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'Greys'</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contourf<span class="token punctuation">(</span> lonGrid<span class="token punctuation">,</span> latGrid<span class="token punctuation">,</span> landMask<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'Greys'</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contourf<span class="token punctuation">(</span> lonGrid<span class="token punctuation">,</span> latGrid<span class="token punctuation">,</span> landMask<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'Greys'</span> <span class="token punctuation">)</span>

<span class="token comment"># polish each plot</span>
axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span> <span class="token string">'pcolor of $\sqrt{u^2+v^2}$'</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token string">'bold'</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span> <span class="token string">'contourf of $\sqrt{u^2+v^2}$'</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token string">'bold'</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span> <span class="token string">'quiver of $(u,v)$'</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token string">'bold'</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span> <span class="token string">'streamplot of $(u,v)$'</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token string">'bold'</span> <span class="token punctuation">)</span>

axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>

axArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'32$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'36$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'40$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'44$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'48$^\circ$'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'32$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'36$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'40$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'44$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'48$^\circ$'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">75</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">55</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">75</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">55</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>

axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'75$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'70$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'65$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'60$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'55$^\circ$'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
axArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'75$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'70$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'65$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'60$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'55$^\circ$'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># adjust spacing and add colorbar</span>
plt<span class="token punctuation">.</span>subplots_adjust<span class="token punctuation">(</span> wspace<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> hspace<span class="token operator">=</span><span class="token number">0.15</span> <span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplots_adjust<span class="token punctuation">(</span> right<span class="token operator">=</span><span class="token number">0.88</span> <span class="token punctuation">)</span>

cbarAx <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_axes<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.11</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">,</span><span class="token number">0.77</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
cbar <span class="token operator">=</span> fig<span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span> im0<span class="token punctuation">,</span> cax<span class="token operator">=</span>cbarAx <span class="token punctuation">)</span>
cbar<span class="token punctuation">.</span>set_label<span class="token punctuation">(</span><span class="token string">'Speed (ms$^{-1}$)'</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">11</span> <span class="token punctuation">)</span>
cbar<span class="token punctuation">.</span>ax<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span> labelsize<span class="token operator">=</span><span class="token number">12</span> <span class="token punctuation">)</span>

<span class="token comment"># save the figure</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span> <span class="token string">'gulfStreamUV_snapshots.png'</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">600</span> <span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>这是一个Python脚本，它从文件中加载速度数据，创建并保存数据的图形，并显示该图形。</p> 
<p>脚本首先导入必要的模块：<code>numpy</code>(用于数值操作)、<code>matplotlib.pyplot</code>(用于绘图)和<code>scipy.io</code>(用于从MATLAB格式的文件中加载数据)。</p> 
<p>接下来，脚本使用<code>scipy.io</code>中的<code>loadmat</code>函数从一个名为<code>uv.mat</code>的文件中加载数据。从<code>data</code>中提取了<code>u</code>和<code>v</code>数组，并对它们的维度进行了转置。</p> 
<p>使用<code>np.linspace</code>创建了数组<code>lon</code>和<code>lat</code>，然后使用<code>u</code>和<code>v</code>计算出了<code>speed</code>。使用<code>speed</code>中的<code>nan</code>值创建了一个landMask。</p> 
<p>使用<code>axArr</code>创建了四个子图，形成一个2x2的子图数组。前两个图使用<code>pcolor</code>和<code>contourf</code>绘制<code>speed</code>。第三个图使用<code>quiver</code>绘制<code>u</code>和<code>v</code>的向量，第四个图使用<code>streamplot</code>绘制<code>u</code>和<code>v</code>的流线。</p> 
<p>使用<code>contourf</code>添加了一个共同的陆地蒙版到每个子图中，使用各种<code>set_</code>和<code>tick_</code>方法对子图进行了格式化。使用<code>fig.colorbar</code>添加了一个颜色条，并使用<code>plt.savefig</code>将图形保存到文件中。</p> 
<p>最后，使用<code>plt.show()</code>显示了图形。<br> <img src="https://images2.imgbox.com/78/a1/hqi4p2U9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="GIF_477"></a>流场的GIF动图</h3> 
<pre><code class="prism language-python"><span class="token comment"># This script takes velocity data within the Gulf Stream and makes a video of </span>
<span class="token comment"># of the flow evolving. The data is from AVISO satellite altimetry data.</span>

<span class="token keyword">import</span> matplotlib
matplotlib<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">"TkAgg"</span><span class="token punctuation">)</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io <span class="token keyword">as</span> sio
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>cm <span class="token keyword">import</span> get_cmap
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>animation <span class="token keyword">as</span> manimation

<span class="token comment"># uncomment this line if you want to see the plots as they are saved</span>
<span class="token comment">#plt.ion()</span>

<span class="token comment">########## Prepare data ##########</span>

data <span class="token operator">=</span> sio<span class="token punctuation">.</span>loadmat<span class="token punctuation">(</span><span class="token string">'data/uv.mat'</span><span class="token punctuation">)</span>

u <span class="token operator">=</span> np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span> data<span class="token punctuation">[</span><span class="token string">'u_all'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
v <span class="token operator">=</span> np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span> data<span class="token punctuation">[</span><span class="token string">'v_all'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

lon<span class="token punctuation">,</span> lat <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">121</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">81</span> <span class="token punctuation">)</span>

speed <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span> np<span class="token punctuation">.</span>square<span class="token punctuation">(</span> u<span class="token punctuation">,</span> u <span class="token punctuation">)</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>square<span class="token punctuation">(</span> v<span class="token punctuation">,</span> v <span class="token punctuation">)</span> <span class="token punctuation">)</span>

<span class="token comment"># make a land mask (from nan values)</span>
landMask <span class="token operator">=</span> np<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span> speed<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
landMask<span class="token punctuation">[</span> <span class="token operator">~</span>np<span class="token punctuation">.</span>isnan<span class="token punctuation">(</span> landMask <span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
landMask<span class="token punctuation">[</span> np<span class="token punctuation">.</span>isnan<span class="token punctuation">(</span> landMask <span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
landMask<span class="token punctuation">[</span> landMask <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan

lon1 <span class="token operator">=</span> lon<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
lat1 <span class="token operator">=</span> lat<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
lonGrid<span class="token punctuation">,</span> latGrid <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span> lon1<span class="token punctuation">,</span> lat1 <span class="token punctuation">)</span>

<span class="token comment"># define ADT spacings for contourf function and the datelist for title</span>
adtSpacings <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">13</span> <span class="token punctuation">)</span>
dateList <span class="token operator">=</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span> <span class="token string">'1993-01-01'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span>u<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'D'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">########## Make video ##########</span>

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

<span class="token comment"># quiver sub-sampling</span>
n <span class="token operator">=</span> <span class="token number">1</span>

FFMpegWriter <span class="token operator">=</span> manimation<span class="token punctuation">.</span>writers<span class="token punctuation">[</span><span class="token string">'ffmpeg'</span><span class="token punctuation">]</span>
metadata <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span> title<span class="token operator">=</span><span class="token string">'Gulf Stream UV'</span><span class="token punctuation">,</span> artist<span class="token operator">=</span><span class="token string">'Tom Bolton'</span><span class="token punctuation">,</span> comment<span class="token operator">=</span><span class="token string">'Gulf Stream Visualization of AVISO UV data.'</span> <span class="token punctuation">)</span>
writer <span class="token operator">=</span> FFMpegWriter<span class="token punctuation">(</span> fps<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">,</span> metadata<span class="token operator">=</span>metadata<span class="token punctuation">,</span> bitrate<span class="token operator">=</span><span class="token number">30000</span><span class="token punctuation">,</span> codec<span class="token operator">=</span><span class="token string">'libx264'</span> <span class="token punctuation">)</span>

<span class="token keyword">with</span> writer<span class="token punctuation">.</span>saving<span class="token punctuation">(</span> fig<span class="token punctuation">,</span> <span class="token string">"gulfStreamUV.gif"</span><span class="token punctuation">,</span> <span class="token number">100</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span>

    <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span>
        
        <span class="token comment"># make quiver plt</span>
        plt<span class="token punctuation">.</span>quiver<span class="token punctuation">(</span> lon1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">,</span> lat1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">,</span> u<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> speed<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span>n<span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'hot'</span><span class="token punctuation">,</span> clim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1.6</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

        <span class="token comment"># add land</span>
        plt<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>lonGrid<span class="token punctuation">,</span> latGrid<span class="token punctuation">,</span> landMask<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'Greys'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># plot title</span>
        titleString <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>dateList<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span>
        titleString <span class="token operator">=</span> titleString<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>
        plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span> <span class="token string">"Velocity field    "</span> <span class="token operator">+</span> titleString<span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">20</span> <span class="token punctuation">)</span>

        <span class="token comment"># tidy up the axis</span>
        ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>

        ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">75</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">55</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
        ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'75$^\circ$'</span><span class="token punctuation">,</span> <span class="token string">'70$^\circ$'</span><span class="token punctuation">,</span> <span class="token string">'65$^\circ$'</span><span class="token punctuation">,</span> <span class="token string">'60$^\circ$'</span><span class="token punctuation">,</span> <span class="token string">'55$^\circ$'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span> fontsize<span class="token operator">=</span><span class="token number">15</span> <span class="token punctuation">)</span>

        ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
        ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'32$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'36$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'40$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'44$^\circ$'</span><span class="token punctuation">,</span><span class="token string">'48$^\circ$'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span> fontsize<span class="token operator">=</span><span class="token number">15</span> <span class="token punctuation">)</span>

        <span class="token comment"># save this figure as a frame</span>
        plt<span class="token punctuation">.</span>pause<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>grab_frame<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># clear the axis data so it doesn't accumulate</span>
        plt<span class="token punctuation">.</span>cla<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>这是一个Python脚本，它从Gulf Stream中获取速度数据并创建一个流动视频。数据来自AVISO卫星高度计数据。</p> 
<p>脚本首先导入必要的模块：<code>numpy</code>(用于数值操作)、<code>matplotlib.pyplot</code>(用于绘图)、<code>scipy.io</code>(用于从MATLAB格式的文件中加载数据)、<code>pandas</code>(用于处理日期)和<code>matplotlib.animation</code>(用于创建动画)。</p> 
<p>接下来，脚本使用<code>scipy.io</code>中的<code>loadmat</code>函数从一个名为<code>uv.mat</code>的文件中加载数据。从<code>data</code>中提取了<code>u</code>和<code>v</code>数组，并对它们的维度进行了转置。</p> 
<p>使用<code>np.linspace</code>创建了数组<code>lon</code>和<code>lat</code>，然后使用<code>u</code>和<code>v</code>计算出了<code>speed</code>。使用<code>speed</code>中的<code>nan</code>值创建了一个landMask。</p> 
<p>使用<code>pd.date_range</code>创建了日期列表<code>dateList</code>，并使用<code>np.linspace</code>创建了ADT空间，用于<code>contourf</code>函数。</p> 
<p>使用<code>manimation</code>创建了动画，并使用<code>writer.saving</code>将动画保存为gif文件。</p> 
<p>在循环中，对于每个时间步长<code>t</code>，创建了一个<code>quiver</code>图，该图显示了速度向量的方向和大小。使用<code>clim</code>参数设置了颜色映射的范围，使其只显示速度小于1.6的值。</p> 
<p>使用<code>contourf</code>函数向图中添加了一个共同的陆地蒙版，并使用<code>title</code>函数添加了标题。使用<code>set_xticks</code>和<code>set_yticks</code>函数设置了x和y轴上的刻度值，并使用<code>set_xticklabels</code>和<code>set_yticklabels</code>函数设置了刻度标签。使用<code>fontsize</code>参数设置了标签和标题的字体大小。</p> 
<p>使用<code>pause</code>函数暂停了图形的显示，并使用<code>grab_frame</code>函数将当前帧添加到视频中。使用<code>cla</code>函数清除了当前轴中的数据，以便下一帧可以开始。</p> 
<p>最后，使用<code>plt.show()</code>显示了图形。</p> 
<p><img src="https://images2.imgbox.com/6f/88/uKqc41id_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="_591"></a>后记</h3> 
<p>该程序包含了将湾流的卫星数据可视化的python脚本；</p> 
<p>包含产生速度场mp4的py程序，海表面高度的py；</p> 
<p>下图为程序中对应产生的图</p> 
<p><img src="https://images2.imgbox.com/ae/32/rjdmV9le_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>pass: 需要在python 2 的环境下运行</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/cd/a9/am4yFgX8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Reference_603"></a>Reference</h3> 
<p><a href="https://www.zhihu.com/question/30698406" rel="nofollow">墨西哥湾流的形成机制是什么？</a><br> <a href="https://github.com/TomBolton/visualiseGulfStream">GitHub - Visualising the Gulf Stream</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/faffadf08ae9ebbd99d72f643f9186f9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深度学习中，batch大小对模型的效果有影响吗？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/51eb1ba409da8c2a02cc8b8ca8dcd522/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">利用docker轻松安装高斯数据库</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>