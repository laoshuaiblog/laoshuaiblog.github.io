<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【虚拟换衣&#43;论文&#43;代码】2403.OOTDiffusion：高分辨率(1024x768)可控的虚拟试穿（已开源，暂不能训练） - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/c81f1c6e06d64ca46de5c0a932d082d1/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="【虚拟换衣&#43;论文&#43;代码】2403.OOTDiffusion：高分辨率(1024x768)可控的虚拟试穿（已开源，暂不能训练）">
  <meta property="og:description" content="项目地址：https://github.com/levihsu/OOTDiffusion
试用地址：https://ootd.ibot.cn/
论文：2403.OOTDiffusion: 基于衣服融合的可控虚拟试穿潜在扩散
arxiv: Outfitting Fusion based Latent Diffusion for Controllable Virtual Try-on | readpaper
在comfyui中使用: https://github.com/StartHua/ComfyUI_OOTDiffusion_CXH
b站说明：https://www.bilibili.com/video/BV1nj421Q7yg
一、简介 基于图片虚拟试穿（image-based virtual try-on ，VTON）
基于扩散模型全套试穿：Outfitting over Try-on Diffusion (OOTDiffusion)
利用预训练的潜在扩散模型的力量(pretrained latent diffusion models)，用于现实和可控的(realistic and controllable)虚拟试穿。在没有明确的衣物形变适应过程(warping process)的情况下，
提出了一个outfitting UNet来学习服装细节特征，在扩散模型去噪过程中，通过我们提出的服装融合outfitting fusion将其与目标人体融合。
1.1 原文展示结果 生成分辨率 1024x768
第一行数据，是在`VITON-HD，半身数据集上训练的，支持上半身衣服（upper-body garment）
第二行，在Dress Code 数据集训练, 支持上半身服装(upper-body)、下身服装(upper-body)和裙子（dresses）
1.2 实测结果 生成衣服保存特征还是会有问题
二、如何训练？ 2.1 数据集 1024x768分辨率
VitonHD数据集
13,679对正面半身模型和相应的上半身服装组成，其中2032对作为测试集。
Dress Code数据集
15,363/8,951/2,947 个全身模型的图像对和相应的上半身服装/下身服装/服装组成，其中每个服装类别的 1,800 对作为测试集。
训练参数 实验中，我们通过继承Stable Diffusion v1.5 的 预训练权重来初始化 OOTDiffusion 模型。">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-12T11:04:05+08:00">
    <meta property="article:modified_time" content="2024-03-12T11:04:05+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【虚拟换衣&#43;论文&#43;代码】2403.OOTDiffusion：高分辨率(1024x768)可控的虚拟试穿（已开源，暂不能训练）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>项目地址：<a href="https://github.com/levihsu/OOTDiffusion">https://github.com/levihsu/OOTDiffusion</a><br> 试用地址：<a href="https://ootd.ibot.cn/" rel="nofollow">https://ootd.ibot.cn/</a><br> <strong>论文</strong>：2403.OOTDiffusion: 基于衣服融合的可控虚拟试穿潜在扩散<br> arxiv: <a href="https://arxiv.org/pdf/2403.01779.pdf" rel="nofollow">Outfitting Fusion based Latent Diffusion for Controllable Virtual Try-on</a> | <a href="https://readpaper.com/pdf-annotate/note?pdfId=2211576450388681472" rel="nofollow">readpaper</a><br> 在comfyui中使用: <a href="https://github.com/StartHua/ComfyUI_OOTDiffusion_CXH">https://github.com/StartHua/ComfyUI_OOTDiffusion_CXH</a><br> b站说明：<a href="https://www.bilibili.com/video/BV1nj421Q7yg" rel="nofollow">https://www.bilibili.com/video/BV1nj421Q7yg</a></p> 
<h2><a id="_9"></a>一、简介</h2> 
<p>基于图片虚拟试穿（image-based virtual try-on ，<strong>VTON</strong>）<br> 基于扩散模型全套试穿：Outfitting over Try-on Diffusion (<strong>OOTDiffusion</strong>)<br> 利用<code>预训练</code>的潜在扩散模型的力量(<strong>pretrained latent diffusion models</strong>)，用于现实和可控的(realistic and controllable)虚拟试穿。在没有明确的<code>衣物形变适应过程</code>(warping process)的情况下，<br> 提出了一个outfitting UNet来学习服装细节特征，在扩散模型去噪过程中，通过我们提出的<code>服装融合</code><strong>outfitting fusion</strong>将其与目标人体融合。</p> 
<h3><a id="11__15"></a>1.1 原文展示结果</h3> 
<p>生成分辨率 1024x768<br> 第一行数据，是在<a href="https://github.com/shadow2496/VITON-HD">`<strong>VITON-HD</strong></a>，半身数据集上训练的，支持上半身衣服（upper-body garment）<br> 第二行，在<a href="https://github.com/aimagelab/dress-code">Dress Code</a> 数据集训练, 支持上半身服装(upper-body)、下身服装(upper-body)和裙子（dresses）<br> <img src="https://images2.imgbox.com/86/f6/jfVYowgn_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12__21"></a>1.2 实测结果</h3> 
<p>生成衣服保存特征还是会有问题<br> <img src="https://images2.imgbox.com/59/ce/GhdoqFIO_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_24"></a>二、如何训练？</h2> 
<h3><a id="21__25"></a>2.1 数据集</h3> 
<p>1024x768分辨率<br> <strong>VitonHD数据集</strong><br> 13,679对正面半身模型和相应的上半身服装组成，其中2032对作为测试集。<br> <strong>Dress Code数据集</strong><br> 15,363/8,951/2,947 个全身模型的图像对和相应的<strong>上半身服装/下身服装/服装</strong>组成，其中每个服装类别的 1,800 对作为测试集。</p> 
<h3><a id="_31"></a>训练参数</h3> 
<p>实验中，我们通过继承<strong>Stable Diffusion v1.5</strong> 的 <strong>预训练权重</strong>来初始化 OOTDiffusion 模型。<br> 然后我们使用固定学习率为 5e-5 的 AdamW 优化器<code>微调</code>(fineturn)换衣Unet和去噪 UNet。<br> 请注意，我们分别在 512 × 384 和 1024 × 768 的分辨率下在 VITON-HD [6] 和 Dress Code [33] 数据集上训练四种类型的模型。<br> 所有模型都在 <strong>单个NVIDIA A100 GPU</strong> 上训练 <strong>36000</strong> 次迭代，<br> 512 × 384 分辨率的批量大小为 64，<br> 1024 × 768 分辨率的批量大小为 16。<br> 在推理时，我们使用 UniPC 采样器在单个 NVIDIA RTX 4090 GPU 上运行我们的 OOTDiffusion 20 个采样步骤 [</p> 
<h2><a id="_39"></a>三、方法与原理</h2> 
<p><strong>原图2</strong>： 概述OOTDiffusion模型。</p> 
<ol><li>在左侧，服装图像被 <strong>clip-vit-large-patch14</strong> 编码到潜在空间中，并输入到服装UNet中进行单步处理。</li><li>与CLIP编码器生成的辅助调节输入一起，通过服装<strong>融合</strong>（outfitting fusion）将<strong>服装特征</strong>纳入去噪UNet。</li><li>在训练过程中，为了实现<strong>无分类器的指导</strong>（classifier-free guidance），对训练过程进行了 <strong>outfitting dropout</strong>。</li><li>在右侧，输入的人类图像通过<strong>掩码生成模块</strong>（mask generator， <strong>HumanParsing+OpenPose</strong> ）将需要换衣以及相近的地方被<strong>遮盖为黑色</strong>（masked），并与高斯噪声连接在一起，作为多个采样步骤的去噪UNet的输入。</li><li>去噪后，特征映射被解码回图像空间作为我们的试戴结果。</li></ol> 
<blockquote> 
 <p>Overview of our proposed OOTDiffusion model. On the left side, the garment image is encoded into the latent space and fed into the outfitting UNet for a single step process. Along with the auxiliary conditioning input generated by CLIP encoders, the garment features are incorporated into the denoising UNet via outfitting fusion. Outfitting dropout is performed for the garment latents particularly in training to enable classifier-free guidance. On the right side, the input human image is masked with respect to the target region and concatenated with a Gaussian noise as the input to the denoising UNet for multiple sampling steps. After denoising, the feature map is decoded back into the image space as our try-on result.</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ef/59/HI4GOwKT_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_49"></a>数学参数概述</h3> 
<p>输入一张 3xHxW的图片<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         x 
        
       
      
        x 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span>， 一张衣服图片<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         g 
        
       
      
        g 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span></span></span></span></span> ,输出换衣结果 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          x 
         
        
          g 
         
        
       
      
        x_g 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7167em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span></span></span></span></span><br> 采用 OpenPose 和 HumanParsing 产生遮盖区域图片 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          x 
         
        
          m 
         
        
       
      
        x_m 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span><br> 通过VAE的编码器 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ϵ 
        
       
      
        \epsilon 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></span>进入latent空间 (原图被降采样8倍)<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         E 
        
       
         ( 
        
        
        
          x 
         
        
          m 
         
        
       
         ) 
        
       
         ∈ 
        
        
        
          R 
         
         
         
           4 
          
         
           × 
          
         
           h 
          
         
           × 
          
         
           w 
          
         
        
       
         , 
        
       
         h 
        
       
         = 
        
        
        
          H 
         
        
          8 
         
        
       
         , 
        
       
         w 
        
       
         = 
        
        
        
          W 
         
        
          8 
         
        
       
      
        \mathcal{E}(x_m) \in \mathbb{R}^{4 \times h \times w}, h = \frac{H}{8}, w = \frac{W}{8} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathcal" style="margin-right: 0.0894em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0435em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">h</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em;">w</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2173em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8723em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0813em;">H</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0269em;">w</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2173em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8723em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br> 和高斯噪声拼接后构成 （8通道）<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          z 
         
        
          T 
         
        
       
         ∈ 
        
        
        
          R 
         
         
         
           8 
          
         
           × 
          
         
           h 
          
         
           × 
          
         
           w 
          
         
        
       
      
        z_T \in \mathbb{R}^{8 \times h \times w} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6891em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.044em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8491em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">h</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em;">w</span></span></span></span></span></span></span></span></span></span></span></span></span><br> 为了让 <strong>去噪Unet</strong>支持8通道数据的输入，对一个卷积层，增加了4个0<strong>初始化通道</strong></p> 
<p>另一方面，我们将<code>编码的服装隐码</code>（<strong>encoded garment latent</strong>） <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         E 
        
       
         ( 
        
       
         g 
        
       
         ) 
        
       
         ∈ 
        
        
        
          R 
         
         
         
           4 
          
         
           × 
          
         
           h 
          
         
           × 
          
         
           w 
          
         
        
       
      
        \mathcal{E}(g) \in \mathbb{R}^{4 \times h \times w} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathcal" style="margin-right: 0.0894em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8491em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">h</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right: 0.0269em;">w</span></span></span></span></span></span></span></span></span></span></span></span></span>输入到<br> (i) outfit UNet模快，训练一步学习服装特征<br> (ii换衣融合将它们集成到去噪UNet中。<br> (iii) 对<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         E 
        
       
         ( 
        
       
         g 
        
       
         ) 
        
       
      
        \mathcal{E}(g) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathcal" style="margin-right: 0.0894em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mclose">)</span></span></span></span></span>进行 outfit dropout，尤其是在训练过程中</p> 
<p>此外，我们还对<strong>服装图像</strong>进行了CLIP 文本反演[10] <strong><a href="https://readpaper.com/paper/714688733376581632" rel="nofollow">textual-inversion</a></strong>(即)，并可选地将其与服装标签∈{“上半身”、“下半身”、“衣服”}的文本嵌入（text embeding）连接起来作为<strong>辅助条件输入</strong>（auxiliary conditioning input），<br> 通过交叉注意机制输入到2个unet模型中（去噪unet和换衣unet)。</p> 
<p>最后，在去噪过程的多个步骤之后，我们使用 VAE 解码器 D 将去噪的潜在 z0 ∈ R4×h×w 转换回图像空间作为输出图像 xg = D(z0) ∈ R3×H×W。我们将在以下部分中详细说明</p> 
<h3><a id="OOTDiffusion__67"></a>OOTDiffusion 的关键技术</h3> 
<p>(i) Outfitting UNet，<br> (ii) Outfitting fusion<br> (iii) Outfitting dropout</p> 
<h4><a id="outfitting_Unet_72"></a>outfitting Unet</h4> 
<p>与stable diffusion 的UNet结构基本相同<br> 直接复制Stable Diffusion[40]的预训练UNet权值，<br> 初始化我们的过拟合和去噪UNets(除了添加到第一个卷积层的零初始化通道除外</p> 
<p>损失函数为<br> 其中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         where  
        
       
         ψ 
        
       
         = 
        
        
        
          τ 
         
        
          g 
         
        
       
         ( 
        
       
         g 
        
       
         ) 
        
       
         ∘ 
        
        
        
          τ 
         
        
          y 
         
        
       
         ( 
        
       
         y 
        
       
         ) 
        
       
          represents the auxiliary conditioning input for both  
        
        
        
          ω 
         
         
         
           θ 
          
         
           ′ 
          
         
        
       
          and  
        
        
        
          ϵ 
         
        
          θ 
         
        
       
         . 
        
       
      
        \text{where } \psi = \tau_g(g) \circ \tau_y(y) \text{ represents the auxiliary conditioning input for both } \omega_{\theta'} \text{ and } \epsilon_{\theta}. 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord text"><span class="mord">where </span></span><span class="mord mathnormal" style="margin-right: 0.0359em;">ψ</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1132em;">τ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1132em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">∘</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1132em;">τ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1132em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mclose">)</span><span class="mord text"><span class="mord"> represents the auxiliary conditioning input for both </span></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.6828em;"><span class="" style="top: -2.786em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord text"><span class="mord"> and </span></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">.</span></span></span></span></span><br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           L 
          
          
          
            O 
           
          
            O 
           
          
            T 
           
          
            D 
           
          
         
        
          = 
         
         
         
           E 
          
          
          
            E 
           
          
            ( 
           
           
           
             x 
            
           
             m 
            
           
          
            ) 
           
          
            , 
           
          
            E 
           
          
            ( 
           
          
            g 
           
          
            ) 
           
          
            , 
           
          
            ψ 
           
          
            , 
           
          
            ϵ 
           
          
            ∼ 
           
          
            N 
           
          
            ( 
           
          
            0 
           
          
            , 
           
          
            1 
           
          
            ) 
           
          
            , 
           
          
            t 
           
          
         
         
         
           [ 
          
         
           ∥ 
          
         
           ϵ 
          
         
           − 
          
          
          
            ϵ 
           
          
            θ 
           
          
         
           ( 
          
          
          
            z 
           
          
            t 
           
          
         
           , 
          
         
           t 
          
         
           , 
          
          
          
            ω 
           
           
           
             θ 
            
           
             ′ 
            
           
          
         
           ( 
          
         
           E 
          
         
           ( 
          
         
           g 
          
         
           ) 
          
         
           , 
          
         
           ψ 
          
         
           ) 
          
         
           , 
          
         
           ψ 
          
         
           ) 
          
          
          
            ∥ 
           
          
            2 
           
          
            2 
           
          
         
           ] 
          
         
        
          ( 
         
        
          2 
         
        
          ) 
         
        
       
         \mathcal{L}_{OOTD} = \mathbb{E}_{\mathcal{E}(x_m), \mathcal{E}(g), \psi, \epsilon \sim \mathcal{N}(0, 1), t}\left[\lVert \epsilon - \epsilon_{\theta}(\mathbf{z}_t, t, \omega_{\theta'}(\mathcal{E}(g), \psi), \psi) \rVert_2^2\right] (2) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathcal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">OOT</span><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">D</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2193em; vertical-align: -0.3552em;"></span><span class="mord"><span class="mord mathbb">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right: 0.0894em;">E</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1645em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mpunct mtight">,</span><span class="mord mathcal mtight" style="margin-right: 0.0894em;">E</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">g</span><span class="mclose mtight">)</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">ψ</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">ϵ</span><span class="mrel mtight">∼</span><span class="mord mathcal mtight" style="margin-right: 0.1474em;">N</span><span class="mopen mtight">(</span><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span><span class="mclose mtight">)</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size1">[</span></span><span class="mopen">∥</span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0278em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.6828em;"><span class="" style="top: -2.786em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathcal" style="margin-right: 0.0894em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">ψ</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">ψ</span><span class="mclose">)</span><span class="mclose"><span class="mclose">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8641em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span></span></p> 
<h4><a id="Outfitting__fusion_83"></a>Outfitting fusion</h4> 
<p>参考了驱动图片运动的论文<strong>空间注意力机制</strong>（spatial-attention mechanism [）<br> 23.12 <code>Animate Anyone</code>: <a href="https://readpaper.com/paper/2072134566482850048" rel="nofollow">Consistent and Controllable Image-to-Video Synthesis for Character Animation</a><br> 引入了一种融合模块，将学习到的<strong>服装特征融入到去噪Unet</strong>中</p> 
<h2><a id="_b_95"></a>代码和模型下载 （环境安装参考b站）</h2> 
<p>代码</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/levihsu/OOTDiffusion
</code></pre> 
<p>模型</p> 
<pre><code class="prism language-python">export HF_ENDPOINT<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">//</span>hf<span class="token operator">-</span>mirror<span class="token punctuation">.</span>com

huggingface<span class="token operator">-</span>cli download <span class="token operator">-</span><span class="token operator">-</span>resume<span class="token operator">-</span>download levihsu<span class="token operator">/</span>OOTDiffusion <span class="token operator">-</span><span class="token operator">-</span>local<span class="token operator">-</span><span class="token builtin">dir</span> <span class="token punctuation">.</span><span class="token operator">/</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9b3c3ceff686d9564cadefcb03b85240/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【机器学习算法】: MeanShift算法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6de146e80165974669f6a1b6e49f2782/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">R语言绘制散点密度图ggdentity</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>