<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker构建镜像命令 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/235b7790d037b4f4b7654ad993f1a2cd/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="docker构建镜像命令">
  <meta property="og:description" content="编写dockerfile文件 例子1;
FROM oraclelinux:7-slim ENV release=19 ENV update=13 RUN curl -o /etc/yum.repos.d/public-yum-ol7.repo https://yum.oracle.com/public-yum-ol7.repo &amp;amp;&amp;amp; \ yum-config-manager --enable ol7_oracle_instantclient &amp;amp;&amp;amp; \ yum install -y java-1.8.0-openjdk-devel.x86_64 &amp;amp;&amp;amp; \ yum -y install oracle-instantclient${release}.${update}-basic oracle-instantclient${release}.${update}-devel oracle-instantclient${release}.${update}-sqlplus &amp;amp;&amp;amp; \ rm -rf /var/cache/yum &amp;amp;&amp;amp; \ echo /usr/lib/oracle/${release}.${update}/client64/lib &amp;gt; /etc/ld.so.conf.d/oracle-instantclient${release}.${update}.conf &amp;amp;&amp;amp; \ ldconfig #install sqlhc RUN mkdir -p /root/shell COPY sqlhc.sh /root/shell/ COPY sqlhc.sql /root/shell/ RUN chmod &#43;x /root/shell/sqlhc.sh #PDF RUN mkdir -p /root/pdf COPY asmChart.jasper /root/pdf/ COPY asmInfo.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-21T17:34:56+08:00">
    <meta property="article:modified_time" content="2024-03-21T17:34:56+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker构建镜像命令</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="dockerfile_0"></a>编写dockerfile文件</h3> 
<p>例子1;</p> 
<pre><code class="prism language-yaml">FROM oraclelinux<span class="token punctuation">:</span>7<span class="token punctuation">-</span>slim
ENV release=19 
ENV update=13
RUN  curl <span class="token punctuation">-</span>o /etc/yum.repos.d/public<span class="token punctuation">-</span>yum<span class="token punctuation">-</span>ol7.repo https<span class="token punctuation">:</span>//yum.oracle.com/public<span class="token punctuation">-</span>yum<span class="token punctuation">-</span>ol7.repo <span class="token important">&amp;&amp;</span> \
     yum<span class="token punctuation">-</span>config<span class="token punctuation">-</span>manager <span class="token punctuation">-</span><span class="token punctuation">-</span>enable ol7_oracle_instantclient <span class="token important">&amp;&amp;</span> \
     yum install <span class="token punctuation">-</span>y java<span class="token punctuation">-</span>1.8.0<span class="token punctuation">-</span>openjdk<span class="token punctuation">-</span>devel.x86_64 <span class="token important">&amp;&amp;</span> \
     yum <span class="token punctuation">-</span>y install oracle<span class="token punctuation">-</span>instantclient$<span class="token punctuation">{<!-- --></span>release<span class="token punctuation">}</span>.$<span class="token punctuation">{<!-- --></span>update<span class="token punctuation">}</span><span class="token punctuation">-</span>basic oracle<span class="token punctuation">-</span>instantclient$<span class="token punctuation">{<!-- --></span>release<span class="token punctuation">}</span>.$<span class="token punctuation">{<!-- --></span>update<span class="token punctuation">}</span><span class="token punctuation">-</span>devel oracle<span class="token punctuation">-</span>instantclient$<span class="token punctuation">{<!-- --></span>release<span class="token punctuation">}</span>.$<span class="token punctuation">{<!-- --></span>update<span class="token punctuation">}</span><span class="token punctuation">-</span>sqlplus <span class="token important">&amp;&amp;</span> \
     rm <span class="token punctuation">-</span>rf /var/cache/yum <span class="token important">&amp;&amp;</span> \
     echo /usr/lib/oracle/$<span class="token punctuation">{<!-- --></span>release<span class="token punctuation">}</span>.$<span class="token punctuation">{<!-- --></span>update<span class="token punctuation">}</span>/client64/lib <span class="token punctuation">&gt;</span> /etc/ld.so.conf.d/oracle<span class="token punctuation">-</span>instantclient$<span class="token punctuation">{<!-- --></span>release<span class="token punctuation">}</span>.$<span class="token punctuation">{<!-- --></span>update<span class="token punctuation">}</span>.conf <span class="token important">&amp;&amp;</span> \
     ldconfig
<span class="token comment">#install sqlhc</span>
RUN mkdir <span class="token punctuation">-</span>p /root/shell
COPY sqlhc.sh /root/shell/ 
COPY sqlhc.sql /root/shell/ 
RUN chmod +x /root/shell/sqlhc.sh

<span class="token comment">#PDF</span>
RUN mkdir <span class="token punctuation">-</span>p /root/pdf
COPY asmChart.jasper /root/pdf/  
COPY asmInfo.jasper /root/pdf/  
COPY dataBaseTableSpaceInfo.jasper /root/pdf/  
COPY indexUseAs.jasper /root/pdf/  
COPY main.jasper /root/pdf/  
COPY objectFragmentsInfo.jasper /root/pdf/  
COPY topObjectInfo.jasper /root/pdf/ 
COPY dbSpaceChart.jasper /root/pdf/ 
RUN chmod <span class="token punctuation">-</span>R 777  /root/pdf

<span class="token comment">#install java deployment envirement</span>
ENV JAVA_BASE=/usr/java
RUN mkdir <span class="token punctuation">-</span>p $JAVA_BASE
ADD jre<span class="token punctuation">-</span>8u331<span class="token punctuation">-</span>linux<span class="token punctuation">-</span>x64.tar.gz $JAVA_BASE
<span class="token comment">#RUN chown -R root:root $JAVA_BASE/jre1.8.0_331</span>
RUN ln <span class="token punctuation">-</span>s $JAVA_BASE/jre1.8.0_331 $JAVA_BASE/jdk<span class="token punctuation">-</span><span class="token number">8</span>
ENV JAVA_HOME=$JAVA_BASE/jdk<span class="token punctuation">-</span><span class="token number">8</span>

<span class="token comment">#timezone setting</span>
ENV TimeZone=Asia/Shanghai
RUN ln <span class="token punctuation">-</span>snf /usr/share/zoneinfo/$TimeZone /etc/localtime <span class="token important">&amp;&amp;</span> echo $TimeZone <span class="token punctuation">&gt;</span> /etc/timezone

ENV PATH=$PATH<span class="token punctuation">:</span>/usr/lib/oracle/$<span class="token punctuation">{<!-- --></span>release<span class="token punctuation">}</span>.$<span class="token punctuation">{<!-- --></span>update<span class="token punctuation">}</span>/client64/bin<span class="token punctuation">:</span>$JAVA_HOME/bin

</code></pre> 
<p>命令解读</p> 
<ul><li>From 用于指定基础镜像，后续的指令都基于这个基础镜像进行构建。</li></ul> 
<pre><code class="prism language-yaml"> From 镜像名称
<span class="token comment"># 基于 oraclelinux:7-slim 来构建新的镜像</span>
FROM oraclelinux<span class="token punctuation">:</span>7<span class="token punctuation">-</span>slim

<span class="token comment">#或者基于openjdk:11来构建</span>
FROM openjdk<span class="token punctuation">:</span><span class="token number">11</span>

</code></pre> 
<ul><li>ENV命令,在 Dockerfile 中，ENV 命令用于设置环境变量。这些环境变量可以在后续的构建步骤（即后续的 RUN 命令）以及容器运行时中使用。在使用的时候 可以使用 $符 加变量名称</li></ul> 
<pre><code class="prism language-yaml"><span class="token comment">#ENV 命令的基本语法如下：</span>
ENV &lt;key<span class="token punctuation">&gt;</span>=&lt;value<span class="token punctuation">&gt;</span> <span class="token punctuation">...</span>



</code></pre> 
<ul><li>RUN命令,用来执行在linux中的命令，比如赋权，或者安装命令，下载之类的</li></ul> 
<pre><code class="prism language-yaml"><span class="token comment"># 例如给文件夹增加下的文件增加读写权限</span>
RUN chmod <span class="token punctuation">-</span>R 777  /root/pdf
<span class="token comment">#下载文件的命令</span>
RUN yum install <span class="token punctuation">-</span>y java<span class="token punctuation">-</span>1.8.0<span class="token punctuation">-</span>openjdk<span class="token punctuation">-</span>devel.x86_64
<span class="token comment"># 换行符 和 \</span>
可以使用换行符  和 \  来跨行编写命令
<span class="token comment"># &amp;&amp;  符号，表示必须 &amp;&amp; 前的命令执行成功后才会执行后面的命令，如果前面失败了后面不会执行</span>
</code></pre> 
<ul><li>COPY,表示复制</li></ul> 
<pre><code class="prism language-yaml"><span class="token comment"># copy 宿主机文件路径  镜像内路径</span>
<span class="token comment"># 复制文件</span>
COPY sqlhc.sh /root/shell/ 
COPY asmChart.jasper /root/pdf/ 

</code></pre> 
<ul><li>ADD,在 Dockerfile 中，ADD 命令用于将本地文件、目录或远程文件 URL 添加到镜像的文件系统中。ADD 命令非常强大，因为它可以自动解压归档文件（如 tar、gzip、bzip2 等）到镜像中。</li></ul> 
<pre><code class="prism language-yaml"><span class="token comment"># ADD &lt;src&gt; &lt;dest&gt;</span>
<span class="token comment"># &lt;src&gt;：要添加的源文件或目录的路径，或者远程文件的 URL。</span>
<span class="token comment"># &lt;dest&gt;：目标路径在 Docker 镜像中的位置</span>

<span class="token comment"># 将tar包，复制并解压到 $JAVA_BASE这个所代表的路径中</span>
ADD jre<span class="token punctuation">-</span>8u331<span class="token punctuation">-</span>linux<span class="token punctuation">-</span>x64.tar.gz $JAVA_BASE
<span class="token comment"># 将当前上下文中的 myfile.txt 文件添加到镜像的 /app/ 目录下：</span>
ADD myfile.txt /app/
<span class="token comment">#将当前上下文中的 mydir/ 目录（包括其内容）添加到镜像的 /app/ 目录下</span>
ADD mydir/ /app/
<span class="token comment">#从远程 URL 添加一个文件到镜像中：</span>
ADD https<span class="token punctuation">:</span>//example.com/myfile.txt /app/

</code></pre> 
<p>例子2</p> 
<pre><code class="prism language-yaml">FROM nginx<span class="token punctuation">:</span><span class="token number">1.23</span> 
ARG APP_BIN=/usr/share/nginx/html
COPY default.conf /etc/nginx/conf.d/ 
COPY bin/ $APP_BIN
EXPOSE 80
</code></pre> 
<ul><li>ARG 定义可以在构建时传递的变量</li></ul> 
<pre><code class="prism language-yaml"><span class="token comment">#使用ARG命令 定义一个名为 APP_BIN变量</span>
ARG APP_BIN=/usr/share/nginx/html
<span class="token comment"># 将当前目录下，bin目录下的文件 复制到 APP_BIN变量所代表的路径下</span>
COPY bin/ $APP_BIN

</code></pre> 
<p>ARG和ENV命令在Dockerfile中各自扮演着不同的角色，它们的主要差别如下：</p> 
<ol><li>定义阶段和存在时间：<br> ARG命令主要用于在构建镜像的过程中设置一个构建时的环境变量。这些变量在构建过程中可以被使用，并且可以在Dockerfile中通过引用它们的名称来访问。然而，一旦镜像编译成功，ARG指定的变量将不再存在。<br> ENV命令则用于在容器运行时设置环境变量。这些变量在容器启动时被设置，并且可以在容器中的应用程序中使用。与ARG不同，ENV设置的环境变量在镜像构建完成后会保留在镜像中，因此当使用构建后的镜像运行容器时，这些环境变量仍然保持不变。</li><li>使用方式和语法：<br> ARG命令的格式为ARG [=]。在执行docker build时，可以通过–build-arg &lt;参数名&gt;=&lt;值&gt;来为声明的变量赋值。此外，ARG还可以引用Docker内置的一些镜像创建变量，这些变量无需用户声明即可直接使用。<br> ENV命令的语法允许直接设置一个或多个环境变量，如ENV MY_NAME=“John Doe” MY_DOG=Rex。它支持在指令中设置多个环境变量，并且环境变量的值可以被其他环境变量引用。</li><li>功能和用途：<br> ARG主要用于在构建过程中传递参数或设置构建时的环境，但这些变量并不会被保留到最终的镜像中。它们主要在Dockerfile的构建阶段提供灵活性和可配置性。<br> ENV则更关注于容器运行时的环境配置。通过设置环境变量，它可以影响容器内部应用程序的行为或配置。<br> 总结来说，ARG和ENV在Dockerfile中各有其特定的使用场景和功能。ARG主要用于构建时的参数传递和环境设置，而ENV则关注于容器运行时的环境配置。在构建Docker镜像时，应根据具体需求选择使用合适的命令。</li></ol> 
<ul><li>EXPOSE,暴露端口，EXPOSE 命令在 Dockerfile 中用于声明容器在运行时应该监听的端口。这个命令并不实际地映射或公开任何端口到宿主机，而是作为一个元数据，告诉 Docker 容器哪些网络端口会被应用程序使用。</li></ul> 
<pre><code class="prism language-yaml">EXPOSE 80
</code></pre> 
<p>例子三<br> 基于jdk11镜像构建新的镜像</p> 
<pre><code class="prism language-yaml">FROM openjdk<span class="token punctuation">:</span><span class="token number">11</span>
COPY 5gSports<span class="token punctuation">-</span>app.jar /
COPY ./hikliblinux64 /lib/hik/hikliblinux64
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"java"</span><span class="token punctuation">,</span><span class="token string">"-jar"</span><span class="token punctuation">,</span><span class="token string">"/5gSports-app.jar"</span><span class="token punctuation">,</span><span class="token string">"--spring.config.location=classpath:/product.yml"</span><span class="token punctuation">]</span>
</code></pre> 
<ul><li>ENTRYPOINT 命令，配置容器启动时运行的命令。与 CMD 类似，但 ENTRYPOINT 的命令不会被 docker run 命令行参数指定的指令所覆盖，而是将这些参数当作参数传给 ENTRYPOINT 指定的命令。</li></ul> 
<p>ENTRYPOINT 指令应该是一个 JSON 数组，其中每个元素都是一个独立的字符串，而不是一个包含整个命令和参数的单一字符串。<br> 正确的方式是将命令和每个参数分开成数组中的不同元素</p> 
<pre><code class="prism language-yaml">ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"java"</span><span class="token punctuation">,</span><span class="token string">"-jar"</span><span class="token punctuation">,</span><span class="token string">"/5gSports-app.jar"</span><span class="token punctuation">,</span><span class="token string">"--spring.config.location=classpath:/product.yml"</span><span class="token punctuation">]</span>
</code></pre> 
<p>这样，java 是命令，-jar 和 5gSports-app.jar 是传递给 java 命令的参数，–spring.config.location=classpath:/product.yml 也是另一个参数。每个参数都作为一个独立的数组元素。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eff79fca540b6a696d456d536e075f7b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">原生ajax进行简单的封装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/12283759b806f99de5b406f9f3543601/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【JavaScript 漫游】【040】Blob 对象</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>