<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>《流畅的Python》读书笔记——Python一等函数 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/c29dea2d6f98bde52d88ac8ed5bb8c8d/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="《流畅的Python》读书笔记——Python一等函数">
  <meta property="og:description" content="在Python中，函数是一等对象：
在运行时创建能赋值给变量或数据结构中的元素能作为参数传给函数能作为函数的返回结果 把函数视作对象 &amp;gt;&amp;gt;&amp;gt; def factorial(n): #通过控制台会话运行时创建一个函数 ... &#39;&#39;&#39;returns n!&#39;&#39;&#39; ... return 1 if n &amp;lt; 2 else n * factorial(n-1) ... &amp;gt;&amp;gt;&amp;gt; factorial(42) 1405006117752879898543142606244511569936384000000000 &amp;gt;&amp;gt;&amp;gt; factorial.__doc__ &#39;returns n!&#39; &amp;gt;&amp;gt;&amp;gt; type(factorial) &amp;lt;class &#39;function&#39;&amp;gt; #是function类的实例 我们来看下赋值、调用：
&amp;gt;&amp;gt;&amp;gt; fact = factorial &amp;gt;&amp;gt;&amp;gt; fact &amp;lt;function factorial at 0x7f1c69958e18&amp;gt; &amp;gt;&amp;gt;&amp;gt; fact(5) 120 &amp;gt;&amp;gt;&amp;gt; map(factorial,range(11)) &amp;lt;map object at 0x7f1c62361908&amp;gt; &amp;gt;&amp;gt;&amp;gt; list(map(fact,range(11))) [1, 1, 2, 6, 24, 120, 720, 5040, 40320, 362880, 3628800] 有了一等函数，就可以使用函数式风格编程。
高阶函数 接受函数为参数，或者把函数作为结果返回的函数是高阶函数。map函数就是的，另外sorted()函数也是：可选的key参数可用于提供一个函数，应用到各个元素上进行排序。">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-07-30T16:28:29+08:00">
    <meta property="article:modified_time" content="2019-07-30T16:28:29+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">《流畅的Python》读书笔记——Python一等函数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在Python中，函数是一等对象：</p> 
<ul><li>在运行时创建</li><li>能赋值给变量或数据结构中的元素</li><li>能作为参数传给函数</li><li>能作为函数的返回结果</li></ul> 
<h2><a id="_7"></a>把函数视作对象</h2> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">def</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#通过控制台会话运行时创建一个函数</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token triple-quoted-string string">'''returns n!'''</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">return</span> <span class="token number">1</span> <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token keyword">else</span> n <span class="token operator">*</span> factorial<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> factorial<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token number">1405006117752879898543142606244511569936384000000000</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> factorial<span class="token punctuation">.</span>__doc__
<span class="token string">'returns n!'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">type</span><span class="token punctuation">(</span>factorial<span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'function'</span><span class="token operator">&gt;</span> <span class="token comment">#是function类的实例</span>
</code></pre> 
<p>我们来看下赋值、调用：</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> fact <span class="token operator">=</span> factorial
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> fact
<span class="token operator">&lt;</span>function factorial at <span class="token number">0x7f1c69958e18</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> fact<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token number">120</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">map</span><span class="token punctuation">(</span>factorial<span class="token punctuation">,</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token builtin">map</span> <span class="token builtin">object</span> at <span class="token number">0x7f1c62361908</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>fact<span class="token punctuation">,</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">720</span><span class="token punctuation">,</span> <span class="token number">5040</span><span class="token punctuation">,</span> <span class="token number">40320</span><span class="token punctuation">,</span> <span class="token number">362880</span><span class="token punctuation">,</span> <span class="token number">3628800</span><span class="token punctuation">]</span>
</code></pre> 
<p>有了一等函数，就可以使用函数式风格编程。</p> 
<h2><a id="_38"></a>高阶函数</h2> 
<p>接受函数为参数，或者把函数作为结果返回的函数是高阶函数。<code>map</code>函数就是的，另外<code>sorted()</code>函数也是：可选的<code>key</code>参数可用于提供一个函数，应用到各个元素上进行排序。</p> 
<p>根据单词长度给一个列表排序：</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'strawberry'</span><span class="token punctuation">,</span> <span class="token string">'fig'</span><span class="token punctuation">,</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'cherry'</span><span class="token punctuation">,</span> <span class="token string">'raspberry'</span><span class="token punctuation">,</span> <span class="token string">'banana'</span><span class="token punctuation">]</span>    
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>fruits<span class="token punctuation">,</span>key<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'fig'</span><span class="token punctuation">,</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'cherry'</span><span class="token punctuation">,</span> <span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token string">'raspberry'</span><span class="token punctuation">,</span> <span class="token string">'strawberry'</span><span class="token punctuation">]</span>
</code></pre> 
<p>根据反向拼写给一个单词列表排序:</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">def</span> <span class="token function">reverse</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">return</span> word<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> reverse<span class="token punctuation">(</span><span class="token string">'testing'</span><span class="token punctuation">)</span>
<span class="token string">'gnitset'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>fruits<span class="token punctuation">,</span>key<span class="token operator">=</span>reverse<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'fig'</span><span class="token punctuation">,</span> <span class="token string">'raspberry'</span><span class="token punctuation">,</span> <span class="token string">'strawberry'</span><span class="token punctuation">,</span> <span class="token string">'cherry'</span><span class="token punctuation">]</span>
</code></pre> 
<p>banana的反向拼写是a开头，因此是第一个元素。</p> 
<h3><a id="mapfilterreduce_63"></a>map、filter和reduce的替代品</h3> 
<p>函数式语言通常会提供map、filter和reduce三个高阶函数。</p> 
<p>列表推导和生成器表达式具有map和filter两个函数的功能，而且更易于阅读。</p> 
<p>计算阶乘列表:map和filter与列表推导比较</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>fact<span class="token punctuation">,</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#0!到5!的一个阶乘列表</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>fact<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">#使用列表推导执行相同的操作</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>factorial<span class="token punctuation">,</span> <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> n<span class="token punctuation">:</span> n <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">]</span><span class="token comment">#奇数阶乘列表(1!,3!,5!)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>factorial<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">if</span> n <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">#使用列表推导替代map和filter，同时避免了使用lambda表达式</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">]</span>
</code></pre> 
<p>reduce在Python3中是在functools模块，常用于求和，但最好使用内置的sum函数：</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> operator <span class="token keyword">import</span> add
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">4950</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">4950</span>
</code></pre> 
<p>为了使用高阶函数，有时创建一次性的小型函数更便利。这便是匿名函数存在的原因。</p> 
<h2><a id="_95"></a>匿名函数</h2> 
<p>lambda关键字在Python表达式内创建匿名函数。</p> 
<p>Python限制了lambda函数的定义体内只能使用纯表达式，不能赋值，不能使用while和try等。</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'strawberry'</span><span class="token punctuation">,</span> <span class="token string">'fig'</span><span class="token punctuation">,</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'cherry'</span><span class="token punctuation">,</span> <span class="token string">'raspberry'</span><span class="token punctuation">,</span> <span class="token string">'banana'</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>fruits<span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token keyword">lambda</span> word<span class="token punctuation">:</span> word<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'fig'</span><span class="token punctuation">,</span> <span class="token string">'raspberry'</span><span class="token punctuation">,</span> <span class="token string">'strawberry'</span><span class="token punctuation">,</span> <span class="token string">'cherry'</span><span class="token punctuation">]</span>
</code></pre> 
<h2><a id="_106"></a>可调用对象</h2> 
<p>除了用户定义的函数，调用运算符(即<code>()</code>)还可以应用到其他对象上。<br> 可通过<code>callable()</code>函数来判断对象是否能调用。</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">abs</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token number">13</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> function <span class="token builtin">abs</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token builtin">callable</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token keyword">for</span> obj <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span>
</code></pre> 
<h2><a id="_117"></a>用户定义的可调用类型</h2> 
<p>只要实现实例方法<code>__call__</code>，任何 Python 对象都可以表现得像函数。</p> 
<p>比如调用<code>BingoCage</code>实例，从打乱的列表中取出一个元素:</p> 
<pre><code class="prism language-py"><span class="token comment"># -*- coding: utf-8 -*</span>
<span class="token keyword">import</span> random

<span class="token keyword">class</span> <span class="token class-name">BingoCage</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_items <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token comment">#接受任何可迭代对象，本地构建一个副本</span>
        random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_items<span class="token punctuation">)</span> <span class="token comment">#打乱</span>

    <span class="token keyword">def</span> <span class="token function">pick</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_items<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span> <span class="token comment">#为空抛出异常</span>
            <span class="token keyword">raise</span> LookupError<span class="token punctuation">(</span><span class="token string">'pick from empty BingoCage'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>pick<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    bingo <span class="token operator">=</span> BingoCage<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>bingo<span class="token punctuation">.</span>pick<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>bingo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#打印2 可以像函数一样调用</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">callable</span><span class="token punctuation">(</span>bingo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#True</span>

</code></pre> 
<p>下面讨论把函数视作对象处理的另一方面：运行时内省。</p> 
<h2><a id="_152"></a>函数内省</h2> 
<p>除了 <code>__doc__</code>，函数对象还有很多属性。使用 <code>dir</code> 函数可以探知<br> factorial 具有下述属性：</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">dir</span><span class="token punctuation">(</span>factorial<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'__annotations__'</span><span class="token punctuation">,</span> <span class="token string">'__call__'</span><span class="token punctuation">,</span> <span class="token string">'__class__'</span><span class="token punctuation">,</span> <span class="token string">'__closure__'</span><span class="token punctuation">,</span> <span class="token string">'__code__'</span><span class="token punctuation">,</span>
<span class="token string">'__defaults__'</span><span class="token punctuation">,</span> <span class="token string">'__delattr__'</span><span class="token punctuation">,</span> <span class="token string">'__dict__'</span><span class="token punctuation">,</span> <span class="token string">'__dir__'</span><span class="token punctuation">,</span> <span class="token string">'__doc__'</span><span class="token punctuation">,</span> <span class="token string">'__eq__'</span><span class="token punctuation">,</span>
<span class="token string">'__format__'</span><span class="token punctuation">,</span> <span class="token string">'__ge__'</span><span class="token punctuation">,</span> <span class="token string">'__get__'</span><span class="token punctuation">,</span> <span class="token string">'__getattribute__'</span><span class="token punctuation">,</span> <span class="token string">'__globals__'</span><span class="token punctuation">,</span>
<span class="token string">'__gt__'</span><span class="token punctuation">,</span> <span class="token string">'__hash__'</span><span class="token punctuation">,</span> <span class="token string">'__init__'</span><span class="token punctuation">,</span> <span class="token string">'__kwdefaults__'</span><span class="token punctuation">,</span> <span class="token string">'__le__'</span><span class="token punctuation">,</span> <span class="token string">'__lt__'</span><span class="token punctuation">,</span>
<span class="token string">'__module__'</span><span class="token punctuation">,</span> <span class="token string">'__name__'</span><span class="token punctuation">,</span> <span class="token string">'__ne__'</span><span class="token punctuation">,</span> <span class="token string">'__new__'</span><span class="token punctuation">,</span> <span class="token string">'__qualname__'</span><span class="token punctuation">,</span> <span class="token string">'__reduce__'</span><span class="token punctuation">,</span>
<span class="token string">'__reduce_ex__'</span><span class="token punctuation">,</span> <span class="token string">'__repr__'</span><span class="token punctuation">,</span> <span class="token string">'__setattr__'</span><span class="token punctuation">,</span> <span class="token string">'__sizeof__'</span><span class="token punctuation">,</span> <span class="token string">'__str__'</span><span class="token punctuation">,</span>
<span class="token string">'__subclasshook__'</span><span class="token punctuation">]</span>
</code></pre> 
<p>其中大多数属性是 Python 对象共有的。本节讨论与把函数视作对象相关<br> 的几个属性，先从 <code>__dict__</code> 开始。</p> 
<p>与用户定义的常规类一样，函数使用 <code>__dict__</code> 属性存储赋予它的用<br> 户属性。这相当于一种基本形式的注解。</p> 
<p>下面重点说明函数专有而用户定义的一般对象没有的属性。计算两个属性集合的差集便能得到函数专有属性列表:</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> obj <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>  
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'__annotations__'</span><span class="token punctuation">,</span> <span class="token string">'__call__'</span><span class="token punctuation">,</span> <span class="token string">'__closure__'</span><span class="token punctuation">,</span> <span class="token string">'__code__'</span><span class="token punctuation">,</span> <span class="token string">'__defaults__'</span><span class="token punctuation">,</span> <span class="token string">'__get__'</span><span class="token punctuation">,</span> <span class="token string">'__globals__'</span><span class="token punctuation">,</span> <span class="token string">'__kwdefaults__'</span><span class="token punctuation">,</span> <span class="token string">'__name__'</span><span class="token punctuation">,</span> <span class="token string">'__qualname__'</span><span class="token punctuation">]</span>
</code></pre> 
<table><thead><tr><th>名称</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>__annotations__</code></td><td>dict</td><td>参数和返回值的注解</td></tr><tr><td><code>__call__</code></td><td>methodwrapper</td><td>实现()运算符；可调用对象协议</td></tr><tr><td><code>__closure__</code></td><td>tuple</td><td>函数闭包，即自由变量的绑定</td></tr><tr><td><code>__code__</code></td><td>code</td><td>编译成字节码的函数元数据和函数定义体</td></tr><tr><td><code>__defaults__</code></td><td>tuple</td><td>形式参数的默认值</td></tr><tr><td><code>__get__</code></td><td>methodwrapper</td><td>实现只读描述符协议</td></tr><tr><td><code>__globals__</code></td><td>dict</td><td>函数所在模块中的全局变量</td></tr><tr><td><code>__kwdefaults__</code></td><td>dict</td><td>仅限关键字形式参数的默认值</td></tr><tr><td><code>__name__</code></td><td>str</td><td>函数名称</td></tr><tr><td><code>__qualname__</code></td><td>str</td><td>函数的限定名称，如Random.choice</td></tr></tbody></table> 
<h2><a id="_198"></a>从定位参数到仅限关键字参数</h2> 
<p>Python 最好的特性之一是提供了极为灵活的参数处理机制，而且 Python<br> 3 进一步提供了仅限关键字参数（keyword-only argument）。与之密切相<br> 关的是，调用函数时使用 <code>*</code> 和 <code>**</code>“展开”可迭代对象，映射到单个参<br> 数。</p> 
<pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">tag</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token operator">*</span>content<span class="token punctuation">,</span>cls <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span><span class="token operator">**</span>attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 生成一个或多个HTML标签
    :param name:  定位参数(位置参数)
    :param content: 可变参数(允许传入任意(或0)个参数，通过tuple存储)
    :param cls:  命名关键字参数，命名关键字参数需要一个*(或者是可变参数)作为分隔符,该分隔符后面的就是命名关键字参数，
                必须传入参数名
    :param attrs: 关键字参数，允许传入任意(或0)个含参数名的参数，通过dict存储
    :return:
    """</span>
    <span class="token keyword">if</span> cls <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        attrs<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cls
    <span class="token keyword">if</span> attrs<span class="token punctuation">:</span>
        attr_str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">' %s="%s"'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>attr<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token keyword">for</span> attr<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>attrs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        attr_str <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">if</span> content<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'&lt;%s%s&gt;%s&lt;/%s&gt;'</span> <span class="token operator">%</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> attr_str<span class="token punctuation">,</span> c<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> content<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'&lt;%s%s /&gt;'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> attr_str<span class="token punctuation">)</span>
</code></pre> 
<p>我们来对这些参数做一些解释：</p> 
<ul><li><code>name</code>: 定位参数(位置参数)</li><li><code>*content</code>: 可变参数(允许传入任意(或0)个参数，通过tuple存储)</li><li><code>cls</code> : 仅限(命名)关键字参数，命名关键字参数需要一个<code>*</code>(或者是可变参数)作为分隔符,该分隔符后面的类似位置参数的就是命名关键字参数， <strong>注意调用的时候必须传入参数名。</strong></li><li><code>attrs</code>: 关键字参数，允许传入任意(或0)个含参数名的参数，通过dict存储</li></ul> 
<p>下面是调用例子：</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> tag<span class="token punctuation">(</span><span class="token string">'br'</span><span class="token punctuation">)</span> <span class="token comment"># 传入单个参数到定位参数name，生成一个指定名称的空标签</span>
<span class="token string">'&lt;br /&gt;'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> tag<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span><span class="token string">'hello'</span><span class="token punctuation">)</span> <span class="token comment">#第一个参数后的任意个参数会被*content捕获，存入元组</span>
<span class="token string">'&lt;p&gt;hello&lt;/p&gt;'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> tag<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">)</span> <span class="token comment">#第一个参数后的任意个参数会被*content捕获，存入元组</span>
<span class="token string">'&lt;p&gt;hello&lt;/p&gt;\n&lt;p&gt;world&lt;/p&gt;'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> tag<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">)</span> <span class="token comment">#tag函数签名中没有指定名称的关键字会被**attrs捕获，存入字典(这里是id)</span>
<span class="token string">'&lt;p id="33"&gt;hello&lt;/p&gt;'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> tag<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">,</span> cls<span class="token operator">=</span><span class="token string">'sidebar'</span><span class="token punctuation">)</span> <span class="token comment">#cls参数只能作为关键字参数传入，必须传入参数名，不然无法与位置参数进行区分</span>
<span class="token string">'&lt;p class="sidebar"&gt;hello&lt;/p&gt;\n&lt;p class="sidebar"&gt;world&lt;/p&gt;'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> tag<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">'testing'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"img"</span><span class="token punctuation">)</span>
<span class="token string">'&lt;img content="testing" /&gt;'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> my_tag <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Sunset Boulevard'</span><span class="token punctuation">,</span><span class="token string">'src'</span><span class="token punctuation">:</span> <span class="token string">'sunset.jpg'</span><span class="token punctuation">,</span> <span class="token string">'cls'</span><span class="token punctuation">:</span> <span class="token string">'framed'</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>tag<span class="token punctuation">(</span><span class="token operator">**</span>my_tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#my_tag 前面加上 **，字典中的所有元素作为单个参数传入，同名键会绑定到对应的具名参数上，余下的则被 **attrs 捕获。</span>
<span class="token operator">&lt;</span>img <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"framed"</span> src<span class="token operator">=</span><span class="token string">"sunset.jpg"</span> title<span class="token operator">=</span><span class="token string">"Sunset Boulevard"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<p>定义函数时若想指定仅限关键字参数，要把它们放到前面有 <code>*</code>的参数后面。如果不想支持数量不定的定位参数，但是想支持仅限关键字参数，在签名中<br> 放一个 <code>*</code>，如下所示：</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">return</span> a<span class="token punctuation">,</span>b
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">#必须制定参数名b</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;stdin&gt;"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
TypeError<span class="token punctuation">:</span> f<span class="token punctuation">(</span><span class="token punctuation">)</span> takes <span class="token number">1</span> positional argument but <span class="token number">2</span> were given
</code></pre> 
<h2><a id="_270"></a>获取关于参数的信息</h2> 
<p>HTTP 微框架 Bobo 中有个使用函数内省的好例子。示例 是对 Bobo<br> 教程中“Hello world”应用的改编，说明了内省怎么使用。</p> 
<pre><code class="prism language-py"><span class="token keyword">import</span> bobo

@bobo<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'Hello %s!'</span> <span class="token operator">%</span> person
</code></pre> 
<p>Bobo 会内省 hello 函数，发现它需要一个名为<br> person 的参数，然后从请求中获取那个名称对应的参数，将其传给<br> hello 函数，因此程序员根本不用触碰请求对象。<br> 通过以下命令启动程序：</p> 
<pre><code class="prism language-cmd">&gt;bobo -f bobo_demo.py
Serving ['bobo__main__'] on port 8080...
</code></pre> 
<p><img src="https://images2.imgbox.com/aa/dc/I4JZbLOy_o.png" alt="在这里插入图片描述"></p> 
<p>通过Postman访问 http://localhost:8080 可以看到状态码是403，并且有个消息提示缺少person变量。</p> 
<p>我们加上person试一下：</p> 
<p><img src="https://images2.imgbox.com/3f/6c/HsnFnOFr_o.png" alt="在这里插入图片描述"></p> 
<p>Bobo是怎么知道函数需要哪个参数的呢？它又怎么知道参数没有默认值呢？</p> 
<p>函数对象有个<code>__defaults__</code>属性，它的值是一个元组，里面保存着<br> 定位参数和关键字参数的默认值。仅限关键字参数的默认值在<br> <code>__kwdefaults__</code>属性中。然而，参数的名称在<code>__code__</code> 属性中，<br> 它的值是一个 code 对象引用，自身也有很多属性。</p> 
<pre><code class="prism language-py#">
def clip(text, max_len=80):
    """在max_len前面或后面的第一个空格处截断文本"""
    end = None
    if len(text) &gt; max_len:
        space_before = text.rfind(' ', 0, max_len)
        if space_before &gt;= 0:
            end = space_before
        else:
            space_after = text.rfind(' ', max_len)
            if space_after &gt;= 0:
                end = space_after
    if end is None:
        end = len(text)
    return text[:end].rstrip()


print(clip.__defaults__) #(80,)
print(clip.__code__) #&lt;code object clip at 0x000001F1807759C0, file "D:/workspace/python/FluentPython/first_class_function/clip.py", line 3&gt;
print(clip.__code__.co_varnames) #('text', 'max_len', 'end', 'space_before', 'space_after')
print(clip.__code__.co_argcount) #2 
</code></pre> 
<p>可以看出，这种组织信息的方式并不是最便利的。参数名称在<br> <code>__code__.co_varnames</code> 中，不过里面还有函数定义体中创建的局<br> 部变量。因此，参数名称是前 N 个字符串，N 的值由<br> <code>__code__.co_argcount</code>确定。</p> 
<p>幸好，我们有更好的方式——使用<code>inspect</code>模块</p> 
<pre><code class="prism language-py">sig <span class="token operator">=</span> signature<span class="token punctuation">(</span>clip<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sig<span class="token punctuation">)</span> <span class="token comment">#(text, max_len=80)</span>
<span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> sig<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span>kind<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
    
<span class="token comment">#POSITIONAL_OR_KEYWORD : text = &lt;class 'inspect._empty'&gt;</span>
<span class="token comment">#POSITIONAL_OR_KEYWORD : max_len = 80</span>
</code></pre> 
<p><code>inspect.Signature</code> 对象有个 <code>bind</code> 方法，它可以把任意个参数绑<br> 定到签名中的形参上，所用的规则与实参到形参的匹配方式一样。框架<br> 可以使用这个方法在真正调用函数前验证参数，如示例所示。</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> inspect
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sig <span class="token operator">=</span> inspect<span class="token punctuation">.</span>signature<span class="token punctuation">(</span>tag<span class="token punctuation">)</span> <span class="token comment">#tag函数在上面定义过</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> my_tag <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Sunset Boulevard'</span><span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">:</span> <span class="token string">'sunset.jpg'</span><span class="token punctuation">,</span> <span class="token string">'cls'</span><span class="token punctuation">:</span> <span class="token string">'framed'</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> bound_args <span class="token operator">=</span> sig<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token operator">**</span>my_tag<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> bound_args <span class="token comment">#得到BoundArguments对象</span>
<span class="token operator">&lt;</span>BoundArguments <span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'img'</span><span class="token punctuation">,</span> cls<span class="token operator">=</span><span class="token string">'framed'</span><span class="token punctuation">,</span> attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Sunset Boulevard'</span><span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">:</span> <span class="token string">'sunset.jpg'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> name<span class="token punctuation">,</span> value <span class="token keyword">in</span> bound_args<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#迭代bound_args.arguments</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
name <span class="token operator">=</span> img
cls <span class="token operator">=</span> framed
attrs <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Sunset Boulevard'</span><span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">:</span> <span class="token string">'sunset.jpg'</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">del</span> my_tag<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token comment">#把必须指定的参数name从my_tag中删除</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> bound_args <span class="token operator">=</span> sig<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token operator">**</span>my_tag<span class="token punctuation">)</span> <span class="token comment">#调用报错</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;stdin&gt;"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
  File <span class="token string">"/usr/lib/python3.6/lib/python3.6/inspect.py"</span><span class="token punctuation">,</span> line <span class="token number">2933</span><span class="token punctuation">,</span> <span class="token keyword">in</span> bind
    <span class="token keyword">return</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_bind<span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span>
  File <span class="token string">"/usr/lib/python3.6/lib/python3.6/inspect.py"</span><span class="token punctuation">,</span> line <span class="token number">2848</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _bind
    <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token boolean">None</span>
TypeError<span class="token punctuation">:</span> missing a required argument<span class="token punctuation">:</span> <span class="token string">'name'</span>
</code></pre> 
<p>框架和 IDE 等工具可以使用这些信息验证代码。Python 3 的另一个特性<br> ——函数注解——增进了这些信息的用途</p> 
<h2><a id="_379"></a>函数注解</h2> 
<p>Python 3 提供了一种句法，用于为函数声明中的参数和返回值附加元数据。</p> 
<p>下面给定一个有注解的clip函数:</p> 
<pre><code class="prism language-py"><span class="token keyword">def</span> <span class="token function">clip</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">,</span> max_len<span class="token punctuation">:</span><span class="token string">'int &gt; 0'</span><span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span> <span class="token comment">#有注解的函数声明</span>
    <span class="token triple-quoted-string string">"""在max_len前面或后面的第一个空格处截断文本"""</span>
    end <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">&gt;</span> max_len<span class="token punctuation">:</span>
        space_before <span class="token operator">=</span> text<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> max_len<span class="token punctuation">)</span>
        <span class="token keyword">if</span> space_before <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            end <span class="token operator">=</span> space_before
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            space_after <span class="token operator">=</span> text<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> max_len<span class="token punctuation">)</span>
            <span class="token keyword">if</span> space_after <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                end <span class="token operator">=</span> space_after
    <span class="token keyword">if</span> end <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        end <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token keyword">return</span> text<span class="token punctuation">[</span><span class="token punctuation">:</span>end<span class="token punctuation">]</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>注解不会做任何处理，只是存储在函数的 <code>__annotations__</code>属性（一个字典）中：</p> 
<pre><code class="prism language-py"><span class="token keyword">print</span><span class="token punctuation">(</span>clip<span class="token punctuation">.</span>__annotations__<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'text'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token string">'max_len'</span><span class="token punctuation">:</span> <span class="token string">'int &gt; 0'</span><span class="token punctuation">,</span> <span class="token string">'return'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">&gt;</span><span class="token punctuation">}</span>
</code></pre> 
<p>Python 对注解所做的唯一的事情是，把它们存储在函数的<br> <code>__annotations__</code>属性里。仅此而已，Python 不做检查、不做强制、<br> 不做验证，什么操作都不做。</p> 
<p>在未来，Bobo 等框架可以支持注解，并进一步自动处理请求。例如，<br> 使用 <code>price:float</code> 注解的参数可以自动把查询字符串转换成函数期待<br> 的<code>float</code> 类型；<code>quantity:'int &gt; 0'</code>这样的字符串注解可以转换<br> 成对参数的验证。</p> 
<h2><a id="_420"></a>支持函数式编程的包</h2> 
<h3><a id="operator_422"></a>operator模块</h3> 
<p>在函数式编程中，经常需要把算术运算符当作函数使用。例如，不使用<br> 递归计算阶乘。求和可以使用 sum 函数，但是求积则没有这样的函<br> 数。我们可以使用 <code>reduce</code> 函数，但是需要一个函数计算序列中两个<br> 元素之积。示例展示如何使用 lambda 表达式解决这个问题。</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">def</span> <span class="token function">fact</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">return</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> a<span class="token operator">*</span>b<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><code>operator</code>模块为多个算术运算符提供了对应的函数，从而避免编写<br> <code>lambda a, b: a*b</code> 这种<strong>平凡的匿名函数</strong>。</p> 
<pre><code class="prism language-py"><span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>
<span class="token keyword">from</span> operator <span class="token keyword">import</span> mul

<span class="token keyword">def</span> <span class="token function">fact</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>mul<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>operator 模块中还有一类函数，能替代从序列中取出元素或读取对象<br> 属性的 lambda 表达式：因此，itemgetter 和 attrgetter 其实会<br> 自行构建函数</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> metro_data <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">(</span><span class="token string">'Tokyo'</span><span class="token punctuation">,</span> <span class="token string">'JP'</span><span class="token punctuation">,</span> <span class="token number">36.933</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">35.689722</span><span class="token punctuation">,</span> <span class="token number">139.691667</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">(</span><span class="token string">'Delhi NCR'</span><span class="token punctuation">,</span> <span class="token string">'IN'</span><span class="token punctuation">,</span> <span class="token number">21.935</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">28.613889</span><span class="token punctuation">,</span> <span class="token number">77.208889</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">(</span><span class="token string">'Mexico City'</span><span class="token punctuation">,</span> <span class="token string">'MX'</span><span class="token punctuation">,</span> <span class="token number">20.142</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">19.433333</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">99.133333</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">(</span><span class="token string">'New York-Newark'</span><span class="token punctuation">,</span> <span class="token string">'US'</span><span class="token punctuation">,</span> <span class="token number">20.104</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">40.808611</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.020386</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">(</span><span class="token string">'Sao Paulo'</span><span class="token punctuation">,</span> <span class="token string">'BR'</span><span class="token punctuation">,</span> <span class="token number">19.649</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">23.547778</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">46.635833</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> city <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>metro_data<span class="token punctuation">,</span> key<span class="token operator">=</span>itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token punctuation">(</span><span class="token string">'Sao Paulo'</span><span class="token punctuation">,</span> <span class="token string">'BR'</span><span class="token punctuation">,</span> <span class="token number">19.649</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">23.547778</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">46.635833</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'Delhi NCR'</span><span class="token punctuation">,</span> <span class="token string">'IN'</span><span class="token punctuation">,</span> <span class="token number">21.935</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">28.613889</span><span class="token punctuation">,</span> <span class="token number">77.208889</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'Tokyo'</span><span class="token punctuation">,</span> <span class="token string">'JP'</span><span class="token punctuation">,</span> <span class="token number">36.933</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">35.689722</span><span class="token punctuation">,</span> <span class="token number">139.691667</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'Mexico City'</span><span class="token punctuation">,</span> <span class="token string">'MX'</span><span class="token punctuation">,</span> <span class="token number">20.142</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">19.433333</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">99.133333</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'New York-Newark'</span><span class="token punctuation">,</span> <span class="token string">'US'</span><span class="token punctuation">,</span> <span class="token number">20.104</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">40.808611</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.020386</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>其实，<code>itemgetter(1)</code>的作用与<code>lambda fields: fields[1]</code>一样：创建一个接受集合的函数，返回索引位 1上的元素。</p> 
<p>如果把多个参数传给<code>itemgetter</code>，它构建的函数会返回提取的值构<br> 成的元组：</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cc_name <span class="token operator">=</span> itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> city <span class="token keyword">in</span> metro_data<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>cc_name<span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token punctuation">(</span><span class="token string">'JP'</span><span class="token punctuation">,</span> <span class="token string">'Tokyo'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'IN'</span><span class="token punctuation">,</span> <span class="token string">'Delhi NCR'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'MX'</span><span class="token punctuation">,</span> <span class="token string">'Mexico City'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'US'</span><span class="token punctuation">,</span> <span class="token string">'New York-Newark'</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'BR'</span><span class="token punctuation">,</span> <span class="token string">'Sao Paulo'</span><span class="token punctuation">)</span>
</code></pre> 
<p>attrgetter 与 itemgetter 作用类似，它创建的函数根据名称提取<br> 对象的属性。如果把多个属性名传给 attrgetter，它也会返回提取<br> 的值构成的元组。此外，如果参数名中包含 .（点号），attrgetter<br> 会深入嵌套对象，获取指定的属性。</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> LatLong <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'LatLong'</span><span class="token punctuation">,</span><span class="token string">'lat long'</span><span class="token punctuation">)</span> <span class="token comment">#使用 namedtuple 定义 LatLong</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Metropolis <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'Metropolis'</span><span class="token punctuation">,</span> <span class="token string">'name cc pop coord'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> metro_areas <span class="token operator">=</span> <span class="token punctuation">[</span>Metropolis<span class="token punctuation">(</span>name<span class="token punctuation">,</span> cc<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> LatLong<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> <span class="token builtin">long</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">for</span> name<span class="token punctuation">,</span>cc<span class="token punctuation">,</span>pop<span class="token punctuation">,</span><span class="token punctuation">(</span>lat<span class="token punctuation">,</span><span class="token builtin">long</span><span class="token punctuation">)</span> <span class="token keyword">in</span> metro_data<span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> metro_areas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Metropolis<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Tokyo'</span><span class="token punctuation">,</span> cc<span class="token operator">=</span><span class="token string">'JP'</span><span class="token punctuation">,</span> pop<span class="token operator">=</span><span class="token number">36.933</span><span class="token punctuation">,</span> coord<span class="token operator">=</span>LatLong<span class="token punctuation">(</span>lat<span class="token operator">=</span><span class="token number">35.689722</span><span class="token punctuation">,</span> <span class="token builtin">long</span><span class="token operator">=</span><span class="token number">139.691667</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> metro_areas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>coord<span class="token punctuation">.</span>lat<span class="token comment">#获取它的纬度</span>
<span class="token number">35.689722</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> operator <span class="token keyword">import</span> attrgetter
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> name_lat <span class="token operator">=</span> attrgetter<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'coord.lat'</span><span class="token punctuation">)</span> <span class="token comment">#获取 name 属性和嵌套的 coord.lat 属性</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> city <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>metro_areas<span class="token punctuation">,</span> key<span class="token operator">=</span>attrgetter<span class="token punctuation">(</span><span class="token string">'coord.lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#使用attrgetter,按照纬度排序</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>name_lat<span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token punctuation">(</span><span class="token string">'Sao Paulo'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">23.547778</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'Mexico City'</span><span class="token punctuation">,</span> <span class="token number">19.433333</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'Delhi NCR'</span><span class="token punctuation">,</span> <span class="token number">28.613889</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'Tokyo'</span><span class="token punctuation">,</span> <span class="token number">35.689722</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'New York-Newark'</span><span class="token punctuation">,</span> <span class="token number">40.808611</span><span class="token punctuation">)</span>
</code></pre> 
<p>使用 Metropolis 实例构建 metro_areas 列表；注意，我们使用<br> 嵌套的元组拆包提取 (lat, long)，然后使用它们构建 LatLong，<br> 作为 Metropolis 的 coord 属性。</p> 
<p>在 operator 模块余下的函数中，最后介绍一下<br> <code>methodcaller</code>。它的作用与 attrgetter 和 itemgetter 类似，它<br> 会自行创建函数。<code>methodcaller</code> 创建的函数会在对象上调用参数指<br> 定的方法:</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> operator <span class="token keyword">import</span> methodcaller
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> s <span class="token operator">=</span> <span class="token string">'The time has come'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> upcase <span class="token operator">=</span> methodcaller<span class="token punctuation">(</span><span class="token string">'upper'</span><span class="token punctuation">)</span> <span class="token comment">#想调用str.upper方法</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> upcase<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token string">'THE TIME HAS COME'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> hiphenate <span class="token operator">=</span> methodcaller<span class="token punctuation">(</span><span class="token string">'replace'</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> hiphenate<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token string">'The-time-has-come'</span>
</code></pre> 
<h3><a id="functoolspartial_535"></a>使用functools.partial冻结参数</h3> 
<p>functools.partial 这个高阶函数用于部分应用一个函数。部分应<br> 用是指，基于一个函数创建一个新的可调用对象，把原函数的某些参数<br> 固定。使用这个函数可以把接受一个或多个参数的函数改编成需要回调<br> 的 API，这样参数更少。</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> operator <span class="token keyword">import</span> mul
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> functools <span class="token keyword">import</span> partial
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> triple <span class="token operator">=</span> partial<span class="token punctuation">(</span>mul<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#将参数3固定，这样只需要传一个参数</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> triple<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token number">21</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>triple<span class="token punctuation">,</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span>
</code></pre> 
<p>使用 上篇介绍的<code>unicode.normalize</code> 函数再举个例子，这个示例<br> 更有实际意义。如果处理多国语言编写的文本，在比较或排序之前可能<br> 会想使用 <code>unicode.normalize('NFC', s)</code> 处理所有字符串 <code>s</code>。如<br> 果经常这么做，可以定义一个 <code>nfc</code> 函数:</p> 
<pre><code class="prism language-py"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> unicodedata<span class="token punctuation">,</span>functools
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> nfc <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>unicodedata<span class="token punctuation">.</span>normalize<span class="token punctuation">,</span><span class="token string">'NFC'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> s1 <span class="token operator">=</span> <span class="token string">'café'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> s2 <span class="token operator">=</span> <span class="token string">'cafe\u0301'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> s1<span class="token punctuation">,</span>s2
<span class="token punctuation">(</span><span class="token string">'café'</span><span class="token punctuation">,</span> <span class="token string">'café'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> s1 <span class="token operator">==</span> s2
<span class="token boolean">False</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> nfc<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token operator">==</span> nfc<span class="token punctuation">(</span>s2<span class="token punctuation">)</span>
<span class="token boolean">True</span>
</code></pre> 
<p><code>partial</code> 的第一个参数是一个可调用对象，后面跟着任意个要绑定的<br> 定位参数和关键字参数。这个功能其实很有用的。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d8788f6dc09623c1ad5fff918c1572a9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">自定义springboot starter</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/57f92612c9b3e00432f825387a4f9c0c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">nestjs中typeorm事务操作的三种方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>