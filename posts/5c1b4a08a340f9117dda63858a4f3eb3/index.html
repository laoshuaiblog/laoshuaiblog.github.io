<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Flask: flask &#43; tornado&#43; nginx组合 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/5c1b4a08a340f9117dda63858a4f3eb3/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="Flask: flask &#43; tornado&#43; nginx组合">
  <meta property="og:description" content="在本地完成大部分开发后，迁移到阿里云生产环境。因为是小网站，选择了windows平台，但是后端又选择了flask框架，只能选择tornado web容器和nginx组合。其实，nginx都没有必要，只是为了试着玩玩，看看生产环境如何配置。
tornado代码很简单，就是一个server.py.
具体在阿里云上：
我选择了生产环境配置了一台ecs服务器。
server name 是阿里云上绑定对应域名的www.myweb.com（假定）的主页地址。端口需要看ecs网络安全组对应的端口设置。允许有相应的访问权限就可以。
需要说明的是，这里域名绑定，域名申请，网络安全组设置等不介绍了。
nginx第一次设置，可能会让大家感觉是不是会很复杂？其实大可不必紧张。首先去下载一个nginx到本地，如下：
配置文件 就是conf目录下，nginx.conf文件。打开即可，进行相关设置。
主要就两部分：
1、sever下 listen 端口和server_name
server { listen 80; server_name myweb.com; #charset koi8-r; #access_log logs/host.access.log main; location / { proxy_pass http://localhost:9000; } #error_page 404 /404.html; } 另外一个linux下设置：
db@iZgw041dtbsye3lhp8lz3eZ:~/dataapi/http_server$ cd /etc/nginx db@iZgw041dtbsye3lhp8lz3eZ:/etc/nginx$ ls conf.d fastcgi_params koi-win modules-available nginx.conf scgi_params sites-enabled uwsgi_params fastcgi.conf koi-utf mime.types modules-enabled proxy_params sites-available snippets win-utf db@iZgw041dtbsye3lhp8lz3eZ:/etc/nginx$ sudo vi nginx.conf 在nginx.conf中http下：增加
server { listen 80; server_name localhost; #charset koi8-r; #access_log logs/host.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-09-24T11:49:51+08:00">
    <meta property="article:modified_time" content="2022-09-24T11:49:51+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Flask: flask &#43; tornado&#43; nginx组合</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在本地完成大部分开发后，迁移到阿里云生产环境。因为是小网站，选择了windows平台，但是后端又选择了flask框架，只能选择tornado web容器和nginx组合。其实，nginx都没有必要，只是为了试着玩玩，看看生产环境如何配置。</p> 
<p>tornado代码很简单，就是一个server.py.<br> <img src="https://images2.imgbox.com/b0/50/dGkHk7lk_o.png" alt="在这里插入图片描述">具体在阿里云上：<br> 我选择了生产环境配置了一台ecs服务器。<br> server name 是阿里云上绑定对应域名的www.myweb.com（假定）的主页地址。端口需要看ecs网络安全组对应的端口设置。允许有相应的访问权限就可以。</p> 
<p>需要说明的是，这里域名绑定，域名申请，网络安全组设置等不介绍了。</p> 
<p>nginx第一次设置，可能会让大家感觉是不是会很复杂？其实大可不必紧张。首先去下载一个nginx到本地，如下：<br> <img src="https://images2.imgbox.com/42/6f/IyPYMdJh_o.png" alt="在这里插入图片描述">配置文件 就是conf目录下，nginx.conf文件。打开即可，进行相关设置。<br> 主要就两部分：</p> 
<p>1、sever下 listen 端口和server_name</p> 
<pre><code class="prism language-bash">server <span class="token punctuation">{<!-- --></span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  myweb.com<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{<!-- --></span>
            proxy_pass http://localhost:9000<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>
      <span class="token punctuation">}</span>
</code></pre> 
<p>另外一个linux下设置：</p> 
<pre><code class="prism language-bash">db@iZgw041dtbsye3lhp8lz3eZ:~/dataapi/http_server$ <span class="token builtin class-name">cd</span> /etc/nginx
db@iZgw041dtbsye3lhp8lz3eZ:/etc/nginx$ <span class="token function">ls</span>
conf.d        fastcgi_params  koi-win     modules-available  nginx.conf    scgi_params      sites-enabled  uwsgi_params
fastcgi.conf  koi-utf         mime.types  modules-enabled    proxy_params  sites-available  snippets       win-utf
db@iZgw041dtbsye3lhp8lz3eZ:/etc/nginx$ <span class="token function">sudo</span> <span class="token function">vi</span> nginx.conf
</code></pre> 
<p><img src="https://images2.imgbox.com/e1/a8/0RiljHGh_o.png" alt="在这里插入图片描述">在nginx.conf中http下：增加</p> 
<pre><code class="prism language-bash">    
server <span class="token punctuation">{<!-- --></span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>
        <span class="token comment">#charset koi8-r;</span>
        <span class="token comment">#access_log  logs/host.access.log  main;</span>
        location / <span class="token punctuation">{<!-- --></span>
            proxy_pass http://localhost:9090<span class="token punctuation">;</span>
            proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
            proxy_set_header X-Real-Port <span class="token variable">$remote_port</span><span class="token punctuation">;</span>
            proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        error_page  <span class="token number">404</span>              /404.html<span class="token punctuation">;</span>
        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>2、location部分</p> 
<p>这部分比较重要，否则即使nginx正常，也只是到欢迎来到nginx那个页面，是到不到你应用那的。</p> 
<pre><code class="prism language-bash">proxy_pass http://localhost:9000<span class="token punctuation">;</span>
</code></pre> 
<p>这部分是nginx到tornado web 服务器的分发的部分，tornado 发把端口9000的信息，分发给flask应用。<br> 具体的端口和tornado中的端口一致就OK了。</p> 
<p>上面好了，就可以启动tornado和nginx了。如果nginx已经启后，需要再reload一下，更新一下配置。这个可以互联网上到处查到。</p> 
<pre><code class="prism language-bash">常见的ubuntu平台下的修改命令:
<span class="token function">sudo</span> systemctl start nginx <span class="token comment"># 启动</span>
<span class="token function">sudo</span> systemctl stop nginx <span class="token comment"># 停止</span>
<span class="token function">sudo</span> systemctl restart nginx <span class="token comment">#重新启动</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx <span class="token comment"># 查询nginx状态</span>
<span class="token function">sudo</span> nginx -s reload <span class="token comment"># 修改配置文件后，重新载入配置文件</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/97/47/m8LBHhAE_o.jpg" alt="在这里插入图片描述"></p> 
<p>nginx的状态，可以在windows下，通过任务管理器看一下，是否正常启动或处于运行状态。</p> 
<p>其它具体nginx的相关操作，这里就不详述了。过程比较简单，远远比想象的简单。</p> 
<p>一切ok后，你输入www.myweb.com就可以访问了。</p> 
<p>问题：</p> 
<p>如果访问没有反应，可以看看tornado设置的端口是否被占用了，可以重设一个端口，此时需要nginx conf文件 进行重设一下，并reload。</p> 
<p>另外，在flask下，图片等静态文件 最好放在staic文件 夹下，放在其它地方，哪怕是绝对路径也可能找不到。</p> 
<p>3、关于真实IP设置</p> 
<p>server {<!-- --><br> listen 80;<br> server_name myweb.com;</p> 
<pre><code>    #charset koi8-r;

    #access_log  logs/host.access.log  main;

    location / {
        proxy_pass http://localhost:9000;
        proxy_set_header X-Real-IP $remote_addr;
	   proxy_set_header X-Real-Port $remote_port;
	   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    #error_page  404              /404.html;
  }
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/01693d400bdc79ad8e3670822b3c30e4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OpenCV&#43;python实现摄像头简单手势识别--进度条控制亮度</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/223b4422c98ddabfb2fa37e9dcdb3c9c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">OPLS-DA的S-plot图可视化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>