<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用钉钉机器人Webhook向钉钉群推送告警通知 - 老帅的博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://laoshuaiblog.github.io/posts/3e25b96316972d4e67fd1e64a90139d0/">
  <meta property="og:site_name" content="老帅的博客">
  <meta property="og:title" content="利用钉钉机器人Webhook向钉钉群推送告警通知">
  <meta property="og:description" content="一、配置钉钉群
1、新建一个接收通知的钉钉群
如下图，创建一个接收通知的钉钉群
选择项目群，点创建
输入群名称，右侧选择群成员，最后点击右下角的创建
2、对群进行设置
点群右上角的设置按钮
点击 “智能群助手”
点 “添加机器人”
点 添加机器人 最右边的 “&#43;” 加号 选最后的 自定义 通过Webhook接入自定义服务
点 添加
输入机器人名字，安全设置里输入自定义的关键字
注意注意：这个自定义关键字必须输入，而且等下在代码里发送消息时，消息的内容体里，必须包含这个关键字，否则钉钉会返回 消息发送失败
点 完成
完成后，会出现下图的画面，点击 复制，把生成的 Webhook复制一下，最后点击 完成
完成后，会进入下边的页面
到这里，钉钉群的配置就完成了
二、Java代码的编写
钉钉群配置好，拿到Webhook的值后，就可以在java代码里调用钉钉的消息推送了
下面贴一下代码
import lombok.extern.slf4j.Slf4j; import java.util.HashMap; import java.util.Map; /** * @描述 异常告警钉钉通知 * @创建人 anan * @创建时间 2023/1/30 14:03 */ @Slf4j public class SendDDMessage { //这里就是刚才拿到的Webhook的值 public static final String DING_DING_TOKEN = &#34;https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;; public static void sendDDMessage(String msg){ //钉钉的webhook //请求的JSON数据，这里用map在工具类里转成json格式 Map&amp;lt;String,Object&amp;gt; json=new HashMap(); Map&amp;lt;String,Object&amp;gt; text=new HashMap(); json.">
  <meta property="og:locale" content="zh-CN">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-01-30T14:10:24+08:00">
    <meta property="article:modified_time" content="2023-01-30T14:10:24+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="老帅的博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">老帅的博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用钉钉机器人Webhook向钉钉群推送告警通知</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>一、配置钉钉群<br> 1、新建一个接收通知的钉钉群<br> 如下图，创建一个接收通知的钉钉群</p> 
<p><img alt="" src="https://images2.imgbox.com/22/1a/96XfxfMi_o.png"></p> 
<p> </p> 
<p>选择项目群，点创建</p> 
<p><img alt="" src="https://images2.imgbox.com/16/d0/XYaCQkHr_o.png"></p> 
<p> </p> 
<p>输入群名称，右侧选择群成员，最后点击右下角的创建</p> 
<p><img alt="" src="https://images2.imgbox.com/46/5e/ewJj1tqh_o.png"></p> 
<p> </p> 
<p>2、对群进行设置<br> 点群右上角的设置按钮</p> 
<p><img alt="" src="https://images2.imgbox.com/ed/ca/vu7awFXf_o.png"></p> 
<p> </p> 
<p> 点击 “智能群助手”</p> 
<p><img alt="" src="https://images2.imgbox.com/5f/9f/L5nszDaB_o.png"></p> 
<p> </p> 
<p>点 “添加机器人”</p> 
<p><img alt="" src="https://images2.imgbox.com/b3/a1/KYqqXlcy_o.png"></p> 
<p> </p> 
<p>点 添加机器人 最右边的 “+”  加号 </p> 
<p><img alt="" src="https://images2.imgbox.com/e1/8d/hEkj6DVI_o.png"></p> 
<p> </p> 
<p>选最后的 自定义 通过Webhook接入自定义服务</p> 
<p> 点 添加</p> 
<p><img alt="" src="https://images2.imgbox.com/bf/d2/rQJcD5Rc_o.png"></p> 
<p> <img alt="" src="https://images2.imgbox.com/89/7d/Am3sHuAo_o.png"></p> 
<p> </p> 
<p> 输入机器人名字，安全设置里输入自定义的关键字</p> 
<p>注意注意：这个自定义关键字必须输入，而且等下在代码里发送消息时，消息的内容体里，必须包含这个关键字，否则钉钉会返回 消息发送失败</p> 
<p>点 完成</p> 
<p><img alt="" src="https://images2.imgbox.com/cc/24/cDDhirqG_o.png"></p> 
<p> </p> 
<p> 完成后，会出现下图的画面，点击 复制，把生成的 Webhook复制一下，最后点击 完成</p> 
<p><img alt="" src="https://images2.imgbox.com/91/23/8MnjiRfZ_o.png"></p> 
<p> </p> 
<p>完成后，会进入下边的页面</p> 
<p><img alt="" src="https://images2.imgbox.com/31/3a/Z3eKs1dw_o.png"></p> 
<p> </p> 
<p> 到这里，钉钉群的配置就完成了</p> 
<p>二、Java代码的编写<br> 钉钉群配置好，拿到Webhook的值后，就可以在java代码里调用钉钉的消息推送了</p> 
<p>下面贴一下代码<br>  </p> 
<pre><code class="hljs">import lombok.extern.slf4j.Slf4j;
import java.util.HashMap;
import java.util.Map;
 
/**
 * @描述 异常告警钉钉通知
 * @创建人 anan
 * @创建时间 2023/1/30 14:03
 */
@Slf4j
public class SendDDMessage {
    
    //这里就是刚才拿到的Webhook的值
    public static final String DING_DING_TOKEN =
            "https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";
 
    public static void sendDDMessage(String msg){
        //钉钉的webhook
        //请求的JSON数据，这里用map在工具类里转成json格式
        Map&lt;String,Object&gt; json=new HashMap();
        Map&lt;String,Object&gt; text=new HashMap();
        json.put("msgtype","text");
        text.put("content","项目告警通知："+msg);
        json.put("text",text);
        //发送post请求
        String response = SendHttps.sendPostByMap(DING_DING_TOKEN, json);
        log.error("项目告警发送钉钉，响应结果：{}",response);
    }
 
}</code></pre> 
<pre><code class="hljs">import com.alibaba.fastjson.JSON;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.URL;
import java.net.URLConnection;
import java.util.HashMap;
import java.util.Map;
import java.util.Map.Entry;
 
/**
 * @描述 发送http请求的工具类
 * @创建人 anan
 * @创建时间 2023/1/30 14:33
 */
 
public class SendHttps {
 
    private static Logger logger = LoggerFactory.getLogger(SendHttps.class);
 
    /**
     * 发送POST请求，参数是Map, contentType=x-www-form-urlencoded
     *
     * @param url
     * @param mapParam
     * @return
     */
    public static String sendPostByMap(String url, Map&lt;String, Object&gt; mapParam) {
        Map&lt;String, String&gt; headParam = new HashMap();
        headParam.put("Content-type", "application/json;charset=UTF-8");
        return sendPost(url, mapParam, headParam);
    }
 
    /**
     * 向指定 URL 发送POST方法的请求
     *
     * @param url   发送请求的 URL
     * @param param 请求参数，
     * @return 所代表远程资源的响应结果
     */
    public static String sendPost(String url, Map&lt;String, Object&gt; param, Map&lt;String, String&gt; headParam) {
        PrintWriter out = null;
        BufferedReader in = null;
        String result = "";
        try {
            URL realUrl = new URL(url);
            // 打开和URL之间的连接
            URLConnection conn = realUrl.openConnection();
            // 设置通用的请求属性 请求头
            conn.setRequestProperty("accept", "*/*");
            conn.setRequestProperty("connection", "Keep-Alive");
            conn.setRequestProperty("user-agent",
                    "Fiddler");
 
            if (headParam != null) {
                for (Entry&lt;String, String&gt; entry : headParam.entrySet()) {
                    conn.setRequestProperty(entry.getKey(), entry.getValue());
                }
            }
            // 发送POST请求必须设置如下两行
            conn.setDoOutput(true);
            conn.setDoInput(true);
            // 获取URLConnection对象对应的输出流
            out = new PrintWriter(conn.getOutputStream());
            // 发送请求参数
            out.print(JSON.toJSONString(param));
            // flush输出流的缓冲
            out.flush();
            // 定义BufferedReader输入流来读取URL的响应
            in = new BufferedReader(
                    new InputStreamReader(conn.getInputStream()));
            String line;
            while ((line = in.readLine()) != null) {
                result += line;
            }
        } catch (Exception e) {
            logger.info("发送 POST 请求出现异常！" + e);
            e.printStackTrace();
        }
        //使用finally块来关闭输出流、输入流
        finally {
            try {
                if (out != null) {
                    out.close();
                }
                if (in != null) {
                    in.close();
                }
            } catch (IOException ex) {
                ex.printStackTrace();
            }
        }
        return result;
    }
}</code></pre> 
<h3>三、测试发送钉钉通知</h3> 
<p>写好代码后，下面我们写一个测试类，来测试发送一下钉钉群的通知</p> 
<blockquote> 
 <pre><code class="hljs">/**
 * @描述
 * @创建人 anan
 * @创建时间 2023/1/30 14:50
 */
public class SendMessageTest {
 
    public static void main(String[] args) {
 
        SendDDMessage.sendDDMessage("测试项目告警通知！！！");
 
    }
 
}</code></pre> 
</blockquote> 
<p>点击运行后，可以看到，刚才创建的钉钉群已经收到了我们推送的测试消息</p> 
<p><img alt="" src="https://images2.imgbox.com/d4/a1/2i5e02f0_o.png"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/78a561704dfff2bf2f0d24f7bd9be4cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Git 简介</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/224ae2602cc86a151f0181f0aba1e35d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">chumpy&#43;py3 报错 numpy</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 老帅的博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>